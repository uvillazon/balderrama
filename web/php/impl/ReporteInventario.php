<?php
session_name("balderrama");
session_start();

////////////////////////////////////////////////////
function verIngresosKardexMarcaEstiloFechatallaHTMLamericano($idmarca,$idestilo,$fechain,$fechaf, $return)
{
    $html = "";
    $html .= "<tr><td colspan='4' align='center'>
    <p>Nova Moda S.RL.<br />
         <br />
         Telf. 4-258993  Fax: 4-504183
    </p>
</td></tr>";
    $html .= "<!DOCTYPE HTML PUBLIC '-//W3C//DTD HTML 4.01 Transitional//EN'>";
    $html .= "<html>";
    $html .= "<body>";
    $html .= "<tr>";
    $fechafin = $fechaf;
    $fechainic = $fechain;
    $fechaactual = Date("Y-m-d");
    $formatear1 = explode( '-' , $fechaactual);
    $fechaact = $formatear1[2].'-'.$formatear1[1].'-' .$formatear1[0];
    if($fechaf == null && $fechaf  == "")
    {        $fecha = Date("Y-m-d");
        $formatear = explode( '-' , $fecha);
        $fechaf = $formatear[2].'-'.$formatear[1].'-' .$formatear[0];
    }
    if($fechain == null && $fechain  == "")
    {
        $fechaa = Date("Y-m-d");
        $formatear = explode( '-' , $fechaa);
        $fechain = $formatear[2].'-'.$formatear[1].'-' .$formatear[0];
    }
    $html .= "<table cellpadding='1' cellspacing='0' border='0' style='width:100%' font-size:11px; font-family:Tahoma;'>";
    $html .= "<td style='width:100%;height:100%;text-align:right;font-size:12px;font-family:Tahoma;'>";
    $html .= "$fecha  $tipo";
    $html .= "</td>";
    $html .= "<tr>";
    $sql = "SELECT ma.nombre AS marca,ma.talla,ma.opcionb
FROM  `marcas` ma
WHERE ma.idmarca = '$idmarca'";

    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'marca');
    $marcalista = $idalmacenA2['resultado'];
    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'talla');
    $opcionmarca = $idalmacenA2['resultado'];
    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'opcionb');
    $opcionb = $idalmacenA2['resultado'];
    $idsCAr = split("-", $opcionmarca);
    $rango1=$idsCAr[0];
    $rango2=$idsCAr[1];
    $sql1 = "SELECT  es.nombre AS estilo
FROM  estilos es
WHERE es.idestilo = '$idestilo'";
    $idalmacenA =  findBySqlReturnCampoUnique($sql1, true, true, 'estilo');
    $estilolista = $idalmacenA['resultado'];
    //$html .= "<tr style='width:100%height:100px;text-align:center;font-size:15px;font-family:Tahoma;'>";
    $html .= "<td style='width:100%;height:100px;text-align:center;font-size:15px;font-family:Tahoma;'>";
    if($idestilo == null ||$idestilo == "null" )
    {
        $html .= "Reporte de Ingresos Marca $marcalista<br>";
        $html .= "<br>Del ".$fechainic." Al ".$fechafin."";
        //  $sqldetalle = "SELECT ".$select." FROM ".$from. " WHERE ".$where."ORDER BY ".$order;
    }else {
        $html .= "Reporte de Ingresos Marca $marcalista<br>";
        $html .= "<br>Del ".$fechainic." Al ".$fechafin."";
    }

    $html .= "</td>";
    $html .= "</tr>";
    $html .= "</table>";
    $html .= "</tr>";
    $html .= "<tr>";
    $html .= "<td colspan='3'>";
    $html .= "<table width='1250' border='0' cellspacing='0' cellpadding='0'><tr>";
    $html .= "<tr>";
    $iddet1="1";
    $iddet2="26";
    $select = "talla,idmodelo,iddetalleingresotalla,tallasm";
    $from = "tallasdetallem";
    $where = "iddetalleingresotalla >='$iddet1' AND iddetalleingresotalla <='$iddet2' ORDER BY iddetalleingresotalla ASC";
    $sql2 = "SELECT ".$select." FROM ".$from." WHERE ".$where;


    $row = NumeroTuplas($sql2);
    $row1= $row['resultado'];
    $sql21 = getTablaToArrayOfSQL($sql2);
    $sql3 = $sql21['resultado'];


    $valor= "5%";
    $anchoparest ="10%";
    $anchobst ="4%";
    $totalcalculo = "69";
    $subtotal = $totalcalculo/$row1;
    $numerocolumnas = $subtotal."%";
    $porcen1 = "33.33";
    $porcen2 = "66.67";
    $anchopares1 = ($subtotal * $porcen1)/100;
    $anchobs1 = ($subtotal * $porcen2)/100;
    $anchoparesb =$anchopares1."%";
    $anchobsb =$anchobs1."%";
    $anchopares ="1.5%";
    $anchobs ="3%";
    $anchonuevo = $anchoparesb+$anchobsb."%";
    $anchonuevo= $numerocolumnas;
    $numcolum = $row1 +1;
    $valor1= "3%";
    $valor2= "4%";
    $valor3= "4%";
    $valor4= "4%";
    $valor5= "4%";
    $valor6= "4%";
    $sql2 = "SELECT pedido,opcionb FROM marcas WHERE idmarca = '$idmarca'";
    $idalmacenA =  findBySqlReturnCampoUnique($sql2, true, true, 'pedido');
    $opcionpedido = $idalmacenA['resultado'];
    $idalmacenA =  findBySqlReturnCampoUnique($sql2, true, true, 'opcionb');
    $opcionb = $idalmacenA['resultado'];
    $html .= "<tr>";
    $html .= "<td style='width:100%;text-align:center;font-size:1px;font-family:Tahoma;'>";
    $html .= "<table cellpadding='0' cellspacing='0' border='1' style='width:100%;border:1px solid #000000;font-size:11px;text-align:center'>";
    $html .= "<td style='width:$valor1;'>Col.</td>";
    $html .= "<td style='width:$valor2;'>Modelo</td>";
    $html .= "<td style='width:$valor3;'>Detalle</td>";
    $html .= "<td style='width:$valor4;'>Precio</td>";

    $html .= "<td style='width:$valor5; font-size:11px;'>Pares</td>";
    $html .= "<td style='width:$valor6; font-size:11px;'>TotalBs</td>";

    $rangoa=$iddet1;
    $rangob=$iddet2;

    for($i=$rangoa;$i<=$rangob;$i++){
        //ojitos
        //   for($h=0;$h<$row1;$h++){
        $codigo = $sql3[$i];
        $codigovendedor = $codigo['talla'];

        if($j==$numcolum){ $j=0; }
        $html .="
           <td width='$anchonuevo'>".$codigovendedor."</td>
                   ";
        $j++;
    }



    $html .= "</tr>";
    $html .= "</table>";
    $html .= "</td></tr>";
    $select = "dtpt.iddetalleingreso,dtpt.idmodelo,dtpt.idingreso,mdd.codigo AS codigo, ad.material,ad.color, col.codigo AS coleccion";
    $from = "adicioningresotienda k, adiciondetalleingresotalla dtpt, modelos mdd, adiciondetalleingreso ad, coleccion col";
    $where = "k.idingreso = dtpt.idingreso
AND dtpt.idmodelo = mdd.idmodelo
AND mdd.idcoleccion = col.idcoleccion
AND dtpt.iddetalleingreso = ad.iddetalleingreso";
    { $where .= " AND mdd.idmarca = '$idmarca'  AND k.fecha >= '$fechain' AND
k.fecha <= '$fechaf' ";}
    if($idestilo !="null")
    {
        $where .= " AND mdd.stylename = '$idestilo'";}
    $sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where." GROUP BY dtpt.iddetalleingreso";

    //
    //$select = "dtp.iddetalleingreso,mdd.codigo AS codigo, dtp.totalpares, dtp.totalbs AS precio,dtp.material,dtp.color, col.codigo AS coleccion";
    //    $from = "adiciondetalleingreso dtp, modelos mdd, coleccion col, estilos es";
    //   $where = "dtp.idmodelo = mdd.idmodelo AND mdd.idcoleccion = col.idcoleccion AND mdd.stylename = es.idestilo AND dtp.unido='no'";
    //  { $where .= " AND mdd.idmarca = '$idmarca' AND mdd.stylename = '$idestilo'";}
    //    $sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where." ORDER BY CAST( `mdd`.`codigo` AS SIGNED) ASC";
    //    //echo $sql25;
    $row5 = NumeroTuplas($sql25);
    $row15= $row5['resultado'];
    $sql215 = getTablaToArrayOfSQL($sql25);
    $sql35 = $sql215['resultado'];

    for($i=0;$i<=$row15-1;$i++){
        //for($i=$fecha1;$i<=$fecha2;$i = date("Y-m-d", strtotime($i ."+ 1 days"))){
        $codigo = $sql35[$i];
        $iddetalleingreso = $codigo['iddetalleingreso'];
        $codigomodelo = $codigo['codigo'];
        $coleccion = $codigo['coleccion'];
        $color = $codigo['color'];
        $precio = $codigo['precio'];
        if($opcionpedido=="CODIGO"){

            $detalle = $codigo['color'];
        }
        if($opcionpedido=="CODIGO-COLOR"){
            $detalle = $codigo['color'];
        }
        if(($opcionpedido=="CODIGO-COLOR-MATERIAL")&&($opcionb=="6")){
            $detalle = $codigo['color'];

        }
        if(($opcionpedido=="CODIGO-COLOR-STYLENAME")&&($opcionb=="4")){
            $detalle = $codigo['color']."/".$codigo['material'];
            //$color = $codigo['color'];
            //".$pares1."
        }
        if(($opcionpedido=="CODIGO-MATERIAL")&&($opcionb=="7")){
            $detalle = $codigo['material'];
        }
        if($opcionpedido=="LINEA-CODIGO-COLOR"){
            $detalle = $codigo['color'];}
        if($opcionb=="3"){
            $detalle = $codigo['color'];}
        if($opcionb=="3"){
            $detalle = $codigo['color'];}


        $select = " SUM( dtpt.cantidad ) AS totalpares";
        $from = "adicioningresotienda k, adiciondetalleingresotalla dtpt, modelos mdd";
        $where = "k.idingreso = dtpt.idingreso
AND dtpt.idmodelo = mdd.idmodelo ";
        { $where .= " ANd dtpt.iddetalleingreso='$iddetalleingreso' AND k.fecha >= '$fechain' AND
k.fecha <= '$fechaf' ";}
        if($idestilo !="null")
        {
            $where .= " AND mdd.stylename = '$idestilo'";}
        $sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where."";
        // echo $sql25;
        $almacenA1 =  findBySqlReturnCampoUnique($sql25, true, true, 'totalpares');
        $totalpares = $almacenA1['resultado'];
        $select = " (sum( dtpt.cantidad ) * dtpt.precio2bs
) AS totalprecio";
        $from = "adicioningresotienda k, adiciondetalleingresotalla dtpt, modelos mdd";
        $where = "k.idingreso = dtpt.idingreso
AND dtpt.idmodelo = mdd.idmodelo ";
        { $where .= " AND dtpt.iddetalleingreso='$iddetalleingreso' AND k.fecha >= '$fechain' AND
k.fecha <= '$fechaf' ";}
        if($idestilo !="null")
        {
            $where .= " AND mdd.stylename = '$idestilo'";}
        $sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where."";
        $almacenA1 =  findBySqlReturnCampoUnique($sql25, true, true, 'totalprecio');
        $totalprecio = $almacenA1['resultado'];
        $select = " dtpt.precio2bs as precio ";
        $from = "adicioningresotienda k, adiciondetalleingresotalla dtpt, modelos mdd";
        $where = "k.idingreso = dtpt.idingreso
AND dtpt.idmodelo = mdd.idmodelo ";
        { $where .= " AND dtpt.iddetalleingreso='$iddetalleingreso' AND k.fecha >= '$fechain' AND
k.fecha <= '$fechaf' ";}
        if($idestilo !="null")
        {
            $where .= " AND mdd.stylename = '$idestilo'";}
        $sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where." group by dtpt.precio2bs";
        $almacenA1 =  findBySqlReturnCampoUnique($sql25, true, true, 'precio');
        $precio = $almacenA1['resultado'];

        $html .= "<tr>";
        $html .= "<td style='width:100%;text-align:center;font-size:12px;font-family:Tahoma;'>";
        $html .= "<table cellpadding='0' cellspacing='0' border='1' style='width:100%;border:1px solid #000000;font-size:11px;text-align:center'>";
        $html .= "<td style='width:$valor1;'>$coleccion</td>";
        $html .= "<td style='width:$valor2;'>$codigomodelo</td>";
        $html .= "<td style='width:$valor3;'>$detalle</td>";
        $html .= "<td style='width:$valor4;'>$precio</td>";
        $html .= "<td style='width:$valor5;'>$totalpares</td>";
        $html .= "<td style='width:$valor6;'>$totalprecio</td>";
        $j=0;
        for($h=0;$h<$row1;$h++){
            $codigo = $sql3[$h];
            $idmmarca = $codigo['talla'];
            if($j==$numcolum){
                $j=0;
            }
            $fecha =$i;
            $select1 = "SUM(k.cantidad) AS Pares";
            $from1 = "adiciondetalleingresotalla k,adicioningresotienda d";
            $where1 = "d.fecha >= '$fechain' AND
d.fecha <= '$fechaf'  and d.idingreso=k.idingreso AND k.iddetalleingreso = '$iddetalleingreso'AND k.tallakardex='$idmmarca' ";

            $sql21 = "SELECT ".$select1." FROM ".$from1. " WHERE ".$where1;
            //echo $sql21;
            $almacenA1 =  findBySqlReturnCampoUnique($sql21, true, true, 'Pares');
            $pares1 = $almacenA1['resultado'];

            if($pares1==NULL || $pares1 =='' || $pares1 == ""){ $pares1="0"; }
            $html .="
    <td width='$anchonuevo'>".$pares1."</td>";
            $j++;
        }


        $html .= "</tr>";
        $html .= "</table>";
        $html .= "</td></tr>";
    }
    //suma

    $html .= "<tr>";
    $html .= "<td style='width:100%;text-align:center;font-size:11px;font-family:Tahoma;'>";
    $html .= "<table cellpadding='0' cellspacing='0' border='1' style='width:100%;border:1px solid #000000;font-size:11px;text-align:center'>";
    $html .= "<td style='width:$valor1;'>Total</td>";
    $html .= "<td style='width:$valor2;'></td>";
    $html .= "<td style='width:$valor3;'></td>";
    $html .= "<td style='width:$valor4;'></td>";

    $select = "SUM( dtpt.cantidad ) AS Pares";
    $from = "adicioningresotienda k, adiciondetalleingresotalla dtpt, modelos mdd";
    $where = "k.idingreso = dtpt.idingreso AND dtpt.idmodelo = mdd.idmodelo
";
    { $where .= " AND mdd.idmarca = '$idmarca'  AND k.fecha >= '$fechain' AND
k.fecha <= '$fechaf' ";}
    if($idestilo !="null")
    //if($idestilo!=null || $idestilo!='')
    { $where .= " AND mdd.stylename = '$idestilo'";}
    $sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where;
    $almacenA1 =  findBySqlReturnCampoUnique($sql25, true, true, 'Pares');
    $totalparesactual = $almacenA1['resultado'];

    if($totalparesactual==NULL || $totalparesactual =='' || $totalparesactual == ""){ $totalparesactual="0"; }
    //          $html .= "<td style='width:$anchoparest;font-weight:bold;font-size:11px;'>20</td>";
    $html .= "<td style='width:$valor5;font-weight:bold;font-size:11px;'>$totalparesactual</td>";
    $select = "SUM( dtpt.cantidad*dtpt.precio2bs) AS totalprecio";
    $from = "adicioningresotienda k, adiciondetalleingresotalla dtpt,  modelos mdd";
    $where = "k.idingreso = dtpt.idingreso AND dtpt.idmodelo = mdd.idmodelo
";
    { $where .= " AND mdd.idmarca = '$idmarca'  AND k.fecha >= '$fechain' AND
k.fecha <= '$fechaf' ";}
    if($idestilo !="null")
    //if($idestilo!=null || $idestilo!='')
    { $where .= " AND mdd.stylename = '$idestilo'";}
    $sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where;
    $almacenA1 =  findBySqlReturnCampoUnique($sql25, true, true, 'totalprecio');
    $totalparesactualbs = $almacenA1['resultado'];

    $html .= "<td style='width:$valor5;font-weight:bold;font-size:11px;'>$totalparesactualbs</td>";
    //    s
    for($h=0;$h<$row1;$h++){
        $codigo = $sql3[$h];
        $tallasub = $codigo['talla'];
        if($j==$numcolum){ $j=0; }

        $select = "SUM(i.cantidad) AS Pares";
        $from = "adiciondetalleingresotalla i,adicionkardextienda k, adicioningresotienda vent,modelos mdt";
        $where = " k.idmodelodetalle = mdt.idmodelo AND k.talla='$tallasub' AND mdt.idmarca = '$idmarca' and vent.idingreso=k.idoperacion AND mdt.stylename = '$idestilo' AND i.idmodelo=k.idmodelodetalle AND vent.fecha >= '$fechain'AND vent.fecha <= '$fechaf'";

        // $select = "SUM(cantidad) AS Pares";
        //    $from = "historialkardextienda k,modelos mdt";
        //    $where = " k.idmodelodetalle = mdt.idmodelo AND k.talla='$tallasub' AND mdt.idmarca = '$idmarca' AND mdt.stylename = '$idestilo' ";

        $sql212 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
        //echo $sql212;
        $almacenA1 =  findBySqlReturnCampoUnique($sql212, true, true, 'Pares');
        $paresvendedor = $almacenA1['resultado'];

        if($paresvendedor==NULL || $paresvendedor =='' || $paresvendedor == ""){ $paresvendedor="0"; }

        $html .="
    <td width='$anchonuevo'>$paresvendedor</td>";
        $j++;
    }

    //sumatorias

    //    $select = "SUM(cantidad) AS vendido";
    //    $from = "itemventa";
    //    $where = "idcalzado='$iddetalleingreso' AND estado!='cambiado'";


    // $html .= "<td style='width:$anchobst;font-weight:bold;font-size:11px;'>$totalbs</td>";

    $html .= "</tr>";
    $html .= "</table>";
    $html .= "</td></tr>";

    $html .= "</tr>";
    $html .= "</table>";
    $html .= "</body>";
    $html .= "</html>";
    if($return == true)
    {
        return $html;
    }
    else
    {
        echo $html;
    }
}
function verIngresosMarcaEstiloFechatallaHTMLamericano($idmarca,$idestilo,$fechain,$fechaf, $return)
{
    $html = "";
    $html .= "<tr><td colspan='4' align='center'>
    <p>Nova Moda S.RL.<br />
         <br />
         Telf. 4-258993  Fax: 4-504183
    </p>
</td></tr>";
    $html .= "<!DOCTYPE HTML PUBLIC '-//W3C//DTD HTML 4.01 Transitional//EN'>";
    $html .= "<html>";
    $html .= "<body>";
    $html .= "<tr>";
    $fechafin = $fechaf;
    $fechainic = $fechain;
    $fechaactual = Date("Y-m-d");
    $formatear1 = explode( '-' , $fechaactual);
    $fechaact = $formatear1[2].'-'.$formatear1[1].'-' .$formatear1[0];
    if($fechaf == null && $fechaf  == "")
    {        $fecha = Date("Y-m-d");
        $formatear = explode( '-' , $fecha);
        $fechaf = $formatear[2].'-'.$formatear[1].'-' .$formatear[0];
    }
    if($fechain == null && $fechain  == "")
    {
        $fechaa = Date("Y-m-d");
        $formatear = explode( '-' , $fechaa);
        $fechain = $formatear[2].'-'.$formatear[1].'-' .$formatear[0];
    }
    $html .= "<table cellpadding='1' cellspacing='0' border='0' style='width:100%' font-size:11px; font-family:Tahoma;'>";
    $html .= "<td style='width:100%;height:100%;text-align:right;font-size:12px;font-family:Tahoma;'>";
    $html .= "$fecha  $tipo";
    $html .= "</td>";
    $html .= "<tr>";
    $sql = "SELECT ma.nombre AS marca,ma.talla,ma.opcionb
FROM  `marcas` ma
WHERE ma.idmarca = '$idmarca'";

    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'marca');
    $marcalista = $idalmacenA2['resultado'];
    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'talla');
    $opcionmarca = $idalmacenA2['resultado'];
    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'opcionb');
    $opcionb = $idalmacenA2['resultado'];
    $idsCAr = split("-", $opcionmarca);
    $rango1=$idsCAr[0];
    $rango2=$idsCAr[1];
    $sql1 = "SELECT  es.nombre AS estilo
FROM  estilos es
WHERE es.idestilo = '$idestilo'";
    $idalmacenA =  findBySqlReturnCampoUnique($sql1, true, true, 'estilo');
    $estilolista = $idalmacenA['resultado'];
    //$html .= "<tr style='width:100%height:100px;text-align:center;font-size:15px;font-family:Tahoma;'>";
    $html .= "<td style='width:100%;height:100px;text-align:center;font-size:15px;font-family:Tahoma;'>";
    if($idestilo == null ||$idestilo == "null" )
    {
        $html .= "VENTAS POR Talla $marcalista<br> Ingreso por marca";

        //  $sqldetalle = "SELECT ".$select." FROM ".$from. " WHERE ".$where."ORDER BY ".$order;
    }else {
        $html .= "VENTAS POR Talla $marcalista<br> Estilo $estilolista";
        $html .= "<br>Del ".$fechainic." Al ".$fechafin."";
    }

    $html .= "</td>";
    $html .= "</tr>";
    $html .= "</table>";
    $html .= "</tr>";
    $html .= "<tr>";
    $html .= "<td colspan='3'>";
    $html .= "<table width='1250' border='0' cellspacing='0' cellpadding='0'><tr>";
    $html .= "<tr>";
    $iddet1="1";
    $iddet2="26";
    $select = "talla,idmodelo,iddetalleingresotalla,tallasm";
    $from = "tallasdetallem";
    $where = "iddetalleingresotalla >='$iddet1' AND iddetalleingresotalla <='$iddet2' ORDER BY iddetalleingresotalla ASC";
    $sql2 = "SELECT ".$select." FROM ".$from." WHERE ".$where;


    $row = NumeroTuplas($sql2);
    $row1= $row['resultado'];
    $sql21 = getTablaToArrayOfSQL($sql2);
    $sql3 = $sql21['resultado'];


    $valor= "5%";
    $anchoparest ="10%";
    $anchobst ="4%";
    $totalcalculo = "69";
    $subtotal = $totalcalculo/$row1;
    $numerocolumnas = $subtotal."%";
    $porcen1 = "33.33";
    $porcen2 = "66.67";
    $anchopares1 = ($subtotal * $porcen1)/100;
    $anchobs1 = ($subtotal * $porcen2)/100;
    $anchoparesb =$anchopares1."%";
    $anchobsb =$anchobs1."%";
    $anchopares ="1.5%";
    $anchobs ="3%";
    $anchonuevo = $anchoparesb+$anchobsb."%";
    $anchonuevo= $numerocolumnas;
    $numcolum = $row1 +1;
    $valor1= "3%";
    $valor2= "4%";
    $valor3= "14%";
    $valor4= "4%";
    $sql2 = "SELECT pedido,opcionb FROM marcas WHERE idmarca = '$idmarca'";
    $idalmacenA =  findBySqlReturnCampoUnique($sql2, true, true, 'pedido');
    $opcionpedido = $idalmacenA['resultado'];
    $idalmacenA =  findBySqlReturnCampoUnique($sql2, true, true, 'opcionb');
    $opcionb = $idalmacenA['resultado'];
    $html .= "<tr>";
    $html .= "<td style='width:100%;text-align:center;font-size:1px;font-family:Tahoma;'>";
    $html .= "<table cellpadding='0' cellspacing='0' border='1' style='width:100%;border:1px solid #000000;font-size:11px;text-align:center'>";
    $html .= "<td style='width:$valor1;'>Col.</td>";
    $html .= "<td style='width:$valor2;'>Modelo</td>";
    $html .= "<td style='width:$valor3;'>Detalle</td>";
    $html .= "<td style='width:$valor4;'>Precio</td>";

    $rangoa=$iddet1;
    $rangob=$iddet2;

    for($i=$rangoa;$i<=$rangob;$i++){
        //ojitos
        //   for($h=0;$h<$row1;$h++){
        $codigo = $sql3[$i];
        $codigovendedor = $codigo['talla'];

        if($j==$numcolum){ $j=0; }
        $html .="
           <td width='$anchonuevo'>".$codigovendedor."</td>
                   ";
        $j++;
    }
    $html .= "<td style='width:$anchoparest; font-size:11px;'>Totales</td>";


    $html .= "</tr>";
    $html .= "</table>";
    $html .= "</td></tr>";

    $select = "dtp.iddetalleingreso,mdd.codigo AS codigo, dtp.totalpares, dtp.totalbs AS precio,dtp.material,dtp.color, col.codigo AS coleccion";
    $from = "adiciondetalleingreso dtp, modelos mdd, coleccion col, estilos es";
    $where = "dtp.idmodelo = mdd.idmodelo AND mdd.idcoleccion = col.idcoleccion AND mdd.stylename = es.idestilo AND dtp.unido='no'";
    { $where .= " AND mdd.idmarca = '$idmarca' AND mdd.stylename = '$idestilo'";}
    $sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where." ORDER BY CAST( `mdd`.`codigo` AS SIGNED) ASC";
    //echo $sql25;
    $row5 = NumeroTuplas($sql25);
    $row15= $row5['resultado'];
    $sql215 = getTablaToArrayOfSQL($sql25);
    $sql35 = $sql215['resultado'];

    for($i=0;$i<=$row15;$i++){
        //for($i=$fecha1;$i<=$fecha2;$i = date("Y-m-d", strtotime($i ."+ 1 days"))){
        $codigo = $sql35[$i];
        $iddetalleingreso = $codigo['iddetalleingreso'];
        $codigomodelo = $codigo['codigo'];
        $coleccion = $codigo['coleccion'];
        $color = $codigo['color'];
        $precio = $codigo['precio'];
        if($opcionpedido=="CODIGO"){

            $detalle = $codigo['color'];
        }
        if($opcionpedido=="CODIGO-COLOR"){
            $detalle = $codigo['color'];
        }
        if(($opcionpedido=="CODIGO-COLOR-MATERIAL")&&($opcionb=="6")){
            $detalle = $codigo['color'];

        }
        if(($opcionpedido=="CODIGO-COLOR-STYLENAME")&&($opcionb=="4")){
            $detalle = $codigo['material']."/".$codigo['color'];
            //$color = $codigo['color'];
            //".$pares1."
        }
        if(($opcionpedido=="CODIGO-MATERIAL")&&($opcionb=="7")){
            $detalle = $codigo['material'];
        }
        if($opcionpedido=="LINEA-CODIGO-COLOR"){
            $detalle = $codigo['color'];}
        if($opcionb=="3"){
            $detalle = $codigo['color'];}

        $html .= "<tr>";
        $html .= "<td style='width:100%;text-align:center;font-size:12px;font-family:Tahoma;'>";
        $html .= "<table cellpadding='0' cellspacing='0' border='1' style='width:100%;border:1px solid #000000;font-size:11px;text-align:center'>";
        $html .= "<td style='width:$valor1;'>$coleccion</td>";
        $html .= "<td style='width:$valor2;'>$codigomodelo</td>";
        $html .= "<td style='width:$valor3;'>$detalle</td>";
        $html .= "<td style='width:$valor4;'>$precio</td>";
        $j=0;
        for($h=0;$h<$row1;$h++){
            $codigo = $sql3[$h];
            $idmmarca = $codigo['talla'];
            if($j==$numcolum){
                $j=0;
            }
            $fecha =$i;

            $select1 = "SUM(i.cantidad) AS Pares";
            $from1 = "itemventa i,adicionkardextienda k, ventasdetalle vent";
            $where1 = "k.idcalzado = '$iddetalleingreso' AND i.idventa=vent.idventadetalle AND i.idkardextienda=k.idkardextienda AND
k.talla='$idmmarca' AND vent.fecha >= '$fechain'AND vent.fecha <= '$fechaf'  ";

            //if($ltienda != "Todos"){ $where .= " AND ve.idtienda = '$ltienda' ";}
            $sql21 = "SELECT ".$select1." FROM ".$from1. " WHERE ".$where1;
            //echo $sql21;
            $almacenA1 =  findBySqlReturnCampoUnique($sql21, true, true, 'Pares');
            $pares1 = $almacenA1['resultado'];
            if($pares1==NULL || $pares1 =='' || $pares1 == ""){ $pares1="0"; }
            $html .="
    <td width='$anchonuevo'>".$pares1."</td>";
            $j++;
        }
        $select = "SUM(i.cantidad) AS Pares";
        $from = "itemventa i,adicionkardextienda k, ventasdetalle vent";
        $where = " i.idcalzado='$iddetalleingreso' AND i.idkardextienda=k.idkardextienda AND i.idventa=vent.idventadetalle AND vent.fecha >= '$fechain'AND vent.fecha <= '$fechaf'";
        $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
        $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
        $pares = $almacenA1['resultado'];

        if($pares==NULL || $pares =='' || $pares == ""){ $pares="0"; }
        $html .= "<td style='width:$anchoparest;'>".$pares."</td>";

        $html .= "</tr>";
        $html .= "</table>";
        $html .= "</td></tr>";
    }


    $html .= "<tr>";
    $html .= "<td style='width:100%;text-align:center;font-size:11px;font-family:Tahoma;'>";
    $html .= "<table cellpadding='0' cellspacing='0' border='1' style='width:100%;border:1px solid #000000;font-size:11px;text-align:center'>";
    $html .= "<td style='width:$valor1;'>Total</td>";
    $html .= "<td style='width:$valor2;'></td>";
    $html .= "<td style='width:$valor3;'></td>";
    $html .= "<td style='width:$valor4;'></td>";
    //    s
    for($h=0;$h<$row1;$h++){
        $codigo = $sql3[$h];
        $tallasub = $codigo['talla'];
        if($j==$numcolum){ $j=0; }
        $select = "SUM(i.cantidad) AS Pares";
        $from = "itemventa i,adicionkardextienda k, ventasdetalle vent,modelos mdt";
        $where = " k.idmodelodetalle = mdt.idmodelo AND k.talla='$tallasub' AND mdt.idmarca = '$idmarca' AND mdt.stylename = '$idestilo' AND i.idkardextienda=k.idkardextienda AND i.idventa=vent.idventadetalle AND vent.fecha >= '$fechain'AND vent.fecha <= '$fechaf'";

        // $select = "SUM(cantidad) AS Pares";
        //    $from = "historialkardextienda k,modelos mdt";
        //    $where = " k.idmodelodetalle = mdt.idmodelo AND k.talla='$tallasub' AND mdt.idmarca = '$idmarca' AND mdt.stylename = '$idestilo' ";

        $sql212 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
        //echo $sql212;
        $almacenA1 =  findBySqlReturnCampoUnique($sql212, true, true, 'Pares');
        $paresvendedor = $almacenA1['resultado'];

        if($paresvendedor==NULL || $paresvendedor =='' || $paresvendedor == ""){ $paresvendedor="0"; }

        $html .="
    <td width='$anchonuevo'>$paresvendedor</td>";
        $j++;
    }

    //sumatorias

    //    $select = "SUM(cantidad) AS vendido";
    //    $from = "itemventa";
    //    $where = "idcalzado='$iddetalleingreso' AND estado!='cambiado'";

    if($totalparesventa==NULL || $totalparesventa =='' || $totalparesventa == ""){ $totalparesventa="0"; }
    $select = "SUM(i.cantidad) AS Pares";
    $from = "itemventa i,adicionkardextienda k, ventasdetalle vent,modelos mdt";
    $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND mdt.stylename = '$idestilo' AND i.idkardextienda=k.idkardextienda AND i.idventa=vent.idventadetalle AND vent.fecha >= '$fechain'AND vent.fecha <= '$fechaf'";

    $sql2121 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
    $almacenA1 =  findBySqlReturnCampoUnique($sql2121, true, true, 'Pares');
    $totalparesactual = $almacenA1['resultado'];
    if($totalparesactual==NULL || $totalparesactual =='' || $totalparesactual == ""){ $totalparesactual="0"; }
    $html .= "<td style='width:$anchoparest;font-weight:bold;font-size:11px;'>$totalparesactual</td>";

    // $html .= "<td style='width:$anchobst;font-weight:bold;font-size:11px;'>$totalbs</td>";

    $html .= "</tr>";
    $html .= "</table>";
    $html .= "</td></tr>";

    $html .= "</tr>";
    $html .= "</table>";
    $html .= "</body>";
    $html .= "</html>";
    if($return == true)
    {
        return $html;
    }
    else
    {
        echo $html;
    }
}
function verIngresosMarcaEstiloFechatallaHTML($idmarca,$idestilo,$fechain,$fechaf, $return)
{
    $html = "";
    $html .= "<tr><td colspan='4' align='center'>
    <p>Nova Moda S.RL.<br />
         <br />
         Telf. 4-258993  Fax: 4-504183
    </p>
</td></tr>";
    $html .= "<!DOCTYPE HTML PUBLIC '-//W3C//DTD HTML 4.01 Transitional//EN'>";
    $html .= "<html>";
    $html .= "<body>";
    $html .= "<tr>";
    $fechafin = $fechaf;
    $fechainic = $fechain;
    $fechaactual = Date("Y-m-d");
    $formatear1 = explode( '-' , $fechaactual);
    $fechaact = $formatear1[2].'-'.$formatear1[1].'-' .$formatear1[0];
    if($fechaf == null && $fechaf  == "")
    {        $fecha = Date("Y-m-d");
        $formatear = explode( '-' , $fecha);
        $fechaf = $formatear[2].'-'.$formatear[1].'-' .$formatear[0];
    }
    if($fechain == null && $fechain  == "")
    {
        $fechaa = Date("Y-m-d");
        $formatear = explode( '-' , $fechaa);
        $fechain = $formatear[2].'-'.$formatear[1].'-' .$formatear[0];
    }
    $html .= "<table cellpadding='1' cellspacing='0' border='0' style='width:100%' font-size:11px; font-family:Tahoma;'>";
    $html .= "<td style='width:100%;height:100%;text-align:right;font-size:12px;font-family:Tahoma;'>";
    $html .= "$fecha  $tipo";
    $html .= "</td>";
    $html .= "<tr>";
    $sql = "SELECT ma.nombre AS marca,ma.talla,ma.opcionb
FROM  `marcas` ma
WHERE ma.idmarca = '$idmarca'";

    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'marca');
    $marcalista = $idalmacenA2['resultado'];
    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'talla');
    $opcionmarca = $idalmacenA2['resultado'];
    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'opcionb');
    $opcionb = $idalmacenA2['resultado'];
    $idsCAr = split("-", $opcionmarca);
    $rango1=$idsCAr[0];
    $rango2=$idsCAr[1];

    $sql1 = "SELECT  es.nombre AS estilo
FROM  estilos es
WHERE es.idestilo = '$idestilo'";
    $idalmacenA =  findBySqlReturnCampoUnique($sql1, true, true, 'estilo');
    $estilolista = $idalmacenA['resultado'];
    //$html .= "<tr style='width:100%height:100px;text-align:center;font-size:15px;font-family:Tahoma;'>";
    $html .= "<td style='width:100%;height:100px;text-align:center;font-size:15px;font-family:Tahoma;'>";
    if($idestilo == null ||$idestilo == "null" )
    {
        $html .= "VENTAS POR Talla $marcalista<br> Ingreso por marca";

        //  $sqldetalle = "SELECT ".$select." FROM ".$from. " WHERE ".$where."ORDER BY ".$order;
    }else {
        $html .= "VENTAS POR Talla $marcalista<br> Estilo $estilolista";
        $html .= "<br>Del ".$fechainic." Al ".$fechafin."";
    }

    $html .= "</td>";
    $html .= "</tr>";
    $html .= "</table>";
    $html .= "</tr>";
    $html .= "<tr>";
    $html .= "<td colspan='3'>";
    $html .= "<table width='1250' border='0' cellspacing='0' cellpadding='0'><tr>";
    $html .= "<tr>";
    $select = "talla,idmodelo";
    $from = "tallasdetalle";
    $where = "talla >='$rango1' AND talla <='$rango2' AND idmodelo='2' ORDER BY talla ASC";
    $sql2 = "SELECT ".$select." FROM ".$from." WHERE ".$where;

    $row = NumeroTuplas($sql2);
    $row1= $row['resultado'];
    $sql21 = getTablaToArrayOfSQL($sql2);
    $sql3 = $sql21['resultado'];


    $valor= "5%";
    $anchoparest ="10%";
    $anchobst ="4%";
    $totalcalculo = "69";
    $subtotal = $totalcalculo/$row1;
    $numerocolumnas = $subtotal."%";
    $porcen1 = "33.33";
    $porcen2 = "66.67";
    $anchopares1 = ($subtotal * $porcen1)/100;
    $anchobs1 = ($subtotal * $porcen2)/100;
    $anchoparesb =$anchopares1."%";
    $anchobsb =$anchobs1."%";
    $anchopares ="1.5%";
    $anchobs ="3%";
    $anchonuevo = $anchoparesb+$anchobsb."%";
    $anchonuevo= $numerocolumnas;
    $numcolum = $row1 +1;
    $valor1= "3%";
    $valor2= "4%";
    $valor3= "14%";
    $valor4= "4%";
    $sql2 = "SELECT pedido,opcionb FROM marcas WHERE idmarca = '$idmarca'";
    $idalmacenA =  findBySqlReturnCampoUnique($sql2, true, true, 'pedido');
    $opcionpedido = $idalmacenA['resultado'];
    $idalmacenA =  findBySqlReturnCampoUnique($sql2, true, true, 'opcionb');
    $opcionb = $idalmacenA['resultado'];
    $html .= "<tr>";
    $html .= "<td style='width:100%;text-align:center;font-size:1px;font-family:Tahoma;'>";
    $html .= "<table cellpadding='0' cellspacing='0' border='1' style='width:100%;border:1px solid #000000;font-size:11px;text-align:center'>";
    $html .= "<td style='width:$valor1;'>Col.</td>";
    $html .= "<td style='width:$valor2;'>Modelo</td>";
    $html .= "<td style='width:$valor3;'>Detalle</td>";
    $html .= "<td style='width:$valor4;'>Precio</td>";
    $html .= "<td style='width:$anchoparest; font-size:11px;'>Totales</td>";

    $rangoa=$rango1;
    $rangob=$rango2;

    for($i=$rangoa;$i<=$rangob;$i++){

        //   for($h=0;$h<$row1;$h++){
        $codigo = $sql3[$i];

        $codigovendedor =$i;

        if($j==$numcolum){ $j=0; }
        $html .="
           <td width='$anchonuevo'>".$codigovendedor."</td>
                   ";
        $j++;
    }



    $html .= "</tr>";
    $html .= "</table>";
    $html .= "</td></tr>";

    $select = "dtp.iddetalleingreso,mdd.codigo AS codigo, dtp.totalpares, dtp.totalbs AS precio,dtp.material,dtp.color, col.codigo AS coleccion";
    $from = "adiciondetalleingreso dtp, modelos mdd, coleccion col, estilos es";
    $where = "dtp.idmodelo = mdd.idmodelo AND mdd.idcoleccion = col.idcoleccion AND mdd.stylename = es.idestilo AND dtp.unido='no'";
    { $where .= " AND mdd.idmarca = '$idmarca' AND mdd.stylename = '$idestilo'";}
    $sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where." ORDER BY CAST( `mdd`.`codigo` AS SIGNED) ASC";
    //echo $sql25;
    $row5 = NumeroTuplas($sql25);
    $row15= $row5['resultado'];
    $sql215 = getTablaToArrayOfSQL($sql25);
    $sql35 = $sql215['resultado'];

    for($i=0;$i<=$row15;$i++){
        //for($i=$fecha1;$i<=$fecha2;$i = date("Y-m-d", strtotime($i ."+ 1 days"))){
        $codigo = $sql35[$i];
        $iddetalleingreso = $codigo['iddetalleingreso'];
        $codigomodelo = $codigo['codigo'];
        $coleccion = $codigo['coleccion'];
        $color = $codigo['color'];
        $precio = $codigo['precio'];
        if($opcionpedido=="CODIGO"){

            $detalle = $codigo['color'];
        }
        if($opcionpedido=="CODIGO-COLOR"){
            $detalle = $codigo['color'];
        }
        if(($opcionpedido=="CODIGO-COLOR-MATERIAL")&&($opcionb=="6")){
            $detalle = $codigo['color'];

        }
        if(($opcionpedido=="CODIGO-COLOR-STYLENAME")&&($opcionb=="4")){
            $detalle = $codigo['material']."/".$codigo['color'];
            //$color = $codigo['color'];
            //".$pares1."
        }
        if(($opcionpedido=="CODIGO-MATERIAL")&&($opcionb=="7")){
            $detalle = $codigo['material'];
        }
        if($opcionpedido=="LINEA-CODIGO-COLOR"){
            $detalle = $codigo['color'];}
        if($opcionb=="3"){
            $detalle = $codigo['color'];}

        $html .= "<tr>";
        $html .= "<td style='width:100%;text-align:center;font-size:12px;font-family:Tahoma;'>";
        $html .= "<table cellpadding='0' cellspacing='0' border='1' style='width:100%;border:1px solid #000000;font-size:11px;text-align:center'>";
        $html .= "<td style='width:$valor1;'>$coleccion</td>";
        $html .= "<td style='width:$valor2;'>$codigomodelo</td>";
        $html .= "<td style='width:$valor3;'>$detalle</td>";
        $html .= "<td style='width:$valor4;'>$precio</td>";
        $j=0;
        $select = "SUM(i.cantidad) AS Pares";
        $from = "itemventa i,adicionkardextienda k, ventasdetalle vent";
        $where = " i.idcalzado='$iddetalleingreso' AND i.idkardextienda=k.idkardextienda AND i.idventa=vent.idventadetalle AND vent.fecha >= '$fechain' AND vent.fecha <= '$fechaf' and i.estado!='cambiado'";
        $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
        $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
        $pares = $almacenA1['resultado'];
        if($pares==NULL || $pares =='' || $pares == ""){ $pares="0"; }
        $html .= "<td style='width:$anchoparest;'>".$pares."</td>";

        for($h=0;$h<$row1;$h++){
            $codigo = $sql3[$h];
            $idmmarca = $codigo['talla'];
            if($j==$numcolum){
                $j=0;
            }
            $fecha =$i;

            $select1 = "SUM(i.cantidad) AS Pares";
            $from1 = "itemventa i,adicionkardextienda k, ventasdetalle vent";
            $where1 = "k.idcalzado = '$iddetalleingreso' AND i.idventa=vent.idventadetalle AND i.idkardextienda=k.idkardextienda AND
k.talla='$idmmarca' AND vent.fecha >= '$fechain'AND vent.fecha <= '$fechaf' and i.estado!='cambiado' ";
            //if($ltienda != "Todos"){ $where .= " AND ve.idtienda = '$ltienda' ";}
            $sql21 = "SELECT ".$select1." FROM ".$from1. " WHERE ".$where1;
            //echo $sql21;
            $almacenA1 =  findBySqlReturnCampoUnique($sql21, true, true, 'Pares');
            $pares1 = $almacenA1['resultado'];
            if($pares1==NULL || $pares1 =='' || $pares1 == ""){ $pares1="0"; }
            $html .="
    <td width='$anchonuevo'>".$pares1."</td>";
            $j++;
        }

        $html .= "</tr>";
        $html .= "</table>";
        $html .= "</td></tr>";
    }


    $html .= "<tr>";
    $html .= "<td style='width:100%;text-align:center;font-size:11px;font-family:Tahoma;'>";
    $html .= "<table cellpadding='0' cellspacing='0' border='1' style='width:100%;border:1px solid #000000;font-size:11px;text-align:center'>";
    $html .= "<td style='width:$valor1;'>Total</td>";
    $html .= "<td style='width:$valor2;'></td>";
    $html .= "<td style='width:$valor3;'></td>";
    $html .= "<td style='width:$valor4;'></td>";
    //    s
    $select = "SUM(i.cantidad) AS Pares";
    $from = "itemventa i,adicionkardextienda k, ventasdetalle vent,modelos mdt";
    $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND mdt.stylename = '$idestilo' AND i.idkardextienda=k.idkardextienda AND i.idventa=vent.idventadetalle AND vent.fecha >= '$fechain'AND vent.fecha <= '$fechaf' and i.estado!='cambiado'";

    $sql2121 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
    $almacenA1 =  findBySqlReturnCampoUnique($sql2121, true, true, 'Pares');
    $totalparesactual = $almacenA1['resultado'];
    if($totalparesactual==NULL || $totalparesactual =='' || $totalparesactual == ""){ $totalparesactual="0"; }
    $html .= "<td style='width:$anchoparest;font-weight:bold;font-size:11px;'>$totalparesactual</td>";

    for($h=0;$h<$row1;$h++){
        $codigo = $sql3[$h];
        $tallasub = $codigo['talla'];
        if($j==$numcolum){ $j=0; }
        $select = "SUM(i.cantidad) AS Pares";
        $from = "itemventa i,adicionkardextienda k, ventasdetalle vent,modelos mdt";
        $where = " k.idmodelodetalle = mdt.idmodelo AND k.talla='$tallasub' AND mdt.idmarca = '$idmarca' AND mdt.stylename = '$idestilo' AND i.idkardextienda=k.idkardextienda AND i.idventa=vent.idventadetalle AND vent.fecha >= '$fechain'AND vent.fecha <= '$fechaf' and i.estado!='cambiado'";

        // $select = "SUM(cantidad) AS Pares";
        //    $from = "historialkardextienda k,modelos mdt";
        //    $where = " k.idmodelodetalle = mdt.idmodelo AND k.talla='$tallasub' AND mdt.idmarca = '$idmarca' AND mdt.stylename = '$idestilo' ";

        $sql212 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
        //echo $sql212;
        $almacenA1 =  findBySqlReturnCampoUnique($sql212, true, true, 'Pares');
        $paresvendedor = $almacenA1['resultado'];

        if($paresvendedor==NULL || $paresvendedor =='' || $paresvendedor == ""){ $paresvendedor="0"; }

        $html .="
    <td width='$anchonuevo'>$paresvendedor</td>";
        $j++;
    }

    //sumatorias

    //    $select = "SUM(cantidad) AS vendido";
    //    $from = "itemventa";
    //    $where = "idcalzado='$iddetalleingreso' AND estado!='cambiado'";

    if($totalparesventa==NULL || $totalparesventa =='' || $totalparesventa == ""){ $totalparesventa="0"; }

    // $html .= "<td style='width:$anchobst;font-weight:bold;font-size:11px;'>$totalbs</td>";

    $html .= "</tr>";
    $html .= "</table>";
    $html .= "</td></tr>";

    $html .= "</tr>";
    $html .= "</table>";
    $html .= "</body>";
    $html .= "</html>";
    if($return == true)
    {
        return $html;
    }
    else
    {
        echo $html;
    }
}

function verIngresosKardexMarcaEstiloFechatallaHTML($idmarca,$idestilo,$fechain,$fechaf, $return)
{
    $fechaactual = Date("Y-m-d");
    $formatear1 = explode( '-' , $fechaactual);
    $fechaact = $formatear1[2].'-'.$formatear1[1].'-' .$formatear1[0];
    $fecha = Date("Y-m-d");
    $formatear = explode( '-' , $fechaf);
    $fechafin = $formatear[2].'-'.$formatear[1].'-' .$formatear[0];
    $fechaa = Date("Y-m-d");
    $formatear = explode( '-' , $fechain);
    $fechainic = $formatear[2].'-'.$formatear[1].'-' .$formatear[0];
    $html = "";
    $html .= "<tr><td colspan='4' align='center'>
    <p>Nova Moda S.RL.<br />
         <br />
         Telf. 4-258993  Fax: 4-504183
    </p>
</td></tr>";

    $html .= "<!DOCTYPE HTML PUBLIC '-//W3C//DTD HTML 4.01 Transitional//EN'>";
    $html .= "<html>";
    $html .= "<body>";
    $html .= "<tr>";
    $formatear = explode( '-' , $fecha);
    $fecha = $formatear[2].'-'.$formatear[1].'-' .$formatear[0];

    $html .= "<table cellpadding='1' cellspacing='0' border='0' style='width:100%' font-size:11px; font-family:Tahoma;'>";
    $html .= "<td style='width:100%;height:100%;text-align:right;font-size:12px;font-family:Tahoma;'>";
    $html .= "$fecha  $tipo";
    $html .= "</td>";
    $html .= "<tr>";

    $html .= "<td style='width:100%;height:100px;text-align:center;font-size:15px;font-family:Tahoma;'>";


    $sql = "SELECT ma.nombre AS marca
FROM  `marcas` ma
WHERE ma.idmarca = '$idmarca'";

    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'marca');
    $marcalista = $idalmacenA2['resultado'];
    $sql1 = "SELECT  es.nombre AS estilo
FROM  estilos es
WHERE es.idestilo = '$idestilo'";
    $idalmacenA =  findBySqlReturnCampoUnique($sql1, true, true, 'estilo');
    $estilolista = $idalmacenA['resultado'];
    if($idestilo == null ||$idestilo == "null" )
    {
        $html .= "Reporte de Ingresos $marcalista<br> ";
        $html .= "<br>Del ".$fechainic." Al ".$fechafin."";

        //  $sqldetalle = "SELECT ".$select." FROM ".$from. " WHERE ".$where."ORDER BY ".$order;
    }else {
        $html .= "Ingresos $marcalista<br> Estilo $estilolista";
        $html .= "<br>Del ".$fechainic." Al ".$fechafin."";

    }
    $html .= "</td>";
    $html .= "</tr>";
    $html .= "</table>";
    $html .= "</tr>";
    $html .= "<tr>";
    $html .= "<td colspan='3'>";

    $html .= "<table width='1250' border='0' cellspacing='0' cellpadding='0'><tr>";
    //$sql2 = "SELECT ma.idmarca,ma.nombre
    //FROM  `marcas` ma
    //group by ma.idmarca";
    $sql2 = "SELECT ma.idmarca,ma.nombre
FROM  `marcas` ma,adicioningresotienda c
WHERE c.idmarca=ma.idmarca AND c.fecha >= '$fechain' AND c.fecha <= '$fechaf' group by ma.idmarca";

    $row = NumeroTuplas($sql2);
    $row1= $row['resultado'];
    $sql21 = getTablaToArrayOfSQL($sql2);
    $sql3 = $sql21['resultado'];
    $row5 = NumeroTuplas($sql2);
    $row15= $row5['resultado'];
    //    $html .= "<td style='width:100%;text-align:center;font-size:1px;font-family:Tahoma;'>";
    $html .= "<tr>";
    $html .= "<td style='width:33%;text-align:right;font-size:15px;font-family:Tahoma;'>";
    $sqlCar = "SELECT fecha,hora,ma.nombre as marca,cantidadpares,montoanterior,montonuevo,diferencia
FROM cambioprecio c,marcas ma WHERE c.idmarca=ma.idmarca AND c.fecha >= '$fechain' AND c.fecha <= '$fechaf' ";
    // $carac = dibujarTablaOfSQLNormalingresos($sqlCar, "Totales" ,$fechain,$fechaf);

    //$html .= $carac['resultado'];
    $html .= "</td>";
    $html .= "</tr>";
    $html .= "<table cellpadding='0' cellspacing='0' border='0' style='width:100%;border:0px solid #000000;font-size:11px;text-align:center'>";

    $html .= "<tr>";
    $sql = "SELECT ma.nombre AS marca,ma.talla,ma.opcionb,ma.pedido
FROM  `marcas` ma
WHERE ma.idmarca = 'mar-1'";
    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'marca');
    $marcalista = $idalmacenA2['resultado'];
    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'talla');
    $opcionmarca = $idalmacenA2['resultado'];

    $idsCAr = split("-", $opcionmarca);
    $rango1=$idsCAr[0];
    $rango2=$idsCAr[1];
    if($opcionmarca="33-45"){
        $tipo="1";
    }else{
        if($opcionmarca="14-38"){
            $tipo="3";
        }
    }


    for($i=0;$i<=$row15;$i++){
        $codigo = $sql3[$i];
        $idmarca = $codigo['idmarca'];
        $nombremarca = $codigo['nombre'];
        $html .= "<tr style='width:100%; font-size:11px;'>";
        $html .=" <td style='font-size:11px;text-align:left'>".$nombremarca."";
        $html .=" </td> ";
        $html .= "</tr>";
        $html .= "<tr>";


        $select = "dtpt.iddetalleingreso";
        $from = "adicioningresotienda k, adiciondetalleingresotalla dtpt, modelos mdd, adiciondetalleingreso ad, coleccion col";
        $where = "k.idingreso = dtpt.idingreso
AND dtpt.idmodelo = mdd.idmodelo
AND mdd.idcoleccion = col.idcoleccion
AND dtpt.iddetalleingreso = ad.iddetalleingreso";
        { $where .= " AND mdd.idmarca = '$idmarca'  AND k.fecha >= '$fechain' AND
k.fecha <= '$fechaf' ";}
        if($idestilo !="null")
        {
            $where .= " AND mdd.stylename = '$idestilo'";}
        $sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where." GROUP BY dtpt.iddetalleingreso";
        $sql = "SELECT ma.opcionb
    FROM  `marcas` ma
    WHERE ma.idmarca = '$idmarca'";
        $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'opcionb');
        $opcionb = $idalmacenA2['resultado'];
        if($opcionb=="4"||$opcionb=="14"||$opcionb=="15"){
            $iddet1="1";
            $iddet2="26";
            $select = "talla,idmodelo,iddetalleingresotalla,tallasm";
            $from = "tallasdetallem";
            $where = "iddetalleingresotalla >='$iddet1' AND iddetalleingresotalla <='$iddet2' ORDER BY iddetalleingresotalla ASC";
            $sql212 = "SELECT ".$select." FROM ".$from." WHERE ".$where;
            $row = NumeroTuplas($sql212);
            $row12= $row['resultado'];
        }else{
            $select1 = "talla,idmodelo";
            $from1 = "tallasdetalle";
            $where1 = "talla >='$rango1' AND talla <='$rango2' AND idmodelo='2' ORDER BY talla ASC";
            $sql212 = "SELECT ".$select1." FROM ".$from1." WHERE ".$where1;
            $row13 = NumeroTuplas($sql212);
            $row12= $row13['resultado'];
        }
        $table = dibujarTablaofrebajasporingresos($sql25,$sql212,$row12,$idmarca,$idestilo,$fechain,$fechaf,$totalparesestilo,$totalbsestilo);

        $html .= $table['resultado'];
        $html .= "</tr>";
        //       ss
    }
    //totales de totales
    $html .= "</tr>";
    $html .= "</table>";


    $html .= "</body>";
    $html .= "</html>";
    if($return == true)
    {
        return $html;
    }
    else
    {
        echo $html;
    }
}
function verIngresosKardexMarcaEstiloFechatallaHTMLpormarca($idmarca,$idestilo,$fechain,$fechaf, $return)
{
    $fechaactual = Date("Y-m-d");
    $formatear1 = explode( '-' , $fechaactual);
    $fechaact = $formatear1[2].'-'.$formatear1[1].'-' .$formatear1[0];
    $fecha = Date("Y-m-d");
    $formatear = explode( '-' , $fechaf);
    $fechafin = $formatear[2].'-'.$formatear[1].'-' .$formatear[0];
    $fechaa = Date("Y-m-d");
    $formatear = explode( '-' , $fechain);
    $fechainic = $formatear[2].'-'.$formatear[1].'-' .$formatear[0];
    $html = "";
    $html .= "<tr><td colspan='4' align='center'>
    <p>Nova Moda S.RL.<br />
         <br />
         Telf. 4-258993  Fax: 4-504183
    </p>
</td></tr>";

    $html .= "<!DOCTYPE HTML PUBLIC '-//W3C//DTD HTML 4.01 Transitional//EN'>";
    $html .= "<html>";
    $html .= "<body>";
    $html .= "<tr>";
    $formatear = explode( '-' , $fecha);
    $fecha = $formatear[2].'-'.$formatear[1].'-' .$formatear[0];

    $html .= "<table cellpadding='1' cellspacing='0' border='0' style='width:100%' font-size:11px; font-family:Tahoma;'>";
    $html .= "<td style='width:100%;height:100%;text-align:right;font-size:12px;font-family:Tahoma;'>";
    $html .= "$fecha  $tipo";
    $html .= "</td>";
    $html .= "<tr>";

    $html .= "<td style='width:100%;height:100px;text-align:center;font-size:15px;font-family:Tahoma;'>";


    $sql = "SELECT ma.nombre AS marca
FROM  `marcas` ma
WHERE ma.idmarca = '$idmarca'";

    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'marca');
    $marcalista = $idalmacenA2['resultado'];
    $sql1 = "SELECT  es.nombre AS estilo
FROM  estilos es
WHERE es.idestilo = '$idestilo'";
    $idalmacenA =  findBySqlReturnCampoUnique($sql1, true, true, 'estilo');
    $estilolista = $idalmacenA['resultado'];
    if($idestilo == null ||$idestilo == "null" )
    {
        $html .= "Reporte de Ingresos $marcalista<br> ";
        $html .= "<br>Del ".$fechainic." Al ".$fechafin."";

        //  $sqldetalle = "SELECT ".$select." FROM ".$from. " WHERE ".$where."ORDER BY ".$order;
    }else {
        $html .= "Ingresos $marcalista<br> Estilo $estilolista";
        $html .= "<br>Del ".$fechainic." Al ".$fechafin."";

    }
    $html .= "</td>";
    $html .= "</tr>";
    $html .= "</table>";
    $html .= "</tr>";
    $html .= "<tr>";
    $html .= "<td colspan='3'>";

    $html .= "<table width='1250' border='0' cellspacing='0' cellpadding='0'><tr>";
    //$sql2 = "SELECT ma.idmarca,ma.nombre
    //FROM  `marcas` ma
    //group by ma.idmarca";
    $sql2 = "SELECT ma.idmarca,ma.nombre
FROM  `marcas` ma,adicioningresotienda c
WHERE c.idmarca=ma.idmarca AND c.fecha >= '$fechain' AND c.fecha <= '$fechaf' group by ma.idmarca";

    $row = NumeroTuplas($sql2);
    $row1= $row['resultado'];
    $sql21 = getTablaToArrayOfSQL($sql2);
    $sql3 = $sql21['resultado'];
    $row5 = NumeroTuplas($sql2);
    $row15= $row5['resultado'];
    //    $html .= "<td style='width:100%;text-align:center;font-size:1px;font-family:Tahoma;'>";
    $html .= "<tr>";
    $html .= "<td style='width:33%;text-align:right;font-size:15px;font-family:Tahoma;'>";
    $sqlCar = "SELECT fecha,hora,ma.nombre as marca,cantidadpares,montoanterior,montonuevo,diferencia
FROM cambioprecio c,marcas ma WHERE c.idmarca=ma.idmarca AND c.fecha >= '$fechain' AND c.fecha <= '$fechaf' ";
    $html .= "</td>";
    $html .= "</tr>";
    $html .= "<table cellpadding='0' cellspacing='0' border='0' style='width:100%;border:0px solid #000000;font-size:11px;text-align:center'>";

    $html .= "<tr>";

    $sql = "SELECT ma.nombre AS marca,ma.talla,ma.opcionb,ma.pedido
FROM  `marcas` ma
WHERE ma.idmarca = '$idmarca'";
    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'marca');
    $marcalista = $idalmacenA2['resultado'];
    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'talla');
    $opcionmarca = $idalmacenA2['resultado'];

    $idsCAr = split("-", $opcionmarca);
    $rango1=$idsCAr[0];
    $rango2=$idsCAr[1];
    if($opcionmarca="33-45"){
        $tipo="1";
    }else{
        if($opcionmarca="14-38"){
            $tipo="3";
        }
    }
    $sql = "SELECT ma.opcionb
    FROM  `marcas` ma
    WHERE ma.idmarca = '$idmarca'";
    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'opcionb');
    $opcionb = $idalmacenA2['resultado'];
    if($opcionb=="4"||$opcionb=="14"||$opcionb=="15"){
        $iddet1="1";
        $iddet2="26";
        $select = "talla,idmodelo,iddetalleingresotalla,tallasm";
        $from = "tallasdetallem";
        $where = "iddetalleingresotalla >='$iddet1' AND iddetalleingresotalla <='$iddet2' ORDER BY iddetalleingresotalla ASC";
        $sql212 = "SELECT ".$select." FROM ".$from." WHERE ".$where;
        $row = NumeroTuplas($sql212);
        $row12= $row['resultado'];
    }else{
        $select1 = "talla,idmodelo";
        $from1 = "tallasdetalle";
        $where1 = "talla >='$rango1' AND talla <='$rango2' AND idmodelo='2' ORDER BY talla ASC";
        $sql212 = "SELECT ".$select1." FROM ".$from1." WHERE ".$where1;
        $row13 = NumeroTuplas($sql212);
        $row12= $row13['resultado'];
    }

    //for($i=0;$i<=$row15;$i++){
    $codigo = $sql3[$i];
    //$idmarca = $codigo['idmarca'];
    //  $nombremarca = $codigo['nombre'];
    $html .= "<tr style='width:100%; font-size:11px;'>";
    $html .=" <td style='font-size:11px;text-align:left'>".$nombremarca."";
    $html .=" </td> ";
    $html .= "</tr>";
    $html .= "<tr>";


    $select = "dtpt.iddetalleingreso";
    $from = "adicioningresotienda k, adiciondetalleingresotalla dtpt, modelos mdd, adiciondetalleingreso ad, coleccion col";
    $where = "k.idingreso = dtpt.idingreso
AND dtpt.idmodelo = mdd.idmodelo
AND mdd.idcoleccion = col.idcoleccion
AND dtpt.iddetalleingreso = ad.iddetalleingreso";
    { $where .= " AND mdd.idmarca = '$idmarca'  AND k.fecha >= '$fechain' AND
k.fecha <= '$fechaf' ";}
    if($idestilo !="null")
    {
        $where .= " AND mdd.stylename = '$idestilo'";}
    $sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where." GROUP BY dtpt.iddetalleingreso";

    $table = dibujarTablaofrebajasporingresos($sql25,$sql212,$row12,$idmarca,$idestilo,$fechain,$fechaf,$totalparesestilo,$totalbsestilo);

    $html .= $table['resultado'];
    $html .= "</tr>";
    // }
    //totales de totales
    $html .= "</tr>";
    $html .= "</table>";


    $html .= "</body>";
    $html .= "</html>";
    if($return == true)
    {
        return $html;
    }
    else
    {
        echo $html;
    }
}

function dibujarTablaofrebajasporingresos($sql,$sql21,$row1,$idmarca,$idestilo,$fechainicio,$fechafin,$total1,$total2)
{
    $sql211 = getTablaToArrayOfSQL($sql21);
    $sql3 = $sql211['resultado'];

    if($link=new BD)
    {
        if($link->conectar())
        {
            if($re = $link->consulta($sql))
            {
                //echo mysql_num_rows($re);
                if($fi = mysql_fetch_array($re))
                {
                    $select = "c.fecha,mar.nombre AS marca,es.nombre as estilo ,mo.codigo,CONCAT( ad.color, '-', ad.material ) AS detalle,dtp.cantidadpares,dtp.precioanterior,dtp.precionuevo,dtp.diferencia";

                    $devS .= "<table cellpadding='0' cellspacing='0' border='0' style='width:750px;border:1px solid #000000;font-size:11px;'>";
                    $devS .= "<tr><td style='border-bottom:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Nro</td>";
                    $devS .= "<td style='display:none;'>".mysql_field_name($re, $zz)."</td>";
                    // $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Modelo</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Modelo</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Detalle</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Precio</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Pares</td>";

                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Total Bs</td>";

                    for($hi=0;$hi<$row1;$hi++){
                        $codigo = $sql3[$hi];
                        $idmmarca = $codigo['talla'];
                        $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>$idmmarca</td>";
                        $ji++;
                    }

                    $devS .= "</tr>";
                    $ii = 0;
                    //$totalCount = mysql_num_rows($re);
                    $z = 1;
                    do{
                        $devS .= "<tr><td style='text-align:left'>".$z."</td>";
                        for($i = 0; $i< mysql_num_fields($re); $i++)
                        {$dato = $fi[$i];
                            $iddetalleingreso = $fi[$i]['iddetalleingreso'];
                            $devS .= "<td style='display:none;'>&nbsp;".$dato."&nbsp;</td>";
                            // echo $marcapedido;

                            $select = "dtpt.iddetalleingreso,dtpt.idingreso,dtpt.precio2bs,mdd.codigo AS codigo, SUM( dtpt.cantidad ) AS totalpares, ad.material,ad.color, col.codigo AS coleccion";
                            $from = "adicioningresotienda k, adiciondetalleingresotalla dtpt, modelos mdd, adiciondetalleingreso ad, coleccion col";
                            $where = "k.idingreso = dtpt.idingreso
AND dtpt.idmodelo = mdd.idmodelo
AND mdd.idcoleccion = col.idcoleccion
AND dtpt.iddetalleingreso = ad.iddetalleingreso";
                            { $where .= " AND mdd.idmarca = '$idmarca'  AND k.fecha >= '$fechainicio' AND
k.fecha <= '$fechafin' AND dtpt.iddetalleingreso='$dato' GROUP BY dtpt.iddetalleingreso";}
                            // if($idestilo!=null || $idestilo!='' || $idestilo !="null")
                            if($idestilo !="null")
                            {   $where .= " AND mdd.stylename = '$idestilo'";}
                            $sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where." ";
                            $almacenA1 =  findBySqlReturnCampoUnique($sql25, true, true, 'codigo');
                            $modelo = $almacenA1['resultado'];
                            $almacenA1 =  findBySqlReturnCampoUnique($sql25, true, true, 'precio2bs');
                            $precio = $almacenA1['resultado'];
                            $almacenA1 =  findBySqlReturnCampoUnique($sql25, true, true, 'material');
                            $material = $almacenA1['resultado'];
                            $almacenA1 =  findBySqlReturnCampoUnique($sql25, true, true, 'color');
                            $color = $almacenA1['resultado'];


                            $sql2 = "SELECT pedido,opcionb FROM marcas WHERE idmarca = '$idmarca'";
                            $idalmacenA =  findBySqlReturnCampoUnique($sql2, true, true, 'pedido');
                            $opcionpedido = $idalmacenA['resultado'];
                            $idalmacenA =  findBySqlReturnCampoUnique($sql2, true, true, 'opcionb');
                            $opcionb = $idalmacenA['resultado'];

                            if($opcionpedido=="CODIGO"){
                                $detalle = $color;
                            }
                            if($opcionpedido=="CODIGO-COLOR"){
                                $detalle = $color;
                            }
                            if(($opcionpedido=="CODIGO-COLOR-MATERIAL")&&($opcionb=="6")){
                                // $detalle = $codigo['color'];
                                $detalle = $color;           }
                            if(($opcionpedido=="CODIGO-COLOR-STYLENAME")&&($opcionb=="4")){
                                $detalle = $color."/".$material;
                            }
                            if(($opcionpedido=="CODIGO-MATERIAL")&&($opcionb=="7")){
                                $detalle = $material;
                            }
                            if($opcionpedido=="LINEA-CODIGO-COLOR"){
                                $detalle = $color;}
                            if($opcionb=="3"){
                                $detalle = $color;
                                $select = "dtpt.iddetalleingreso,CONCAT(l.codigo, '-',mdd.codigo) AS codigo";
                                $from = "adicioningresotienda k, adiciondetalleingresotalla dtpt, modelos mdd, adiciondetalleingreso ad, coleccion col,lineas l";
                                $where = "k.idingreso = dtpt.idingreso
AND dtpt.idmodelo = mdd.idmodelo
AND mdd.idcoleccion = col.idcoleccion AND mdd.idlinea = l.idlinea
AND dtpt.iddetalleingreso = ad.iddetalleingreso";
                                { $where .= " AND mdd.idmarca = '$idmarca'  AND k.fecha >= '$fechainicio' AND
k.fecha <= '$fechafin' AND dtpt.iddetalleingreso='$dato' GROUP BY dtpt.iddetalleingreso";}
                                $sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where." ";

                                $idalmacenA =  findBySqlReturnCampoUnique($sql25, true, true, 'codigo');
                                $modelo = $idalmacenA['resultado'];
                            }

                            $select = "SUM( dtpt.cantidad ) AS Pares";
                            $from = "adicioningresotienda k, adiciondetalleingresotalla dtpt, adiciondetalleingreso ad, modelos mdd";
                            $where = "k.idingreso = dtpt.idingreso AND dtpt.idmodelo = mdd.idmodelo
AND dtpt.iddetalleingreso = ad.iddetalleingreso";
                            { $where .= " AND mdd.idmarca = '$idmarca'  AND k.fecha >= '$fechainicio' AND
k.fecha <= '$fechafin' AND  dtpt.iddetalleingreso='$dato'";}
                            if($idestilo !="null")
                            { $where .= " AND mdd.stylename = '$idestilo'";}
                            $sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where;
                            $almacenA1 =  findBySqlReturnCampoUnique($sql25, true, true, 'Pares');
                            $pares = $almacenA1['resultado'];

                            $select = "SUM( dtpt.cantidad*dtpt.precio2bs ) AS Pares";
                            $from = "adicioningresotienda k, adiciondetalleingresotalla dtpt, adiciondetalleingreso ad, modelos mdd";
                            $where = "k.idingreso = dtpt.idingreso AND dtpt.idmodelo = mdd.idmodelo
AND dtpt.iddetalleingreso = ad.iddetalleingreso";
                            { $where .= " AND mdd.idmarca = '$idmarca'  AND k.fecha >= '$fechainicio' AND
k.fecha <= '$fechafin' AND  dtpt.iddetalleingreso='$dato'";}
                            if($idestilo !="null")
                            { $where .= " AND mdd.stylename = '$idestilo'";}
                            $sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where;
                            $almacenA1 =  findBySqlReturnCampoUnique($sql25, true, true, 'Pares');
                            $totalbs = $almacenA1['resultado'];

                            $devS .= "<td style='text-align:left;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$modelo."&nbsp;</td>";
                            $devS .= "<td style='text-align:left;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$detalle."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$precio."&nbsp;</td>";

                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$pares."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$totalbs."&nbsp;</td>";
                            $select = "k.idingreso";
                            $from = "adicioningresotienda k, adiciondetalleingresotalla dtpt, adiciondetalleingreso ad, modelos mdd";
                            $where = "k.idingreso = dtpt.idingreso AND dtpt.idmodelo = mdd.idmodelo
AND dtpt.iddetalleingreso = ad.iddetalleingreso";
                            { $where .= " AND mdd.idmarca = '$idmarca'  AND k.fecha >= '$fechainicio' AND
k.fecha <= '$fechafin' AND  dtpt.iddetalleingreso='$dato' Group by k.idingreso";}
                            if($idestilo !="null")
                            { $where .= " AND mdd.stylename = '$idestilo'";}
                            $sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where;
                            $almacenA1 =  findBySqlReturnCampoUnique($sql25, true, true, 'idingreso');
                            $idingreso = $almacenA1['resultado'];


                            for($h=0;$h<$row1;$h++){
                                $codigo = $sql3[$h];
                                $idmmarca = $codigo['talla'];

                                $select1 = "cantidad AS Pares";
                                $from1 = "adiciondetalleingresotalla";
                                $where1 = "iddetalleingreso = '$dato' AND idingreso='$idingreso' AND tallakardex='$idmmarca'";
                                //    $where1 = "iddetalleingreso = '$dato' AND tallakardex='$idmmarca'";
                                $sql21 = "SELECT ".$select1." FROM ".$from1. " WHERE ".$where1;
                                // echo $sql21;
                                $almacenA1 =  findBySqlReturnCampoUnique($sql21, true, true, 'Pares');
                                $pares1 = $almacenA1['resultado'];
                                if($pares1==NULL || $pares1 =='' || $pares1 == ""){ $pares1="0"; }
                                $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$pares1."&nbsp;</td>";
                                $j++;
                            }

                        }
                        $devS .= "</tr>";
                        $iii++;
                        $zi ++;
                    }while($fi = mysql_fetch_array($re));
                    //$devS .= "<tr><td style='border:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Total</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td style='border:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>$totalparesestilo</td><td style='border:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>$totalbsestilo</td>";
                    $devS .= "<tr style='background-color:silver;'><td style='border: 1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>TOTAL</td>";
                    $devS .= "<td style='display:none;'></td>";
                    $fechatoday = Date("d-m-Y");
                    $devS .= "<td style='text-align:center;border-bottom: 1px solid #000000;'></td>";
                    $devS .= "<td style='text-align:center;border-bottom: 1px solid #000000;'></td>";
                    $devS .= "<td style='text-align:center;border-bottom: 1px solid #000000;'></td>";
                    $select = "SUM( dtpt.cantidad ) AS Pares";
                    $from = "adicioningresotienda k, adiciondetalleingresotalla dtpt, adiciondetalleingreso ad, modelos mdd";
                    $where = "k.idingreso = dtpt.idingreso AND dtpt.idmodelo = mdd.idmodelo
AND dtpt.iddetalleingreso = ad.iddetalleingreso";
                    { $where .= " AND mdd.idmarca = '$idmarca'  AND k.fecha >= '$fechainicio' AND
k.fecha <= '$fechafin' ";}
                    if($idestilo !="null")
                    { $where .= " AND mdd.stylename = '$idestilo'";}
                    $sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where;
                    $almacenA1 =  findBySqlReturnCampoUnique($sql25, true, true, 'Pares');
                    $totalpares = $almacenA1['resultado'];

                    $select = "SUM( dtpt.cantidad*dtpt.precio2bs ) AS Pares";
                    $from = "adicioningresotienda k, adiciondetalleingresotalla dtpt, adiciondetalleingreso ad, modelos mdd";
                    $where = "k.idingreso = dtpt.idingreso AND dtpt.idmodelo = mdd.idmodelo
AND dtpt.iddetalleingreso = ad.iddetalleingreso";
                    { $where .= " AND mdd.idmarca = '$idmarca'  AND k.fecha >= '$fechainicio' AND
k.fecha <= '$fechafin' ";}
                    if($idestilo !="null")
                    { $where .= " AND mdd.stylename = '$idestilo'";}
                    $sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where;
                    $almacenA1 =  findBySqlReturnCampoUnique($sql25, true, true, 'Pares');
                    $totalparesbs = $almacenA1['resultado'];

                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$totalpares."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-bottom: 1px solid #000000;'>&nbsp;".$totalparesbs."&nbsp;</td>";
                    for($h=0;$h<$row1;$h++){
                        $codigo = $sql3[$h];
                        $idmmarca = $codigo['idmarca'];

                        $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'></td>";
                        $he++;
                    }
                    $devS .= "</tr>";

                    $devS .= "</table>";

                    $dev['mensaje'] = "Existen resultados";
                    $dev['error']   = "true";
                    $dev['resultado'] = $devS;

                }
                else
                {
                    $dev['mensaje'] = "No se encontro datos en la consulta2".mysql_error();
                    $dev['error']   = "false";
                    $dev['resultado'] = "";
                }
            }
            else
            {
                $dev['mensaje'] = "Error en la consulta";
                $dev['error']   = "false";
                $dev['resultado'] = "";
            }
        }
        else
        {
            $dev['mensaje'] = "No se pudo conectar a la BD";
            $dev['error']   = "false";
            $dev['resultado'] = "";
        }
    }
    else
    {
        $dev['mensaje'] = "No se pudo crear la conexion a la BD";
        $dev['error']   = "false";
        $dev['resultado'] = "";
    }
    return $dev;
}

function dibujarTablaOfSQLNormalingresos($sql, $titulo = "ninguno",$fechainicio,$fechafin)
{
    if($link=new BD)
    {
        if($link->conectar())
        {
            if($re = $link->consulta($sql))
            {
                //echo mysql_num_rows($re);
                if($fi = mysql_fetch_array($re))
                {
                    $devS .= "<table cellpadding='0' cellspacing='0' border='0' style='width:100%;border:1px solid #000000;font-size:11px;'>";
                    if($titulo != "ninguno")
                    {
                        $devS .= "<tr><td colspan='".(mysql_num_fields($re)+1)."' style='border-bottom:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>$titulo</td></tr>";
                    }
                    $devS .= "<tr><td style='border-bottom:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Nro</td>";

                    //dibjamos las cabeceras



                    for($zz = 0; $zz < mysql_num_fields($re); $zz++)
                    {
                        $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>".mysql_field_name($re, $zz)."</td>";
                    }
                    $devS .= "</tr>";
                    $ii = 0;
                    //$totalCount = mysql_num_rows($re);
                    $z = 1;
                    do{
                        $devS .= "<tr><td style='text-align:center'>".$z."</td>";
                        for($i = 0; $i< mysql_num_fields($re); $i++)
                        {
                            if(mysql_field_type($re, $i) == "real")
                            {
                                $dato = $fi[$i];
                                if(mysql_field_name($re, $i) == "precio" || mysql_field_name($re, $i) == "importe")
                                {
                                    //                                    $dato = $fi[$i]/$tc;
                                    $dato = $fi[$i];
                                }
                                $devS .= "<td style='text-align:right;border-left: 1px solid #000000;'>&nbsp;".redondear($dato)."&nbsp;</td>";
                            }
                            else
                            {
                                $devS .= "<td style='border-left: 1px solid #000000;'>&nbsp;".$fi[$i]."&nbsp;</td>";
                            }
                        }
                        $devS .= "</tr>";
                        $ii++;
                        $z ++;
                    }while($fi = mysql_fetch_array($re));
                    $devS .= "<tr style='background-color:silver;'><td style='border: 1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>TOTAL</td>";
                    $devS .= "<td style='display:none;'></td>";
                    $fechatoday = Date("d-m-Y");
                    $devS .= "<td style='text-align:center;border-bottom: 1px solid #000000;'></td>";
                    $devS .= "<td style='text-align:center;border-bottom: 1px solid #000000;'></td>";
                    $devS .= "<td style='text-align:center;border-bottom: 1px solid #000000;'></td>";
                    $select = "SUM(dtp.cantidadpares)AS pares";
                    $from = "cambiopreciodetalle dtp, cambioprecio c, adiciondetalleingreso ad, modelos mo, marcas mar, estilos es";
                    $where = "c.idcambio = dtp.idcambio
AND dtp.iddetalleingreso = ad.iddetalleingreso
AND dtp.idmodelo = mo.idmodelo
AND dtp.idmodelo = ad.idmodelo
AND mo.idmarca = mar.idmarca
AND mo.stylename = es.idestilo AND c.fecha >= '$fechainicio' AND c.fecha <= '$fechafin' ";
                    $sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where." ORDER BY fecha DESC";
                    $almacenA1 =  findBySqlReturnCampoUnique($sql25, true, true, 'pares');
                    $totalpares = $almacenA1['resultado'];

                    $select = "SUM(dtp.cantidadpares*dtp.precionuevo)AS bs";
                    $from = "cambiopreciodetalle dtp, cambioprecio c, adiciondetalleingreso ad, modelos mo, marcas mar, estilos es";
                    $where = "c.idcambio = dtp.idcambio
AND dtp.iddetalleingreso = ad.iddetalleingreso
AND dtp.idmodelo = mo.idmodelo
AND dtp.idmodelo = ad.idmodelo
AND mo.idmarca = mar.idmarca
AND mo.stylename = es.idestilo AND c.fecha >= '$fechainicio' AND c.fecha <= '$fechafin' ";
                    $sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where." ORDER BY fecha DESC";
                    $almacenA1 =  findBySqlReturnCampoUnique($sql25, true, true, 'bs');
                    $preciobs = $almacenA1['resultado'];
                    $select = "SUM(dtp.diferencia)AS bs";
                    $from = "cambiopreciodetalle dtp, cambioprecio c, adiciondetalleingreso ad, modelos mo, marcas mar, estilos es";
                    $where = "c.idcambio = dtp.idcambio
AND dtp.iddetalleingreso = ad.iddetalleingreso
AND dtp.idmodelo = mo.idmodelo
AND dtp.idmodelo = ad.idmodelo
AND mo.idmarca = mar.idmarca
AND mo.stylename = es.idestilo AND c.fecha >= '$fechainicio' AND c.fecha <= '$fechafin' ";
                    $sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where." ORDER BY fecha DESC";
                    $almacenA1 =  findBySqlReturnCampoUnique($sql25, true, true, 'bs');
                    $dif = $almacenA1['resultado'];

                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$totalpares."&nbsp;</td>";

                    $devS .= "<td style='text-align:center;border-bottom: 1px solid #000000;'></td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$preciobs."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$dif."&nbsp;</td>";
                    $devS .= "</tr>";
                    $devS .= "</table>";

                    $dev['mensaje'] = "Existen resultados";
                    $dev['error']   = "true";
                    $dev['resultado'] = $devS;

                }
                else
                {
                    $dev['mensaje'] = "No se encontro datos en la consulta2".mysql_error();
                    $dev['error']   = "false";
                    $dev['resultado'] = "";
                }
            }
            else
            {
                $dev['mensaje'] = "Error en la consulta";
                $dev['error']   = "false";
                $dev['resultado'] = "";
            }
        }
        else
        {
            $dev['mensaje'] = "No se pudo conectar a la BD";
            $dev['error']   = "false";
            $dev['resultado'] = "";
        }
    }
    else
    {
        $dev['mensaje'] = "No se pudo crear la conexion a la BD";
        $dev['error']   = "false";
        $dev['resultado'] = "";
    }
    return $dev;
}


function verIngresosMarcaEstiloHTML($idmarca,$idestilo, $return)
{
    $html = "";
    $html .= "<tr><td colspan='4' align='center'>
    <p>Nova Moda S.RL.<br />
         <br />
         Telf. 4-258993  Fax: 4-504183
    </p>
</td></tr>";
    $html .= "<!DOCTYPE HTML PUBLIC '-//W3C//DTD HTML 4.01 Transitional//EN'>";
    $html .= "<html>";
    $html .= "<body>";
    $html .= "<tr>";

    $html .= "<table cellpadding='1' cellspacing='0' border='0' style='width:100%' font-size:11px; font-family:Tahoma;'>";
    $html .= "<td style='width:100%;height:100%;text-align:right;font-size:12px;font-family:Tahoma;'>";
    $html .= "$fecha  $tipo";
    $html .= "</td>";
    $html .= "<tr>";
    $sql = "SELECT ma.nombre AS marca,ma.talla,ma.opcionb,ma.pedido
FROM  `marcas` ma
WHERE ma.idmarca = '$idmarca'";

    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'marca');
    $marcalista = $idalmacenA2['resultado'];
    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'talla');
    $opcionmarca = $idalmacenA2['resultado'];
    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'opcionb');
    $opcionb = $idalmacenA2['resultado'];
    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'pedido');
    $marcapedido = $idalmacenA2['resultado'];
    $idsCAr = split("-", $opcionmarca);
    $rango1=$idsCAr[0];
    $rango2=$idsCAr[1];

    if($opcionmarca="33-45"){
        $tipo="1";
        //echo $tipo;
    }else{
        if($opcionmarca="14-38"){
            $tipo="3";
        }
    }

    $sql1 = "SELECT  es.nombre AS estilo
FROM  estilos es
WHERE es.idestilo = '$idestilo'";
    $idalmacenA =  findBySqlReturnCampoUnique($sql1, true, true, 'estilo');
    $estilolista = $idalmacenA['resultado'];
    //$html .= "<tr style='width:100%height:100px;text-align:center;font-size:15px;font-family:Tahoma;'>";
    $html .= "<td style='width:100%;height:100px;text-align:center;font-size:15px;font-family:Tahoma;'>";
    if($idestilo == null ||$idestilo == "null" )
    {
        $html .= "INVENTARIO $marcalista<br> Ingreso por marca";

        //  $sqldetalle = "SELECT ".$select." FROM ".$from. " WHERE ".$where."ORDER BY ".$order;
    }else {
        $html .= "INVENTARIO $marcalista<br> Ingreso por estilo $estilolista";

    }
    $html .= "</td>";
    $html .= "</tr>";
    $html .= "</table>";
    $html .= "</tr>";
    $html .= "<tr>";
    $html .= "<td colspan='3'>";
    $html .= "<table width='1250' border='0' cellspacing='0' cellpadding='0'><tr>";

    $html .= "<tr>";
    $select1 = "talla,idmodelo";
    $from1 = "tallasdetalle";
    $where1 = "talla >='$rango1' AND talla <='$rango2' AND idmodelo='2' ORDER BY talla ASC";
    $sql21 = "SELECT ".$select1." FROM ".$from1." WHERE ".$where1;
    $row = NumeroTuplas($sql21);
    $row1= $row['resultado'];

    $select = "SUM(saldocantidad) AS Pares";
    $from = "historialkardextienda k,modelos mdt";
    $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND mdt.stylename = '$idestilo' ";
    $sql2121 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
    $almacenA1 =  findBySqlReturnCampoUnique($sql2121, true, true, 'Pares');
    $totalparesestilo = $almacenA1['resultado'];
    $select = "SUM(saldocantidad*precio2bs) AS bs";
    $from = "historialkardextienda k,modelos mdt";
    $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND mdt.stylename = '$idestilo' ";
    $sql2121 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
    $almacenA1 =  findBySqlReturnCampoUnique($sql2121, true, true, 'bs');
    $totalbsestilo = $almacenA1['resultado'];
    $select = "dtp.iddetalleingreso";
    $from = "adiciondetalleingreso dtp, modelos mdd, coleccion col, estilos es";
    $where = "dtp.idmodelo = mdd.idmodelo AND mdd.idcoleccion = col.idcoleccion AND mdd.stylename = es.idestilo AND dtp.unido='no' AND mdd.idmarca = '$idmarca' AND mdd.stylename='$idestilo'";
    $sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where." ORDER BY CAST( `mdd`.`codigo` AS SIGNED) ASC";
    $table = dibujarTablaOfSQLinventario($sql25,$sql21,$row1,$idmarca,$idestilo,$rango1,$rango2,$totalparesestilo,$totalbsestilo,$tipo, $marcapedido);

    $html .= $table['resultado'];
    $html .= "</tr>";
    $html .= "</table>";
    $html .= "</td></tr>";

    $html .= "</tr>";
    $html .= "</table>";
    $html .= "</body>";
    $html .= "</html>";
    if($return == true)
    {
        return $html;
    }
    else
    {
        echo $html;
    }
}

function verIngresosMarcaEstiloHTMLVentas($idmarca,$idestilo,$idkardex, $return)
{
    //  echo $idkardex;
    $html = "";
    $html .= "<tr><td colspan='4' align='center'>
    <p>Nova Moda S.RL.<br />
         <br />
         Telf. 4-258993  Fax: 4-504183
    </p>
</td></tr>";
    $html .= "<!DOCTYPE HTML PUBLIC '-//W3C//DTD HTML 4.01 Transitional//EN'>";
    $html .= "<html>";
    $html .= "<body>";
    $html .= "<tr>";

    $html .= "<table cellpadding='1' cellspacing='0' border='0' style='width:100%' font-size:11px; font-family:Tahoma;'>";
    $html .= "<td style='width:100%;height:100%;text-align:right;font-size:12px;font-family:Tahoma;'>";
    $html .= "$fecha  $tipo";
    $html .= "</td>";
    $html .= "<tr>";
    $sql = "SELECT ma.nombre AS marca,ma.talla,ma.opcionb,ma.pedido
FROM  `marcas` ma
WHERE ma.idmarca = '$idmarca'";

    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'marca');
    $marcalista = $idalmacenA2['resultado'];
    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'talla');
    $opcionmarca = $idalmacenA2['resultado'];
    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'opcionb');
    $opcionb = $idalmacenA2['resultado'];
    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'pedido');
    $marcapedido = $idalmacenA2['resultado'];
    $idsCAr = split("-", $opcionmarca);
    $rango1=$idsCAr[0];
    $rango2=$idsCAr[1];

    if($opcionmarca="33-45"){
        $tipo="1";
        //echo $tipo;
    }else{
        if($opcionmarca="14-38"){
            $tipo="3";
        }
    }

    $sql1 = "SELECT  es.nombre AS estilo
FROM  estilos es
WHERE es.idestilo = '$idestilo' order by ordennumero ASC";
    $idalmacenA =  findBySqlReturnCampoUnique($sql1, true, true, 'estilo');
    $estilolista = $idalmacenA['resultado'];
    //$html .= "<tr style='width:100%height:100px;text-align:center;font-size:15px;font-family:Tahoma;'>";
    $html .= "<td style='width:100%;height:100px;text-align:center;font-size:15px;font-family:Tahoma;'>";
    if($idestilo == null ||$idestilo == "null" )
    {
        $html .= "INVENTARIO $marcalista<br>";

        //  $sqldetalle = "SELECT ".$select." FROM ".$from. " WHERE ".$where."ORDER BY ".$order;
    }else {
        $html .= "INVENTARIO $marcalista<br> Estilo $estilolista";

    }
    $html .= "</td>";
    $html .= "</tr>";
    $html .= "</table>";
    $html .= "</tr>";
    $html .= "<tr>";
    $html .= "<td colspan='3'>";
    $html .= "<table width='1250' border='0' cellspacing='0' cellpadding='0'><tr>";

    $html .= "<tr>";
    $select1 = "talla,idmodelo";
    $from1 = "tallasdetalle";
    $where1 = "talla >='$rango1' AND talla <='$rango2' AND idmodelo='2' ORDER BY talla ASC";
    $sql21 = "SELECT ".$select1." FROM ".$from1." WHERE ".$where1;
    $row = NumeroTuplas($sql21);
    $row1= $row['resultado'];

    $select = "SUM(saldocantidad) AS Pares";
    $from = "adicionkardextienda k,modelos mdt";
    $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND mdt.stylename = '$idestilo' AND k.unido='no' ";
    $sql2121 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
    $almacenA1 =  findBySqlReturnCampoUnique($sql2121, true, true, 'Pares');
    $totalparesestilo = $almacenA1['resultado'];
    $select = "SUM(saldocantidad*precio2bs) AS bs";
    $from = "adicionkardextienda k,modelos mdt";
    $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND mdt.stylename = '$idestilo' AND k.unido='no'";
    $sql2121 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
    $almacenA1 =  findBySqlReturnCampoUnique($sql2121, true, true, 'bs');
    $totalbsestilo = $almacenA1['resultado'];
    $select = "dtp.iddetalleingreso";
    $from = "adiciondetalleingreso dtp, modelos mdd, coleccion col, estilos es";
    $where = "dtp.idmodelo = mdd.idmodelo AND mdd.idcoleccion = col.idcoleccion AND mdd.stylename = es.idestilo AND dtp.unido='no' AND dtp.estado='activo' AND mdd.idmarca = '$idmarca' AND mdd.stylename='$idestilo'";
    //   $where = "dtp.idmodelo = mdd.idmodelo AND mdd.idcoleccion = col.idcoleccion AND mdd.stylename = es.idestilo AND dtp.unido='no' AND mdd.idmarca = '$idmarca' AND mdd.stylename='$idestilo'";

    $sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where." ORDER BY CAST( `mdd`.`codigo` AS SIGNED) ASC";
    //$table = dibujarTablaOfSQLinventarioVentas($sql25,$sql21,$row1,$idmarca,$rango1,$rango2,$totalparesestilo,$totalbsestilo,$tipo, $marcapedido);

    $table = dibujarTablaOfSQLinventarioVentasTotal($idkardex,$sql25,$sql21,$row1,$idmarca,$idestilo,$rango1,$rango2,$totalparesestilo,$totalbsestilo, $tipo,$marcapedido);

    $html .= $table['resultado'];
    $html .= "</tr>";
    $html .= "</table>";
    $html .= "</td></tr>";

    $html .= "</tr>";
    $html .= "</table>";
    $html .= "</body>";
    $html .= "</html>";
    if($return == true)
    {
        return $html;
    }
    else
    {
        echo $html;
    }
}
function verIngresosMarcaEstiloModelo($idmarca,$idestilo,$modelo,$tipo, $return)
{
    //  echo $idkardex;
    $html = "";
    $html .= "<tr><td colspan='4' align='center'>
    <p>Nova Moda S.RL.<br />
         <br />
         Telf. 4-258993  Fax: 4-504183
    </p>
</td></tr>";
    $html .= "<!DOCTYPE HTML PUBLIC '-//W3C//DTD HTML 4.01 Transitional//EN'>";
    $html .= "<html>";
    $html .= "<body>";
    $html .= "<tr>";

    $html .= "<table cellpadding='1' cellspacing='0' border='0' style='width:100%' font-size:11px; font-family:Tahoma;'>";
    $html .= "<td style='width:100%;height:100%;text-align:right;font-size:12px;font-family:Tahoma;'>";
    $html .= "$fecha  $tipo";
    $html .= "</td>";
    $html .= "<tr>";
    $sql = "SELECT ma.nombre AS marca,ma.talla,ma.opcionb,ma.pedido
FROM  `marcas` ma
WHERE ma.idmarca = '$idmarca'";

    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'marca');
    $marcalista = $idalmacenA2['resultado'];
    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'talla');
    $opcionmarca = $idalmacenA2['resultado'];
    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'opcionb');
    $opcionb = $idalmacenA2['resultado'];
    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'pedido');
    $marcapedido = $idalmacenA2['resultado'];
    $idsCAr = split("-", $opcionmarca);
    $rango1=$idsCAr[0];
    $rango2=$idsCAr[1];

    if($opcionmarca="33-45"){
        $tipo="1";
        //echo $tipo;
    }else{
        if($opcionmarca="14-38"){
            $tipo="3";
        }
    }

    $sql1 = "SELECT  es.nombre AS estilo
FROM  estilos es
WHERE es.idestilo = '$idestilo'";
    $idalmacenA =  findBySqlReturnCampoUnique($sql1, true, true, 'estilo');
    $estilolista = $idalmacenA['resultado'];
    $html .= "<td style='width:100%;height:50px;text-align:center;font-size:20px;font-family:Arial;'>";
    $html .= "<b><u>INVENTARIO $marcalista</u></b><br>";

    $html .= "</td>";
    $html .= "</tr>";
    $html .= "<tr>";
    $html .= "<td style='width:100%;height:50px;text-align:left;font-size:20px;font-family:Arial;'>";
    $html .= "<b><u> $estilolista</u></b><br>";

    $html .= "</td>";
    $html .= "</tr>";
    $html .= "</table>";
    $html .= "</tr>";
    $html .= "<tr>";
    $html .= "<td colspan='3'>";
    $html .= "<table width='1250' border='0' cellspacing='0' cellpadding='0'><tr>";

    $html .= "<tr>";
    $select1 = "talla,idmodelo";
    $from1 = "tallasdetalle";
    $where1 = "talla >='$rango1' AND talla <='$rango2' AND idmodelo='2' ORDER BY talla ASC";
    $sql21 = "SELECT ".$select1." FROM ".$from1." WHERE ".$where1;
    $row = NumeroTuplas($sql21);
    $row1= $row['resultado'];

    $select = "SUM(saldocantidad) AS Pares";
    $from = "adicionkardextienda k,modelos mdt";
    $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND mdt.stylename = '$idestilo' AND k.unido='no' ";
    $sql2121 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
    $almacenA1 =  findBySqlReturnCampoUnique($sql2121, true, true, 'Pares');
    $totalparesestilo = $almacenA1['resultado'];
    $select = "SUM(saldocantidad*precio2bs) AS bs";
    $from = "adicionkardextienda k,modelos mdt";
    $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND mdt.stylename = '$idestilo' AND k.unido='no'";
    $sql2121 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
    $almacenA1 =  findBySqlReturnCampoUnique($sql2121, true, true, 'bs');
    $totalbsestilo = $almacenA1['resultado'];
    $select = "dtp.iddetalleingreso";
    $from = "adiciondetalleingreso dtp, modelos mdd, coleccion col, estilos es";
    $where = "dtp.idmodelo = mdd.idmodelo AND mdd.idcoleccion = col.idcoleccion AND mdd.stylename = es.idestilo AND dtp.unido='no' AND mdd.idmarca = '$idmarca' AND mdd.stylename='$idestilo' and mdd.codigo='$modelo'";
    $sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where." ORDER BY CAST( `mdd`.`codigo` AS SIGNED) ASC";


    //$table = dibujarTablaOfSQLinventarioVentas($sql25,$sql21,$row1,$idmarca,$rango1,$rango2,$totalparesestilo,$totalbsestilo,$tipo, $marcapedido);
    $table = dibujarTablaOfSQLmodelos($modelo,$sql25,$sql21,$row1,$idmarca,$idestilo,$rango1,$rango2,$totalparesestilo,$totalbsestilo, $tipo,$marcapedido);

    $html .= $table['resultado'];

    //$table = dibujarTablaOfSQLinventarioVentasTotal($idkardex,$sql25,$sql21,$row1,$idmarca,$idestilo,$rango1,$rango2,$totalparesestilo,$totalbsestilo, $tipo,$marcapedido);
    //
    //$html .= $table['resultado'];
    $html .= "</tr>";
    $html .= "</table>";
    $html .= "</td></tr>";

    $html .= "</tr>";
    $html .= "</table>";
    $html .= "</body>";
    $html .= "</html>";
    if($return == true)
    {
        return $html;
    }
    else
    {
        echo $html;
    }
}



function verIngresosMarcaEstiloHTMLInventarioTotales($idmarca,$idestilo, $idkardex,$return)
{
    $html = "";
    $html .= "<tr><td colspan='4' align='center'>
    <p>Nova Moda S.RL.<br />
         <br />
         Telf. 4-258993  Fax: 4-504183
    </p>
</td></tr>";
    $html .= "<!DOCTYPE HTML PUBLIC '-//W3C//DTD HTML 4.01 Transitional//EN'>";
    $html .= "<html>";
    $html .= "<body>";
    $html .= "<tr>";

    $html .= "<table cellpadding='1' cellspacing='0' border='0' style='width:100%' font-size:11px; font-family:Tahoma;'>";
    $html .= "<td style='width:100%;height:100%;text-align:right;font-size:12px;font-family:Tahoma;'>";
    $html .= "$fecha  $tipo";
    $html .= "</td>";
    $html .= "<tr>";
    $sql = "SELECT ma.nombre AS marca,ma.talla,ma.opcionb
FROM  `marcas` ma
WHERE ma.idmarca = '$idmarca'";

    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'marca');
    $marcalista = $idalmacenA2['resultado'];
    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'talla');
    $opcionmarca = $idalmacenA2['resultado'];
    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'opcionb');
    $opcionb = $idalmacenA2['resultado'];
    $idsCAr = split("-", $opcionmarca);
    $rango1=$idsCAr[0];
    $rango2=$idsCAr[1];
    $sql1 = "SELECT  es.nombre AS estilo
FROM  estilos es
WHERE es.idestilo = '$idestilo'";
    $idalmacenA =  findBySqlReturnCampoUnique($sql1, true, true, 'estilo');
    $estilolista = $idalmacenA['resultado'];
    //$html .= "<tr style='width:100%height:100px;text-align:center;font-size:15px;font-family:Tahoma;'>";
    $html .= "<td style='width:100%;height:100px;text-align:center;font-size:15px;font-family:Tahoma;'>";
    if($idestilo == null ||$idestilo == "null" )
    {
        $html .= "INVENTARIO $marcalista";

        //  $sqldetalle = "SELECT ".$select." FROM ".$from. " WHERE ".$where."ORDER BY ".$order;
    }else {
        $html .= "INVENTARIO $marcalista";
        //$html .= "INVENTARIO $marcalista<br> Ingreso por estilo $estilolista";

    }
    //    $html .= "Ventas por Marca<br>";
    //    $html .= "CORRESPONDIENTES DEL $fechaini AL $fechafinn<br>";
    //     $html .= "Tienda $tienda";
    $html .= "</td>";
    $html .= "</tr>";
    $html .= "</table>";
    $html .= "</tr>";
    $html .= "<tr>";
    $html .= "<td colspan='3'>";
    $html .= "<table width='300' border='0' cellspacing='0' cellpadding='0'><tr>";
    $html .= "<tr>";
    $select = "talla,idmodelo";
    $from = "tallasdetalle";
    $sqlmarca = " SELECT tabla,mesrango,idperiodo,fechainicio,fechafin FROM administrakardex WHERE idkardex = '$idkardex' ";
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "tabla");
    $tabla = $opcionkardex['resultado'];
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "mesrango");
    $mesrango = $opcionkardex['resultado'];
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "idperiodo");
    $idperiodo = $opcionkardex['resultado'];
    //echo $tabla;
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "fechainicio");
    $fechainicio = $opcionkardex['resultado'];
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "fechafin");
    $fechafin = $opcionkardex['resultado'];

    if($fechafin==null ||$fechafin == ""){
        $fechafin = Date("Y-m-d");
    }
    if($tabla=="historialkardextienda"){
        // echo $idkardex;
        $select = "SUM( k.precio2bs * k.saldocantidad) As bs";
        $from = "historialkardextienda k,modelos mdt";
        $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND k.idperiodo='$idperiodo' AND k.unido='no'";
        $sql2121 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

        $almacenA1 =  findBySqlReturnCampoUnique($sql2121, true, true, 'bs');
        $totalparesbs = $almacenA1['resultado'];


        $select = "SUM(k.saldocantidad) As par";
        $from = "historialkardextienda k,modelos mdt";
        $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND k.idperiodo='$idperiodo' AND k.unido='no'";
        $sql2121 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

        $almacenA1 =  findBySqlReturnCampoUnique($sql2121, true, true, 'par');
        $totalpares = $almacenA1['resultado'];
        //echo $sql2121;
    }else{
        $select = "SUM( k.precio2bs * k.saldocantidad) As bs";
        $from = "adicionkardextienda k,modelos mdt";
        $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND k.unido='no'";
        $sql2121 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

        $almacenA1 =  findBySqlReturnCampoUnique($sql2121, true, true, 'bs');
        $totalparesbs = $almacenA1['resultado'];


        $select = "SUM(k.saldocantidad) As bs";
        $from = "adicionkardextienda k,modelos mdt";
        $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND k.unido='no' ";
        $sql2121 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

        $almacenA1 =  findBySqlReturnCampoUnique($sql2121, true, true, 'bs');
        $totalpares = $almacenA1['resultado'];
    }



    $html .= "<td style='width:100%;text-align:center;font-size:1px;font-family:Tahoma;'>";
    $html .= "<table cellpadding='0' cellspacing='0' border='1' style='width:100%;border:1px solid #000000;font-size:11px;text-align:center'>";

    $html .= "<tr><td style='font-size:11px;font-weight:bold;'>Pares:</td><td>".$totalpares."</td></tr>";
    $html .= "<tr><td style='font-size:11px;font-weight:bold;'>Bs:</td><td>".$totalparesbs."</td></tr>";
    $html .= "</table>";

    $html .= "</td></tr>";


    $html .= "</table>";
    $html .= "</body>";
    $html .= "</html>";
    if($return == true)
    {
        return $html;
    }
    else
    {
        echo $html;
    }
}

function verIngresosMarcaEstiloHTMLInventario($idmarca,$idestilo, $return)
{
    $html = "";
    $html .= "<tr><td colspan='4' align='center'>
    <p>Nova Moda S.RL.<br />
         <br />
         Telf. 4-258993  Fax: 4-504183
    </p>
</td></tr>";

    $html .= "<!DOCTYPE HTML PUBLIC '-//W3C//DTD HTML 4.01 Transitional//EN'>";
    $html .= "<html>";
    $html .= "<body>";
    $html .= "<tr>";

    $html .= "<table cellpadding='1' cellspacing='0' border='0' style='width:100%' font-size:11px; font-family:Tahoma;'>";
    $html .= "<td style='width:100%;height:100%;text-align:right;font-size:12px;font-family:Tahoma;'>";
    $html .= "$fecha  $tipo";
    $html .= "</td>";
    $html .= "<tr>";
    $sql = "SELECT ma.nombre AS marca,ma.talla,ma.opcionb
FROM  `marcas` ma
WHERE ma.idmarca = '$idmarca'";

    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'marca');
    $marcalista = $idalmacenA2['resultado'];
    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'talla');
    $opcionmarca = $idalmacenA2['resultado'];
    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'opcionb');
    $opcionb = $idalmacenA2['resultado'];
    $idsCAr = split("-", $opcionmarca);
    $rango1=$idsCAr[0];
    $rango2=$idsCAr[1];
    $sql1 = "SELECT  es.nombre AS estilo
FROM  estilos es
WHERE es.idestilo = '$idestilo'";
    $idalmacenA =  findBySqlReturnCampoUnique($sql1, true, true, 'estilo');
    $estilolista = $idalmacenA['resultado'];
    //$html .= "<tr style='width:100%height:100px;text-align:center;font-size:15px;font-family:Tahoma;'>";
    $html .= "<td style='width:100%;height:100px;text-align:center;font-size:15px;font-family:Tahoma;'>";

    $html .= "INVENTARIO $marcalista<br> Ingreso por marca";

    //    $html .= "Ventas por Marca<br>";
    //    $html .= "CORRESPONDIENTES DEL $fechaini AL $fechafinn<br>";
    //     $html .= "Tienda $tienda";
    $html .= "</td>";
    $html .= "</tr>";
    $html .= "</table>";
    $html .= "</tr>";
    $html .= "<tr>";
    $html .= "<td colspan='3'>";
    $html .= "<table width='1250' border='0' cellspacing='0' cellpadding='0'><tr>";
    $html .= "<tr>";
    $select = "talla,idmodelo";
    $from = "tallasdetalle";
    $where = "talla >='$rango1' AND talla <='$rango2' AND idmodelo='2' ORDER BY talla ASC";
    $sql2 = "SELECT ".$select." FROM ".$from." WHERE ".$where;
    $row = NumeroTuplas($sql2);
    $row1= $row['resultado'];
    $sql21 = getTablaToArrayOfSQL($sql2);
    $sql3 = $sql21['resultado'];
    $valor= "5%";
    $anchoparest ="4%";
    $anchobst ="4%";
    $totalcalculo = "55";
    $subtotal = $totalcalculo/$row1;
    $numerocolumnas = $subtotal."%";
    $porcen1 = "33.33";
    $porcen2 = "66.67";
    $anchopares1 = ($subtotal * $porcen1)/100;
    $anchobs1 = ($subtotal * $porcen2)/100;
    $anchoparesb =$anchopares1."%";
    $anchobsb =$anchobs1."%";
    $anchopares ="1.5%";
    $anchobs ="3%";
    $anchonuevo = $anchoparesb+$anchobsb."%";
    $anchonuevo= $numerocolumnas;
    $numcolum = $row1 +1;
    $valor1= "3%";
    $valor2= "4%";
    $valor3= "14%";
    $valor4= "4%";
    $html .= "<tr>";
    $html .= "<td style='width:100%;text-align:center;font-size:1px;font-family:Tahoma;'>";
    $html .= "<table cellpadding='0' cellspacing='0' border='1' style='width:100%;border:1px solid #000000;font-size:11px;text-align:center'>";
    $html .= "<td style='width:$valor1;'>Col.</td>";
    $html .= "<td style='width:$valor2;'>Modelo</td>";
    $html .= "<td style='width:$valor3;'>Color</td>";
    $html .= "<td style='width:$valor4;'>Precio</td>";

    $rangoa=$rango1;
    $rangob=$rango2;

    for($i=$rangoa;$i<=$rangob;$i++){

        //   for($h=0;$h<$row1;$h++){
        $codigo = $sql3[$i];

        $codigovendedor =$i;

        if($j==$numcolum){ $j=0; }
        $html .="
           <td width='$anchonuevo'>".$codigovendedor."</td>
                   ";
        $j++;
    }
    $html .= "<td style='width:$anchoparest; font-size:11px;'>Stock Actual</td>";


    $html .= "</tr>";
    $html .= "</table>";
    $html .= "</td></tr>";

    $select = "dtp.iddetalleingreso,mdd.codigo AS codigo, dtp.totalbs AS precio,dtp.material AS color, col.codigo AS coleccion";
    $from = "adiciondetalleingreso dtp, modelos mdd, coleccion col, estilos es";
    $where = "dtp.idmodelo = mdd.idmodelo AND mdd.idcoleccion = col.idcoleccion AND mdd.stylename = es.idestilo AND dtp.unido='no'";
    { $where .= " AND mdd.idmarca = '$idmarca'";}
    $sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where." ORDER BY CAST( `mdd`.`codigo` AS SIGNED) ASC";
    //echo $sql25;
    $row5 = NumeroTuplas($sql25);
    $row15= $row5['resultado'];
    $sql215 = getTablaToArrayOfSQL($sql25);
    $sql35 = $sql215['resultado'];

    for($i=0;$i<=$row15;$i++){
        //for($i=$fecha1;$i<=$fecha2;$i = date("Y-m-d", strtotime($i ."+ 1 days"))){
        $codigo = $sql35[$i];
        $iddetalleingreso = $codigo['iddetalleingreso'];
        $codigomodelo = $codigo['codigo'];
        $coleccion = $codigo['coleccion'];
        $color = $codigo['color'];
        $precio = $codigo['precio'];
        $totalparesiddetalleingreso = $codigo['totalpares'];
        $fecha =$i;

        $html .= "<tr>";
        $html .= "<td style='width:100%;text-align:center;font-size:12px;font-family:Tahoma;'>";
        $html .= "<table cellpadding='0' cellspacing='0' border='1' style='width:100%;border:1px solid #000000;font-size:11px;text-align:center'>";
        $html .= "<td style='width:$valor1;'>$coleccion</td>";
        $html .= "<td style='width:$valor2;'>$codigomodelo</td>";
        $html .= "<td style='width:$valor3;'>$color</td>";
        $html .= "<td style='width:$valor4;'>$precio</td>";
        $j=0;
        for($h=0;$h<$row1;$h++){
            $codigo = $sql3[$h];
            $idmmarca = $codigo['talla'];
            if($j==$numcolum){
                $j=0;
            }
            $fecha =$i;

            $select1 = "saldocantidad AS Pares";
            $from1 = "historialkardextienda";
            $where1 = "idcalzado = '$iddetalleingreso' AND talla='$idmmarca' ";
            //if($ltienda != "Todos"){ $where .= " AND ve.idtienda = '$ltienda' ";}
            $sql21 = "SELECT ".$select1." FROM ".$from1. " WHERE ".$where1;
            //echo $sql21;
            $almacenA1 =  findBySqlReturnCampoUnique($sql21, true, true, 'Pares');
            $pares1 = $almacenA1['resultado'];
            if($pares1==NULL || $pares1 =='' || $pares1 == ""){ $pares1="0"; }
            $html .="
    <td width='$anchonuevo'>".$pares1."</td>";
            $j++;
        }

        $select = "SUM(saldocantidad) AS Pares";
        $from = "historialkardextienda ";
        $where = " idcalzado='$iddetalleingreso' ";
        $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
        $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
        $stockactual = $almacenA1['resultado'];
        if($stockactual==NULL || $stockactual =='' || $stockactual == ""){ $stockactual="0"; }
        $html .= "<td style='width:$anchoparest;'>".$stockactual."</td>";

        // $html .= "<td style='width:$anchobst;'>".$bs."</td>";

        $html .= "</tr>";
        $html .= "</table>";
        $html .= "</td></tr>";
    }

    //totales de totales
    $html .= "<tr>";
    $html .= "<td style='width:100%;text-align:center;font-size:11px;font-family:Tahoma;'>";
    $html .= "<table cellpadding='0' cellspacing='0' border='1' style='width:100%;border:1px solid #000000;font-size:11px;text-align:center'>";
    $html .= "<td style='width:$valor1;'>Total</td>";
    $html .= "<td style='width:$valor2;'>Pares</td>";
    $html .= "<td style='width:$valor3;'></td>";
    $html .= "<td style='width:$valor4;'></td>";
    //    s
    for($h=0;$h<$row1;$h++){
        $codigo = $sql3[$h];
        $tallasub = $codigo['talla'];
        if($j==$numcolum){ $j=0; }

        $select = "SUM(saldocantidad) AS Pares";
        $from = "historialkardextienda k,modelos mdt";
        $where = " k.idmodelodetalle = mdt.idmodelo AND k.talla='$tallasub' AND mdt.idmarca = '$idmarca'  ";

        $sql212 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
        //echo $sql212;
        $almacenA1 =  findBySqlReturnCampoUnique($sql212, true, true, 'Pares');
        $paresvendedor = $almacenA1['resultado'];

        if($paresvendedor==NULL || $paresvendedor =='' || $paresvendedor == ""){ $paresvendedor="0"; }

        $html .="
    <td width='$anchonuevo'>$paresvendedor</td>";
        $j++;
    }

    //sumatorias

    $select = "SUM(k.saldocantidad) AS Pares";
    $from = "historialkardextienda k,modelos mdt";
    $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' ";
    $sql2121 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
    $almacenA1 =  findBySqlReturnCampoUnique($sql2121, true, true, 'Pares');
    $totalparesactual = $almacenA1['resultado'];
    // echo $sql2121;
    if($totalparesactual==NULL || $totalparesactual =='' || $totalparesactual == ""){ $totalparesactual="0"; }


    $html .= "<td style='width:$anchoparest;font-weight:bold;font-size:11px;'>$totalparesactual</td>";


    //$html .= "<td style='width:$anchoparest;font-weight:bold;font-size:11px;'>$totalparesbs</td>";

    // $html .= "<td style='width:$anchobst;font-weight:bold;font-size:11px;'>$totalbs</td>";

    $html .= "</tr>";
    $html .= "</table>";
    $html .= "</td></tr>";
    //dinero
    $html .= "<tr>";
    $html .= "<td style='width:100%;text-align:center;font-size:11px;font-family:Tahoma;'>";
    $html .= "<table cellpadding='0' cellspacing='0' border='1' style='width:100%;border:1px solid #000000;font-size:11px;text-align:center'>";
    $html .= "<td style='width:$valor1;'>Total</td>";
    $html .= "<td style='width:$valor2;'>Bs.</td>";
    $html .= "<td style='width:$valor3;'></td>";
    $html .= "<td style='width:$valor4;'></td>";
    //    s
    for($h=0;$h<$row1;$h++){
        $codigo = $sql3[$h];
        $tallasub = $codigo['talla'];
        if($j==$numcolum){ $j=0; }

        $html .="
    <td width='$anchonuevo'></td>";
        $j++;
    }

    $select = "SUM( k.precio2bs * k.saldocantidad) As bs";
    $from = "historialkardextienda k,modelos mdt";
    $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' ";
    $sql2121 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

    $almacenA1 =  findBySqlReturnCampoUnique($sql2121, true, true, 'bs');
    $totalparesbs = $almacenA1['resultado'];
    if($totalparesbs==NULL || $totalparesbs =='' || $totalparesbs == ""){ $totalparesbs="0"; }


    $html .= "<td style='width:$anchoparest;font-weight:bold;font-size:11px;'>$totalparesbs</td>";
    // $html .= "<td style='width:$anchobst;font-weight:bold;font-size:11px;'>$totalbs</td>";

    $html .= "</tr>";
    $html .= "</table>";
    $html .= "</td></tr>";


    $html .= "</tr>";
    $html .= "</table>";
    $html .= "</body>";
    $html .= "</html>";
    if($return == true)
    {
        return $html;
    }
    else
    {
        echo $html;
    }
}

function verIngresosMarcaEstiloHTMLInventario2($idmarca,$idestilo, $return)
{
    $html = "";
    $html .= "<tr><td colspan='4' align='center'>
    <p>Nova Moda S.RL.<br />
         <br />
         Telf. 4-258993  Fax: 4-504183
    </p>
</td></tr>";

    $html .= "<!DOCTYPE HTML PUBLIC '-//W3C//DTD HTML 4.01 Transitional//EN'>";
    $html .= "<html>";
    $html .= "<body>";
    $html .= "<tr>";

    $html .= "<table cellpadding='1' cellspacing='0' border='0' style='width:100%' font-size:11px; font-family:Tahoma;'>";
    $html .= "<td style='width:100%;height:100%;text-align:right;font-size:12px;font-family:Tahoma;'>";
    $html .= "$fecha  $tipo";
    $html .= "</td>";
    $html .= "<tr>";
    $sql = "SELECT ma.nombre AS marca,ma.talla,ma.opcionb,ma.pedido
FROM  `marcas` ma
WHERE ma.idmarca = '$idmarca'";

    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'marca');
    $marcalista = $idalmacenA2['resultado'];
    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'talla');
    $opcionmarca = $idalmacenA2['resultado'];
    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'opcionb');
    $opcionb = $idalmacenA2['resultado'];
    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'pedido');
    $marcapedido = $idalmacenA2['resultado'];
    $idsCAr = split("-", $opcionmarca);
    $rango1=$idsCAr[0];
    $rango2=$idsCAr[1];
    if($opcionmarca="33-45"){
        $tipo="1";
    }else{
        if($opcionmarca="14-38"){
            $tipo="3";
        }
    }
    $html .= "<td style='width:100%;height:100px;text-align:center;font-size:15px;font-family:Tahoma;'>";

    $html .= "INVENTARIO $marcalista<br>";

    //    $html .= "Ventas por Marca<br>";
    $html .= "CORRESPONDIENTES DEL $fechaini AL $fechafinn<br>";
    //     $html .= "Tienda $tienda";
    $html .= "</td>";
    $html .= "</tr>";
    $html .= "</table>";
    $html .= "</tr>";
    $html .= "<tr>";
    $html .= "<td colspan='3'>";

    $html .= "<table width='1250' border='0' cellspacing='0' cellpadding='0'><tr>";

    $select = "idestilo,nombre";
    $from = "estilos";
    $where .= " descripcion = '$idmarca' ORDER BY CAST( nombre AS SIGNED) ASC";
    $sql2 = "SELECT ".$select." FROM ".$from." WHERE ".$where;
    $row = NumeroTuplas($sql2);
    $row1= $row['resultado'];
    $sql21 = getTablaToArrayOfSQL($sql2);
    $sql3 = $sql21['resultado'];
    $row5 = NumeroTuplas($sql2);
    $row15= $row5['resultado'];
    //    $html .= "<td style='width:100%;text-align:center;font-size:1px;font-family:Tahoma;'>";
    $html .= "<table cellpadding='0' cellspacing='0' border='0' style='width:100%;border:0px solid #000000;font-size:11px;text-align:center'>";
    $html .= "<tr>";
    for($i=0;$i<=$row15;$i++){
        $codigo = $sql3[$i];
        $idestilo = $codigo['idestilo'];
        $nombreestilo = $codigo['nombre'];
        $html .= "<tr style='width:100%; font-size:11px;'>";
        $html .=" <td style='font-size:11px;text-align:left'>".$nombreestilo."";
        $html .=" </td> ";
        $html .= "</tr>";
        $html .= "<tr>";
        $select1 = "talla,idmodelo";
        $from1 = "tallasdetalle";
        $where1 = "talla >='$rango1' AND talla <='$rango2' AND idmodelo='2' ORDER BY talla ASC";
        $sql21 = "SELECT ".$select1." FROM ".$from1." WHERE ".$where1;
        $row = NumeroTuplas($sql21);
        $row1= $row['resultado'];

        $select = "SUM(saldocantidad) AS Pares";
        $from = "historialkardextienda k,modelos mdt";
        $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND mdt.stylename = '$idestilo' ";
        $sql2121 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
        $almacenA1 =  findBySqlReturnCampoUnique($sql2121, true, true, 'Pares');
        $totalparesestilo = $almacenA1['resultado'];
        $select = "SUM(saldocantidad*precio2bs) AS bs";
        $from = "historialkardextienda k,modelos mdt";
        $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND mdt.stylename = '$idestilo' ";
        $sql2121 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
        $almacenA1 =  findBySqlReturnCampoUnique($sql2121, true, true, 'bs');
        $totalbsestilo = $almacenA1['resultado'];
        $select = "dtp.iddetalleingreso";
        $from = "adiciondetalleingreso dtp, modelos mdd, coleccion col, estilos es";
        $where = "dtp.idmodelo = mdd.idmodelo AND mdd.idcoleccion = col.idcoleccion AND mdd.stylename = es.idestilo AND dtp.unido='no' AND mdd.idmarca = '$idmarca' AND mdd.stylename='$idestilo'";
        $sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where." ORDER BY CAST( `mdd`.`codigo` AS SIGNED) ASC";
        $table = dibujarTablaOfSQLinventario($sql25,$sql21,$row1,$idmarca,$idestilo,$rango1,$rango2,$totalparesestilo,$totalbsestilo, $tipo,$marcapedido);

        $html .= $table['resultado'];
        $html .= "</tr>";
        //       ss
    }
    //totales de totales
    $html .= "</tr>";
    $html .= "</table>";

    $html .= "<table cellpadding='1' cellspacing='0' border='0' style='width:50%' font-size:25px; font-family:Tahoma;'>";
    $html .= "<tr style='width:50%;height:50%;text-align:right;font-size:25px;font-family:Tahoma;'>";
    $select21 .= "SUM( dtp.saldocantidad *dtp.precio2bs) AS TOTALbs ";
    $from21 = "historialkardextienda dtp, modelos mdd, coleccion col";
    $where21 = "dtp.idmodelodetalle = mdd.idmodelo AND mdd.idcoleccion = col.idcoleccion AND mdd.idmarca='$idmarca'";

    $sqltotalbs = "SELECT ".$select21." FROM ".$from21. " WHERE ".$where21;
    $idalmacenA2 =  findBySqlReturnCampoUnique($sqltotalbs, true, true, 'TOTALbs');
    $totalbs = $idalmacenA2['resultado'];

    $select2 .= "SUM( dtp.saldocantidad ) AS TOTALPARES ";
    $from2 = "historialkardextienda dtp, modelos mdd, coleccion col";
    $where2 = "dtp.idmodelodetalle = mdd.idmodelo AND mdd.idcoleccion = col.idcoleccion AND mdd.idmarca='$idmarca'";

    $sqltotalpares = "SELECT ".$select2." FROM ".$from2. " WHERE ".$where2;
    // echo $sqltotalpares;
    $idalmacenA2 =  findBySqlReturnCampoUnique($sqltotalpares, true, true, 'TOTALPARES');
    $totalpares = $idalmacenA2['resultado'];
    // echo $sqltotalpares;

    $producto2 = dibujarTuplaOfSQLSimpleinventario($sqltotalpares,$totalpares,$totalbs);
    $html .= $producto2['resultado'];
    $html .= "</tr>";
    $html .= "</table>";

    $html .= "</body>";
    $html .= "</html>";
    if($return == true)
    {
        return $html;
    }
    else
    {
        echo $html;
    }
}
function verIngresosMarcaEstiloHTMLInventario2Ventas($idmarca,$idestilo,$idkardex, $return)
{
    $html = "";
    $html .= "<tr><td colspan='4' align='center'>
    <p>Nova Moda S.RL.<br />
         <br />
         Telf. 4-258993  Fax: 4-504183
    </p>
</td></tr>";

    $html .= "<!DOCTYPE HTML PUBLIC '-//W3C//DTD HTML 4.01 Transitional//EN'>";
    $html .= "<html>";
    $html .= "<body>";
    $html .= "<tr>";

    $html .= "<table cellpadding='1' cellspacing='0' border='0' style='width:100%' font-size:11px; font-family:Tahoma;'>";
    $html .= "<td style='width:100%;height:100%;text-align:right;font-size:12px;font-family:Tahoma;'>";
    $html .= "$fecha  $tipo";
    $html .= "</td>";
    $html .= "<tr>";
    $sql = "SELECT ma.nombre AS marca,ma.talla,ma.opcionb,ma.pedido
FROM  `marcas` ma
WHERE ma.idmarca = '$idmarca'";

    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'marca');
    $marcalista = $idalmacenA2['resultado'];
    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'talla');
    $opcionmarca = $idalmacenA2['resultado'];
    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'opcionb');
    $opcionb = $idalmacenA2['resultado'];
    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'pedido');
    $marcapedido = $idalmacenA2['resultado'];
    $idsCAr = split("-", $opcionmarca);
    $rango1=$idsCAr[0];
    $rango2=$idsCAr[1];
    if($opcionmarca="33-45"){
        $tipo="1";
    }else{
        if($opcionmarca="14-38"){
            $tipo="3";
        }
    }
    $sqlmarca = " SELECT tabla,mesrango,idperiodo,fechainicio,fechafin FROM administrakardex WHERE idkardex = '$idkardex' ";
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "tabla");
    $tabla = $opcionkardex['resultado'];
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "mesrango");
    $mesrango = $opcionkardex['resultado'];
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "idperiodo");
    $idperiodo = $opcionkardex['resultado'];
    //echo $tabla;
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "fechainicio");
    $fechainicio = $opcionkardex['resultado'];
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "fechafin");
    $fechafin = $opcionkardex['resultado'];
    if($fechafin==null ||$fechafin == ""){
        $fechafin = Date("Y-m-d");}

    $formatear = explode( '-' , $fechainicio);
    $fechain = $formatear[2].'-'.$formatear[1].'-' .$formatear[0];
    $formatear = explode( '-' , $fechafin);
    $fechaf = $formatear[2].'-'.$formatear[1].'-' .$formatear[0];
    $html .= "<td style='width:100%;height:100px;text-align:center;font-size:15px;font-family:Tahoma;'>";

    $html .= "INVENTARIO $marcalista<br>";

    //    $html .= "Ventas por Marca<br>";
    $html .= "CORRESPONDIENTE DEL $fechain AL $fechaf<br>";
    //     $html .= "Tienda $tienda";
    $html .= "</td>";
    $html .= "</tr>";
    $html .= "</table>";
    $html .= "</tr>";
    $html .= "<tr>";
    $html .= "<td colspan='3'>";

    $html .= "<table width='1250' border='0' cellspacing='0' cellpadding='0'><tr>";

    $select = "idestilo,nombre";
    $from = "estilos";
    $where .= " descripcion = '$idmarca' ORDER BY ordennumero ASC";
    $sql2 = "SELECT ".$select." FROM ".$from." WHERE ".$where;
    $row = NumeroTuplas($sql2);
    $row1= $row['resultado'];
    $sql21 = getTablaToArrayOfSQL($sql2);
    $sql3 = $sql21['resultado'];
    $row5 = NumeroTuplas($sql2);
    $row15= $row5['resultado'];
    //    $html .= "<td style='width:100%;text-align:center;font-size:1px;font-family:Tahoma;'>";
    $html .= "<table cellpadding='0' cellspacing='0' border='0' style='width:100%;border:0px solid #000000;font-size:11px;text-align:center'>";
    $html .= "<tr>";
    for($i=0;$i<=$row15;$i++){
        $codigo = $sql3[$i];
        $idestilo = $codigo['idestilo'];
        $nombreestilo = $codigo['nombre'];
        $html .= "<tr style='width:100%; font-size:11px;'>";
        $html .=" <td style='font-size:11px;text-align:left'>".$nombreestilo."";
        $html .=" </td> ";
        $html .= "</tr>";
        $html .= "<tr>";
        $select1 = "talla,idmodelo";
        $from1 = "tallasdetalle";
        $where1 = "talla >='$rango1' AND talla <='$rango2' AND idmodelo='2' ORDER BY talla ASC";
        $sql21 = "SELECT ".$select1." FROM ".$from1." WHERE ".$where1;
        $row = NumeroTuplas($sql21);
        $row1= $row['resultado'];

        $select = "SUM(saldocantidad) AS Pares";
        $from = "adicionkardextienda k,modelos mdt";
        $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND mdt.stylename = '$idestilo' AND k.unido='no'";
        $sql2121 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
        $almacenA1 =  findBySqlReturnCampoUnique($sql2121, true, true, 'Pares');
        $totalparesestilo = $almacenA1['resultado'];
        $select = "SUM(saldocantidad*precio2bs) AS bs";
        $from = "adicionkardextienda k,modelos mdt";
        $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND mdt.stylename = '$idestilo' AND k.unido='no' ";
        $sql2121 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
        $almacenA1 =  findBySqlReturnCampoUnique($sql2121, true, true, 'bs');
        $totalbsestilo = $almacenA1['resultado'];
        $select = "dtp.iddetalleingreso";
        $from = "adiciondetalleingreso dtp, modelos mdd, coleccion col, estilos es";
        $where = "dtp.idmodelo = mdd.idmodelo AND mdd.idcoleccion = col.idcoleccion AND mdd.stylename = es.idestilo AND dtp.unido='no' AND dtp.estado='activo' AND mdd.idmarca = '$idmarca' AND mdd.stylename='$idestilo'";
        //   $where = "dtp.idmodelo = mdd.idmodelo AND mdd.idcoleccion = col.idcoleccion AND mdd.stylename = es.idestilo AND dtp.unido='no' AND dtp.estado='activo' AND mdd.idmarca = '$idmarca' AND mdd.stylename='$idestilo'";

        $sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where." ORDER BY CAST( `mdd`.`codigo` AS SIGNED) ASC";

        $table = dibujarTablaOfSQLinventarioVentasTotal($idkardex,$sql25,$sql21,$row1,$idmarca,$idestilo,$rango1,$rango2,$totalparesestilo,$totalbsestilo, $tipo,$marcapedido);
        //$table = dibujarTablaOfSQLinventarioVentasTotal($idkardex,$sql25,$sql21,$row1,$idmarca,$idestilo,$rango1,$rango2,$totalparesestilo,$totalbsestilo, $tipo,$marcapedido);

        $html .= $table['resultado'];
        $html .= "</tr>";
        //       ss
    }
    //totales de totales
    $html .= "</tr>";
    $html .= "</table>";

    $html .= "<table cellpadding='1' cellspacing='0' border='0' style='width:50%' font-size:25px; font-family:Tahoma;'>";
    $html .= "<tr style='width:50%;height:50%;text-align:right;font-size:25px;font-family:Tahoma;'>";


    if($tabla=="historialkardextienda"){
        $select = "SUM( k.precio2bs * k.saldocantidad) As bs";
        $from = "historialkardextienda k,modelos mdt";
        $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND k.idperiodo='$idperiodo' AND k.unido='no'";
        $sql2121 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

        $almacenA1 =  findBySqlReturnCampoUnique($sql2121, true, true, 'bs');
        $totalparesbs = $almacenA1['resultado'];


        $select = "SUM(k.saldocantidad) As par";
        $from = "historialkardextienda k,modelos mdt";
        $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND k.idperiodo='$idperiodo' AND k.unido='no'";
        $sql2121 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

        $almacenA1 =  findBySqlReturnCampoUnique($sql2121, true, true, 'par');
        $totalpares = $almacenA1['resultado'];
        //echo $sql2121;
    }else{
        $select = "SUM( k.precio2bs * k.saldocantidad) As bs";
        $from = "adicionkardextienda k,modelos mdt";
        $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND k.unido='no'";
        $sql2121 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

        $almacenA1 =  findBySqlReturnCampoUnique($sql2121, true, true, 'bs');
        $totalparesbs = $almacenA1['resultado'];


        $select = "SUM(k.saldocantidad) As bs";
        $from = "adicionkardextienda k,modelos mdt";
        $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND k.unido='no' ";
        $sql2121 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

        $almacenA1 =  findBySqlReturnCampoUnique($sql2121, true, true, 'bs');
        $totalpares = $almacenA1['resultado'];
    }

    $html .= "<td style='width:100%;text-align:center;font-size:1px;font-family:Tahoma;'>";
    $html .= "<table cellpadding='0' cellspacing='0' border='1' style='width:100%;border:1px solid #000000;font-size:11px;text-align:center'>";

    $html .= "<tr><td style='font-size:11px;font-weight:bold;'>Pares:</td><td>".$totalpares."</td></tr>";
    $html .= "<tr><td style='font-size:11px;font-weight:bold;'>Bs:</td><td>".$totalparesbs."</td></tr>";
    $html .= "</table>";

    $html .= "</td></tr>";

    //    $producto2 = dibujarTuplaOfSQLSimpleinventario($sqltotalpares,$totalpares,$totalparesbs);
    //    $html .= $producto2['resultado'];
    //    $html .= "</tr>";
    $html .= "</table>";

    $html .= "</body>";
    $html .= "</html>";
    if($return == true)
    {
        return $html;
    }
    else
    {
        echo $html;
    }
}

function verIngresosMarcaEstiloHTMLInventario2VentasVacio($idmarca,$idestilo,$idkardex, $return)
{
    $html = "";
    $html .= "<tr><td colspan='4' align='center'>
    <p>Nova Moda S.RL.<br />
         <br />
         Telf. 4-258993  Fax: 4-504183
    </p>
</td></tr>";

    $html .= "<!DOCTYPE HTML PUBLIC '-//W3C//DTD HTML 4.01 Transitional//EN'>";
    $html .= "<html>";
    $html .= "<body>";
    $html .= "<tr>";

    $html .= "<table cellpadding='1' cellspacing='0' border='0' style='width:100%' font-size:11px; font-family:Tahoma;'>";
    $html .= "<td style='width:100%;height:100%;text-align:right;font-size:12px;font-family:Tahoma;'>";
    $html .= "$fecha  $tipo";
    $html .= "</td>";
    $html .= "<tr>";
    $sql = "SELECT ma.nombre AS marca,ma.talla,ma.opcionb,ma.pedido
FROM  `marcas` ma
WHERE ma.idmarca = '$idmarca'";

    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'marca');
    $marcalista = $idalmacenA2['resultado'];
    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'talla');
    $opcionmarca = $idalmacenA2['resultado'];
    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'opcionb');
    $opcionb = $idalmacenA2['resultado'];
    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'pedido');
    $marcapedido = $idalmacenA2['resultado'];
    $idsCAr = split("-", $opcionmarca);
    $rango1=$idsCAr[0];
    $rango2=$idsCAr[1];
    if($opcionmarca="33-45"){
        $tipo="1";
    }else{
        if($opcionmarca="14-38"){
            $tipo="3";
        }
    }
    $sqlmarca = " SELECT tabla,mesrango,idperiodo,fechainicio,fechafin FROM administrakardex WHERE idkardex = '$idkardex' ";
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "tabla");
    $tabla = $opcionkardex['resultado'];
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "mesrango");
    $mesrango = $opcionkardex['resultado'];
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "idperiodo");
    $idperiodo = $opcionkardex['resultado'];
    //echo $tabla;
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "fechainicio");
    $fechainicio = $opcionkardex['resultado'];
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "fechafin");
    $fechafin = $opcionkardex['resultado'];
    if($fechafin==null ||$fechafin == ""){
        $fechafin = Date("Y-m-d");}

    $formatear = explode( '-' , $fechainicio);
    $fechain = $formatear[2].'-'.$formatear[1].'-' .$formatear[0];
    $formatear = explode( '-' , $fechafin);
    $fechaf = $formatear[2].'-'.$formatear[1].'-' .$formatear[0];
    $html .= "<td style='width:100%;height:100px;text-align:center;font-size:15px;font-family:Tahoma;'>";

    $html .= "INVENTARIO $marcalista<br>";

    //    $html .= "Ventas por Marca<br>";
    $html .= "CORRESPONDIENTE DEL $fechain AL $fechaf<br>";
    //     $html .= "Tienda $tienda";
    $html .= "</td>";
    $html .= "</tr>";
    $html .= "</table>";
    $html .= "</tr>";
    $html .= "<tr>";
    $html .= "<td colspan='3'>";

    $html .= "<table width='1250' border='0' cellspacing='0' cellpadding='0'><tr>";

    $select = "idestilo,nombre";
    $from = "estilos";
    $where .= " descripcion = '$idmarca' ORDER BY CAST( nombre AS SIGNED) ASC";
    $sql2 = "SELECT ".$select." FROM ".$from." WHERE ".$where;
    $row = NumeroTuplas($sql2);
    $row1= $row['resultado'];
    $sql21 = getTablaToArrayOfSQL($sql2);
    $sql3 = $sql21['resultado'];
    $row5 = NumeroTuplas($sql2);
    $row15= $row5['resultado'];
    //    $html .= "<td style='width:100%;text-align:center;font-size:1px;font-family:Tahoma;'>";
    $html .= "<table cellpadding='0' cellspacing='0' border='0' style='width:100%;border:0px solid #000000;font-size:11px;text-align:center'>";
    $html .= "<tr>";
    for($i=0;$i<=$row15;$i++){
        $codigo = $sql3[$i];
        $idestilo = $codigo['idestilo'];
        $nombreestilo = $codigo['nombre'];
        $html .= "<tr style='width:100%; font-size:11px;'>";
        $html .=" <td style='font-size:11px;text-align:left'>".$nombreestilo."";
        $html .=" </td> ";
        $html .= "</tr>";
        $html .= "<tr>";
        $select1 = "talla,idmodelo";
        $from1 = "tallasdetalle";
        $where1 = "talla >='$rango1' AND talla <='$rango2' AND idmodelo='2' ORDER BY talla ASC";
        $sql21 = "SELECT ".$select1." FROM ".$from1." WHERE ".$where1;
        $row = NumeroTuplas($sql21);
        $row1= $row['resultado'];

        $select = "SUM(saldocantidad) AS Pares";
        $from = "adicionkardextienda k,modelos mdt";
        $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND mdt.stylename = '$idestilo' AND k.unido='no'";
        $sql2121 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
        $almacenA1 =  findBySqlReturnCampoUnique($sql2121, true, true, 'Pares');
        $totalparesestilo = $almacenA1['resultado'];
        $select = "SUM(saldocantidad*precio2bs) AS bs";
        $from = "adicionkardextienda k,modelos mdt";
        $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND mdt.stylename = '$idestilo' AND k.unido='no' ";
        $sql2121 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
        $almacenA1 =  findBySqlReturnCampoUnique($sql2121, true, true, 'bs');
        $totalbsestilo = $almacenA1['resultado'];
        $select = "dtp.iddetalleingreso";
        $from = "adiciondetalleingreso dtp, modelos mdd, coleccion col, estilos es";
        $where = "dtp.idmodelo = mdd.idmodelo AND mdd.idcoleccion = col.idcoleccion AND mdd.stylename = es.idestilo AND dtp.unido='no' AND mdd.idmarca = '$idmarca' AND mdd.stylename='$idestilo'";
        $sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where." ORDER BY CAST( `mdd`.`codigo` AS SIGNED) ASC";
        $table = dibujarTablaOfSQLinventarioVacio($idkardex,$sql25,$sql21,$row1,$idmarca,$idestilo,$rango1,$rango2,$totalparesestilo,$totalbsestilo, $tipo,$marcapedido);
        //$table = dibujarTablaOfSQLinventarioVentasTotal($idkardex,$sql25,$sql21,$row1,$idmarca,$idestilo,$rango1,$rango2,$totalparesestilo,$totalbsestilo, $tipo,$marcapedido);

        $html .= $table['resultado'];
        $html .= "</tr>";
        //       ss
    }
    //totales de totales


    //    $producto2 = dibujarTuplaOfSQLSimpleinventario($sqltotalpares,$totalpares,$totalparesbs);
    //    $html .= $producto2['resultado'];
    //    $html .= "</tr>";
    $html .= "</table>";

    $html .= "</body>";
    $html .= "</html>";
    if($return == true)
    {
        return $html;
    }
    else
    {
        echo $html;
    }
}
function verIngresosMarcaEstiloHTMLModelotallam($idmarca,$idestilo,$modelo, $return)
{
    $html = "";
    $html .= "<tr><td colspan='4' align='center'>
    <p>Nova Moda S.RL.<br />
         <br />
         Telf. 4-258993  Fax: 4-504183
    </p>
</td></tr>";

    $html .= "<!DOCTYPE HTML PUBLIC '-//W3C//DTD HTML 4.01 Transitional//EN'>";
    $html .= "<html>";
    $html .= "<body>";
    $html .= "<tr>";

    $html .= "<table cellpadding='1' cellspacing='0' border='0' style='width:100%' font-size:11px; font-family:Tahoma;'>";
    $html .= "<td style='width:100%;height:100%;text-align:right;font-size:12px;font-family:Tahoma;'>";
    $html .= "$fecha  $tipo";
    $html .= "</td>";
    $html .= "<tr>";
    $sql = "SELECT ma.nombre AS marca,ma.talla,ma.opcionb,ma.pedido
FROM  `marcas` ma
WHERE ma.idmarca = '$idmarca'";

    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'marca');
    $marcalista = $idalmacenA2['resultado'];
    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'talla');
    $opcionmarca = $idalmacenA2['resultado'];
    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'opcionb');
    $opcionb = $idalmacenA2['resultado'];
    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'pedido');
    $marcapedido = $idalmacenA2['resultado'];
    $idsCAr = split("-", $opcionmarca);
    $rango1=$idsCAr[0];
    $rango2=$idsCAr[1];
    if($opcionmarca="33-45"){
        $tipo="1";
    }else{
        if($opcionmarca="14-38"){
            $tipo="3";
        }
    }
    $sqlmarca = " SELECT tabla,mesrango,idperiodo,fechainicio,fechafin FROM administrakardex WHERE idkardex = '$idkardex' ";
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "tabla");
    $tabla = $opcionkardex['resultado'];
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "mesrango");
    $mesrango = $opcionkardex['resultado'];
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "idperiodo");
    $idperiodo = $opcionkardex['resultado'];
    //echo $tabla;
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "fechainicio");
    $fechainicio = $opcionkardex['resultado'];
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "fechafin");
    $fechafin = $opcionkardex['resultado'];
    if($fechafin==null ||$fechafin == ""){
        $fechafin = Date("Y-m-d");}

    $formatear = explode( '-' , $fechainicio);
    $fechain = $formatear[2].'-'.$formatear[1].'-' .$formatear[0];
    $formatear = explode( '-' , $fechafin);
    $fechaf = $formatear[2].'-'.$formatear[1].'-' .$formatear[0];
    $html .= "<td style='width:100%;height:50px;text-align:center;font-size:20px;font-family:Arial;'>";
    $html .= "<b><u>INVENTARIO $marcalista</u></b><br>";

    $html .= "</td>";
    $html .= "</tr>";

    $html .= "</table>";
    $html .= "</tr>";
    $html .= "<tr>";
    $html .= "<td colspan='3'>";

    $html .= "<table width='1250' border='0' cellspacing='0' cellpadding='0'><tr>";
    //AND mdt.codigo LIKE '%$modelo%'
    //AND m.codigo = '$modelo'
    $select = "e.idestilo,e.nombre";
    $from = "modelos m, adiciondetalleingreso dtp, estilos e";
    $where .= " dtp.idmodelo = m.idmodelo
AND m.stylename = e.idestilo
AND dtp.unido = 'no'
AND m.idmarca = '$idmarca'
AND m.codigo LIKE '%$modelo%' group by  e.idestilo";
    $sql2 = "SELECT ".$select." FROM ".$from." WHERE ".$where;
    $row = NumeroTuplas($sql2);
    $row1= $row['resultado'];
    $sql21 = getTablaToArrayOfSQL($sql2);
    $sql3 = $sql21['resultado'];
    $row5 = NumeroTuplas($sql2);
    $row15= $row5['resultado'];
    //    $html .= "<td style='width:100%;text-align:center;font-size:1px;font-family:Tahoma;'>";
    $html .= "<table cellpadding='0' cellspacing='0' border='0' style='width:100%;border:0px solid #000000;font-size:12px;text-align:center'>";
    $html .= "<tr>";
    for($i=0;$i<=$row15;$i++){
        $codigo = $sql3[$i];
        $idestilo = $codigo['idestilo'];
        $nombreestilo = $codigo['nombre'];
        $html .= "<tr style='width:100%; font-size:11px;'>";
        $html .=" <td style='font-size:13px;text-align:left'>".$nombreestilo."";
        $html .=" </td> ";
        $html .= "</tr>";
        $html .= "<tr>";
        $iddet1="1";
        $iddet2="26";
        $rango1=$iddet1;
        $rango2=$iddet2;
        $select = "talla,idmodelo,iddetalleingresotalla,tallasm";
        $from = "tallasdetallem";
        $where = "iddetalleingresotalla >='$iddet1' AND iddetalleingresotalla <='$iddet2' ORDER BY iddetalleingresotalla ASC";
        $sql21 = "SELECT ".$select." FROM ".$from." WHERE ".$where;
        $row = NumeroTuplas($sql21);
        $row1= $row['resultado'];

        $select = "SUM(saldocantidad) AS Pares";
        $from = "adicionkardextienda k,modelos mdt";
        $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND mdt.stylename = '$idestilo' AND k.unido='no'";
        $sql2121 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
        $almacenA1 =  findBySqlReturnCampoUnique($sql2121, true, true, 'Pares');
        $totalparesestilo = $almacenA1['resultado'];
        $select = "SUM(saldocantidad*precio2bs) AS bs";
        $from = "adicionkardextienda k,modelos mdt";
        $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND mdt.stylename = '$idestilo' AND k.unido='no'";
        $sql2121 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
        $almacenA1 =  findBySqlReturnCampoUnique($sql2121, true, true, 'bs');
        $totalbsestilo = $almacenA1['resultado'];
        $select = "dtp.iddetalleingreso";
        $from = "adiciondetalleingreso dtp, modelos mdd, coleccion col, estilos es";
        $where = "dtp.idmodelo = mdd.idmodelo AND mdd.idcoleccion = col.idcoleccion AND mdd.stylename = es.idestilo AND dtp.unido='no' AND mdd.idmarca = '$idmarca' AND mdd.stylename='$idestilo' AND mdd.codigo LIKE '%$modelo%'";
        $sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where." ORDER BY CAST( `mdd`.`codigo` AS SIGNED) ASC";

        $table = dibujarTablaOfSQLinventariotallam($modelo,$sql25,$sql21,$row1,$idmarca,$idestilo,$rango1,$rango2,$totalparesestilo,$totalbsestilo, "2",$marcapedido);
        $html .= $table['resultado'];

        $html .= "</tr>";
        //       ss
    }
    //totales de totales
    $html .= "</tr>";
    $html .= "</table>";


    $html .= "</body>";
    $html .= "</html>";
    if($return == true)
    {
        return $html;
    }
    else
    {
        echo $html;
    }
}
function verIngresosMarcaEstiloHTMLModelo($idmarca,$idestilo,$modelo,$tiponum, $return)
{
    $html = "";
    $html .= "<tr><td colspan='4' align='center'>
    <p>Nova Moda S.RL.<br />
         <br />
         Telf. 4-258993  Fax: 4-504183
    </p>
</td></tr>";

    $html .= "<!DOCTYPE HTML PUBLIC '-//W3C//DTD HTML 4.01 Transitional//EN'>";
    $html .= "<html>";
    $html .= "<body>";
    $html .= "<tr>";

    $html .= "<table cellpadding='1' cellspacing='0' border='0' style='width:100%' font-size:11px; font-family:Tahoma;'>";
    $html .= "<td style='width:100%;height:100%;text-align:right;font-size:12px;font-family:Tahoma;'>";
    $html .= "$fecha  $tipo";
    $html .= "</td>";
    $html .= "<tr>";
    $sql = "SELECT ma.nombre AS marca,ma.talla,ma.opcionb,ma.pedido
FROM  `marcas` ma
WHERE ma.idmarca = '$idmarca'";

    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'marca');
    $marcalista = $idalmacenA2['resultado'];
    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'talla');
    $opcionmarca = $idalmacenA2['resultado'];
    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'opcionb');
    $opcionb = $idalmacenA2['resultado'];
    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'pedido');
    $marcapedido = $idalmacenA2['resultado'];
    $idsCAr = split("-", $opcionmarca);
    $rango1=$idsCAr[0];
    $rango2=$idsCAr[1];
    if($opcionmarca="33-45"){
        $tipo="1";
    }else{
        if($opcionmarca="14-38"){
            $tipo="3";
        }
    }
    $sqlmarca = " SELECT tabla,mesrango,idperiodo,fechainicio,fechafin FROM administrakardex WHERE idkardex = '$idkardex' ";
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "tabla");
    $tabla = $opcionkardex['resultado'];
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "mesrango");
    $mesrango = $opcionkardex['resultado'];
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "idperiodo");
    $idperiodo = $opcionkardex['resultado'];
    //echo $tabla;
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "fechainicio");
    $fechainicio = $opcionkardex['resultado'];
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "fechafin");
    $fechafin = $opcionkardex['resultado'];
    if($fechafin==null ||$fechafin == ""){
        $fechafin = Date("Y-m-d");}

    $formatear = explode( '-' , $fechainicio);
    $fechain = $formatear[2].'-'.$formatear[1].'-' .$formatear[0];
    $formatear = explode( '-' , $fechafin);
    $fechaf = $formatear[2].'-'.$formatear[1].'-' .$formatear[0];
    $html .= "<td style='width:100%;height:50px;text-align:center;font-size:20px;font-family:Arial;'>";
    $html .= "<b><u>INVENTARIO $marcalista</u></b><br>";

    $html .= "</td>";
    $html .= "</tr>";

    $html .= "</table>";
    $html .= "</tr>";
    $html .= "<tr>";
    $html .= "<td colspan='3'>";

    $html .= "<table width='1250' border='0' cellspacing='0' cellpadding='0'><tr>";

    //   { $where .= " AND m.codigo LIKE '%$modelo%' "; }

    if($tiponum=="1"){
        $select = "e.idestilo,e.nombre";
        $from = "modelos m, adiciondetalleingreso dtp, estilos e";
        $where .= " dtp.idmodelo = m.idmodelo
AND m.stylename = e.idestilo
AND dtp.unido = 'no'
AND m.idmarca = '$idmarca'
AND m.codigo LIKE '%$modelo%' group by e.idestilo";
        $sql2 = "SELECT ".$select." FROM ".$from." WHERE ".$where;
    }else{

        $formatear = explode( '-' , $modelo);
        $linea = $formatear[0];
        $mod = $formatear[1];
        $color = $formatear[2];
        $select = "e.idestilo,e.nombre";
        $from = "modelos m, adiciondetalleingreso dtp, estilos e,lineas l";
        $where .= " dtp.idmodelo = m.idmodelo
AND m.stylename = e.idestilo
AND dtp.unido = 'no'
AND m.idmarca = '$idmarca'
AND m.codigo ='$mod' AND m.idlinea=l.idlinea and l.codigo='$linea' group by e.idestilo";
        $sql2 = "SELECT ".$select." FROM ".$from." WHERE ".$where;
    }
    //    $select = "dtp.iddetalleingreso";
    //$from = "adiciondetalleingreso dtp, modelos mdd, coleccion col, estilos es,lineas l";
    //   $where = "dtp.idmodelo = mdd.idmodelo AND mdd.idcoleccion = col.idcoleccion AND mdd.idlinea=l.idlinea AND mdd.stylename = es.idestilo AND dtp.unido='no' AND mdd.idmarca = '$idmarca'
    //AND mdd.stylename='$idestilo' AND mdd.codigo='$mod' and l.codigo='$linea'";
    //    $sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where." ORDER BY CAST( `mdd`.`codigo` AS SIGNED) ASC";


    $row = NumeroTuplas($sql2);
    $row1= $row['resultado'];
    $sql21 = getTablaToArrayOfSQL($sql2);
    $sql3 = $sql21['resultado'];
    $row5 = NumeroTuplas($sql2);
    $row15= $row5['resultado'];
    //    $html .= "<td style='width:100%;text-align:center;font-size:1px;font-family:Tahoma;'>";
    $html .= "<table cellpadding='0' cellspacing='0' border='0' style='width:100%;border:0px solid #000000;font-size:12px;text-align:center'>";
    $html .= "<tr>";
    for($i=0;$i<=$row15;$i++){
        $codigo = $sql3[$i];
        $idestilo = $codigo['idestilo'];
        $nombreestilo = $codigo['nombre'];
        $html .= "<tr style='width:100%; font-size:11px;'>";
        $html .=" <td style='font-size:12px;text-align:left'>".$nombreestilo."";
        $html .=" </td> ";
        $html .= "</tr>";
        $html .= "<tr>";
        $select1 = "talla,idmodelo";
        $from1 = "tallasdetalle";
        $where1 = "talla >='$rango1' AND talla <='$rango2' AND idmodelo='2' ORDER BY talla ASC";
        $sql21 = "SELECT ".$select1." FROM ".$from1." WHERE ".$where1;
        $row = NumeroTuplas($sql21);
        $row1= $row['resultado'];

        $select = "SUM(saldocantidad) AS Pares";
        $from = "adicionkardextienda k,modelos mdt";
        $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND mdt.stylename = '$idestilo' AND k.unido='no'";
        $sql2121 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
        $almacenA1 =  findBySqlReturnCampoUnique($sql2121, true, true, 'Pares');
        $totalparesestilo = $almacenA1['resultado'];
        $select = "SUM(saldocantidad*precio2bs) AS bs";
        $from = "adicionkardextienda k,modelos mdt";
        $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND mdt.stylename = '$idestilo' AND k.unido='no' ";
        $sql2121 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
        $almacenA1 =  findBySqlReturnCampoUnique($sql2121, true, true, 'bs');
        $totalbsestilo = $almacenA1['resultado'];
        if($tiponum=="1"){
            $select = "dtp.iddetalleingreso";
            $from = "adiciondetalleingreso dtp, modelos mdd, coleccion col, estilos es";
            $where = "dtp.idmodelo = mdd.idmodelo AND mdd.idcoleccion = col.idcoleccion AND mdd.stylename = es.idestilo AND dtp.unido='no' AND mdd.idmarca = '$idmarca' AND mdd.stylename='$idestilo' AND mdd.codigo LIKE '%$modelo%'";
            $sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where." ORDER BY CAST( `mdd`.`codigo` AS SIGNED) ASC";

        }else{
            $formatear = explode( '-' , $modelo);
            $linea = $formatear[0];
            $mod = $formatear[1];
            $color = $formatear[2];

            $select = "dtp.iddetalleingreso";
            $from = "adiciondetalleingreso dtp, modelos mdd, coleccion col, estilos es,lineas l";
            $where = "dtp.idmodelo = mdd.idmodelo AND mdd.idcoleccion = col.idcoleccion AND mdd.idlinea=l.idlinea AND mdd.stylename = es.idestilo AND dtp.unido='no' AND mdd.idmarca = '$idmarca'
AND mdd.stylename='$idestilo' AND mdd.codigo='$mod' and l.codigo='$linea'";
            $sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where." ORDER BY CAST( `mdd`.`codigo` AS SIGNED) ASC";

        }

        $table = dibujarTablaOfSQLmodelos($modelo,$sql25,$sql21,$row1,$idmarca,$idestilo,$rango1,$rango2,$totalparesestilo,$totalbsestilo, $tipo,$marcapedido);
        //$table = dibujarTablaOfSQLinventarioVentasModelo($modelo,$sql25,$sql21,$row1,$idmarca,$idestilo,$rango1,$rango2,$totalparesestilo,$totalbsestilo, $tipo,$marcapedido);

        $html .= $table['resultado'];
        $html .= "</tr>";
        //       ss
    }
    //totales de totales
    $html .= "</tr>";
    $html .= "</table>";

    $html .= "<table cellpadding='1' cellspacing='0' border='0' style='width:50%' font-size:25px; font-family:Tahoma;'>";


    //    $producto2 = dibujarTuplaOfSQLSimpleinventario($sqltotalpares,$totalpares,$totalparesbs);
    //    $html .= $producto2['resultado'];
    //    $html .= "</tr>";
    $html .= "</table>";

    $html .= "</body>";
    $html .= "</html>";
    if($return == true)
    {
        return $html;
    }
    else
    {
        echo $html;
    }
}
function dibujarTablaOfSQLinventarioVentasModelo($modelo,$sql,$sql21,$row1,$idmarca,$idestilo,$rango1,$rango2,$total1,$total2, $tipo,$marcapedido)
{   $idalmacen =$_SESSION['idalmacen'];
    //reportegrande
    $sqlmarca = " SELECT tabla,mesrango,idperiodo,fechainicio,fechafin FROM administrakardex WHERE estado = 'pendiente' and idalmacen='$idalmacen' ";
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "tabla");
    $tabla = $opcionkardex['resultado'];
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "mesrango");
    $mesrango = $opcionkardex['resultado'];
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "idperiodo");
    $idperiodo = $opcionkardex['resultado'];
    //echo $tabla;
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "fechainicio");
    $fechainicio = $opcionkardex['resultado'];
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "fechafin");
    $fechafin = $opcionkardex['resultado'];
    //AND k.idperiodo='$idperiodo'

    if($fechafin==null ||$fechafin == ""){
        $fechafin = Date("Y-m-d");
    }
    if($tabla=="historialkardextienda"){
    }else{
        $sqlInv = "SELECT MAX(idperiodo)AS numero
FROM administrakardex where tabla='historialkardextienda'";
        $almacenA1 =  findBySqlReturnCampoUnique($sqlInv, true, true, 'numero');
        $idperiodoant = $almacenA1['resultado'];
        $sqlmarca = " SELECT tabla,mesrango,idperiodo,fechainicio,fechafin FROM administrakardex WHERE idperiodo = '$idperiodoant' ";
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "fechainicio");
        // $fechainicio = $opcionkardex['resultado'];
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "fechafin");
        // $fechafin = $opcionkardex['resultado'];
    }
    $sql211 = getTablaToArrayOfSQL($sql21);
    $sql3 = $sql211['resultado'];
    if($link=new BD)
    {
        if($link->conectar())
        {
            if($re = $link->consulta($sql))
            {
                //echo mysql_num_rows($re);
                if($fi = mysql_fetch_array($re))
                {
                    $devS .= "<table cellpadding='0' cellspacing='0' border='0' style='width:750px;border:1px solid #000000;font-size:11px;'>";
                    $devS .= "<tr><td style='border-bottom:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Nro</td>";
                    $devS .= "<td style='display:none;'>".mysql_field_name($re, $zz)."</td>";
                    // $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Modelo</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Modelo</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Color</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Precio</td>";
                    for($hi=0;$hi<$row1;$hi++){
                        $codigo = $sql3[$hi];
                        $idmmarca = $codigo['talla'];

                        $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>$idmmarca</td>";
                        $ji++;
                    }
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Anterior</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Rec</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Tras.Rec</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Dev</td>";

                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Tras.Des</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Venta</td>";


                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Prs Actual</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Bs</td>";

                    $devS .= "</tr>";
                    $ii = 0;
                    //$totalCount = mysql_num_rows($re);
                    $z = 1;
                    do{
                        $devS .= "<tr><td style='text-align:left'>".$z."</td>";
                        for($i = 0; $i< mysql_num_fields($re); $i++)
                        {$dato = $fi[$i];
                            $iddetalleingreso = $fi[$i]['iddetalleingreso'];

                            $devS .= "<td style='display:none;'>&nbsp;".$dato."&nbsp;</td>";
                            // echo $marcapedido;
                            $select = "dtp.totalbs AS precio";
                            $from = "adiciondetalleingreso dtp, modelos mdd, coleccion col, estilos es";
                            $where = "dtp.idmodelo = mdd.idmodelo AND mdd.idcoleccion = col.idcoleccion AND mdd.stylename = es.idestilo AND dtp.iddetalleingreso='$dato'";

                            if($marcapedido=='CODIGO-COLOR-MATERIAL'){
                                $select .= ",mdd.codigo, dtp.color";
                                // $select .= ",concat(col.detalle,'-',mdd.codigo) AS codigo, dtp.color";
                            }else{
                                if($marcapedido=="CODIGO-MATERIAL"){
                                    $select .= ",concat(mdd.codigo,'-',dtp.material) AS codigo, dtp.color";
                                }else{
                                    if(($marcapedido=="CODIGO-COLOR")||($marcapedido=="CODIGO")){
                                        $select .= ",mdd.codigo, dtp.color";
                                    }else{
                                        if($marcapedido=="CODIGO-COLOR-STYLENAME"){
                                            $select .= ",concat(mdd.codigo,'-',dtp.color) AS codigo, dtp.material AS color";
                                        }else{
                                            if($marcapedido=="LINEA-CODIGO-COLOR"){
                                                $select .= ",concat(l.codigo,'-',mdd.codigo) AS codigo, dtp.color AS color";
                                                //  $select .= ",concat(mdd.codigo,'-',dtp.color) AS codigo, dtp.material AS color";

                                                $from .= ",lineas l";
                                                $where .= "AND mdd.idlinea = l.idlinea";

                                            }
                                        }

                                    }
                                }
                            }
                            //lor
                            // $from = "adiciondetalleingreso dtp, modelos mdd, coleccion col, estilos es";
                            //$where = "dtp.idmodelo = mdd.idmodelo AND mdd.idcoleccion = col.idcoleccion AND mdd.stylename = es.idestilo AND dtp.iddetalleingreso='$dato'";
                            $sql2p1 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                            //echo $sql2p1;
                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p1, true, true, 'codigo');
                            $modelo = $almacenA1['resultado'];
                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p1, true, true, 'color');
                            $color = $almacenA1['resultado'];
                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p1, true, true, 'precio');
                            $precio = $almacenA1['resultado'];
                            $devS .= "<td style='text-align:left;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$modelo."&nbsp;</td>";
                            $devS .= "<td style='text-align:left;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$color."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$precio."&nbsp;</td>";

                            //lorg
                            for($h=0;$h<$row1;$h++){
                                $codigo = $sql3[$h];
                                $idmmarca = $codigo['talla'];


                                $select1 = "saldocantidad AS Pares";
                                $from1 = "adicionkardextienda";
                                $where1 = "idcalzado = '$dato' AND talla='$idmmarca'";
                                //if($ltienda != "Todos"){ $where .= " AND ve.idtienda = '$ltienda' ";}
                                $sql21 = "SELECT ".$select1." FROM ".$from1. " WHERE ".$where1;

                                $almacenA1 =  findBySqlReturnCampoUnique($sql21, true, true, 'Pares');
                                $pares1 = $almacenA1['resultado'];

                                //  if($pares1==NULL || $pares1 =='' || $pares1 == ""){ $pares1="0"; }
                                $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$pares1."&nbsp;</td>";
                                $j++;
                            }

                            if($tabla=="historialkardextienda"){
                                $sqlInv = "SELECT MAX(idperiodo)AS numero
FROM administrakardex where tabla='historialkardextienda'";
                                $almacenA1 =  findBySqlReturnCampoUnique($sqlInv, true, true, 'numero');
                                $idperiodoant = $almacenA1['resultado'];
                                $idper = $idperiodoant - 1;
                                $select = "SUM(saldocantidad) AS Pares";
                                $from = "historialkardextienda k";
                                $where = " k.idcalzado='$dato' AND k.idperiodo='$idper' AND k.unido='no'";
                                $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                                $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                                $stockanterior = $almacenA1['resultado'];
                            }
                            else{
                                $sqlInv = "SELECT MAX(idperiodo)AS numero
FROM administrakardex where tabla='historialkardextienda'";
                                $almacenA1 =  findBySqlReturnCampoUnique($sqlInv, true, true, 'numero');
                                $idperiodoant = $almacenA1['resultado'];
                                //  echo $idperiodoant;
                                $select = "SUM(saldocantidad) AS Pares";
                                $from = "historialkardextienda k";
                                $where = " k.idcalzado='$dato' AND k.idperiodo='$idperiodoant' AND k.unido='no'";
                                $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                                $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                                $stockanterior = $almacenA1['resultado'];

                            }

                            // $pares=$totalparesiddetalleingreso;
                            // echo $sql2p;
                            if($stockanterior==NULL || $stockanterior =='' || $stockanterior == ""){ $stockanterior="0"; }


                            $select = "SUM( dtpt.cantidad ) AS Pares";
                            $from = "adicioningresotienda k, adiciondetalleingresotalla dtpt, adiciondetalleingreso ad, modelos mdd";
                            $where = "k.idingreso = dtpt.idingreso AND dtpt.idmodelo = mdd.idmodelo
AND dtpt.iddetalleingreso = ad.iddetalleingreso";
                            { $where .= " AND k.fecha >= '$fechainicio' AND
k.fecha <= '$fechafin' AND  dtpt.iddetalleingreso='$dato'";}
                            if($idestilo !="null")
                            { $where .= " AND mdd.stylename = '$idestilo'";}
                            if($idestilo!=null || $idestilo!='')
                            { $where .= " AND mdd.stylename = '$idestilo'";}
                            $sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where;
                            $almacenA1 =  findBySqlReturnCampoUnique($sql25, true, true, 'Pares');
                            $recibido = $almacenA1['resultado'];

                            $select = "SUM(i.cantidad) AS Pares";
                            $from = "ingresos i,adicionkardextienda k";
                            $where = " k.idcalzado='$dato' AND k.idkardextienda=i.idkardextienda AND i.fecha >= '$fechainicio'
    AND i.fecha <= '$fechafin' AND i.detalle2!='ingresoalmacen' ";
                            $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                            $trasrecibido = $almacenA1['resultado'];
                            //     if($trasrecibido==NULL || $trasrecibido =='' || $trasrecibido == ""){ $trasrecibido="0";   }
                            $select = "SUM(i.cantidad) AS Pares";
                            $from = "itemventa i,adicionkardextienda k, ventasdetalle v";
                            $where = " k.idcalzado='$dato' AND k.idkardextienda=i.idkardextienda ANd i.idventa=v.idventadetalle AND  i.estado='cambiado'
and v.fecha >= '$fechainicio'
    AND v.fecha <= '$fechafin' ";
                            $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                            $devueltos = $almacenA1['resultado'];
                            // $pares=$totalparesiddetalleingreso;
                            // if($devueltos==NULL || $devueltos =='' || $devueltos == ""){ $devueltos="0"; }


                            $select = "SUM(i.cantidad) AS Pares";
                            $from = "detalletraspaso i,adicionkardextienda k,traspasos tr";
                            $where = " k.idcalzado='$dato' AND k.idkardextienda=i.idkardextienda ANd i.idtraspaso=tr.idtraspaso AND tr.fecha >= '$fechainicio'
    AND tr.fecha <= '$fechafin' ";
                            $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                            $trasdesp = $almacenA1['resultado'];

                            //  if($trasdesp==NULL || $trasdesp =='' || $trasdesp == ""){ $trasdesp="0"; }
                            $select = "SUM(i.cantidad) AS Pares";
                            $from = "itemventa i,adicionkardextienda k, ventasdetalle v";
                            $where = " k.idcalzado='$dato' AND k.idkardextienda=i.idkardextienda ANd i.idventa=v.idventadetalle AND  i.estado!='cambiado'
and v.fecha >= '$fechainicio'
    AND v.fecha <= '$fechafin' ";
                            $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                            $venta = $almacenA1['resultado'];
                            // $pares=$totalparesiddetalleingreso;
                            if($venta==NULL || $venta =='' || $venta == ""){ $venta="0"; }
                            if($tabla=="historialkardextienda"){

                                $select = "SUM(saldocantidad) AS Pares";
                                $from = "historialkardextienda k";
                                $where = " k.idcalzado='$dato' and k.unido='no' AND k.idperiodo='$idperiodo'";
                                $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                                $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                                $pares = $almacenA1['resultado'];
                            }else{
                                $select = "SUM(saldocantidad) AS Pares";
                                $from = "adicionkardextienda k";
                                $where = " k.idcalzado='$dato' and k.unido='no'";
                                $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                                $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                                $pares = $almacenA1['resultado'];

                            }
                            if($tabla=="historialkardextienda"){
                                $select = "SUM(saldocantidad*precio2bs) AS Pares";
                                $from = "historialkardextienda k";
                                $where = " k.idcalzado='$dato' and k.unido='no' AND k.idperiodo='$idperiodo'";
                                $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                                $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                                $totalbs = $almacenA1['resultado'];
                            }else{
                                $select = "SUM(saldocantidad*precio2bs) AS bs";
                                $from = "adicionkardextienda k";
                                $where = " k.idcalzado='$dato' and k.unido='no'";
                                $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                                $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'bs');
                                $totalbs = $almacenA1['resultado'];
                            }
                            // $pares=$totalparesiddetalleingreso;

                            if($pares==NULL || $pares =='' || $pares == ""){ $pares="0"; }


                            if($totalbs==NULL || $totalbs =='' || $totalbs == ""){ $totalbs="0"; }

                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$stockanterior."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$recibido."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$trasrecibido."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$devueltos."&nbsp;</td>";

                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$trasdesp."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$venta."&nbsp;</td>";

                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$pares."&nbsp;</td>";

                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$totalbs."&nbsp;</td>";

                        }
                        $devS .= "</tr>";
                        $ii++;
                        $z ++;
                    }while($fi = mysql_fetch_array($re));
                    //$devS .= "<tr><td style='border:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Total</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td style='border:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>$totalparesestilo</td><td style='border:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>$totalbsestilo</td>";
                    $devS .= "<tr style='background-color:silver;'><td style='border: 1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>TOTAL</td>";
                    $devS .= "<td style='display:none;'></td>";
                    $fechatoday = Date("d-m-Y");
                    $devS .= "<td style='text-align:center;border-bottom: 1px solid #000000;'></td>";
                    $devS .= "<td style='text-align:center;border-bottom: 1px solid #000000;'></td>";
                    $devS .= "<td style='text-align:center;border-bottom: 1px solid #000000;'></td>";

                    for($h=0;$h<$row1;$h++){
                        $codigo = $sql3[$h];
                        $idmmarca = $codigo['idmarca'];

                        $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'></td>";
                        $j++;
                    }

                    if($tabla=="historialkardextienda"){
                        $sqlInv = "SELECT MAX(idperiodo)AS numero
FROM administrakardex where tabla='historialkardextienda'";
                        $almacenA1 =  findBySqlReturnCampoUnique($sqlInv, true, true, 'numero');
                        $idperiodoant = $almacenA1['resultado'];
                        $idper = $idperiodoant - 1;
                        $select = "SUM(saldocantidad) AS Pares";
                        $from = "historialkardextienda k,modelos mdt";
                        $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND mdt.stylename = '$idestilo' AND k.idperiodo='$idper' AND k.unido='no'";
                        $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                        $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                        $tstockant = $almacenA1['resultado'];
                    }
                    else{
                        $sqlInv = "SELECT MAX(idperiodo)AS numero
FROM administrakardex where tabla='historialkardextienda'";
                        $almacenA1 =  findBySqlReturnCampoUnique($sqlInv, true, true, 'numero');
                        $idperiodoant = $almacenA1['resultado'];
                        $select = "SUM(saldocantidad) AS Pares";
                        $from = "historialkardextienda k,modelos mdt";
                        $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND mdt.stylename = '$idestilo' AND k.idperiodo='$idperiodoant' AND k.unido='no'";
                        $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                        //echo $sql2p;
                        $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                        $tstockant = $almacenA1['resultado'];
                    }

                    //reseteo
                    $select = "SUM( dtpt.cantidad ) AS Pares";
                    $from = "adicioningresotienda k, adiciondetalleingresotalla dtpt, adiciondetalleingreso ad, modelos mdd";
                    $where = "k.idingreso = dtpt.idingreso AND dtpt.idmodelo = mdd.idmodelo
AND dtpt.iddetalleingreso = ad.iddetalleingreso";
                    { $where .= " AND mdd.stylename = '$idestilo' AND k.fecha >= '$fechainicio' AND
k.fecha <= '$fechafin' ";}

                    $sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where;

                    $almacenA1 =  findBySqlReturnCampoUnique($sql25, true, true, 'Pares');
                    $recibido = $almacenA1['resultado'];
                    if($recibido==NULL || $recibido =='' || $recibido == ""){ $recibido="0"; }

                    $select = "SUM(i.cantidad) AS Pares";
                    $from = "ingresos i,adicionkardextienda k,modelos mdt";
                    $where = "k.idkardextienda=i.idkardextienda AND i.fecha >= '$fechainicio'
    AND i.fecha <= '$fechafin' and k.idmodelodetalle=mdt.idmodelo and mdt.stylename = '$idestilo' AND i.detalle2!='ingresoalmacen' ";
                    $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                    $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                    $trasrecibido = $almacenA1['resultado'];
                    if($trasrecibido==NULL || $trasrecibido =='' || $trasrecibido == ""){ $trasrecibido="0"; }

                    //$select = "SUM(i.cantidad) AS Pares";
                    //    $from = "itemventa i,adicionkardextienda k, ventasdetalle v,modelos mdt";
                    //    $where = "k.idkardextienda=i.idkardextienda ANd i.idventa=v.idventadetalle AND k.idmodelodetalle=mdt.idmodelo  and mdt.stylename = '$idestilo'
                    //and i.estado!='cambiado' AND v.fecha >= '$fechainicio'
                    //    AND v.fecha <= '$fechafin' ";

                    $select = "SUM(i.cantidad) AS Pares";
                    $from = "itemventa i,adicionkardextienda k, ventasdetalle v,modelos mdt";
                    $where = " k.idkardextienda=i.idkardextienda ANd i.idventa=v.idventadetalle AND k.idmodelodetalle=mdt.idmodelo  and mdt.stylename = '$idestilo'
AND  i.estado='cambiado'
and v.fecha >= '$fechainicio'
    AND v.fecha <= '$fechafin' ";
                    $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                    $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                    $devueltos = $almacenA1['resultado'];
                    // $pares=$totalparesiddetalleingreso;
                    if($devueltos==NULL || $devueltos =='' || $devueltos == ""){ $devueltos="0"; }


                    $select = "SUM(i.cantidad) AS Pares";
                    $from = "detalletraspaso i,adicionkardextienda k,traspasos tr,modelos mdt";
                    $where = "  k.idkardextienda=i.idkardextienda ANd i.idtraspaso=tr.idtraspaso  and k.idmodelodetalle=mdt.idmodelo and mdt.stylename = '$idestilo'
AND tr.fecha >= '$fechainicio'
    AND tr.fecha <= '$fechafin' ";
                    $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                    $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                    $trasdesp = $almacenA1['resultado'];

                    if($trasdesp==NULL || $trasdesp =='' || $trasdesp == ""){ $trasdesp="0"; }
                    $select = "SUM(i.cantidad) AS Pares";
                    $from = "itemventa i,adicionkardextienda k, ventasdetalle v,modelos mdt";
                    $where = "k.idkardextienda=i.idkardextienda ANd i.idventa=v.idventadetalle AND k.idmodelodetalle=mdt.idmodelo  and mdt.stylename = '$idestilo'
and i.estado!='cambiado' AND v.fecha >= '$fechainicio'
    AND v.fecha <= '$fechafin' ";

                    $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                    //  echo $sql2p;
                    //    d
                    $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                    $venta = $almacenA1['resultado'];
                    // $pares=$totalparesiddetalleingreso;
                    if($venta==NULL || $venta =='' || $venta == ""){ $venta="0"; }



                    if($tabla=="historialkardextienda"){
                        $select = "SUM(k.saldocantidad) AS Pares";
                        $from = "historialkardextienda k,modelos mdt";
                        $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.stylename = '$idestilo'  AND k.unido='no' AND k.idperiodo='$idperiodo'";
                        $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                        $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                        $tstockactual = $almacenA1['resultado'];

                    }else{
                        $select = "SUM(k.saldocantidad) AS Pares";
                        $from = "adicionkardextienda k,modelos mdt";
                        $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.stylename = '$idestilo'  AND k.unido='no'";
                        $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                        $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                        $tstockactual = $almacenA1['resultado'];

                    }

                    if($tstockactual==NULL || $tstockactual =='' || $tstockactual == ""){ $tstockactual="0"; }
                    //fin
                    if($tabla=="historialkardextienda"){

                        $select = "SUM(saldocantidad*precio2bs) AS bs";
                        $from = "historialkardextienda k,modelos mdt";
                        $where = "k.idmodelodetalle=mdt.idmodelo AND mdt.stylename = '$idestilo' and k.unido='no' AND k.idperiodo='$idperiodo'";
                        $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                        $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'bs');
                        $totalbsactual = $almacenA1['resultado'];

                    }else{
                        $select = "SUM(k.saldocantidad*precio2bs) AS Pares";
                        $from = "adicionkardextienda k,modelos mdt";
                        $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.stylename = '$idestilo'  AND k.unido='no'";
                        $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                        $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                        $totalbsactual = $almacenA1['resultado'];

                    }

                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$tstockant."&nbsp;</td>";

                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$recibido."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$trasrecibido."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$devueltos."&nbsp;</td>";

                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$trasdesp."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$venta."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$tstockactual."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$totalbsactual."&nbsp;</td>";

                    $devS .= "</tr>";

                    $devS .= "</table>";

                    $dev['mensaje'] = "Existen resultados";
                    $dev['error']   = "true";
                    $dev['resultado'] = $devS;

                }
                else
                {
                    $dev['mensaje'] = "No se encontro datos en la consulta2".mysql_error();
                    $dev['error']   = "false";
                    $dev['resultado'] = "";
                }
            }
            else
            {
                $dev['mensaje'] = "Error en la consulta";
                $dev['error']   = "false";
                $dev['resultado'] = "";
            }
        }
        else
        {
            $dev['mensaje'] = "No se pudo conectar a la BD";
            $dev['error']   = "false";
            $dev['resultado'] = "";
        }
    }
    else
    {
        $dev['mensaje'] = "No se pudo crear la conexion a la BD";
        $dev['error']   = "false";
        $dev['resultado'] = "";
    }
    return $dev;
}

function verDetalleTotalesDiferencia($idmarca,$idestilo,$idkardex, $return)
{
    //  echo $idkardex;
    $html = "";
    $html .= "<tr><td colspan='4' align='center'>
    <p>Nova Moda S.RL.<br />
         <br />
         Telf. 4-258993  Fax: 4-504183
    </p>
</td></tr>";
    $html .= "<!DOCTYPE HTML PUBLIC '-//W3C//DTD HTML 4.01 Transitional//EN'>";
    $html .= "<html>";
    $html .= "<body>";
    $html .= "<tr>";

    $html .= "<table cellpadding='1' cellspacing='0' border='0' style='width:100%' font-size:11px; font-family:Tahoma;'>";
    $html .= "<td style='width:100%;height:100%;text-align:right;font-size:12px;font-family:Tahoma;'>";
    $html .= "$fecha  $tipo";
    $html .= "</td>";
    $html .= "<tr>";
    $sql = "SELECT ma.nombre AS marca,ma.talla,ma.opcionb,ma.pedido
FROM  `marcas` ma
WHERE ma.idmarca = '$idmarca'";

    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'marca');
    $marcalista = $idalmacenA2['resultado'];
    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'talla');
    $opcionmarca = $idalmacenA2['resultado'];
    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'opcionb');
    $opcionb = $idalmacenA2['resultado'];
    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'pedido');
    $marcapedido = $idalmacenA2['resultado'];
    $idsCAr = split("-", $opcionmarca);
    $rango1=$idsCAr[0];
    $rango2=$idsCAr[1];

    if($opcionmarca="33-45"){
        $tipo="1";
        //echo $tipo;
    }else{
        if($opcionmarca="14-38"){
            $tipo="3";
        }
    }

    $sql1 = "SELECT  es.nombre AS estilo
FROM  estilos es
WHERE es.idestilo = '$idestilo'";
    $idalmacenA =  findBySqlReturnCampoUnique($sql1, true, true, 'estilo');
    $estilolista = $idalmacenA['resultado'];
    $sqlmarca = " SELECT tabla,mesrango,idperiodo,fechainicio,fechafin FROM administrakardex WHERE idkardex = '$idkardex' ";
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "tabla");
    $tabla = $opcionkardex['resultado'];
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "mesrango");
    $mesrango = $opcionkardex['resultado'];
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "idperiodo");
    $idperiodo = $opcionkardex['resultado'];
    //echo $tabla;
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "fechainicio");
    $fechainicio = $opcionkardex['resultado'];
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "fechafin");
    $fechafin = $opcionkardex['resultado'];
    if($fechafin==null ||$fechafin == ""){
        $fechafin = Date("Y-m-d");}

    $formatear = explode( '-' , $fechainicio);
    $fechain = $formatear[2].'-'.$formatear[1].'-' .$formatear[0];
    $formatear = explode( '-' , $fechafin);
    $fechaf = $formatear[2].'-'.$formatear[1].'-' .$formatear[0];
    //$html .= "<tr style='width:100%height:100px;text-align:center;font-size:15px;font-family:Tahoma;'>";
    $html .= "<td style='width:100%;height:100px;text-align:center;font-size:15px;font-family:Tahoma;'>";
    if($idestilo == null ||$idestilo == "null" )
    {
        $html .= "INVENTARIO $marcalista<br>";
        $html .= "CORRESPONDIENTE DEL $fechain AL $fechaf<br>";
        //  $sqldetalle = "SELECT ".$select." FROM ".$from. " WHERE ".$where."ORDER BY ".$order;
    }else {
        $html .= "INVENTARIO $marcalista<br> Estilo $estilolista";
        $html .= "CORRESPONDIENTE DEL $fechain AL $fechaf<br>";
    }

    $html .= "</td>";
    $html .= "</tr>";
    $html .= "</table>";
    $html .= "</tr>";
    $html .= "<tr>";
    $html .= "<td colspan='3'>";
    $html .= "<table width='1250' border='0' cellspacing='0' cellpadding='0'><tr>";

    $html .= "<tr>";
    $select1 = "talla,idmodelo";
    $from1 = "tallasdetalle";
    $where1 = "talla >='$rango1' AND talla <='$rango2' AND idmodelo='2' ORDER BY talla ASC";
    $sql21 = "SELECT ".$select1." FROM ".$from1." WHERE ".$where1;
    $row = NumeroTuplas($sql21);
    $row1= $row['resultado'];

    $select = "SUM(saldocantidad) AS Pares";
    $from = "adicionkardextienda k,modelos mdt";
    $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND mdt.stylename = '$idestilo' AND k.unido='no' ";
    $sql2121 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
    $almacenA1 =  findBySqlReturnCampoUnique($sql2121, true, true, 'Pares');
    $totalparesestilo = $almacenA1['resultado'];
    $select = "SUM(saldocantidad*precio2bs) AS bs";
    $from = "adicionkardextienda k,modelos mdt";
    $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND mdt.stylename = '$idestilo' AND k.unido='no'";
    $sql2121 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
    $almacenA1 =  findBySqlReturnCampoUnique($sql2121, true, true, 'bs');
    $totalbsestilo = $almacenA1['resultado'];
    //$select = "dtp.iddetalleingreso";
    //$from = "adiciondetalleingreso dtp, modelos mdd, coleccion col, estilos es";
    //   $where = "dtp.idmodelo = mdd.idmodelo AND mdd.idcoleccion = col.idcoleccion AND mdd.stylename = es.idestilo AND dtp.unido='no' AND mdd.idmarca = '$idmarca' AND mdd.stylename='$idestilo'";
    //   $sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where." ORDER BY CAST( `mdd`.`codigo` AS SIGNED) ASC";
    $sqlmarca = " SELECT tabla,mesrango,idperiodo,fechainicio,fechafin FROM administrakardex WHERE idkardex = '$idkardex' ";
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "tabla");
    $tabla = $opcionkardex['resultado'];
    $sqlInv = "SELECT MAX(idperiodo)AS numero
FROM administrakardex where tabla='historialkardextienda'";
    $almacenA1 =  findBySqlReturnCampoUnique($sqlInv, true, true, 'numero');
    $idperiodoant = $almacenA1['resultado'];


    if($tabla=="historialkardextienda"){
        $select = "dtp.idcalzado AS iddetalleingreso";
        $from = "historialkardextienda dtp, modelos mdd";
        $where = "dtp.idmodelodetalle = mdd.idmodelo  AND dtp.saldocantidad!=dtp.cantidadlector
AND dtp.unido='no' AND mdd.idmarca = '$idmarca' AND mdd.stylename='$idestilo' and dtp.idperiodo='$idperiodoant'";
        $sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where." GROUP by dtp.idcalzado ORDER BY CAST( `mdd`.`codigo` AS SIGNED) ASC";
    }else{
        $select = "dtp.idcalzado AS iddetalleingreso";
        $from = "adicionkardextienda dtp, modelos mdd";
        $where = "dtp.idmodelodetalle = mdd.idmodelo  AND dtp.saldocantidad!=dtp.cantidadlector
AND dtp.unido='no' AND mdd.idmarca = '$idmarca' AND mdd.stylename='$idestilo' ";
        $sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where." GROUP by dtp.idcalzado ORDER BY CAST( `mdd`.`codigo` AS SIGNED) ASC";
    }
    $table = dibujarTablaOfDetalleLector($idkardex,$sql25,$sql21,$row1,$idmarca,$idestilo,$rango1,$rango2,$totalparesestilo,$totalbsestilo, $tipo,$marcapedido);

    $html .= $table['resultado'];
    $html .= "</tr>";
    $html .= "</table>";
    $html .= "</td></tr>";

    $html .= "</tr>";
    $html .= "</table>";
    $html .= "</body>";
    $html .= "</html>";
    if($return == true)
    {
        return $html;
    }
    else
    {
        echo $html;
    }
}

function verDetalleLectortallam($idmarca,$idestilo,$idkardex, $return)
{
    $html = "";
    $html .= "<tr><td colspan='4' align='center'>
    <p>Nova Moda S.RL.<br />
         <br />
         Telf. 4-258993  Fax: 4-504183
    </p>
</td></tr>";

    $html .= "<!DOCTYPE HTML PUBLIC '-//W3C//DTD HTML 4.01 Transitional//EN'>";
    $html .= "<html>";
    $html .= "<body>";
    $html .= "<tr>";

    $html .= "<table cellpadding='1' cellspacing='0' border='0' style='width:100%' font-size:11px; font-family:Tahoma;'>";
    $html .= "<td style='width:100%;height:100%;text-align:right;font-size:12px;font-family:Tahoma;'>";
    $html .= "$fecha  $tipo";
    $html .= "</td>";
    $html .= "<tr>";
    $sql = "SELECT ma.nombre AS marca,ma.talla,ma.opcionb,ma.pedido
FROM  `marcas` ma
WHERE ma.idmarca = '$idmarca'";

    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'marca');
    $marcalista = $idalmacenA2['resultado'];
    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'talla');
    $opcionmarca = $idalmacenA2['resultado'];
    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'opcionb');
    $opcionb = $idalmacenA2['resultado'];
    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'pedido');
    $marcapedido = $idalmacenA2['resultado'];
    $idsCAr = split("-", $opcionmarca);
    $rango1=$idsCAr[0];
    $rango2=$idsCAr[1];
    if($opcionmarca="33-45"){
        $tipo="1";
    }else{
        if($opcionmarca="14-38"){
            $tipo="3";
        }
    }
    $sqlmarca = " SELECT tabla,mesrango,idperiodo,fechainicio,fechafin FROM administrakardex WHERE idkardex = '$idkardex' ";
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "tabla");
    $tabla = $opcionkardex['resultado'];
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "mesrango");
    $mesrango = $opcionkardex['resultado'];
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "idperiodo");
    $idperiodo = $opcionkardex['resultado'];
    //echo $tabla;
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "fechainicio");
    $fechainicio = $opcionkardex['resultado'];
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "fechafin");
    $fechafin = $opcionkardex['resultado'];
    if($fechafin==null ||$fechafin == ""){
        $fechafin = Date("Y-m-d");}

    $formatear = explode( '-' , $fechainicio);
    $fechain = $formatear[2].'-'.$formatear[1].'-' .$formatear[0];
    $formatear = explode( '-' , $fechafin);
    $fechaf = $formatear[2].'-'.$formatear[1].'-' .$formatear[0];
    $html .= "<td style='width:100%;height:100px;text-align:center;font-size:15px;font-family:Tahoma;'>";

    $html .= "INVENTARIO $marcalista<br>";

    //    $html .= "Ventas por Marca<br>";
    $html .= "CORRESPONDIENTE DEL $fechain AL $fechaf<br>";
    //     $html .= "Tienda $tienda";
    $html .= "</td>";
    $html .= "</tr>";
    $html .= "</table>";
    $html .= "</tr>";
    $html .= "<tr>";
    $html .= "<td colspan='3'>";

    $html .= "<table width='1250' border='0' cellspacing='0' cellpadding='0'><tr>";

    $select = "idestilo,nombre";
    $from = "estilos";
    $where .= " descripcion = '$idmarca' ORDER BY CAST( nombre AS SIGNED) ASC";
    $sql2 = "SELECT ".$select." FROM ".$from." WHERE ".$where;
    $row = NumeroTuplas($sql2);
    $row1= $row['resultado'];
    $sql21 = getTablaToArrayOfSQL($sql2);
    $sql3 = $sql21['resultado'];
    $row5 = NumeroTuplas($sql2);
    $row15= $row5['resultado'];
    //    $html .= "<td style='width:100%;text-align:center;font-size:1px;font-family:Tahoma;'>";
    $html .= "<table cellpadding='0' cellspacing='0' border='0' style='width:100%;border:0px solid #000000;font-size:11px;text-align:center'>";
    $html .= "<tr>";
    for($i=0;$i<=$row15;$i++){
        $codigo = $sql3[$i];
        $idestilo = $codigo['idestilo'];
        $nombreestilo = $codigo['nombre'];
        $html .= "<tr style='width:100%; font-size:11px;'>";
        $html .=" <td style='font-size:11px;text-align:left'>".$nombreestilo."";
        $html .=" </td> ";
        $html .= "</tr>";
        $html .= "<tr>";
        $iddet1="1";
        $iddet2="26";
        $rango1=$iddet1;
        $rango2=$iddet2;
        $select = "talla,idmodelo,iddetalleingresotalla,tallasm";
        $from = "tallasdetallem";
        $where = "iddetalleingresotalla >='$iddet1' AND iddetalleingresotalla <='$iddet2' ORDER BY iddetalleingresotalla ASC";
        $sql21 = "SELECT ".$select." FROM ".$from." WHERE ".$where;
        $row = NumeroTuplas($sql21);
        $row1= $row['resultado'];

        $select = "SUM(saldocantidad) AS Pares";
        $from = "adicionkardextienda k,modelos mdt";
        $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND mdt.stylename = '$idestilo' AND k.unido='no'";
        $sql2121 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
        $almacenA1 =  findBySqlReturnCampoUnique($sql2121, true, true, 'Pares');
        $totalparesestilo = $almacenA1['resultado'];
        $select = "SUM(saldocantidad*precio2bs) AS bs";
        $from = "adicionkardextienda k,modelos mdt";
        $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND mdt.stylename = '$idestilo' AND k.unido='no'";
        $sql2121 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
        $almacenA1 =  findBySqlReturnCampoUnique($sql2121, true, true, 'bs');
        $totalbsestilo = $almacenA1['resultado'];
        $sqlmarca = " SELECT tabla,mesrango,idperiodo,fechainicio,fechafin FROM administrakardex WHERE idkardex = '$idkardex' ";
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "tabla");
        $tabla = $opcionkardex['resultado'];
        $sqlInv = "SELECT MAX(idperiodo)AS numero
FROM administrakardex where tabla='historialkardextienda'";
        $almacenA1 =  findBySqlReturnCampoUnique($sqlInv, true, true, 'numero');
        $idperiodoant = $almacenA1['resultado'];
        $select = "dtp.idcalzado AS iddetalleingreso";
        $from = "historialkardextienda dtp, modelos mdd";
        $where = "dtp.idmodelodetalle = mdd.idmodelo  AND dtp.saldocantidad!=dtp.cantidadlector
AND dtp.unido='no' AND mdd.idmarca = '$idmarca' AND mdd.stylename='$idestilo' and dtp.idperiodo='$idperiodoant'";
        $sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where." GROUP by dtp.idcalzado ORDER BY CAST( `mdd`.`codigo` AS SIGNED) ASC";

        $table = dibujarTablaOfSQLtallasm($idkardex,$sql25,$sql21,$row1,$idmarca,$idestilo,$rango1,$rango2,$totalparesestilo,$totalbsestilo, "2",$marcapedido);

        $html .= $table['resultado'];
        $html .= "</tr>";
        //       ss
    }
    //totales de totales
    $html .= "</tr>";
    $html .= "</table>";

    $html .= "<table cellpadding='1' cellspacing='0' border='0' style='width:50%' font-size:25px; font-family:Tahoma;'>";
    $html .= "<tr style='width:50%;height:50%;text-align:right;font-size:25px;font-family:Tahoma;'>";


    if($tabla=="historialkardextienda"){
        $select = "SUM( k.precio2bs * k.saldocantidad) As bs";
        $from = "historialkardextienda k,modelos mdt";
        $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND k.idperiodo='$idperiodo' AND k.unido='no'";
        $sql2121 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

        $almacenA1 =  findBySqlReturnCampoUnique($sql2121, true, true, 'bs');
        $totalparesbs = $almacenA1['resultado'];


        $select = "SUM( k.precio2bs * k.cantidadlector) As bs";
        $from = "historialkardextienda k,modelos mdt";
        $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND k.idperiodo='$idperiodo' AND k.unido='no'";
        $sql2121 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

        $almacenA1 =  findBySqlReturnCampoUnique($sql2121, true, true, 'bs');
        $totalparesbslector = $almacenA1['resultado'];

        $select = "SUM(k.saldocantidad) As par";
        $from = "historialkardextienda k,modelos mdt";
        $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND k.idperiodo='$idperiodo' AND k.unido='no'";
        $sql2121 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

        $almacenA1 =  findBySqlReturnCampoUnique($sql2121, true, true, 'par');
        $totalpares = $almacenA1['resultado'];



        $select = "SUM(k.cantidadlector) As par";
        $from = "historialkardextienda k,modelos mdt";
        $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND k.idperiodo='$idperiodo' AND k.unido='no'";
        $sql2121 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

        $almacenA1 =  findBySqlReturnCampoUnique($sql2121, true, true, 'par');
        $totalpareslector = $almacenA1['resultado'];
        //echo $sql2121;
    }else{
        $select = "SUM( k.precio2bs * k.saldocantidad) As bs";
        $from = "adicionkardextienda k,modelos mdt";
        $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND k.unido='no'";
        $sql2121 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

        $almacenA1 =  findBySqlReturnCampoUnique($sql2121, true, true, 'bs');
        $totalparesbs = $almacenA1['resultado'];

        $select = "SUM( k.precio2bs * k.cantidadlector) As bs";
        $from = "adicionkardextienda k,modelos mdt";
        $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND k.unido='no'";
        $sql2121 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

        $almacenA1 =  findBySqlReturnCampoUnique($sql2121, true, true, 'bs');
        $totalparesbslector = $almacenA1['resultado'];

        $select = "SUM(k.saldocantidad) As bs";
        $from = "adicionkardextienda k,modelos mdt";
        $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND k.unido='no' ";
        $sql2121 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

        $almacenA1 =  findBySqlReturnCampoUnique($sql2121, true, true, 'bs');
        $totalpares = $almacenA1['resultado'];

        $select = "SUM(k.cantidadlector) As bs";
        $from = "adicionkardextienda k,modelos mdt";
        $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND k.unido='no'";
        $sql2121 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

        $almacenA1 =  findBySqlReturnCampoUnique($sql2121, true, true, 'bs');
        $totalpareslector = $almacenA1['resultado'];
    }

    $html .= "<td style='width:100%;text-align:center;font-size:1px;font-family:Tahoma;'>";
    $html .= "<table cellpadding='0' cellspacing='0' border='1' style='width:100%;border:1px solid #000000;font-size:11px;text-align:center'>";

    $html .= "<tr><td style='font-size:11px;font-weight:bold;'>Pares Stock:</td><td>".$totalpares."</td></tr>";
    $html .= "<tr><td style='font-size:11px;font-weight:bold;'>Bs:</td><td>".$totalparesbs."</td></tr>";
    $html .= "</table>";


    $html .= "<table cellpadding='0' cellspacing='0' border='1' style='width:100%;border:1px solid #000000;font-size:11px;text-align:center'>";

    $html .= "<tr><td style='font-size:11px;font-weight:bold;'>Pares Lector:</td><td>".$totalpareslector."</td></tr>";
    $html .= "<tr><td style='font-size:11px;font-weight:bold;'>Bs:</td><td>".$totalparesbslector."</td></tr>";
    $html .= "</table>";

    $html .= "</td></tr>";
    $html .= "</table>";

    $html .= "</body>";
    $html .= "</html>";
    if($return == true)
    {
        return $html;
    }
    else
    {
        echo $html;
    }
}
function verDetalleTotalesDiferenciatallam($idmarca,$idestilo, $idkardex,$return)
{
    $html = "";
    $html .= "<tr><td colspan='4' align='center'>
    <p>Nova Moda S.RL.<br />
         <br />
         Telf. 4-258993  Fax: 4-504183
    </p>
</td></tr>";
    $html .= "<!DOCTYPE HTML PUBLIC '-//W3C//DTD HTML 4.01 Transitional//EN'>";
    $html .= "<html>";
    $html .= "<body>";
    $html .= "<tr>";

    $html .= "<table cellpadding='1' cellspacing='0' border='0' style='width:100%' font-size:11px; font-family:Tahoma;'>";
    $html .= "<td style='width:100%;height:100%;text-align:right;font-size:12px;font-family:Tahoma;'>";
    $html .= "$fecha  $tipo";
    $html .= "</td>";
    $html .= "<tr>";
    $sql = "SELECT ma.nombre AS marca,ma.talla,ma.opcionb,ma.pedido
FROM  `marcas` ma
WHERE ma.idmarca = '$idmarca'";

    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'marca');
    $marcalista = $idalmacenA2['resultado'];
    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'talla');
    $opcionmarca = $idalmacenA2['resultado'];
    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'opcionb');
    $opcionb = $idalmacenA2['resultado'];
    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'pedido');
    $marcapedido = $idalmacenA2['resultado'];
    $idsCAr = split("-", $opcionmarca);
    $sqlmarca = " SELECT tabla,mesrango,idperiodo,fechainicio,fechafin FROM administrakardex WHERE idkardex = '$idkardex' ";
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "tabla");
    $tabla = $opcionkardex['resultado'];
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "mesrango");
    $mesrango = $opcionkardex['resultado'];
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "idperiodo");
    $idperiodo = $opcionkardex['resultado'];
    //echo $tabla;
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "fechainicio");
    $fechainicio = $opcionkardex['resultado'];
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "fechafin");
    $fechafin = $opcionkardex['resultado'];
    if($fechafin==null ||$fechafin == ""){
        $fechafin = Date("Y-m-d");}

    $formatear = explode( '-' , $fechainicio);
    $fechain = $formatear[2].'-'.$formatear[1].'-' .$formatear[0];
    $formatear = explode( '-' , $fechafin);
    $fechaf = $formatear[2].'-'.$formatear[1].'-' .$formatear[0];
    $sql1 = "SELECT  es.nombre AS estilo
FROM  estilos es
WHERE es.idestilo = '$idestilo'";
    $idalmacenA =  findBySqlReturnCampoUnique($sql1, true, true, 'estilo');
    $estilolista = $idalmacenA['resultado'];
    //$html .= "<tr style='width:100%height:100px;text-align:center;font-size:15px;font-family:Tahoma;'>";
    $html .= "<td style='width:100%;height:100px;text-align:center;font-size:15px;font-family:Tahoma;'>";
    if($idestilo == null ||$idestilo == "null" )
    {
        $html .= "INVENTARIO $marcalista<br>";
        $html .= "CORRESPONDIENTE DEL $fechain AL $fechaf<br>";
        //  $sqldetalle = "SELECT ".$select." FROM ".$from. " WHERE ".$where."ORDER BY ".$order;
    }else {
        $html .= "INVENTARIO $marcalista<br>Estilo $estilolista";
        $html .= "CORRESPONDIENTE DEL $fechain AL $fechaf<br>";
    }

    $html .= "</td>";
    $html .= "</tr>";
    $html .= "</table>";
    $html .= "</tr>";
    $html .= "<tr>";
    $html .= "<td colspan='3'>";
    $html .= "<table width='1250' border='0' cellspacing='0' cellpadding='0'><tr>";
    $html .= "<tr>";
    $iddet1="1";
    $iddet2="26";
    $rango1=$iddet1;
    $rango2=$iddet2;
    $select = "talla,idmodelo,iddetalleingresotalla,tallasm";
    $from = "tallasdetallem";
    $where = "iddetalleingresotalla >='$iddet1' AND iddetalleingresotalla <='$iddet2' ORDER BY iddetalleingresotalla ASC";
    $sql21 = "SELECT ".$select." FROM ".$from." WHERE ".$where;
    $row = NumeroTuplas($sql21);
    $row1= $row['resultado'];

    $select = "SUM(saldocantidad) AS Pares";
    $from = "historialkardextienda k,modelos mdt";
    $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND mdt.stylename = '$idestilo' AND k.unido='no'";
    $sql2121 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
    $almacenA1 =  findBySqlReturnCampoUnique($sql2121, true, true, 'Pares');
    $totalparesestilo = $almacenA1['resultado'];
    $select = "SUM(saldocantidad*precio2bs) AS bs";
    $from = "historialkardextienda k,modelos mdt";
    $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND mdt.stylename = '$idestilo' AND k.unido='no'";
    $sql2121 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
    $almacenA1 =  findBySqlReturnCampoUnique($sql2121, true, true, 'bs');
    $totalbsestilo = $almacenA1['resultado'];
    //$select = "dtp.iddetalleingreso";
    //$from = "adiciondetalleingreso dtp, modelos mdd, coleccion col, estilos es";
    //   $where = "dtp.idmodelo = mdd.idmodelo AND mdd.idcoleccion = col.idcoleccion AND mdd.stylename = es.idestilo AND dtp.unido='no' AND mdd.idmarca = '$idmarca' AND mdd.stylename='$idestilo'";
    //   $sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where." ORDER BY CAST( `mdd`.`codigo` AS SIGNED) ASC";
    $sqlmarca = " SELECT tabla,mesrango,idperiodo,fechainicio,fechafin FROM administrakardex WHERE idkardex = '$idkardex' ";
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "tabla");
    $tabla = $opcionkardex['resultado'];
    $sqlInv = "SELECT MAX(idperiodo)AS numero
FROM administrakardex where tabla='historialkardextienda'";
    $almacenA1 =  findBySqlReturnCampoUnique($sqlInv, true, true, 'numero');
    $idperiodoant = $almacenA1['resultado'];

    $select = "dtp.idcalzado AS iddetalleingreso";
    $from = "historialkardextienda dtp, modelos mdd";
    $where = "dtp.idmodelodetalle = mdd.idmodelo  AND dtp.saldocantidad!=dtp.cantidadlector
AND dtp.unido='no' AND mdd.idmarca = '$idmarca' AND mdd.stylename='$idestilo' and dtp.idperiodo='$idperiodoant'";
    $sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where." GROUP by dtp.idcalzado ORDER BY CAST( `mdd`.`codigo` AS SIGNED) ASC";

    $table = dibujarTablaOfSQLtallasm($idkardex,$sql25,$sql21,$row1,$idmarca,$idestilo,$rango1,$rango2,$totalparesestilo,$totalbsestilo, "2",$marcapedido);

    $html .= $table['resultado'];
    $html .= "</tr>";


    $html .= "</table>";
    $html .= "</body>";
    $html .= "</html>";
    if($return == true)
    {
        return $html;
    }
    else
    {
        echo $html;
    }
}

function dibujarTablaOfSQLtallasm($idkardex,$sql,$sql21,$row1,$idmarca,$idestilo,$rango1,$rango2,$totalpar1,$totalbs1, $tipo,$marcapedido)
{
    $sqlmarca = " SELECT tabla,mesrango,idperiodo,fechainicio,fechafin FROM administrakardex WHERE idkardex = '$idkardex' ";
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "tabla");
    $tabla = $opcionkardex['resultado'];
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "mesrango");
    $mesrango = $opcionkardex['resultado'];
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "idperiodo");
    $idperiodo = $opcionkardex['resultado'];
    //echo $tabla;
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "fechainicio");
    $fechainicio = $opcionkardex['resultado'];
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "fechafin");
    $fechafin = $opcionkardex['resultado'];
    if($fechafin==null ||$fechafin == ""){
        $fechafin = Date("Y-m-d");
    }

    if($tabla=="historialkardextienda"){
    }else{
        $sqlInv = "SELECT MAX(idperiodo)AS numero
FROM administrakardex where tabla='historialkardextienda'";
        $almacenA1 =  findBySqlReturnCampoUnique($sqlInv, true, true, 'numero');
        $idperiodoant = $almacenA1['resultado'];
        $sqlmarca = " SELECT tabla,mesrango,idperiodo,fechainicio,fechafin FROM administrakardex WHERE idperiodo = '$idperiodoant' ";
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "fechainicio");
        // $fechainicio = $opcionkardex['resultado'];
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "fechafin");
        // $fechafin = $opcionkardex['resultado'];
    }
    $sql211 = getTablaToArrayOfSQL($sql21);
    $sql3 = $sql211['resultado'];
    if($link=new BD)
    {
        if($link->conectar())
        {
            if($re = $link->consulta($sql))
            {
                //echo mysql_num_rows($re);
                if($fi = mysql_fetch_array($re))
                {
                    $devS .= "<table cellpadding='0' cellspacing='0' border='0' style='width:750px;border:1px solid #000000;font-size:11px;'>";
                    $devS .= "<tr><td style='border-bottom:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Nro</td>";
                    $devS .= "<td style='display:none;'>".mysql_field_name($re, $zz)."</td>";
                    // $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Modelo</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Modelo</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Color</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Precio</td>";
                    for($hi=0;$hi<$row1;$hi++){
                        $codigo = $sql3[$hi];
                        $idmmarca = $codigo['talla'];

                        $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>$idmmarca</td>";
                        $ji++;
                    }
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Anterior</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Actual</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Cantidad Lector</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Diferencia</td>";

                    $devS .= "</tr>";
                    $ii = 0;
                    //$totalCount = mysql_num_rows($re);
                    $z = 1;
                    do{
                        $devS .= "<tr><td style='text-align:left'>".$z."</td>";
                        for($i = 0; $i< mysql_num_fields($re); $i++)
                        {$dato = $fi[$i];
                            $iddetalleingreso = $fi[$i]['iddetalleingreso'];
                            $devS .= "<td style='display:none;'>&nbsp;".$dato."&nbsp;</td>";
                            // echo $marcapedido;
                            $select = "dtp.totalbs AS precio";
                            $from = "adiciondetalleingreso dtp, modelos mdd, coleccion col, estilos es";
                            $where = "dtp.idmodelo = mdd.idmodelo AND mdd.idcoleccion = col.idcoleccion AND mdd.stylename = es.idestilo AND dtp.iddetalleingreso='$dato'";

                            if($marcapedido=='CODIGO-COLOR-MATERIAL'){
                                $select .= ",concat(col.detalle,'-',mdd.codigo) AS codigo, dtp.color";
                            }else{
                                if($marcapedido=="CODIGO-MATERIAL"){
                                    $select .= ",concat(mdd.codigo,'-',dtp.material) AS codigo, dtp.color";
                                }else{
                                    if(($marcapedido=="CODIGO-COLOR")||($marcapedido=="CODIGO")){
                                        $select .= ",mdd.codigo, dtp.color";
                                    }else{
                                        if($marcapedido=="CODIGO-COLOR-STYLENAME"){
                                            $select .= ",concat(mdd.codigo,'-',dtp.color) AS codigo, dtp.material AS color";
                                        }else{
                                            if($marcapedido=="LINEA-CODIGO-COLOR"){
                                                $select .= ",concat(mdd.codigo,'-',dtp.color) AS codigo, dtp.material AS color";
                                                $from .= ",lineas l";
                                                $where .= ",AND mdd.idlinea = l.idlinea";

                                            }
                                        }

                                    }
                                }
                            }

                            // $from = "adiciondetalleingreso dtp, modelos mdd, coleccion col, estilos es";
                            //$where = "dtp.idmodelo = mdd.idmodelo AND mdd.idcoleccion = col.idcoleccion AND mdd.stylename = es.idestilo AND dtp.iddetalleingreso='$dato'";
                            $sql2p1 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                            // echo $sql2p1;
                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p1, true, true, 'codigo');
                            $modelo = $almacenA1['resultado'];
                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p1, true, true, 'color');
                            $color = $almacenA1['resultado'];
                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p1, true, true, 'precio');
                            $precio = $almacenA1['resultado'];
                            $devS .= "<td style='text-align:left;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$modelo."&nbsp;</td>";
                            $devS .= "<td style='text-align:left;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$color."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$precio."&nbsp;</td>";


                            for($h=0;$h<$row1;$h++){
                                $codigo = $sql3[$h];
                                $idmmarca = $codigo['talla'];
                                if($tabla=="historialkardextienda"){

                                    $select1 = "cantidadlector AS Pares";
                                    $from1 = "historialkardextienda";
                                    $where1 = "idcalzado = '$dato' AND talla='$idmmarca' AND idperiodo='$idperiodo'";
                                    //if($ltienda != "Todos"){ $where .= " AND ve.idtienda = '$ltienda' ";}
                                    $sql21 = "SELECT ".$select1." FROM ".$from1. " WHERE ".$where1;

                                    $almacenA1 =  findBySqlReturnCampoUnique($sql21, true, true, 'Pares');
                                    $pares1 = $almacenA1['resultado'];
                                }else{
                                    $select1 = "cantidadlector AS Pares";
                                    $from1 = "adicionkardextienda";
                                    $where1 = "idcalzado = '$dato' AND talla='$idmmarca'";
                                    //if($ltienda != "Todos"){ $where .= " AND ve.idtienda = '$ltienda' ";}
                                    $sql21 = "SELECT ".$select1." FROM ".$from1. " WHERE ".$where1;

                                    $almacenA1 =  findBySqlReturnCampoUnique($sql21, true, true, 'Pares');
                                    $pares1 = $almacenA1['resultado'];

                                }
                                // if($pares1==NULL || $pares1 =='' || $pares1 == ""){ $pares1="0"; }
                                $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$pares1."&nbsp;</td>";
                                $j++;
                            }

                            if($tabla=="historialkardextienda"){
                                $sqlInv = "SELECT MAX(idperiodo)AS numero
FROM administrakardex where tabla='historialkardextienda'";
                                $almacenA1 =  findBySqlReturnCampoUnique($sqlInv, true, true, 'numero');
                                $idperiodoant = $almacenA1['resultado'];
                                $idper = $idperiodoant - 1;
                                $select = "SUM(saldocantidad) AS Pares";
                                $from = "historialkardextienda k";
                                $where = " k.idcalzado='$dato' AND k.idperiodo='$idper' AND k.unido='no'";
                                $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                                $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                                $stockanterior = $almacenA1['resultado'];


                                $select = "SUM(saldocantidad) AS Pares";
                                $from = "historialkardextienda k";
                                $where = " k.idcalzado='$dato' AND k.idperiodo='$idperiodoant' AND k.unido='no'";
                                $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                                $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                                $stockactual = $almacenA1['resultado'];

                                $select = "SUM(cantidadlector) AS Pares";
                                $from = "historialkardextienda k";
                                $where = " k.idcalzado='$dato' AND k.idperiodo='$idperiodoant' AND k.unido='no'";
                                $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                                $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                                $cantidadlector = $almacenA1['resultado'];

                                $diferencia = $cantidadlector - $stockactual;
                            }
                            else{
                                $sqlInv = "SELECT MAX(idperiodo)AS numero
FROM administrakardex where tabla='historialkardextienda'";
                                $almacenA1 =  findBySqlReturnCampoUnique($sqlInv, true, true, 'numero');
                                $idperiodoant = $almacenA1['resultado'];
                                //  echo $idperiodoant;
                                $select = "SUM(saldocantidad) AS Pares";
                                $from = "historialkardextienda k";
                                $where = " k.idcalzado='$dato' AND k.idperiodo='$idperiodoant' AND k.unido='no'";
                                $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                                $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                                $stockanterior = $almacenA1['resultado'];

                                $select = "SUM(saldocantidad) AS Pares";
                                $from = "adicionkardextienda k";
                                $where = " k.idcalzado='$dato' and k.unido='no'";
                                $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                                $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                                $stockactual = $almacenA1['resultado'];

                                $select = "SUM(cantidadlector) AS Pares";
                                $from = "adicionkardextienda k";
                                $where = " k.idcalzado='$dato' and k.unido='no'";
                                $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                                $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                                $cantidadlector = $almacenA1['resultado'];
                                $diferencia = $cantidadlector - $stockactual;
                            }
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$stockanterior."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$stockactual."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$cantidadlector."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$diferencia."&nbsp;</td>";

                        }
                        $devS .= "</tr>";
                        $ii++;
                        $z ++;
                    }while($fi = mysql_fetch_array($re));
                    $devS .= "<tr style='background-color:silver;'><td style='border: 1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>TOTAL</td>";
                    $devS .= "<td style='display:none;'></td>";
                    $fechatoday = Date("d-m-Y");
                    $devS .= "<td style='text-align:center;border-bottom: 1px solid #000000;'></td>";
                    $devS .= "<td style='text-align:center;border-bottom: 1px solid #000000;'></td>";
                    $devS .= "<td style='text-align:center;border-bottom: 1px solid #000000;'></td>";

                    for($h=0;$h<$row1;$h++){
                        $codigo = $sql3[$h];
                        $idmmarca = $codigo['idmarca'];

                        $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'></td>";
                        $j++;
                    }

                    if($tabla=="historialkardextienda"){
                        $sqlInv = "SELECT MAX(idperiodo)AS numero
FROM administrakardex where tabla='historialkardextienda'";
                        $almacenA1 =  findBySqlReturnCampoUnique($sqlInv, true, true, 'numero');
                        $idperiodoant = $almacenA1['resultado'];
                        $idper = $idperiodoant - 1;
                        $select = "SUM(saldocantidad) AS Pares";
                        $from = "historialkardextienda k,modelos mdt";
                        $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND mdt.stylename = '$idestilo' AND k.idperiodo='$idper' AND k.unido='no'";
                        $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                        $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                        $tstockant = $almacenA1['resultado'];

                        $select = "SUM(saldocantidad) AS Pares";
                        $from = "historialkardextienda k,modelos mdt";
                        $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND mdt.stylename = '$idestilo' AND k.idperiodo='$idperiodoant' AND k.unido='no'";
                        $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                        $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                        $tstockactual = $almacenA1['resultado'];

                        $select = "SUM(cantidadlector) AS Pares";
                        $from = "historialkardextienda k,modelos mdt";
                        $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND mdt.stylename = '$idestilo' AND k.idperiodo='$idperiodoant' AND k.unido='no'";
                        $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                        $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                        $tlector = $almacenA1['resultado'];
                        $tdiferencia = $tlector - $tstockactual;
                    }
                    else{
                        $sqlInv = "SELECT MAX(idperiodo)AS numero
FROM administrakardex where tabla='historialkardextienda'";
                        $almacenA1 =  findBySqlReturnCampoUnique($sqlInv, true, true, 'numero');
                        $idperiodoant = $almacenA1['resultado'];
                        $select = "SUM(saldocantidad) AS Pares";
                        $from = "historialkardextienda k,modelos mdt";
                        $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND mdt.stylename = '$idestilo' AND k.idperiodo='$idperiodoant' AND k.unido='no'";
                        $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                        //echo $sql2p;
                        $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                        $tstockant = $almacenA1['resultado'];
                        $select = "SUM(k.saldocantidad) AS Pares";
                        $from = "adicionkardextienda k,modelos mdt";
                        $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.stylename = '$idestilo'  AND k.unido='no'";
                        $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                        $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                        $tstockactual = $almacenA1['resultado'];

                        $select = "SUM(k.cantidadlector) AS Pares";
                        $from = "adicionkardextienda k,modelos mdt";
                        $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.stylename = '$idestilo'  AND k.unido='no'";
                        $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                        $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                        $tlector = $almacenA1['resultado'];
                        $tdiferencia = $tlector - $tstockactual;
                    }
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$tstockant."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$tstockactual."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$tlector."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$tdiferencia."&nbsp;</td>";

                    $devS .= "</tr>";
                    $devS .= "</table>";

                    $dev['mensaje'] = "Existen resultados";
                    $dev['error']   = "true";
                    $dev['resultado'] = $devS;

                }
                else
                {
                    $dev['mensaje'] = "No se encontro datos en la consulta2".mysql_error();
                    $dev['error']   = "false";
                    $dev['resultado'] = "";
                }
            }
            else
            {
                $dev['mensaje'] = "Error en la consulta";
                $dev['error']   = "false";
                $dev['resultado'] = "";
            }
        }
        else
        {
            $dev['mensaje'] = "No se pudo conectar a la BD";
            $dev['error']   = "false";
            $dev['resultado'] = "";
        }
    }
    else
    {
        $dev['mensaje'] = "No se pudo crear la conexion a la BD";
        $dev['error']   = "false";
        $dev['resultado'] = "";
    }
    return $dev;
}

function verDetalleLector($idmarca,$idestilo,$idkardex, $return)
{
    $html = "";
    $html .= "<tr><td colspan='4' align='center'>
    <p>Nova Moda S.RL.<br />
         <br />
         Telf. 4-258993  Fax: 4-504183
    </p>
</td></tr>";

    $html .= "<!DOCTYPE HTML PUBLIC '-//W3C//DTD HTML 4.01 Transitional//EN'>";
    $html .= "<html>";
    $html .= "<body>";
    $html .= "<tr>";

    $html .= "<table cellpadding='1' cellspacing='0' border='0' style='width:100%' font-size:11px; font-family:Tahoma;'>";
    $html .= "<td style='width:100%;height:100%;text-align:right;font-size:12px;font-family:Tahoma;'>";
    $html .= "$fecha  $tipo";
    $html .= "</td>";
    $html .= "<tr>";
    $sql = "SELECT ma.nombre AS marca,ma.talla,ma.opcionb,ma.pedido
FROM  `marcas` ma
WHERE ma.idmarca = '$idmarca'";

    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'marca');
    $marcalista = $idalmacenA2['resultado'];
    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'talla');
    $opcionmarca = $idalmacenA2['resultado'];
    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'opcionb');
    $opcionb = $idalmacenA2['resultado'];
    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'pedido');
    $marcapedido = $idalmacenA2['resultado'];
    $idsCAr = split("-", $opcionmarca);
    $rango1=$idsCAr[0];
    $rango2=$idsCAr[1];
    if($opcionmarca="33-45"){
        $tipo="1";
    }else{
        if($opcionmarca="14-38"){
            $tipo="3";
        }
    }
    $sqlmarca = " SELECT tabla,mesrango,idperiodo,fechainicio,fechafin FROM administrakardex WHERE idkardex = '$idkardex' ";
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "tabla");
    $tabla = $opcionkardex['resultado'];
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "mesrango");
    $mesrango = $opcionkardex['resultado'];
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "idperiodo");
    $idperiodo = $opcionkardex['resultado'];
    //echo $tabla;
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "fechainicio");
    $fechainicio = $opcionkardex['resultado'];
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "fechafin");
    $fechafin = $opcionkardex['resultado'];
    if($fechafin==null ||$fechafin == ""){
        $fechafin = Date("Y-m-d");}

    $formatear = explode( '-' , $fechainicio);
    $fechain = $formatear[2].'-'.$formatear[1].'-' .$formatear[0];
    $formatear = explode( '-' , $fechafin);
    $fechaf = $formatear[2].'-'.$formatear[1].'-' .$formatear[0];
    $html .= "<td style='width:100%;height:100px;text-align:center;font-size:15px;font-family:Tahoma;'>";

    $html .= "INVENTARIO $marcalista<br>";

    //    $html .= "Ventas por Marca<br>";
    $html .= "CORRESPONDIENTE DEL $fechain AL $fechaf<br>";
    //     $html .= "Tienda $tienda";
    $html .= "</td>";
    $html .= "</tr>";
    $html .= "</table>";
    $html .= "</tr>";
    $html .= "<tr>";
    $html .= "<td colspan='3'>";

    $html .= "<table width='1250' border='0' cellspacing='0' cellpadding='0'><tr>";

    $select = "idestilo,nombre";
    $from = "estilos";
    $where .= " descripcion = '$idmarca' ORDER BY CAST( nombre AS SIGNED) ASC";
    $sql2 = "SELECT ".$select." FROM ".$from." WHERE ".$where;
    $row = NumeroTuplas($sql2);
    $row1= $row['resultado'];
    $sql21 = getTablaToArrayOfSQL($sql2);
    $sql3 = $sql21['resultado'];
    $row5 = NumeroTuplas($sql2);
    $row15= $row5['resultado'];
    //    $html .= "<td style='width:100%;text-align:center;font-size:1px;font-family:Tahoma;'>";
    $html .= "<table cellpadding='0' cellspacing='0' border='0' style='width:100%;border:0px solid #000000;font-size:11px;text-align:center'>";
    $html .= "<tr>";
    for($i=0;$i<=$row15;$i++){
        $codigo = $sql3[$i];
        $idestilo = $codigo['idestilo'];
        $nombreestilo = $codigo['nombre'];
        $html .= "<tr style='width:100%; font-size:11px;'>";
        $html .=" <td style='font-size:11px;text-align:left'>".$nombreestilo."";
        $html .=" </td> ";
        $html .= "</tr>";
        $html .= "<tr>";
        $select1 = "talla,idmodelo";
        $from1 = "tallasdetalle";
        $where1 = "talla >='$rango1' AND talla <='$rango2' AND idmodelo='2' ORDER BY talla ASC";
        $sql21 = "SELECT ".$select1." FROM ".$from1." WHERE ".$where1;
        $row = NumeroTuplas($sql21);
        $row1= $row['resultado'];

        $select = "SUM(saldocantidad) AS Pares";
        $from = "adicionkardextienda k,modelos mdt";
        $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND mdt.stylename = '$idestilo' AND k.unido='no'";
        $sql2121 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
        $almacenA1 =  findBySqlReturnCampoUnique($sql2121, true, true, 'Pares');
        $totalparesestilo = $almacenA1['resultado'];
        $select = "SUM(saldocantidad*precio2bs) AS bs";
        $from = "adicionkardextienda k,modelos mdt";
        $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND mdt.stylename = '$idestilo' AND k.unido='no' ";
        $sql2121 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
        $almacenA1 =  findBySqlReturnCampoUnique($sql2121, true, true, 'bs');
        $totalbsestilo = $almacenA1['resultado'];
        //$select = "dtp.iddetalleingreso";
        //$from = "adiciondetalleingreso dtp, modelos mdd, coleccion col, estilos es";
        //   $where = "dtp.idmodelo = mdd.idmodelo AND mdd.idcoleccion = col.idcoleccion AND mdd.stylename = es.idestilo AND dtp.unido='no' AND mdd.idmarca = '$idmarca' AND mdd.stylename='$idestilo'";
        //    $sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where." ORDER BY CAST( `mdd`.`codigo` AS SIGNED) ASC";
        $sqlmarca = " SELECT tabla,mesrango,idperiodo,fechainicio,fechafin FROM administrakardex WHERE idkardex = '$idkardex' ";
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "tabla");
        $tabla = $opcionkardex['resultado'];
        $sqlInv = "SELECT MAX(idperiodo)AS numero
FROM administrakardex where tabla='historialkardextienda'";
        $almacenA1 =  findBySqlReturnCampoUnique($sqlInv, true, true, 'numero');
        $idperiodoant = $almacenA1['resultado'];


        if($tabla=="historialkardextienda"){
            $select = "dtp.idcalzado AS iddetalleingreso";
            $from = "historialkardextienda dtp, modelos mdd";
            $where = "dtp.idmodelodetalle = mdd.idmodelo  AND dtp.saldocantidad!=dtp.cantidadlector
AND dtp.unido='no' AND mdd.idmarca = '$idmarca' AND mdd.stylename='$idestilo' and dtp.idperiodo='$idperiodoant'";
            $sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where." GROUP by dtp.idcalzado ORDER BY CAST( `mdd`.`codigo` AS SIGNED) ASC";

        }else{
            $select = "dtp.idcalzado AS iddetalleingreso";
            $from = "adicionkardextienda dtp, modelos mdd";
            $where = "dtp.idmodelodetalle = mdd.idmodelo  AND dtp.saldocantidad!=dtp.cantidadlector
AND dtp.unido='no' AND mdd.idmarca = '$idmarca' AND mdd.stylename='$idestilo'";
            $sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where." GROUP by dtp.idcalzado ORDER BY CAST( `mdd`.`codigo` AS SIGNED) ASC";

        }
        $table = dibujarTablaOfDetalleLector($idkardex,$sql25,$sql21,$row1,$idmarca,$idestilo,$rango1,$rango2,$totalparesestilo,$totalbsestilo, $tipo,$marcapedido);
        //$table = dibujarTablaOfSQLinventarioVentasTotal($idkardex,$sql25,$sql21,$row1,$idmarca,$idestilo,$rango1,$rango2,$totalparesestilo,$totalbsestilo, $tipo,$marcapedido);

        $html .= $table['resultado'];
        $html .= "</tr>";
        //       ss
    }
    //totales de totales
    $html .= "</tr>";
    $html .= "</table>";

    $html .= "<table cellpadding='1' cellspacing='0' border='0' style='width:50%' font-size:25px; font-family:Tahoma;'>";
    $html .= "<tr style='width:50%;height:50%;text-align:right;font-size:25px;font-family:Tahoma;'>";


    if($tabla=="historialkardextienda"){
        $select = "SUM( k.precio2bs * k.saldocantidad) As bs";
        $from = "historialkardextienda k,modelos mdt";
        $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND k.idperiodo='$idperiodo' AND k.unido='no'";
        $sql2121 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

        $almacenA1 =  findBySqlReturnCampoUnique($sql2121, true, true, 'bs');
        $totalparesbs = $almacenA1['resultado'];


        $select = "SUM( k.precio2bs * k.cantidadlector) As bs";
        $from = "historialkardextienda k,modelos mdt";
        $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND k.idperiodo='$idperiodo' AND k.unido='no'";
        $sql2121 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

        $almacenA1 =  findBySqlReturnCampoUnique($sql2121, true, true, 'bs');
        $totalparesbslector = $almacenA1['resultado'];

        $select = "SUM(k.saldocantidad) As par";
        $from = "historialkardextienda k,modelos mdt";
        $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND k.idperiodo='$idperiodo' AND k.unido='no'";
        $sql2121 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

        $almacenA1 =  findBySqlReturnCampoUnique($sql2121, true, true, 'par');
        $totalpares = $almacenA1['resultado'];



        $select = "SUM(k.cantidadlector) As par";
        $from = "historialkardextienda k,modelos mdt";
        $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND k.idperiodo='$idperiodo' AND k.unido='no'";
        $sql2121 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

        $almacenA1 =  findBySqlReturnCampoUnique($sql2121, true, true, 'par');
        $totalpareslector = $almacenA1['resultado'];
        //echo $sql2121;
    }else{
        $select = "SUM( k.precio2bs * k.saldocantidad) As bs";
        $from = "adicionkardextienda k,modelos mdt";
        $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND k.unido='no'";
        $sql2121 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

        $almacenA1 =  findBySqlReturnCampoUnique($sql2121, true, true, 'bs');
        $totalparesbs = $almacenA1['resultado'];

        $select = "SUM( k.precio2bs * k.cantidadlector) As bs";
        $from = "adicionkardextienda k,modelos mdt";
        $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND k.unido='no'";
        $sql2121 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

        $almacenA1 =  findBySqlReturnCampoUnique($sql2121, true, true, 'bs');
        $totalparesbslector = $almacenA1['resultado'];

        $select = "SUM(k.saldocantidad) As bs";
        $from = "adicionkardextienda k,modelos mdt";
        $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND k.unido='no' ";
        $sql2121 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

        $almacenA1 =  findBySqlReturnCampoUnique($sql2121, true, true, 'bs');
        $totalpares = $almacenA1['resultado'];

        $select = "SUM(k.cantidadlector) As bs";
        $from = "adicionkardextienda k,modelos mdt";
        $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND k.unido='no' ";
        $sql2121 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

        $almacenA1 =  findBySqlReturnCampoUnique($sql2121, true, true, 'bs');
        $totalpareslector = $almacenA1['resultado'];
    }

    $html .= "<td style='width:100%;text-align:center;font-size:1px;font-family:Tahoma;'>";
    $html .= "<table cellpadding='0' cellspacing='0' border='1' style='width:100%;border:1px solid #000000;font-size:11px;text-align:center'>";

    $html .= "<tr><td style='font-size:11px;font-weight:bold;'>Pares Stock:</td><td>".$totalpares."</td></tr>";
    $html .= "<tr><td style='font-size:11px;font-weight:bold;'>Bs:</td><td>".$totalparesbs."</td></tr>";
    $html .= "</table>";


    $html .= "<table cellpadding='0' cellspacing='0' border='1' style='width:100%;border:1px solid #000000;font-size:11px;text-align:center'>";

    $html .= "<tr><td style='font-size:11px;font-weight:bold;'>Pares Lector:</td><td>".$totalpareslector."</td></tr>";
    $html .= "<tr><td style='font-size:11px;font-weight:bold;'>Bs:</td><td>".$totalparesbslector."</td></tr>";
    $html .= "</table>";

    $html .= "</td></tr>";

    //    $producto2 = dibujarTuplaOfSQLSimpleinventario($sqltotalpares,$totalpares,$totalparesbs);
    //    $html .= $producto2['resultado'];
    //    $html .= "</tr>";
    $html .= "</table>";

    $html .= "</body>";
    $html .= "</html>";
    if($return == true)
    {
        return $html;
    }
    else
    {
        echo $html;
    }
}

function VerRecapitulacion($idmarca,$idalmacen2,$idkardex,$fechainicio,$fechafin, $return)
{
    //$idalmacen=$_SESSION['idalmacen'];
    $html = "";
    $html .= "<tr><td colspan='4' align='center'>
    <p>Nova Moda S.RL.<br />
         <br />
         Telf. 4-258993  Fax: 4-504183
    </p>
</td></tr>";

    $html .= "<!DOCTYPE HTML PUBLIC '-//W3C//DTD HTML 4.01 Transitional//EN'>";
    $html .= "<html>";
    $html .= "<body>";
    $html .= "<tr>";

    $html .= "<table cellpadding='1' cellspacing='0' border='0' style='width:100%' font-size:11px; font-family:Tahoma;'>";
    $html .= "<td style='width:100%;height:100%;text-align:right;font-size:12px;font-family:Tahoma;'>";
    $html .= "$fecha  $tipo";
    $html .= "</td>";
    $html .= "<tr>";
    $sql = "SELECT ma.nombre AS marca,ma.talla,ma.opcionb,ma.pedido
FROM  `marcas` ma
WHERE ma.idmarca = '$idmarca'";

    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'marca');
    $marcalista = $idalmacenA2['resultado'];
    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'talla');
    $opcionmarca = $idalmacenA2['resultado'];
    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'opcionb');
    $opcionb = $idalmacenA2['resultado'];
    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'pedido');
    $marcapedido = $idalmacenA2['resultado'];
    $idsCAr = split("-", $opcionmarca);
    $rango1=$idsCAr[0];
    $rango2=$idsCAr[1];
    if($opcionmarca="33-45"){
        $tipo="1";
    }else{
        if($opcionmarca="14-38"){
            $tipo="3";
        }
    }
    $sqlmarca = " SELECT idkardex FROM administrakardex WHERE idkardex = '$idkardex' group by mesrango";
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "idkardex");
    $idkar = $opcionkardex['resultado'];


    if($idkar==null || $idkar==''){
        $sqlmarca = " SELECT idkardex,tabla,mesrango,idperiodo,fechainicio,fechafin FROM administrakardex WHERE  mesrango= '$idkardex' group by mesrango";
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "idkardex");
        $idkar = $opcionkardex['resultado'];
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "tabla");
        $tabla = $opcionkardex['resultado'];
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "mesrango");
        $mesrango = $opcionkardex['resultado'];
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "idperiodo");
        $idperiodo = $opcionkardex['resultado'];
        
    }else{
        $sqlmarca = " SELECT idkardex,tabla,mesrango,idperiodo,fechainicio,fechafin FROM administrakardex WHERE idkardex = '$idkardex' ";
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "idkardex");
        $idkar = $opcionkardex['resultado'];
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "tabla");
        $tabla = $opcionkardex['resultado'];
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "mesrango");
        $mesrango = $opcionkardex['resultado'];
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "idperiodo");
        $idperiodo = $opcionkardex['resultado'];
       }
    if($fechafin==null ||$fechafin == ""){
        $fechafin = Date("Y-m-d");
    }

    $formatear = explode( '-' , $fechainicio);
    $fechain = $formatear[2].'-'.$formatear[1].'-' .$formatear[0];
    $formatear = explode( '-' , $fechafin);
    $fechaf = $formatear[2].'-'.$formatear[1].'-' .$formatear[0];
    $formatearmes = explode( '/' , $mesrango);
    $mesplani = $formatearmes[0];
    if($mesplani == "01") {
        $mes="ENERO";  }
    if($mesplani == "02") {
        $mes="FEBRERO";   }
    if($mesplani == "03") {
        $mes="MARZO";     }
    if($mesplani == "04") {
        $mes="ABRIL";}
    if($mesplani == "05") {
        $mes="MAYO";}
    if($mesplani == "06") {
        $mes="JUNIO";}
    if($mesplani == "07") {
        $mes="JULIO";}
    if($mesplani == "08") {
        $mes="AGOSTO";}
    if($mesplani == "09") {
        $mes="SEPTIEMBRE";}
    if($mesplani == "10") {
        $mes="OCTUBRE";}
    if($mesplani == "11") {
        $mes="NOVIEMBRE";}
    if($mesplani == "12") {
        $mes="DICIEMBRE";}
    //$html .= "<b><u>INVENTARIO $marcalista</u></b><br>";
    $sqlmarca = " SELECT nombre FROM almacenes WHERE idalmacen = '$idalmacen' ";

    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "nombre");
    $deptocapital = $opcionkardex['resultado'];

    $html .= "<td style='width:100%;height:50px;text-align:center;font-size:15px;font-family:Tahoma;'>";
    $html .= "<b><u>RESUMEN CAPITAL DE OPERACIONES</u></b><br>";
    $html .= "<b><u>CORRESPONDIENTE AL MES DE $mes :  DEL $fechain AL $fechaf </u></b><br>";
    //     $html .= "Tienda $tienda";
    $html .= "</td>";
    $html .= "</tr>";
    $html .= "</table>";
    $html .= "</tr>";
    $html .= "<tr>";
    $html .= "<td colspan='3'>";

    $html .= "<table width='1250' border='0' cellspacing='0' cellpadding='0'><tr>";

    $select = "origen";
    $from = "marcas ";
    $where = " estado='activo' group by origen ";
    //  $sql2 = "SELECT ".$select." FROM ".$from;
    $sql2 = "SELECT ".$select." FROM ".$from." WHERE ".$where;

    $row = NumeroTuplas($sql2);
    $row1= $row['resultado'];
    $sql21 = getTablaToArrayOfSQL($sql2);
    $sql3 = $sql21['resultado'];
    $row5 = NumeroTuplas($sql2);
    $row15= $row5['resultado'];
    $html .= "<table cellpadding='0' cellspacing='0' border='0' style='width:1250px;border:0px solid #000000;font-size:13px;text-align:center'>";
    $html .= "<tr>";

    for($i=0;$i<=$row15;$i++){
        $codigo = $sql3[$i];
        $nombrecategoria = $codigo['origen'];
        $html .= "<tr style='width:100%; font-size:13px;'>";
        $html .=" <td style='font-size:14px;text-align:left'>";
        $html .=" </td> ";
        $html .= "</tr>";
        $html .= "<tr>";
        $select1 = "talla,idmodelo";
        $from1 = "tallasdetalle";
        $where1 = "talla >='$rango1' AND talla <='$rango2' AND idmodelo='2' ORDER BY talla ASC";
        $sql21 = "SELECT ".$select1." FROM ".$from1." WHERE ".$where1;
        $row = NumeroTuplas($sql21);
        $row1= $row['resultado'];

        $select = "SUM(saldocantidad) AS Pares";
        $from = "adicionkardextienda k,modelos mdt";
        $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND mdt.stylename = '$idestilo' ";
        $sql2121 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
        $almacenA1 =  findBySqlReturnCampoUnique($sql2121, true, true, 'Pares');
        $totalparesestilo = $almacenA1['resultado'];
        $select = "SUM(saldocantidad*precio2bs) AS bs";
        $from = "adicionkardextienda k,modelos mdt";
        $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND mdt.stylename = '$idestilo' ";
        $sql2121 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
        $almacenA1 =  findBySqlReturnCampoUnique($sql2121, true, true, 'bs');
        $totalbsestilo = $almacenA1['resultado'];
        //$select = "idmarca";
        //$from = "marcas";
        //   $where = "categoria = '$nombrecategoria' and estado='activo' order by numeroorden ASC";
        $select = "idmarca";
        $from = "marcas";
        $where = " estado='activo' AND origen='$nombrecategoria' order by numeroorden ASC";
        $sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where;
      
      $table = dibujarTablaOfSQLmarcarecapitulacion($idkar,$sql25,$sql21,$row1,$nombrecategoria,$porcentajecat,$parestotalactualcategoria,$idalmacen,$rango1,$rango2,$totalparesestilo,$totalbsestilo, $tipo,$marcapedido);
      $html .= $table['resultado'];
    }


    $html .= "</tr>";

    $html .= "</table>";

    $html .= "</td></tr>";

    $html .= "</tr>";
    $html .= "</table>";

    $html .= "</body>";
    $html .= "</html>";
    if($return == true)
    {
        return $html;
    }
    else
    {
        echo $html;
    }
}

function VerRecapitulacionMarca($idalmacen,$idalmacen2,$idkardex,$fechainicio,$fechafin, $return)
{$today = Date("Y-m-d");
    $html = "";
    $html .= "<tr><td colspan='4' align='center'>
    <p>Nova Moda S.R.L.<br />
         <br />
         Telf. 4-258993  Fax: 4-504183
<br />
$today
    </p>
</td></tr>";
    $html .= "<!DOCTYPE HTML PUBLIC '-//W3C//DTD HTML 4.01 Transitional//EN'>";
    $html .= "<html>";
    $html .= "<body>";
    $html .= "<tr>";
    $html .= "<table cellpadding='1' cellspacing='0' border='0' style='width:100%' font-size:11px; font-family:Tahoma;'>";
    $html .= "<td style='width:100%;height:100%;text-align:right;font-size:12px;font-family:Tahoma;'>";
    $html .= "$fecha  $tipo";
    $html .= "</td>";
    $html .= "<tr>";
    $sql = "SELECT ma.nombre AS marca,ma.talla,ma.opcionb,ma.pedido FROM  `marcas` ma WHERE ma.idmarca = '$idmarca'";

    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'marca');
    $marcalista = $idalmacenA2['resultado'];
    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'talla');
    $opcionmarca = $idalmacenA2['resultado'];
    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'opcionb');
    $opcionb = $idalmacenA2['resultado'];
    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'pedido');
    $marcapedido = $idalmacenA2['resultado'];
    $idsCAr = split("-", $opcionmarca);
    $rango1=$idsCAr[0];
    $rango2=$idsCAr[1];
    if($opcionmarca="33-45"){         $tipo="1";
    }else{ if($opcionmarca="14-38"){
            $tipo="3";
           }
    }
    $sqlmarca = " SELECT idkardex FROM administrakardex WHERE idkardex = '$idkardex' and idalmacen='$idalmacen' ";
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "idkardex");
    $idkar = $opcionkardex['resultado'];

    if($idkar==null || $idkar==''){
        $sqlmarca = " SELECT idkardex,tabla,mesrango,idperiodo,fechainicio,fechafin,mesanterior,estado FROM administrakardex WHERE  mesrango= '$idkardex' and idalmacen='$idalmacen'";
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "idkardex");
        $idkar = $opcionkardex['resultado'];
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "tabla");
        $tabla = $opcionkardex['resultado'];
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "mesrango");
        $mesrango = $opcionkardex['resultado'];
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "idperiodo");
        $idperiodo = $opcionkardex['resultado'];
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "mesanterior");
        $mesanterior = $opcionkardex['resultado'];
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "estado");
        $estado = $opcionkardex['resultado'];

    }else{
        $sqlmarca = " SELECT * FROM administrakardex WHERE idkardex = '$idkardex' ";
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "idkardex");
        $idkar = $opcionkardex['resultado'];
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "tabla");
        $tabla = $opcionkardex['resultado'];
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "mesrango");
        $mesrango = $opcionkardex['resultado'];
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "idperiodo");
        $idperiodo = $opcionkardex['resultado'];
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "mesanterior");
        $mesanterior = $opcionkardex['resultado'];
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "estado");
        $estado = $opcionkardex['resultado'];
    }
    //echo $sqlmarca;
    if($fechafin==null ||$fechafin == ""){
        $fechafin = Date("Y-m-d");
    }

    $formatear = explode( '-' , $fechainicio);
    $fechain = $formatear[2].'-'.$formatear[1].'-' .$formatear[0];
    $formatear = explode( '-' , $fechafin);
    $fechaf = $formatear[2].'-'.$formatear[1].'-' .$formatear[0];
    $mesplani=substr($mesrango,0,2);
    $anioplani=substr($mesrango,2,5);
    if($mesplani == "01") { $mes="ENERO";  }
    if($mesplani == "02") { $mes="FEBRERO"; }
    if($mesplani == "03") {
        $mes="MARZO";
    }
    if($mesplani == "04") {
        $mes="ABRIL";}
    if($mesplani == "05") {
        $mes="MAYO";}
    if($mesplani == "06") {
        $mes="JUNIO";}
    if($mesplani == "07") {
        $mes="JULIO";}
    if($mesplani == "08") {
        $mes="AGOSTO";}
    if($mesplani == "09") {
        $mes="SEPTIEMBRE";}
    if($mesplani == "10") {
        $mes="OCTUBRE";}
    if($mesplani == "11") {
        $mes="NOVIEMBRE";}
    if($mesplani == "12") {
        $mes="DICIEMBRE";}
    $sqlmarca = " SELECT nombre FROM almacenes WHERE idalmacen = '$idalmacen' ";
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "nombre");
    $deptocapital = $opcionkardex['resultado'];
    $html .= "<td style='width:100%;height:50px;text-align:center;font-size:15px;font-family:Tahoma;'>";
    $html .= "<b><u>RESUMEN CAPITAL DE OPERACIONES</u></b><br>";
    if($idalmacen==null || $idalmacen=='null'){
        $html .= "<b><u>TODOS LOS DEPARTAMENTOS</u></b><br>";
    }else{
        $html .= "<b><u>OFICINA $deptocapital</u></b><br>";
    }
    $html .= "<b><u>CORRESPONDIENTE AL MES DE $mes :  DEL $fechain AL $fechaf </u></b><br>";
    $html .= "</td>";
    $html .= "</tr>";
    $html .= "</table>";
    $html .= "</tr>";
    $html .= "<tr>";
    $html .= "<td colspan='3'>";

    $html .= "<table width='1250' border='0' cellspacing='0' cellpadding='0'><tr>";

    $select = "idmarca";
    $from = "marcas ";
    $where = " estado='activo' and origen='BRASIL' ";
    //  $sql2 = "SELECT ".$select." FROM ".$from;
    $sql2 = "SELECT ".$select." FROM ".$from." WHERE ".$where;

    $row = NumeroTuplas($sql2);
    $row1= $row['resultado'];
    $sql21 = getTablaToArrayOfSQL($sql2);
    $sql3 = $sql21['resultado'];
    $row5 = NumeroTuplas($sql2);
    $row15= $row5['resultado'];
    $html .= "<table cellpadding='0' cellspacing='0' border='0' style='width:1250px;border:0px solid #000000;font-size:13px;text-align:center'>";
    $html .= "<tr>";

    for($i=0;$i<=$row15-1;$i++){
        $codigo = $sql3[$i];
        $idmara = $codigo['idmarca'];
        $html .= "<tr style='width:100%; font-size:13px;'>";
        $html .=" <td style='font-size:14px;text-align:left'>";
        $html .=" </td> ";
        $html .= "</tr>";
        $html .= "<tr>";
        $select1 = "talla,idmodelo";
        $from1 = "tallasdetalle";
        $where1 = "talla >='$rango1' AND talla <='$rango2' AND idmodelo='2' ORDER BY talla ASC";
        $sql21 = "SELECT ".$select1." FROM ".$from1." WHERE ".$where1;
        $row = NumeroTuplas($sql21);
        $row1= $row['resultado'];


        $select = "idempleado";
        $from = "empleadomarca";
        $where = "idmarca='$idmara' AND idalmacen='$idalmacen' and estado='A'";
        $sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where;
        //echo $sql25;
        $table = dibujarTablaOfSQLmarcarecapitulacionvendedor($idkardex,$sql25,$sql21,$row1,$idmara,$porcentajecat,$parestotalactualcategoria,$idalmacen,$rango1,$rango2,$totalparesestilo,$totalbsestilo, $tipo,$marcapedido);
        $html .= $table['resultado'];
    }

    $sqlrutafin = " SELECT idkardex FROM administrakardex WHERE idalmacen='$idalmacen' and estado='pendiente' ";
    $table = dibujarTablaresumentotalrecapitulacion($sqlrutafin,$idkardex, "TOTALES");
    $html .= $table['resultado'];

    $html .= "</tr>";
    $html .= "</table>";
    $html .= "</td></tr>";
    $html .= "</tr>";
    $html .= "</table>";
    $html .= "</body>";
    $html .= "</html>";
    if($return == true)
    {
        return $html;
    }
    else
    {
        echo $html;
    }
}
function dibujarTablaresumentotalrecapitulacion($sql,$idkardex, $titulo)
{   $idalmacen=$_SESSION['idalmacen'];

    $sqlmarca = " SELECT idkardex FROM administrakardex WHERE idkardex = '$idkardex' and idalmacen='$idalmacen' ";
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "idkardex");
    $idkar = $opcionkardex['resultado'];
    if($idkar==null || $idkar==''){
        $sqlmarca = " SELECT * FROM administrakardex WHERE  mesrango= '$idkardex' and idalmacen='$idalmacen'";
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "idkardex");
        $idkar = $opcionkardex['resultado'];
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "tabla");
        $tabla = $opcionkardex['resultado'];
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "mesrango");
        $mesrango = $opcionkardex['resultado'];
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "idperiodo");
        $idperiodo = $opcionkardex['resultado'];
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "mesanterior");
        $mesanterior = $opcionkardex['resultado'];
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "estado");
        $estado = $opcionkardex['resultado'];
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "fechainicio");
        $fechainicio = $opcionkardex['resultado'];
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "fechafin");
        $fechafin = $opcionkardex['resultado'];
    }else{
        $sqlmarca = " SELECT * FROM administrakardex WHERE idkardex = '$idkar' ";
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "idkardex");
        $idkar = $opcionkardex['resultado'];
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "tabla");
        $tabla = $opcionkardex['resultado'];
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "mesrango");
        $mesrango = $opcionkardex['resultado'];
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "idperiodo");
        $idperiodo = $opcionkardex['resultado'];
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "mesanterior");
        $mesanterior = $opcionkardex['resultado'];
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "estado");
        $estado = $opcionkardex['resultado'];
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "fechainicio");
        $fechainicio = $opcionkardex['resultado'];
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "fechafin");
        $fechafin = $opcionkardex['resultado'];
    }
    //echo $sqlmarca;
    if($fechafin==null ||$fechafin == ""){
        $fechafin = Date("Y-m-d");
    }


    if($link=new BD)
    {
        if($link->conectar())
        {
            if($re = $link->consulta($sql))
            {
                //echo mysql_num_rows($re);
                if($fi = mysql_fetch_array($re))
                {
                    //tamano $html .= "<tr><td colspan='4' align='center' font-family='Arial'>


                    $devS .= "<table cellpadding='0' cellspacing='0' border='0' style='width:1250px;border:1px solid #000000;font-size:13px;font-family:Arial;'>";
                    $devS .= "<tr><td style='border-bottom:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'></td>";
                    $devS .= "<td style='display:none;'>".mysql_field_name($re, $zz)."</td>";
                    // $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Modelo</td>";
                    $devS .= "<td style='width:120px;border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:13px;text-align:center;'>$titulo</td>";
                    $devS .= "<td colspan='3' align='center' style='border:1px solid #000000'>STOCK MERCADERIA</td>";
                    $devS .= "<td colspan='3' align='center'  style='border:1px solid #000000' >RECIBIDOS</td>";
                    $devS .= "<td colspan='3' align='center'  style='border:1px solid #000000'>TRASP DESP.</td>";
                    $devS .= "<td colspan='3' align='center'  style='border:1px solid #000000'>TRASP REC.</td>";
                    $devS .= "<td colspan='3' align='center'  style='border:1px solid #000000' >VENTAS</td>";
                    $devS .= "<td colspan='3' align='center'  style='border:1px solid #000000' >DEVOLUCION</td>";
                    $devS .= "<td colspan='2' align='center'  style='border:1px solid #000000' >COBROS</td>";
                    //$devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;'>COBROS</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;'>Cuentas</td>";
                    $devS .= "<td colspan='3' align='center'  style='border:1px solid #000000' >STOCK ACTUAL</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;'>Rebajas</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;'>Reb-Inv</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;'>-</td>";

                    $devS .= "</tr>";
                    $devS .= "<tr><td style='border-bottom:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>#</td>";
                    $devS .= "<td style='display:none;'>".mysql_field_name($re, $zz)."</td>";
                    $devS .= "<td style='width:120px;border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:13px;text-align:center;background-color:silver;'></td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Cjs</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Prs</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Sus.</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Cjs</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Prs</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Sus.</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Cjs</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Prs</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Sus.</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Cjs</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Prs</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Sus.</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Cjs</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Prs</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Sus.</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Cjs</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Prs</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Sus.</td>";

                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Sus</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Reb</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>P/C</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Cjs</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Prs</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Sus.</td>";

                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Sus</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'></td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>-</td>";

                    $devS .= "</tr>";
                    $ii = 0;
                    //$totalCount = mysql_num_rows($re);
                    $z = 1;
                    $tcajasstant =0;
                    $tparesstant =0;
                    $ttotalbsstant =0;
                    $ttotalcajasrecibido =0;
                    $ttotalparesrecibido =0;
                    $ttotalbsrecibido =0;
                    $tcajastrasrec =0;
                    $tparestrasrec =0;
                    $ttotalbstrasrec =0;
                    $tcajastraspdesp =0;
                    $tparestraspdesp =0;
                    $ttotalbstraspdesp =0;
                    $ttotalcajasventa =0;
                    $ttotalparesventa =0;
                    $ttotalbsventa =0;
                    $ttotalcajasdev =0;
                    $ttotalparesdev =0;
                    $ttotalbsdev =0;
                    $tcobros =0;
                    $trebajas =0;
                    $tcuentas =0;
                    $tcajasstact =0;
                    $tparesstact =0;
                    $ttotalbsstact =0;
                    $ttotalbs =0;
                    $trebaja =0;
                    $trebajainventario =0;
                    $tporcentaje =0;
                    do{
                        //           $devS .= "<tr><td style='text-align:left'>".$z."</td>";
                        for($i = 0; $i< mysql_num_fields($re); $i++)
                        {$dato = $fi[$i];
                            $iddetalleingreso = $fi[$i]['idempleado'];

                            //  $devS .= "<td style='width:120px;text-align:left;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>".$titulo."</td>";
                            if($cajasstant==NULL || $cajasstant =='' || $cajasstant == ""){ $cajasstant="0"; }
                            if($paresstant==NULL || $paresstant =='' || $paresstant == ""){ $paresstant="0"; }
                            if($totalbsstant==NULL || $totalbsstant =='' || $totalbsstant == ""){ $totalbsstant="0"; }

//recibidos total
                            $select = "SUM(k.totalcajas) AS Pares";
                            $from = "ingresoalmacen k";
                            $where = "";
                            { $where .= " k.fecha >= '$fechainicio' AND k.fecha <= '$fechafin' and k.idalmacen='$idalmacen'";}
                            $sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where;
                            $almacenA1 =  findBySqlReturnCampoUnique($sql25, true, true, 'Pares');
                            $totalcajasrecibido = $almacenA1['resultado'];
                            //  echo $sqlEgreso;
                            $select = "SUM(kp.saldocantidad) AS Pares";
                            $from = "ingresoalmacen i,kardexdetalleparingreso kp";
                            $where = "";
                            { $where .= " i.idingreso=kp.idingreso AND i.fecha >= '$fechainicio' AND
i.fecha <= '$fechafin' and i.idalmacen='$idalmacen'";}
                            $sql25a = "SELECT ".$select." FROM ".$from." WHERE ".$where;
                            $almacenA1 =  findBySqlReturnCampoUnique($sql25a, true, true, 'Pares');
                            $totalparesrecibido = $almacenA1['resultado'];

                          $selectm = "COUNT(kp.idkardexunico) AS Pares, SUM(kp.preciounitario) AS sus ";
                          $fromm = "modelo m,kardexdetallepar kp,modelo as m2,proformas p";
                          $wherem = "kp.idmodelo=m.idmodelo and m.idingreso=p.id_proforma and m2.estadotraspaso=m.idmodelo and p.nombre!='00/2016'";
                           { $wherem .= " AND (DATE_FORMAT(p.fecha, '%Y-%m-%d')) >= '$fechainicio' AND (DATE_FORMAT(p.fecha, '%Y-%m-%d')) <= '$fechafin' AND p.idalmacen='$idalmacen'";}
                        //   { $wherem .= " AND p.fecha >= '$fechainicio' AND p.fecha <= '$fechafin'  AND p.idalmacen='$idalmacen'";}

                        $sql251 = "SELECT ".$selectm." FROM ".$fromm." WHERE ".$wherem;
                      //  echo $sql251;
                            $almacenA1 =  findBySqlReturnCampoUnique($sql251, true, true, 'Pares');
                            $totalparesrecibidonuevo = $almacenA1['resultado'];
                            $almacenA1 =  findBySqlReturnCampoUnique($sql251, true, true, 'sus');
                            $totalbsrecibidonuevo = $almacenA1['resultado'];

                           $select1 = "COUNT(kp.idkardexunico) AS Pares, SUM(kp.preciounitario) AS sus";
                            $from1 = "modelo m,kardexdetallepar kp,proformas p";
                            $where1 = "m.idingreso=p.id_proforma and kp.idmodelo=m.idmodelo and m.estadotraspaso='ninguno' and p.nombre!='00/2016' ";
                          { $where1 .= " AND (DATE_FORMAT(p.fecha, '%Y-%m-%d')) >= '$fechainicio' AND (DATE_FORMAT(p.fecha, '%Y-%m-%d')) <= '$fechafin' AND p.idalmacen='$idalmacen' and m.idalmacen='$idalmacen' and kp.idalmacen='$idalmacen' and m.boleta=p.id_proforma";}
 //{ $where1 .= " AND p.fecha >= '$fechainicio' AND p.fecha <= '$fechafin'  AND p.idalmacen='$idalmacen' and m.idalmacen='$idalmacen' and kp.idalmacen='$idalmacen' and m.boleta=p.id_proforma";}

                            $sql25c = "SELECT ".$select1." FROM ".$from1." WHERE ".$where1;
                            //echo $sql25c;
                            $almacenA1 =  findBySqlReturnCampoUnique($sql25c, true, true, 'Pares');
                            $totalparesrecibidonuevotraspaso = $almacenA1['resultado'];
                            $almacenA1 =  findBySqlReturnCampoUnique($sql25c, true, true, 'sus');
                            $totalbsrecibidonuevotraspaso = $almacenA1['resultado'];
                            $totalparesrecibido =$totalparesrecibido + $totalparesrecibidonuevo + $totalparesrecibidonuevotraspaso;

                            $select = "SUM(k.totalbs) AS totalprecio";
                            $from = "ingresoalmacen k";
                            $where = "";
                            { $where .= "k.fecha >= '$fechainicio' AND k.fecha <= '$fechafin' and k.idalmacen='$idalmacen' ";}
                            $sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where;
                            $almacenA1 =  findBySqlReturnCampoUnique($sql25, true, true, 'totalprecio');
                            $totalbsrecibido = $almacenA1['resultado'];
                            $totalbsrecibido = $totalbsrecibido + $totalbsrecibidonuevo + $totalbsrecibidonuevotraspaso;
                            $totalcajasnuevo = $totalparesrecibido/12;
                            $totalcajasrecibido = $totalcajasrecibido + $totalcajasnuevo;
                            $totalcajasrecibido = round($totalcajasrecibido,2);

                            //traspasos entregados
                            $sqlEgreso ="SELECT SUM(iv.saldocantidad) AS Pares, SUM(iv.preciounitario) AS TotalBs
FROM traspasosinternos iv,modelo md,ventas v, empleados em,empleados emo
WHERE iv.idventa=v.idventa and iv.idmodelo=md.idmodelo and iv.idvendedor=em.idempleado and iv.idvendedororigen=emo.idempleado
AND iv.fecha >= '$fechainicio' AND iv.fecha <= '$fechafin' and iv.idalmacen='$idalmacen' ";
                            $almacenA1 =  findBySqlReturnCampoUnique($sqlEgreso, true, true, 'Pares');
                            $parestrasenvinterno= $almacenA1['resultado'];
                            $almacenA1 =  findBySqlReturnCampoUnique($sqlEgreso, true, true, 'TotalBs');
                            $bstrasenviinterno = $almacenA1['resultado'];

                            $sqlEgresoq ="SELECT SUM(it.saldocantidad) AS Pares, SUM(it.preciounitario) AS TotalBs
FROM traspaso t,traspasodetallepar it,modelo mdd
WHERE t.idtraspaso=it.iddetalletraspaso and t.idalmacen='$idalmacen' and it.idmodeloorigen=mdd.idmodelo and t.fecha >= '$fechainicio' AND t.fecha <= '$fechafin'
   ";
                            $almacenA1 =  findBySqlReturnCampoUnique($sqlEgresoq, true, true, 'Pares');
                            $partraspenv = $almacenA1['resultado'];
                            $partraspenv=$partraspenv+$parestrasenvinterno;
                            $almacenA1 =  findBySqlReturnCampoUnique($sqlEgresoq, true, true, 'TotalBs');
                            $sustraspenv = $almacenA1['resultado'];
                            $sustraspenv=$sustraspenv+$bstrasenviinterno;

                            $ctraspenv = $partraspenv/12;
                            $ctraspenv = round($ctraspenv,2);
                            //fin entregados
                            $sqlEgreso ="SELECT SUM(iv.saldocantidad) AS Pares, SUM(iv.preciounitario) AS TotalBs
FROM traspasosinternos iv,modelo md,ventas v, empleados em,empleados emo
WHERE iv.idventa=v.idventa and iv.idmodelo=md.idmodelo and iv.idvendedor=em.idempleado and iv.idvendedororigen=emo.idempleado
AND iv.fecha >= '$fechainicio' AND iv.fecha <= '$fechafin' and iv.idalmacen='$idalmacen' ";
                            $almacenA1 =  findBySqlReturnCampoUnique($sqlEgreso, true, true, 'Pares');
                            $parestrasrecinterno = $almacenA1['resultado'];
                            $almacenA1 =  findBySqlReturnCampoUnique($sqlEgreso, true, true, 'TotalBs');
                            $bstrasrecinterno= $almacenA1['resultado'];


                            $sqlEgreso ="SELECT  SUM(it.saldocantidad) AS Pares, SUM(it.preciounitario) AS TotalBs
FROM traspaso t,traspasodetallepar it,modelo mdd
WHERE t.idtraspaso=it.iddetalletraspaso and it.idmodelo=mdd.idmodelo and t.idalmacendestino='$idalmacen'
and mdd.idvendedor=t.responsable and t.fecha >= '$fechainicio' AND t.fecha <= '$fechafin'
   ";
                            //ojo
                            $almacenA1 =  findBySqlReturnCampoUnique($sqlEgreso, true, true, 'Pares');
                            $partrasrec = $almacenA1['resultado'];
                            $partrasrec=$partrasrec+$parestrasrecinterno;
                            $almacenA1 =  findBySqlReturnCampoUnique($sqlEgreso, true, true, 'TotalBs');
                            $sustrasrec = $almacenA1['resultado'];
                            $sustrasrec=$sustrasrec+$bstrasrecinterno;
                            $ctrasprec = $partrasrec/12;
                            $ctrasprec = round($ctrasprec,2);
                            //fin  recibidos




                            $select = "SUM(vi.cantidad) AS Pares";
                            $from = "ventas v,modelo mo,ventaitem vi";
                            $where = " v.idventa=vi.idventa AND vi.idmodelo=mo.idmodelo
and v.fecha >= '$fechainicio'
    AND v.fecha <= '$fechafin' and v.idalmacen='$idalmacen' ";
                            $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');

                            $totalparesventa = $almacenA1['resultado'];
                            $totalcajasventa = $totalparesventa/12;
                            $totalcajasventa = round($totalcajasventa,2);
                            $select = "sUM(vi.precioventa) AS Pares";
                            $from = "ventas v,modelo mo,ventaitem vi";
                            $where = "v.idventa=vi.idventa AND vi.idmodelo=mo.idmodelo and v.fecha >= '$fechainicio'
    AND v.fecha <= '$fechafin' and v.idalmacen='$idalmacen' ";
                            $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                            $totalbsventa = $almacenA1['resultado'];

                            $select = "COUNT(v.iddetalledevolucion) AS Pares";
                            $from = "detalledevolucion v,devolucion d,kardexdetallepar k";
                            $where = " v.idkardexunico=k.idkardexunico and v.iddevolucion=d.iddevolucion
    and d.fecha >= '$fechainicio' AND d.fecha <= '$fechafin' and d.idalmacen='$idalmacen'";
                            $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                            $totalparesdev = $almacenA1['resultado'];
                            $totalcajasdev = $totalparesdev/12;
                            $totalcajasdev= round($totalcajasdev,2);
                            $select = "SUM(v.valorcalzado) AS Pares";
                            $from = "detalledevolucion v,devolucion d,kardexdetallepar k";
                            $where = "v.idkardexunico=k.idkardexunico and v.iddevolucion=d.iddevolucion
     and d.fecha >= '$fechainicio' AND d.fecha <= '$fechafin' and d.idalmacen='$idalmacen'";
                            $sql2p1 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p1, true, true, 'Pares');
                            $totalbsdev = $almacenA1['resultado'];

                            $sqlEgreso ="SELECT  estado FROM periodo WHERE idperiodo= '$idperiodo'    ";
                            $almacenA1 =  findBySqlReturnCampoUnique($sqlEgreso, true, true, 'estado');
                            $estadoperiodo = $almacenA1['resultado'];


                            if($estado=="cerrado"){
                                //   echo $mesanterior;
                                $select = "SUM(k.pares) AS Pares";
                                $from = "kardexresumen k,modelo m";
                                $where = " k.idmodelo=m.idmodelo and
    m.idalmacen='$idalmacen' and mes='$mesrango'";
                                $sql2p3 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                                $almacenA1 =  findBySqlReturnCampoUnique($sql2p3, true, true, 'Pares');
                                $paresstact = $almacenA1['resultado'];

                                $cajasstact = $paresstact/12;
                                $select = "SUM(k.pares*m.preciounitario) AS Precio";
                                $from = "kardexresumen k,modelo m";
                                $where = " k.idmodelo=m.idmodelo and
    m.idalmacen='$idalmacen' and mes='$mesrango'";
                                $sql2p3 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                                $almacenA1 =  findBySqlReturnCampoUnique($sql2p3, true, true, 'Precio');
                                $totalbsstact = $almacenA1['resultado'];

                                $sqlmarca = " SELECT * FROM administrakardex WHERE idalmacen = '$idalmacen' and mesrango='$mesrango' ";
                                $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "mesanterior");
                                $mesanterior = $opcionkardex['resultado'];

                                $select = "SUM(k.pares) AS Pares";
                                $from = "kardexresumen k,modelo m";
                                $where = " k.idmodelo=m.idmodelo and
    m.idalmacen='$idalmacen' and mes='$mesanterior'";
                                $sql2p3 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                                $almacenA1 =  findBySqlReturnCampoUnique($sql2p3, true, true, 'Pares');
                                $paresstant = $almacenA1['resultado'];

                                $cajasstant = $paresstant/12;
                                $select = "SUM(k.pares*m.preciounitario) AS Precio";
                                $from = "kardexresumen k,modelo m";
                                $where = " k.idmodelo=m.idmodelo and
    m.idalmacen='$idalmacen' and mes='$mesanterior'";
                                $sql2p3 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                                $almacenA1 =  findBySqlReturnCampoUnique($sql2p3, true, true, 'Precio');
                                $totalbsstant = $almacenA1['resultado'];
                                $cajasstant =round($cajasstant,2);


                            }else{
                                $select = "SUM(ka.saldocantidad) AS Pares";
                                $from = "modelo m,kardexdetallepar ka";
                                $where = "  ka.idmodelo=m.idmodelo and m.idalmacen='$idalmacen'";
                                $sql2p3 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                                $almacenA1 =  findBySqlReturnCampoUnique($sql2p3, true, true, 'Pares');
                                $paresstact = $almacenA1['resultado'];

                                $cajasstact = $paresstact/12;
                                $select = "SUM(ka.saldocantidad*ka.preciounitario) AS Precio";
                                $from = "modelo m,kardexdetallepar ka";
                                $where = " ka.idmodelo=m.idmodelo  and ka.idalmacen='$idalmacen'";
                                $sql2p3 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                                $almacenA1 =  findBySqlReturnCampoUnique($sql2p3, true, true, 'Precio');
                                $totalbsstact = $almacenA1['resultado'];


                                $select = "SUM(k.pares) AS Pares";
                                $from = "kardexresumen k,modelo m";
                                $where = " k.idmodelo=m.idmodelo and
    k.idalmacen='$idalmacen' and k.mes='$mesanterior'";
                                $sql2p3q = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                                $almacenA1 =  findBySqlReturnCampoUnique($sql2p3q, true, true, 'Pares');
                                $paresstant = $almacenA1['resultado'];
                                //echo $sql2p3q;
                                $cajasstact = $paresstact/12;
                                $select = "SUM(k.pares*m.preciounitario) AS Precio";
                                $from = "kardexresumen k,modelo m";
                                $where = " k.idmodelo=m.idmodelo and
    k.idalmacen='$idalmacen' and mes='$mesanterior'";
                                $sql2p3d = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                                $almacenA1 =  findBySqlReturnCampoUnique($sql2p3d, true, true, 'Precio');
                                $totalbsstant = $almacenA1['resultado'];
                                $cajasstant = $paresstant/12;
                                $cajasstant =round($cajasstant,2);

                            }
                            if($cajasstact==NULL || $cajasstact =='' || $cajasstact == ""){ $cajasstact="0"; }
                            if($paresstact==NULL || $paresstact =='' || $paresstact == ""){ $paresstact="0"; }
                            if($totalbsstact==NULL || $totalbsstact =='' || $totalbsstact == ""){ $totalbsstact="0"; }

                            $totalbsstant =round($totalbsstant,2);
                            $select = "SUM(vi.precioventa) AS Pares";
                            $from = "ventas v,modelo mo,ventaitem vi";
                            $where = "v.idventa=vi.idventa AND vi.idmodelo=mo.idmodelo and v.fecha >= '$fechainicio'
    AND v.fecha <= '$fechafin' and v.idalmacen='$idalmacen'";
                            $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                            $totalbsventa = $almacenA1['resultado'];
                            $select2 = "sum(cp.monto) as monto";
                            $from = "creditopago cp";
                            $where = "cp.fechapago >= '$fechainicio' AND cp.fechapago <= '$fechafin'";
                            $sql251 = "SELECT ".$select2." FROM ".$from." WHERE ".$where." ";
                            $idalmacenA =  findBySqlReturnCampoUnique($sql251, true, true, 'monto');
                            $cobros = $idalmacenA['resultado'];

                            $select2 = "sum(cr.monto) as monto";
                            $from = "creditorebaja cr";
                            $where = "cr.fechapago >= '$fechainicio' AND cr.fechapago <= '$fechafin'";
                            $sql251 = "SELECT ".$select2." FROM ".$from." WHERE ".$where." ";
                            $idalmacenA =  findBySqlReturnCampoUnique($sql251, true, true, 'monto');
                            $rebajas = $idalmacenA['resultado'];

                            $select = "sum(cl.porpagar) as monto";
                            $from = "creditocliente cl,clientes c";
                            $where = "cl.idcliente=c.idcliente and cl.estado='pendiente' and cl.idalmacen = '$idalmacen' ";
                            $sql251 = "SELECT ".$select." FROM ".$from." WHERE ".$where." ";
                            $idalmacenA =  findBySqlReturnCampoUnique($sql251, true, true, 'monto');
                            $cuentas = $idalmacenA['resultado'];

                            $sql3 = "SELECT SUM(vf.diferencia) as total FROM ventafinalmodelo vf, ventas v WHERE v.idventa=vf.idventa and vf.fecha >= '$fechainicio'
    AND vf.fecha <= '$fechafin' and v.idalmacen='$idalmacen' ";
                            $idalmacenA2 =  findBySqlReturnCampoUnique($sql3, true, true, 'total');
                            $rebaja = $idalmacenA2['resultado'];
                            $rebaja = round($rebaja,2);
                            if($rebaja==0){
                            }else{
                                $rebaja = $rebaja*(-1);
                            }
                            $sql3w = "SELECT SUM(vf.diferencia) as total FROM kardexrebaja vf WHERE vf.fecha >= '$fechainicio'
    AND vf.fecha <= '$fechafin' and vf.idalmacen='$idalmacen'";
                            $idalmacenA2 =  findBySqlReturnCampoUnique($sql3w, true, true, 'total');
                            $rebajainventario = $idalmacenA2['resultado'];
                            $rebajainventario = round($rebajainventario,2);
                            //fin rehice
                            $tcajasstant =$tcajasstant+$cajasstant;

                            $tparesstant =$tparesstant+$paresstant;
                            $ttotalbsstant =$ttotalbsstant+$totalbsstant;
                            $ttotalcajasrecibido =$ttotalcajasrecibido+$totalcajasrecibido;
                            $ttotalparesrecibido =$ttotalparesrecibido+$totalparesrecibido;
                            $ttotalbsrecibido =$ttotalbsrecibido+$totalbsrecibido;

                            $tcajastrasrec =$tcajastrasrec+$ctraspenv;
                            $tparestrasrec =$tparestrasrec+$partraspenv;
                            $ttotalbstrasrec =$ttotalbstrasrec+$sustraspenv;
                            $tcajastraspdesp =$tcajastraspdesp+$ctrasprec;
                            $tparestraspdesp =$tparestraspdesp+$partrasrec;
                            $ttotalbstraspdesp =$ttotalbstraspdesp+$sustrasrec;
                            $ttotalcajasventa =$ttotalcajasventa+$totalcajasventa;
                            $ttotalparesventa =$ttotalparesventa+$totalparesventa;
                            $ttotalbsventa =$ttotalbsventa+$totalbsventa;
                            $ttotalcajasdev =$ttotalcajasdev+$totalcajasdev;
                            $ttotalparesdev =$ttotalparesdev+$totalparesdev;
                            $ttotalbsdev =$ttotalbsdev+$totalbsdev;
                            $tcobros =$tcobros+$cobros;
                            $trebajas =$trebajas+$rebajas;
                            $tcuentas =$tcuentas+$cuentas;
                            $tcajasstact =$tcajasstact+$cajasstact;
                            $tcajasstact =round($tcajasstact,2);

                            $tparesstact =$tparesstact+$paresstact;
                            $ttotalbsstact =$ttotalbsstact+$totalbsstact;
                            $ttotalbs =$ttotalbs+$totalbs;
                            $trebaja =$trebaja+$rebaja;
                            $trebajainventario =$trebajainventario+$rebajainventario;
                            $tporcentaje =$tporcentaje+$porcentaje;
                        }
                        //   $devS .= "</tr>";
                        $ii++;
                        $z ++;
                    }while($fi = mysql_fetch_array($re));
                    //$devS .= "<tr><td style='border:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Total</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td style='border:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>$totalparesestilo</td><td style='border:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>$totalbsestilo</td>";
                    $devS .= "<tr style='background-color:silver;'><td style='border: 1px solid #000000;font-weight:bold;font-size:12px;text-align:center;background-color:silver;font-family:Arial;'></td>";
                    $devS .= "<td style='display:none;'></td>";

                    $fechatoday = Date("d-m-Y");
                    //font-weight:bold;font-size:12px;
                    $devS .= "<td style='width:120px;text-align:center;border-bottom: 1px solid #000000;font-weight:bold;font-size:12px;'>TOTALES </td>";
                    //totalesagru


                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$tcajasstant."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$tparesstant."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$ttotalbsstant."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$ttotalcajasrecibido."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$ttotalparesrecibido."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$ttotalbsrecibido."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$tcajastrasrec."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$tparestrasrec."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$ttotalbstrasrec."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$tcajastraspdesp."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$tparestraspdesp."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$ttotalbstraspdesp."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$ttotalcajasventa."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$ttotalparesventa."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$ttotalbsventa."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$ttotalcajasdev."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$ttotalparesdev."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$ttotalbsdev."&nbsp;</td>";

                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$tcobros."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$trebajas."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$tcuentas."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$tcajasstact."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$tparesstact."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$ttotalbsstact."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$trebaja."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$trebajainventario."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$tporcentaje."&nbsp;</td>";


                    $devS .= "</tr>";

                    $devS .= "</tr>";
                    $devS .= "<br />";

                    $devS .= "</table>";

                    $dev['mensaje'] = "Existen resultados";
                    $dev['error']   = "true";
                    $dev['resultado'] = $devS;

                }
                else
                {
                    $dev['mensaje'] = "No se encontro datos en la consulta2".mysql_error();
                    $dev['error']   = "false";
                    $dev['resultado'] = "";
                }
            }
            else
            {
                $dev['mensaje'] = "Error en la consulta";
                $dev['error']   = "false";
                $dev['resultado'] = "";
            }
        }
        else
        {
            $dev['mensaje'] = "No se pudo conectar a la BD";
            $dev['error']   = "false";
            $dev['resultado'] = "";
        }
    }
    else
    {
        $dev['mensaje'] = "No se pudo crear la conexion a la BD";
        $dev['error']   = "false";
        $dev['resultado'] = "";
    }
    return $dev;
}

//recapitulacion general
function dibujarTablaOfSQLmarcarecapitulacionvendedor($idkardex,$sql,$sql21,$row1,$idmarca,$porcentajecat,$parestotalactualcategoria,$idalmacen,$rango1,$rango2,$totalparesestilo,$totalbsestilo, $tipo,$marcapedido)
{   $idalmacen=$_SESSION['idalmacen'];
    $sqlmarca = " SELECT idkardex FROM administrakardex WHERE idkardex = '$idkardex' and idalmacen='$idalmacen' ";
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "idkardex");
    $idkar = $opcionkardex['resultado'];
    if($idkar==null || $idkar==''){
        $sqlmarca = " SELECT * FROM administrakardex WHERE  mesrango= '$idkardex' and idalmacen='$idalmacen'";
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "idkardex");
        $idkar = $opcionkardex['resultado'];
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "tabla");
        $tabla = $opcionkardex['resultado'];
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "mesrango");
        $mesrango = $opcionkardex['resultado'];
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "idperiodo");
        $idperiodo = $opcionkardex['resultado'];
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "mesanterior");
        $mesanterior = $opcionkardex['resultado'];
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "estado");
        $estado = $opcionkardex['resultado'];
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "fechainicio");
        $fechainicio = $opcionkardex['resultado'];
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "fechafin");
        $fechafin = $opcionkardex['resultado'];
    }else{
        $sqlmarca = " SELECT * FROM administrakardex WHERE idkardex = '$idkar' ";
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "idkardex");
        $idkar = $opcionkardex['resultado'];
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "tabla");
        $tabla = $opcionkardex['resultado'];
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "mesrango");
        $mesrango = $opcionkardex['resultado'];
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "idperiodo");
        $idperiodo = $opcionkardex['resultado'];
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "mesanterior");
        $mesanterior = $opcionkardex['resultado'];
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "estado");
        $estado = $opcionkardex['resultado'];
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "fechainicio");
        $fechainicio = $opcionkardex['resultado'];
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "fechafin");
        $fechafin = $opcionkardex['resultado'];
    }
    //echo $sqlmarca;
    if($fechafin==null ||$fechafin == ""){
        $fechafin = Date("Y-m-d");
    }

    $sqlw = "SELECT ma.nombre AS marca,ma.talla,ma.opcionb,ma.pedido FROM  `marcas` ma WHERE ma.idmarca = '$idmarca'";
    $idalmacenA2 =  findBySqlReturnCampoUnique($sqlw, true, true, 'marca');
    $marcas = $idalmacenA2['resultado'];
    $sql211 = getTablaToArrayOfSQL($sql21);
    $sql3 = $sql211['resultado'];
    if($link=new BD)
    {
        if($link->conectar())
        {
            if($re = $link->consulta($sql))
            {
                //echo mysql_num_rows($re);
                if($fi = mysql_fetch_array($re))
                {
                    //tamano $html .= "<tr><td colspan='4' align='center' font-family='Arial'>


                    $devS .= "<table cellpadding='0' cellspacing='0' border='0' style='width:1250px;border:1px solid #000000;font-size:13px;font-family:Arial;'>";
                    $devS .= "<tr><td style='border-bottom:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'></td>";
                    $devS .= "<td style='display:none;'>".mysql_field_name($re, $zz)."</td>";
                    // $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Modelo</td>";
                    $devS .= "<td style='width:120px;border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:13px;text-align:center;'>$marcas</td>";
                    $devS .= "<td colspan='3' align='center' style='border:1px solid #000000'>STOCK MERCADERIA</td>";
                    $devS .= "<td colspan='3' align='center'  style='border:1px solid #000000' >RECIBIDOS</td>";
                    $devS .= "<td colspan='3' align='center'  style='border:1px solid #000000'>TRASP DESP.</td>";
                    $devS .= "<td colspan='3' align='center'  style='border:1px solid #000000'>TRASP REC.</td>";
                    $devS .= "<td colspan='3' align='center'  style='border:1px solid #000000' >VENTAS</td>";
                    $devS .= "<td colspan='3' align='center'  style='border:1px solid #000000' >DEVOLUCION</td>";
                    $devS .= "<td colspan='2' align='center'  style='border:1px solid #000000' >COBROS</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;'>Cuentas</td>";
                    $devS .= "<td colspan='3' align='center'  style='border:1px solid #000000' >STOCK ACTUAL</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;'>Rebajas</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;'>Reb-Inv</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;'>-</td>";

                    $devS .= "</tr>";
                    $devS .= "<tr><td style='border-bottom:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>#</td>";
                    $devS .= "<td style='display:none;'>".mysql_field_name($re, $zz)."</td>";
                    $devS .= "<td style='width:120px;border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:13px;text-align:center;background-color:silver;'></td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Cjs</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Prs</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Sus.</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Cjs</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Prs</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Sus.</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Cjs</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Prs</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Sus.</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Cjs</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Prs</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Sus.</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Cjs</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Prs</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Sus.</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Cjs</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Prs</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Sus.</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Sus</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Reb</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>P/C</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Cjs</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Prs</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Sus.</td>";

                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Sus</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'></td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>-</td>";


                    $devS .= "</tr>";
                    $ii = 0;
                    //$totalCount = mysql_num_rows($re);
                    $z = 1;
                    $tcajasstant =0;
                    $tparesstant =0;
                    $ttotalbsstant =0;
                    $ttotalcajasrecibido =0;
                    $ttotalparesrecibido =0;
                    $ttotalbsrecibido =0;

                    $tcajastrasrec =0;
                    $tparestrasrec =0;
                    $ttotalbstrasrec =0;
                    $tcajastraspdesp =0;
                    $tparestraspdesp =0;
                    $ttotalbstraspdesp =0;
                    $ttotalcajasventa =0;
                    $ttotalparesventa =0;
                    $ttotalbsventa =0;
                    $ttotalcajasdev =0;
                    $ttotalparesdev =0;
                    $ttotalbsdev =0;
                    $tcobros =0;
                    $trebajas= 0;
                    $tcuentas =0;
                    $tcajasstact =0;
                    $tparesstact =0;
                    $ttotalbsstact =0;
                    $ttotalbs =0;
                    $trebaja =0;
                    $trebajainventario =0;
                    $tporcentaje =0;
                    do{
                        $devS .= "<tr><td style='text-align:left'>".$z."</td>";
                        for($i = 0; $i< mysql_num_fields($re); $i++)
                        {$dato = $fi[$i];
                            $iddetalleingreso = $fi[$i]['idempleado'];
                            $idempleado =$dato;
                            $sql = "SELECT * FROM  empleados WHERE idempleado = '$dato' and estado!='Inactivo'";
                            $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'nombres');
                            $marcalista = $idalmacenA2['resultado'];
                            $devS .= "<td style='display:none;'>".$dato."</td>";

                            $devS .= "<td style='width:120px;text-align:left;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>".$marcalista."</td>";
                            if($cajasstant==NULL || $cajasstant =='' || $cajasstant == ""){ $cajasstant="0"; }
                            if($paresstant==NULL || $paresstant =='' || $paresstant == ""){ $paresstant="0"; }
                            if($totalbsstant==NULL || $totalbsstant =='' || $totalbsstant == ""){ $totalbsstant="0"; }

                            $select = "SUM(k.totalcajas) AS Pares";
                            $from = "ingresoalmacen k";
                            $where = "";
                            { $where .= " k.idempleado='$idempleado' AND k.idmarca = '$idmarca'  AND k.fecha >= '$fechainicio' AND k.fecha <= '$fechafin' and k.idalmacen='$idalmacen'";}
                            $sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where;
                            $almacenA1 =  findBySqlReturnCampoUnique($sql25, true, true, 'Pares');
                            $totalcajasrecibido = $almacenA1['resultado'];
                            //  echo $sqlEgreso;
                            $select = "SUM(kp.saldocantidad) AS Pares";
                            $from = "ingresoalmacen i,kardexdetalleparingreso kp";
                            $where = "";
                            { $where .= " i.idingreso=kp.idingreso and i.idempleado='$idempleado' AND i.idmarca = '$idmarca'  AND i.fecha >= '$fechainicio' AND
i.fecha <= '$fechafin' and i.idalmacen='$idalmacen'";}
                            $sql25a = "SELECT ".$select." FROM ".$from." WHERE ".$where;
                            $almacenA1 =  findBySqlReturnCampoUnique($sql25a, true, true, 'Pares');
                            $totalparesrecibido = $almacenA1['resultado'];
//ojo modificar fechas para recibido pipe
//                          $selectm = "COUNT(kp.idkardexunico) AS Pares, SUM(kp.preciounitario) AS sus ";
//                          $fromm = "modelo m,kardexdetallepar kp,modelo as m2,proformas p";
//                          $wherem = "kp.idmodelo=m.idmodelo and m.idingreso=p.id_proforma and m2.estadotraspaso=m.idmodelo and p.nombre!='00/2016'";
//                           { $wherem .= " and m2.idvendedor='$idempleado' AND m.idmarca = '$idmarca' AND (DATE_FORMAT(m.fechamodelo, '%Y-%m-%d')) >= '$fechainicio' AND (DATE_FORMAT(m.fechamodelo, '%Y-%m-%d')) <= '$fechafin' AND p.idalmacen='$idalmacen'";}
//
                        $selectm = "COUNT(kp.idkardexunico) AS Pares, SUM(kp.preciounitario) AS sus ";
                          $fromm = "modelo m,kardexdetallepar kp,modelo as m2,proformas p";
                          $wherem = "kp.idmodelo=m.idmodelo and m.idingreso=p.id_proforma and m2.estadotraspaso=m.idmodelo and p.nombre!='00/2016'";
                           { $wherem .= " and m2.idvendedor='$idempleado' AND m.idmarca = '$idmarca' AND (DATE_FORMAT(p.fecha, '%Y-%m-%d')) >= '$fechainicio' AND (DATE_FORMAT(p.fecha, '%Y-%m-%d')) <= '$fechafin' AND p.idalmacen='$idalmacen'";}

                           $sql251 = "SELECT ".$selectm." FROM ".$fromm." WHERE ".$wherem;
                            $almacenA1 =  findBySqlReturnCampoUnique($sql251, true, true, 'Pares');
                            $totalparesrecibidonuevo = $almacenA1['resultado'];
                            $almacenA1 =  findBySqlReturnCampoUnique($sql251, true, true, 'sus');
                            $totalbsrecibidonuevo = $almacenA1['resultado'];

//   $select1 = "COUNT(kp.idkardexunico) AS Pares, SUM(kp.preciounitario) AS sus";
//                            $from1 = "modelo m,kardexdetallepar kp,proformas p";
//                            $where1 = "m.idingreso=p.id_proforma and kp.idmodelo=m.idmodelo and m.estadotraspaso='ninguno' and p.nombre!='00/2016' ";
//                            { $where1 .= "and m.idvendedor='$idempleado' AND m.idmarca = '$idmarca' AND (DATE_FORMAT(m.fechamodelo, '%Y-%m-%d')) >= '$fechainicio' AND (DATE_FORMAT(m.fechamodelo, '%Y-%m-%d')) <= '$fechafin' AND p.idalmacen='$idalmacen' and m.idalmacen='$idalmacen' and kp.idalmacen='$idalmacen' and m.boleta=p.id_proforma";}

                           $select1 = "COUNT(kp.idkardexunico) AS Pares, SUM(kp.preciounitario) AS sus";
                            $from1 = "modelo m,kardexdetallepar kp,proformas p";
                            $where1 = "m.idingreso=p.id_proforma and kp.idmodelo=m.idmodelo and m.estadotraspaso='ninguno' and p.nombre!='00/2016' ";
                            { $where1 .= "and m.idvendedor='$idempleado' AND m.idmarca = '$idmarca' AND (DATE_FORMAT(p.fecha, '%Y-%m-%d')) >= '$fechainicio' AND (DATE_FORMAT(p.fecha, '%Y-%m-%d')) <= '$fechafin' AND p.idalmacen='$idalmacen' and m.idalmacen='$idalmacen' and kp.idalmacen='$idalmacen' and m.boleta=p.id_proforma";}

                            $sql25c = "SELECT ".$select1." FROM ".$from1." WHERE ".$where1;
                            //echo $sql25c;
                            $almacenA1 =  findBySqlReturnCampoUnique($sql25c, true, true, 'Pares');
                            $totalparesrecibidonuevotraspaso = $almacenA1['resultado'];
                            $almacenA1 =  findBySqlReturnCampoUnique($sql25c, true, true, 'sus');
                            $totalbsrecibidonuevotraspaso = $almacenA1['resultado'];

                           //ojo sumatoria
                           $totalparesrecibido =$totalparesrecibido + $totalparesrecibidonuevo + $totalparesrecibidonuevotraspaso;

                            $select = "SUM(k.totalbs) AS totalprecio";
                            $from = "ingresoalmacen k";
                            $where = "";
                            { $where .= "k.idempleado='$idempleado' AND k.idmarca = '$idmarca'  AND k.fecha >= '$fechainicio' AND
                                         k.fecha <= '$fechafin' and k.idalmacen='$idalmacen' ";}
                            $sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where;
                            $almacenA1 =  findBySqlReturnCampoUnique($sql25, true, true, 'totalprecio');
                            $totalbsrecibido = $almacenA1['resultado'];

                            $totalbsrecibido = $totalbsrecibido + $totalbsrecibidonuevo + $totalbsrecibidonuevotraspaso;
                            $totalcajasnuevo = $totalparesrecibido/12;
                            $totalcajasrecibido = $totalcajasrecibido + $totalcajasnuevo;
                            $totalcajasrecibido = round($totalcajasrecibido,2);

                            //traspasos entregados
                            $sqlEgreso ="SELECT SUM(iv.saldocantidad) AS Pares, SUM(iv.preciounitario) AS TotalBs
FROM traspasosinternos iv,modelo md,ventas v, empleados em,empleados emo
WHERE iv.idventa=v.idventa and iv.idmodelo=md.idmodelo and iv.idvendedor=em.idempleado and iv.idvendedororigen=emo.idempleado and iv.idvendedororigen='$idempleado' AND md.idmarca = '$idmarca'
AND iv.fecha >= '$fechainicio' AND iv.fecha <= '$fechafin' and iv.idalmacen='$idalmacen' ";
                            $almacenA1 =  findBySqlReturnCampoUnique($sqlEgreso, true, true, 'Pares');
                            $parestrasenvinterno= $almacenA1['resultado'];
                            $almacenA1 =  findBySqlReturnCampoUnique($sqlEgreso, true, true, 'TotalBs');
                            $bstrasenviinterno = $almacenA1['resultado'];

                            $sqlEgresoq ="SELECT SUM(it.saldocantidad) AS Pares, SUM(it.preciounitario) AS TotalBs
FROM traspaso t,traspasodetallepar it,modelo mdd
WHERE t.idtraspaso=it.iddetalletraspaso and t.idalmacen='$idalmacen' and mdd.idvendedor='$idempleado' and it.idmodeloorigen=mdd.idmodelo AND mdd.idmarca = '$idmarca' and t.fecha >= '$fechainicio' AND t.fecha <= '$fechafin'
   ";
                            $almacenA1 =  findBySqlReturnCampoUnique($sqlEgresoq, true, true, 'Pares');
                            $partraspenv = $almacenA1['resultado'];
                            $partraspenv=$partraspenv+$parestrasenvinterno;
                            $almacenA1 =  findBySqlReturnCampoUnique($sqlEgresoq, true, true, 'TotalBs');
                            $sustraspenv = $almacenA1['resultado'];
                            $sustraspenv=$sustraspenv+$bstrasenviinterno;

                            $ctraspenv = $partraspenv/12;
                            $ctraspenv = round($ctraspenv,2);
                            //fin entregados
                            $sqlEgreso ="SELECT SUM(iv.saldocantidad) AS Pares, SUM(iv.preciounitario) AS TotalBs
FROM traspasosinternos iv,modelo md,ventas v, empleados em,empleados emo
WHERE iv.idventa=v.idventa and iv.idmodelo=md.idmodelo and iv.idvendedor=em.idempleado and iv.idvendedororigen=emo.idempleado and iv.idvendedor='$idempleado' AND md.idmarca = '$idmarca'
AND iv.fecha >= '$fechainicio' AND iv.fecha <= '$fechafin' and iv.idalmacen='$idalmacen' ";
                            $almacenA1 =  findBySqlReturnCampoUnique($sqlEgreso, true, true, 'Pares');
                            $parestrasrecinterno = $almacenA1['resultado'];
                            $almacenA1 =  findBySqlReturnCampoUnique($sqlEgreso, true, true, 'TotalBs');
                            $bstrasrecinterno= $almacenA1['resultado'];


                            $sqlEgreso ="SELECT  SUM(it.saldocantidad) AS Pares, SUM(it.preciounitario) AS TotalBs
FROM traspaso t,traspasodetallepar it,modelo mdd
WHERE t.idtraspaso=it.iddetalletraspaso and it.idmodelo=mdd.idmodelo and t.idalmacendestino='$idalmacen'
and mdd.idvendedor='$idempleado' AND mdd.idvendedor=t.responsable AND mdd.idmarca = '$idmarca' and t.fecha >= '$fechainicio' AND t.fecha <= '$fechafin'
   ";
                            //ojo
                            $almacenA1 =  findBySqlReturnCampoUnique($sqlEgreso, true, true, 'Pares');
                            $partrasrec = $almacenA1['resultado'];
                            $partrasrec=$partrasrec+$parestrasrecinterno;
                            $almacenA1 =  findBySqlReturnCampoUnique($sqlEgreso, true, true, 'TotalBs');
                            $sustrasrec = $almacenA1['resultado'];
                            $sustrasrec=$sustrasrec+$bstrasrecinterno;
                            $ctrasprec = $partrasrec/12;
                            $ctrasprec = round($ctrasprec,2);
                            //fin  recibidos
                            $select = "SUM(vi.cantidad) AS Pares";
                            $from = "ventas v,modelo mo,ventaitem vi";
                            $where = " v.idventa=vi.idventa AND vi.idmodelo=mo.idmodelo and mo.idmarca = '$idmarca' and v.fecha >= '$fechainicio'
    AND v.fecha <= '$fechafin' and v.idalmacen='$idalmacen' and v.idvendedor='$idempleado'";
                            $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');

                            $totalparesventa = $almacenA1['resultado'];
                            $totalcajasventa = $totalparesventa/12;
                            $totalcajasventa = round($totalcajasventa,2);
                            $select = "sUM(vi.precioventa) AS Pares";
                            $from = "ventas v,modelo mo,ventaitem vi";
                            $where = "v.idventa=vi.idventa AND vi.idmodelo=mo.idmodelo and mo.idmarca = '$idmarca'
and v.fecha >= '$fechainicio'
    AND v.fecha <= '$fechafin' and v.idalmacen='$idalmacen' and v.idvendedor='$idempleado' ";
                            $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                            $totalbsventa = $almacenA1['resultado'];

                            $selecta = "COUNT(v.iddetalledevolucion) AS Pares";
                            $froma = "detalledevolucion v,devolucion d,kardexdetallepar k";
                            $wherea = " v.idkardexunico=k.idkardexunico and v.iddevolucion=d.iddevolucion
    AND d.idmarca = '$idmarca' and d.idvendedor='$idempleado'  and d.fecha >= '$fechainicio' AND d.fecha <= '$fechafin' and d.idalmacen='$idalmacen'";
                            $sql2p = "SELECT ".$selecta." FROM ".$froma. " WHERE ".$wherea;

                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                            $totalparesdev = $almacenA1['resultado'];
                            $totalcajasdev = $totalparesdev/12;
                            $totalcajasdev= round($totalcajasdev,2);
                         
                            $selectb = "SUM(v.valorcalzado) AS Pares";
                            $fromb = "detalledevolucion v,devolucion d,kardexdetallepar k";
                            $whereb = "v.idkardexunico=k.idkardexunico and v.iddevolucion=d.iddevolucion
     AND d.idmarca = '$idmarca' and d.idvendedor='$idempleado'  and d.fecha >= '$fechainicio' AND d.fecha <= '$fechafin' and d.idalmacen='$idalmacen'";
                            $sql2p1 = "SELECT ".$selectb." FROM ".$fromb. " WHERE ".$whereb;
                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p1, true, true, 'Pares');
                            $totalbsdev = $almacenA1['resultado'];

                            $sqlEgreso ="SELECT  estado FROM periodo WHERE idperiodo= '$idperiodo'    ";
                            $almacenA1 =  findBySqlReturnCampoUnique($sqlEgreso, true, true, 'estado');
                            $estadoperiodo = $almacenA1['resultado'];


                            if($estado=="cerrado"){
                                $select = "SUM(k.pares) AS Pares";
                                $from = "kardexresumen k,modelo m";
                                $where = " k.idmodelo=m.idmodelo AND k.idmarca = '$idmarca' and k.idvendedor='$idempleado' and
    m.idalmacen='$idalmacen' and mes='$mesrango'";
                                $sql2p3 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                                $almacenA1 =  findBySqlReturnCampoUnique($sql2p3, true, true, 'Pares');
                                $paresstact = $almacenA1['resultado'];

                                $cajasstact = $paresstact/12;
                                $select = "SUM(k.pares*m.preciounitario) AS Precio";
                                $from = "kardexresumen k,modelo m";
                                $where = " k.idmodelo=m.idmodelo AND k.idmarca = '$idmarca' and m.idvendedor='$idempleado' and
    m.idalmacen='$idalmacen' and mes='$mesrango'";
                                $sql2p3 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                                $almacenA1 =  findBySqlReturnCampoUnique($sql2p3, true, true, 'Precio');
                                $totalbsstact = $almacenA1['resultado'];

                                $sqlmarca = " SELECT * FROM administrakardex WHERE idalmacen = '$idalmacen' and mesrango='$mesrango' ";
                                $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "mesanterior");
                                $mesanterior = $opcionkardex['resultado'];

                                $select = "SUM(k.pares) AS Pares";
                                $from = "kardexresumen k,modelo m";
                                $where = " k.idmodelo=m.idmodelo AND k.idmarca = '$idmarca' and k.idvendedor='$idempleado' and
    m.idalmacen='$idalmacen' and mes='$mesanterior'";
                                $sql2p3 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                                $almacenA1 =  findBySqlReturnCampoUnique($sql2p3, true, true, 'Pares');
                                $paresstant = $almacenA1['resultado'];

                                $cajasstant = $paresstant/12;
                                $select = "SUM(k.pares*m.preciounitario) AS Precio";
                                $from = "kardexresumen k,modelo m";
                                $where = " k.idmodelo=m.idmodelo AND k.idmarca = '$idmarca' and k.idvendedor='$idempleado' and
    m.idalmacen='$idalmacen' and mes='$mesanterior'";
                                $sql2p3 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                                $almacenA1 =  findBySqlReturnCampoUnique($sql2p3, true, true, 'Precio');
                                $totalbsstant = $almacenA1['resultado'];
                                $cajasstant =round($cajasstant,2);


                            }else{
                                $select = "SUM(ka.saldocantidad) AS Pares";
                                $from = "modelo m,kardexdetallepar ka";
                                $where = "  ka.idmodelo=m.idmodelo  aND m.idmarca = '$idmarca' and m.idalmacen='$idalmacen' and m.idvendedor='$idempleado'
    ";
                                $sql2p3 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                                $almacenA1 =  findBySqlReturnCampoUnique($sql2p3, true, true, 'Pares');
                                $paresstact = $almacenA1['resultado'];

                                $cajasstact = $paresstact/12;
                                $select = "SUM(ka.saldocantidad*ka.preciounitario) AS Precio";
                                $from = "modelo m,kardexdetallepar ka";
                                $where = " ka.idmodelo=m.idmodelo  aND m.idmarca = '$idmarca' and ka.idalmacen='$idalmacen' and m.idvendedor='$idempleado'";
                                $sql2p3 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                                $almacenA1 =  findBySqlReturnCampoUnique($sql2p3, true, true, 'Precio');
                                $totalbsstact = $almacenA1['resultado'];


                                $select = "SUM(k.pares) AS Pares";
                                $from = "kardexresumen k,modelo m";
                                $where = " k.idmodelo=m.idmodelo AND k.idmarca = '$idmarca' and k.idvendedor='$idempleado' and
    k.idalmacen='$idalmacen' and k.mes='$mesanterior'";
                                $sql2p3q = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                                $almacenA1 =  findBySqlReturnCampoUnique($sql2p3q, true, true, 'Pares');
                                $paresstant = $almacenA1['resultado'];
                                //echo $sql2p3q;
                                $cajasstact = $paresstact/12;
                                $select = "SUM(k.pares*m.preciounitario) AS Precio";
                                $from = "kardexresumen k,modelo m";
                                $where = " k.idmodelo=m.idmodelo AND k.idmarca = '$idmarca' and k.idvendedor='$idempleado' and
    k.idalmacen='$idalmacen' and mes='$mesanterior'";
                                $sql2p3d = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                                $almacenA1 =  findBySqlReturnCampoUnique($sql2p3d, true, true, 'Precio');
                                $totalbsstant = $almacenA1['resultado'];
                                $cajasstant = $paresstant/12;
                                $cajasstant =round($cajasstant,2);

                            }
                            if($cajasstact==NULL || $cajasstact =='' || $cajasstact == ""){ $cajasstact="0"; }
                            if($paresstact==NULL || $paresstact =='' || $paresstact == ""){ $paresstact="0"; }
                            if($totalbsstact==NULL || $totalbsstact =='' || $totalbsstact == ""){ $totalbsstact="0"; }

                            $totalbsstant =round($totalbsstant,2);
                            $select = "SUM(vi.precioventa) AS Pares";
                            $from = "ventas v,modelo mo,ventaitem vi";
                            $where = "v.idventa=vi.idventa AND vi.idmodelo=mo.idmodelo and mo.idmarca = '$idmarca' and v.fecha >= '$fechainicio'
    AND v.fecha <= '$fechafin' and v.idalmacen='$idalmacen' and v.idvendedor='$idempleado' ";
                            $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                            $totalbsventa = $almacenA1['resultado'];
                            $select2 = "sum(cp.monto) as monto";
                            $from = "creditopago cp";
                            $where = "cp.idvendedor='$idempleado' and cp.idmarca='$idmarca' AND cp.fechapago >= '$fechainicio' AND cp.fechapago <= '$fechafin'";
                            $sql251 = "SELECT ".$select2." FROM ".$from." WHERE ".$where." ";
                            $idalmacenA =  findBySqlReturnCampoUnique($sql251, true, true, 'monto');
                            $cobros = $idalmacenA['resultado'];

                            $select2 = "sum(cr.monto) as monto";
                            $from = "creditorebaja cr";
                            $where = "cr.idvendedor='$idempleado' and cr.idmarca='$idmarca' AND cr.fechapago >= '$fechainicio' AND cr.fechapago <= '$fechafin'";
                            $sql251 = "SELECT ".$select2." FROM ".$from." WHERE ".$where." ";
                            $idalmacenA =  findBySqlReturnCampoUnique($sql251, true, true, 'monto');
                            $rebajas = $idalmacenA['resultado'];

                            $select = "sum(cl.porpagar) as monto";
                            $from = "creditocliente cl,clientes c";
                            $where = "cl.idcliente=c.idcliente and cl.estado='pendiente' and cl.idmarca='$idmarca' and cl.idvendedor='$idempleado' and cl.idalmacen = '$idalmacen'";
                            $sql251 = "SELECT ".$select." FROM ".$from." WHERE ".$where." ";
                            $idalmacenA =  findBySqlReturnCampoUnique($sql251, true, true, 'monto');
                            $cuentas = $idalmacenA['resultado'];

                            $sql3 = "SELECT SUM(vf.diferencia) as total FROM ventafinalmodelo vf, ventas v WHERE v.idventa=vf.idventa and vf.idmarca = '$idmarca' and vf.fecha >= '$fechainicio'
    AND vf.fecha <= '$fechafin' and v.idalmacen='$idalmacen' and vf.idvendedor='$idempleado'  ";
                            $idalmacenA2 =  findBySqlReturnCampoUnique($sql3, true, true, 'total');
                            $rebaja = $idalmacenA2['resultado'];
                            $rebaja = round($rebaja,2);
                            if($rebaja==0){
                            }else{
                                $rebaja = $rebaja*(-1);
                            }

                            $sql3w = "SELECT SUM(vf.diferencia) as total FROM kardexrebaja vf WHERE vf.idmarca = '$idmarca' and vf.fecha >= '$fechainicio'
    AND vf.fecha <= '$fechafin' and vf.idalmacen='$idalmacen' and vf.idvendedor='$idempleado'  ";
                            $idalmacenA2 =  findBySqlReturnCampoUnique($sql3w, true, true, 'total');
                            $rebajainventario = $idalmacenA2['resultado'];
                            $rebajainventario = round($rebajainventario,2);

                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$cajasstant."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$paresstant."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$totalbsstant."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$totalcajasrecibido."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$totalparesrecibido."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$totalbsrecibido."&nbsp;</td>";

                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$ctraspenv."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$partraspenv."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$sustraspenv."&nbsp;</td>";

                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$ctrasprec."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$partrasrec."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$sustrasrec."&nbsp;</td>";

                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$totalcajasventa."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$totalparesventa."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$totalbsventa."&nbsp;</td>";

                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$totalcajasdev."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$totalparesdev."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$totalbsdev."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$cobros."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$rebajas."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$cuentas."&nbsp;</td>";
                            $cajasstact =round($cajasstact,2);
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$cajasstact."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$paresstact."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$totalbsstact."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$rebaja."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$rebajainventario."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$porcentaje."&nbsp;</td>";
                            $tcajasstant =$tcajasstant+$cajasstant;

                            $tparesstant =$tparesstant+$paresstant;
                            $ttotalbsstant =$ttotalbsstant+$totalbsstant;
                            $ttotalcajasrecibido =$ttotalcajasrecibido+$totalcajasrecibido;
                            $ttotalparesrecibido =$ttotalparesrecibido+$totalparesrecibido;
                            $ttotalbsrecibido =$ttotalbsrecibido+$totalbsrecibido;

                            $tcajastrasrec =$tcajastrasrec+$ctraspenv;
                            $tparestrasrec =$tparestrasrec+$partraspenv;
                            $ttotalbstrasrec =$ttotalbstrasrec+$sustraspenv;
                            $tcajastraspdesp =$tcajastraspdesp+$ctrasprec;
                            $tparestraspdesp =$tparestraspdesp+$partrasrec;
                            $ttotalbstraspdesp =$ttotalbstraspdesp+$sustrasrec;

                            $ttotalcajasventa =$ttotalcajasventa+$totalcajasventa;
                            $ttotalparesventa =$ttotalparesventa+$totalparesventa;
                            $ttotalbsventa =$ttotalbsventa+$totalbsventa;
                            $ttotalcajasdev =$ttotalcajasdev+$totalcajasdev;
                            $ttotalparesdev =$ttotalparesdev+$totalparesdev;
                            $ttotalbsdev =$ttotalbsdev+$totalbsdev;
                            $tcobros =$tcobros+$cobros;
                            $trebajas =$trebajas+$rebajas;
                            $tcuentas =$tcuentas+$cuentas;
                            $tcajasstact =$tcajasstact+$cajasstact;
                            $tparesstact =$tparesstact+$paresstact;
                            $ttotalbsstact =$ttotalbsstact+$totalbsstact;
                            $ttotalbs =$ttotalbs+$totalbs;
                            $trebaja =$trebaja+$rebaja;
                            $trebajainventario =$trebajainventario+$rebajainventario;
                            $tporcentaje =$tporcentaje+$porcentaje;
                        }
                        $devS .= "</tr>";
                        $ii++;
                        $z ++;
                    }while($fi = mysql_fetch_array($re));
                    //$devS .= "<tr><td style='border:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Total</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td style='border:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>$totalparesestilo</td><td style='border:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>$totalbsestilo</td>";
                    $devS .= "<tr style='background-color:silver;'><td style='border: 1px solid #000000;font-weight:bold;font-size:12px;text-align:center;background-color:silver;font-family:Arial;'></td>";
                    $devS .= "<td style='display:none;'></td>";

                    $fechatoday = Date("d-m-Y");
                    //font-weight:bold;font-size:12px;
                    $devS .= "<td style='width:120px;text-align:center;border-bottom: 1px solid #000000;font-weight:bold;font-size:12px;'>TOTAL -".$nombrecategoria."</td>";
                    //totalesagru


                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$tcajasstant."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$tparesstant."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$ttotalbsstant."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$ttotalcajasrecibido."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$ttotalparesrecibido."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$ttotalbsrecibido."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$tcajastrasrec."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$tparestrasrec."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$ttotalbstrasrec."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$tcajastraspdesp."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$tparestraspdesp."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$ttotalbstraspdesp."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$ttotalcajasventa."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$ttotalparesventa."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$ttotalbsventa."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$ttotalcajasdev."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$ttotalparesdev."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$ttotalbsdev."&nbsp;</td>";

                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$tcobros."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$trebajas."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$tcuentas."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$tcajasstact."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$tparesstact."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$ttotalbsstact."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$trebaja."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$trebajainventario."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$tporcentaje."&nbsp;</td>";


                    $devS .= "</tr>";

                    $devS .= "</tr>";
                    $devS .= "<br />";

                    $devS .= "</table>";

                    $dev['mensaje'] = "Existen resultados";
                    $dev['error']   = "true";
                    $dev['resultado'] = $devS;

                }
                else
                {
                    $dev['mensaje'] = "No se encontro datos en la consulta2".mysql_error();
                    $dev['error']   = "false";
                    $dev['resultado'] = "";
                }
            }
            else
            {
                $dev['mensaje'] = "Error en la consulta";
                $dev['error']   = "false";
                $dev['resultado'] = "";
            }
        }
        else
        {
            $dev['mensaje'] = "No se pudo conectar a la BD";
            $dev['error']   = "false";
            $dev['resultado'] = "";
        }
    }
    else
    {
        $dev['mensaje'] = "No se pudo crear la conexion a la BD";
        $dev['error']   = "false";
        $dev['resultado'] = "";
    }
    return $dev;
}


function verIngresosMarcaEstiloHTMLInventariotallam($idmarca,$idestilo,$idkardex, $return)
{
    $html = "";
    $html .= "<tr><td colspan='4' align='center'>
    <p>Nova Moda S.RL.<br />
         <br />
         Telf. 4-258993  Fax: 4-504183
    </p>
</td></tr>";

    $html .= "<!DOCTYPE HTML PUBLIC '-//W3C//DTD HTML 4.01 Transitional//EN'>";
    $html .= "<html>";
    $html .= "<body>";
    $html .= "<tr>";

    $html .= "<table cellpadding='1' cellspacing='0' border='0' style='width:100%' font-size:11px; font-family:Tahoma;'>";
    $html .= "<td style='width:100%;height:100%;text-align:right;font-size:12px;font-family:Tahoma;'>";
    $html .= "$fecha  $tipo";
    $html .= "</td>";
    $html .= "<tr>";
    $sql = "SELECT ma.nombre AS marca,ma.talla,ma.opcionb,ma.pedido
FROM  `marcas` ma
WHERE ma.idmarca = '$idmarca'";

    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'marca');
    $marcalista = $idalmacenA2['resultado'];
    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'talla');
    $opcionmarca = $idalmacenA2['resultado'];
    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'opcionb');
    $opcionb = $idalmacenA2['resultado'];
    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'pedido');
    $marcapedido = $idalmacenA2['resultado'];
    $idsCAr = split("-", $opcionmarca);
    $rango1=$idsCAr[0];
    $rango2=$idsCAr[1];
    if($opcionmarca="33-45"){
        $tipo="1";
    }else{
        if($opcionmarca="14-38"){
            $tipo="3";
        }
    }
    $sqlmarca = " SELECT tabla,mesrango,idperiodo,fechainicio,fechafin FROM administrakardex WHERE idkardex = '$idkardex' ";
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "tabla");
    $tabla = $opcionkardex['resultado'];
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "mesrango");
    $mesrango = $opcionkardex['resultado'];
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "idperiodo");
    $idperiodo = $opcionkardex['resultado'];
    //echo $tabla;
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "fechainicio");
    $fechainicio = $opcionkardex['resultado'];
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "fechafin");
    $fechafin = $opcionkardex['resultado'];
    if($fechafin==null ||$fechafin == ""){
        $fechafin = Date("Y-m-d");}

    $formatear = explode( '-' , $fechainicio);
    $fechain = $formatear[2].'-'.$formatear[1].'-' .$formatear[0];
    $formatear = explode( '-' , $fechafin);
    $fechaf = $formatear[2].'-'.$formatear[1].'-' .$formatear[0];
    $html .= "<td style='width:100%;height:100px;text-align:center;font-size:15px;font-family:Tahoma;'>";

    $html .= "INVENTARIO $marcalista<br>";

    //    $html .= "Ventas por Marca<br>";
    $html .= "CORRESPONDIENTE DEL $fechain AL $fechaf<br>";
    //     $html .= "Tienda $tienda";
    $html .= "</td>";
    $html .= "</tr>";
    $html .= "</table>";
    $html .= "</tr>";
    $html .= "<tr>";
    $html .= "<td colspan='3'>";

    $html .= "<table width='1250' border='0' cellspacing='0' cellpadding='0'><tr>";

    $select = "idestilo,nombre";
    $from = "estilos";
    $where .= " descripcion = '$idmarca' ORDER BY CAST( nombre AS SIGNED) ASC";
    $sql2 = "SELECT ".$select." FROM ".$from." WHERE ".$where;
    $row = NumeroTuplas($sql2);
    $row1= $row['resultado'];
    $sql21 = getTablaToArrayOfSQL($sql2);
    $sql3 = $sql21['resultado'];
    $row5 = NumeroTuplas($sql2);
    $row15= $row5['resultado'];
    //    $html .= "<td style='width:100%;text-align:center;font-size:1px;font-family:Tahoma;'>";
    $html .= "<table cellpadding='0' cellspacing='0' border='0' style='width:100%;border:0px solid #000000;font-size:11px;text-align:center'>";
    $html .= "<tr>";
    for($i=0;$i<=$row15;$i++){
        $codigo = $sql3[$i];
        $idestilo = $codigo['idestilo'];
        $nombreestilo = $codigo['nombre'];
        $html .= "<tr style='width:100%; font-size:11px;'>";
        $html .=" <td style='font-size:11px;text-align:left'>".$nombreestilo."";
        $html .=" </td> ";
        $html .= "</tr>";
        $html .= "<tr>";
        $iddet1="1";
        $iddet2="26";
        $rango1=$iddet1;
        $rango2=$iddet2;
        $select = "talla,idmodelo,iddetalleingresotalla,tallasm";
        $from = "tallasdetallem";
        $where = "iddetalleingresotalla >='$iddet1' AND iddetalleingresotalla <='$iddet2' ORDER BY iddetalleingresotalla ASC";
        $sql21 = "SELECT ".$select." FROM ".$from." WHERE ".$where;
        $row = NumeroTuplas($sql21);
        $row1= $row['resultado'];

        $select = "SUM(saldocantidad) AS Pares";
        $from = "adicionkardextienda k,modelos mdt";
        $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND mdt.stylename = '$idestilo' AND k.unido='no'";
        $sql2121 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
        $almacenA1 =  findBySqlReturnCampoUnique($sql2121, true, true, 'Pares');
        $totalparesestilo = $almacenA1['resultado'];
        $select = "SUM(saldocantidad*precio2bs) AS bs";
        $from = "adicionkardextienda k,modelos mdt";
        $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND mdt.stylename = '$idestilo' AND k.unido='no'";
        $sql2121 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
        $almacenA1 =  findBySqlReturnCampoUnique($sql2121, true, true, 'bs');
        $totalbsestilo = $almacenA1['resultado'];
        $select = "dtp.iddetalleingreso";
        $from = "adiciondetalleingreso dtp, modelos mdd, coleccion col, estilos es";
        $where = "dtp.idmodelo = mdd.idmodelo AND mdd.idcoleccion = col.idcoleccion AND mdd.stylename = es.idestilo AND dtp.unido='no' AND mdd.idmarca = '$idmarca' AND mdd.stylename='$idestilo'";
        $sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where." ORDER BY CAST( `mdd`.`codigo` AS SIGNED) ASC";
        $table = dibujarTablaOfSQLinventario($idkardex,$sql25,$sql21,$row1,$idmarca,$idestilo,$rango1,$rango2,$totalparesestilo,$totalbsestilo, "2",$marcapedido);

        $html .= $table['resultado'];
        $html .= "</tr>";
        //       ss
    }
    //totales de totales
    $html .= "</tr>";
    $html .= "</table>";

    $html .= "<table cellpadding='1' cellspacing='0' border='0' style='width:50%' font-size:25px; font-family:Tahoma;'>";
    $html .= "<tr style='width:50%;height:50%;text-align:right;font-size:25px;font-family:Tahoma;'>";
    $select21 .= "SUM( dtp.saldocantidad *dtp.precio2bs) AS TOTALbs ";
    $from21 = "historialkardextienda dtp, modelos mdd, coleccion col";
    $where21 = "dtp.idmodelodetalle = mdd.idmodelo AND mdd.idcoleccion = col.idcoleccion AND mdd.idmarca='$idmarca'";

    $sqltotalbs = "SELECT ".$select21." FROM ".$from21. " WHERE ".$where21;
    $idalmacenA2 =  findBySqlReturnCampoUnique($sqltotalbs, true, true, 'TOTALbs');
    $totalbs = $idalmacenA2['resultado'];

    $select2 .= "SUM( dtp.saldocantidad ) AS TOTALPARES ";
    $from2 = "historialkardextienda dtp, modelos mdd, coleccion col";
    $where2 = "dtp.idmodelodetalle = mdd.idmodelo AND mdd.idcoleccion = col.idcoleccion AND mdd.idmarca='$idmarca'";

    $sqltotalpares = "SELECT ".$select2." FROM ".$from2. " WHERE ".$where2;
    // echo $sqltotalpares;
    $idalmacenA2 =  findBySqlReturnCampoUnique($sqltotalpares, true, true, 'TOTALPARES');
    $totalpares = $idalmacenA2['resultado'];
    // echo $sqltotalpares;

    $producto2 = dibujarTuplaOfSQLSimpleinventario($sqltotalpares,$totalpares,$totalbs);
    $html .= $producto2['resultado'];
    $html .= "</tr>";
    $html .= "</table>";

    $html .= "</body>";
    $html .= "</html>";
    if($return == true)
    {
        return $html;
    }
    else
    {
        echo $html;
    }
}

function verIngresosMarcaEstiloHTMLInventariotallaVacio($idmarca,$idestilo,$idkardex, $return)
{
    $html = "";
    $html .= "<tr><td colspan='4' align='center'>
    <p>Nova Moda S.RL.<br />
         <br />
         Telf. 4-258993  Fax: 4-504183
    </p>
</td></tr>";

    $html .= "<!DOCTYPE HTML PUBLIC '-//W3C//DTD HTML 4.01 Transitional//EN'>";
    $html .= "<html>";
    $html .= "<body>";
    $html .= "<tr>";

    $html .= "<table cellpadding='1' cellspacing='0' border='0' style='width:100%' font-size:11px; font-family:Tahoma;'>";
    $html .= "<td style='width:100%;height:100%;text-align:right;font-size:12px;font-family:Tahoma;'>";
    $html .= "$fecha  $tipo";
    $html .= "</td>";
    $html .= "<tr>";
    $sql = "SELECT ma.nombre AS marca,ma.talla,ma.opcionb,ma.pedido
FROM  `marcas` ma
WHERE ma.idmarca = '$idmarca'";

    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'marca');
    $marcalista = $idalmacenA2['resultado'];
    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'talla');
    $opcionmarca = $idalmacenA2['resultado'];
    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'opcionb');
    $opcionb = $idalmacenA2['resultado'];
    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'pedido');
    $marcapedido = $idalmacenA2['resultado'];
    $idsCAr = split("-", $opcionmarca);
    $rango1=$idsCAr[0];
    $rango2=$idsCAr[1];
    if($opcionmarca="33-45"){
        $tipo="1";
    }else{
        if($opcionmarca="14-38"){
            $tipo="3";
        }
    }
    $sqlmarca = " SELECT tabla,mesrango,idperiodo,fechainicio,fechafin FROM administrakardex WHERE idkardex = '$idkardex' ";
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "tabla");
    $tabla = $opcionkardex['resultado'];
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "mesrango");
    $mesrango = $opcionkardex['resultado'];
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "idperiodo");
    $idperiodo = $opcionkardex['resultado'];
    //echo $tabla;
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "fechainicio");
    $fechainicio = $opcionkardex['resultado'];
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "fechafin");
    $fechafin = $opcionkardex['resultado'];
    if($fechafin==null ||$fechafin == ""){
        $fechafin = Date("Y-m-d");}

    $formatear = explode( '-' , $fechainicio);
    $fechain = $formatear[2].'-'.$formatear[1].'-' .$formatear[0];
    $formatear = explode( '-' , $fechafin);
    $fechaf = $formatear[2].'-'.$formatear[1].'-' .$formatear[0];
    $html .= "<td style='width:100%;height:100px;text-align:center;font-size:15px;font-family:Tahoma;'>";

    $html .= "INVENTARIO $marcalista<br>";

    //    $html .= "Ventas por Marca<br>";
    $html .= "CORRESPONDIENTE DEL $fechain AL $fechaf<br>";
    //     $html .= "Tienda $tienda";
    $html .= "</td>";
    $html .= "</tr>";
    $html .= "</table>";
    $html .= "</tr>";
    $html .= "<tr>";
    $html .= "<td colspan='3'>";

    $html .= "<table width='1250' border='0' cellspacing='0' cellpadding='0'><tr>";

    $select = "idestilo,nombre";
    $from = "estilos";
    $where .= " descripcion = '$idmarca' ORDER BY CAST( nombre AS SIGNED) ASC";
    $sql2 = "SELECT ".$select." FROM ".$from." WHERE ".$where;
    $row = NumeroTuplas($sql2);
    $row1= $row['resultado'];
    $sql21 = getTablaToArrayOfSQL($sql2);
    $sql3 = $sql21['resultado'];
    $row5 = NumeroTuplas($sql2);
    $row15= $row5['resultado'];
    //    $html .= "<td style='width:100%;text-align:center;font-size:1px;font-family:Tahoma;'>";
    $html .= "<table cellpadding='0' cellspacing='0' border='0' style='width:100%;border:0px solid #000000;font-size:11px;text-align:center'>";
    $html .= "<tr>";
    for($i=0;$i<=$row15;$i++){
        $codigo = $sql3[$i];
        $idestilo = $codigo['idestilo'];
        $nombreestilo = $codigo['nombre'];
        $html .= "<tr style='width:100%; font-size:11px;'>";
        $html .=" <td style='font-size:11px;text-align:left'>".$nombreestilo."";
        $html .=" </td> ";
        $html .= "</tr>";
        $html .= "<tr>";
        $iddet1="1";
        $iddet2="26";
        $rango1=$iddet1;
        $rango2=$iddet2;
        $select = "talla,idmodelo,iddetalleingresotalla,tallasm";
        $from = "tallasdetallem";
        $where = "iddetalleingresotalla >='$iddet1' AND iddetalleingresotalla <='$iddet2' ORDER BY iddetalleingresotalla ASC";
        $sql21 = "SELECT ".$select." FROM ".$from." WHERE ".$where;
        $row = NumeroTuplas($sql21);
        $row1= $row['resultado'];

        $select = "SUM(saldocantidad) AS Pares";
        $from = "adicionkardextienda k,modelos mdt";
        $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND mdt.stylename = '$idestilo' AND k.unido='no'";
        $sql2121 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
        $almacenA1 =  findBySqlReturnCampoUnique($sql2121, true, true, 'Pares');
        $totalparesestilo = $almacenA1['resultado'];
        $select = "SUM(saldocantidad*precio2bs) AS bs";
        $from = "adicionkardextienda k,modelos mdt";
        $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND mdt.stylename = '$idestilo' AND k.unido='no'";
        $sql2121 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
        $almacenA1 =  findBySqlReturnCampoUnique($sql2121, true, true, 'bs');
        $totalbsestilo = $almacenA1['resultado'];
        $select = "dtp.iddetalleingreso";
        $from = "adiciondetalleingreso dtp, modelos mdd, coleccion col, estilos es";
        $where = "dtp.idmodelo = mdd.idmodelo AND mdd.idcoleccion = col.idcoleccion AND mdd.stylename = es.idestilo AND dtp.unido='no' AND mdd.idmarca = '$idmarca' AND mdd.stylename='$idestilo'";
        $sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where." ORDER BY CAST( `mdd`.`codigo` AS SIGNED) ASC";
        $table = dibujarTablaOfSQLinventarioVacio($idkardex,$sql25,$sql21,$row1,$idmarca,$idestilo,$rango1,$rango2,$totalparesestilo,$totalbsestilo, "2",$marcapedido);

        $html .= $table['resultado'];
        $html .= "</tr>";
        //       ss
    }
    //totales de totales
    $html .= "</tr>";
    $html .= "</table>";

    $html .= "<table cellpadding='1' cellspacing='0' border='0' style='width:50%' font-size:25px; font-family:Tahoma;'>";
    $html .= "<tr style='width:50%;height:50%;text-align:right;font-size:25px;font-family:Tahoma;'>";
    $select21 .= "SUM( dtp.saldocantidad *dtp.precio2bs) AS TOTALbs ";
    $from21 = "historialkardextienda dtp, modelos mdd, coleccion col";
    $where21 = "dtp.idmodelodetalle = mdd.idmodelo AND mdd.idcoleccion = col.idcoleccion AND mdd.idmarca='$idmarca'";

    $sqltotalbs = "SELECT ".$select21." FROM ".$from21. " WHERE ".$where21;
    $idalmacenA2 =  findBySqlReturnCampoUnique($sqltotalbs, true, true, 'TOTALbs');
    $totalbs = $idalmacenA2['resultado'];

    $select2 .= "SUM( dtp.saldocantidad ) AS TOTALPARES ";
    $from2 = "historialkardextienda dtp, modelos mdd, coleccion col";
    $where2 = "dtp.idmodelodetalle = mdd.idmodelo AND mdd.idcoleccion = col.idcoleccion AND mdd.idmarca='$idmarca'";

    $sqltotalpares = "SELECT ".$select2." FROM ".$from2. " WHERE ".$where2;
    // echo $sqltotalpares;
    $idalmacenA2 =  findBySqlReturnCampoUnique($sqltotalpares, true, true, 'TOTALPARES');
    $totalpares = $idalmacenA2['resultado'];
    // echo $sqltotalpares;

    $producto2 = dibujarTuplaOfSQLSimpleinventario($sqltotalpares,$totalpares,$totalbs);
    $html .= $producto2['resultado'];
    $html .= "</tr>";
    $html .= "</table>";

    $html .= "</body>";
    $html .= "</html>";
    if($return == true)
    {
        return $html;
    }
    else
    {
        echo $html;
    }
}

function verIngresosMarcaEstiloHTMLtallam($idmarca,$idestilo, $idkardex,$return)
{
    $html = "";
    $html .= "<tr><td colspan='4' align='center'>
    <p>Nova Moda S.RL.<br />
         <br />
         Telf. 4-258993  Fax: 4-504183
    </p>
</td></tr>";
    $html .= "<!DOCTYPE HTML PUBLIC '-//W3C//DTD HTML 4.01 Transitional//EN'>";
    $html .= "<html>";
    $html .= "<body>";
    $html .= "<tr>";

    $html .= "<table cellpadding='1' cellspacing='0' border='0' style='width:100%' font-size:11px; font-family:Tahoma;'>";
    $html .= "<td style='width:100%;height:100%;text-align:right;font-size:12px;font-family:Tahoma;'>";
    $html .= "$fecha  $tipo";
    $html .= "</td>";
    $html .= "<tr>";
    $sql = "SELECT ma.nombre AS marca,ma.talla,ma.opcionb,ma.pedido
FROM  `marcas` ma
WHERE ma.idmarca = '$idmarca'";

    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'marca');
    $marcalista = $idalmacenA2['resultado'];
    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'talla');
    $opcionmarca = $idalmacenA2['resultado'];
    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'opcionb');
    $opcionb = $idalmacenA2['resultado'];
    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'pedido');
    $marcapedido = $idalmacenA2['resultado'];
    $idsCAr = split("-", $opcionmarca);

    $sql1 = "SELECT  es.nombre AS estilo
FROM  estilos es
WHERE es.idestilo = '$idestilo'";
    $idalmacenA =  findBySqlReturnCampoUnique($sql1, true, true, 'estilo');
    $estilolista = $idalmacenA['resultado'];
    //$html .= "<tr style='width:100%height:100px;text-align:center;font-size:15px;font-family:Tahoma;'>";
    $html .= "<td style='width:100%;height:100px;text-align:center;font-size:15px;font-family:Tahoma;'>";
    if($idestilo == null ||$idestilo == "null" )
    {
        $html .= "INVENTARIO $marcalista<br>";
        $html .= "CORRESPONDIENTE DEL $fechain AL $fechaf<br>";
        //  $sqldetalle = "SELECT ".$select." FROM ".$from. " WHERE ".$where."ORDER BY ".$order;
    }else {
        $html .= "INVENTARIO $marcalista<br>Estilo $estilolista";
        $html .= "CORRESPONDIENTE DEL $fechain AL $fechaf<br>";
    }

    $html .= "</td>";
    $html .= "</tr>";
    $html .= "</table>";
    $html .= "</tr>";
    $html .= "<tr>";
    $html .= "<td colspan='3'>";
    $html .= "<table width='1250' border='0' cellspacing='0' cellpadding='0'><tr>";
    $html .= "<tr>";
    $iddet1="1";
    $iddet2="26";
    $rango1=$iddet1;
    $rango2=$iddet2;
    $select = "talla,idmodelo,iddetalleingresotalla,tallasm";
    $from = "tallasdetallem";
    $where = "iddetalleingresotalla >='$iddet1' AND iddetalleingresotalla <='$iddet2' ORDER BY iddetalleingresotalla ASC";
    $sql21 = "SELECT ".$select." FROM ".$from." WHERE ".$where;
    $row = NumeroTuplas($sql21);
    $row1= $row['resultado'];

    $select = "SUM(saldocantidad) AS Pares";
    $from = "historialkardextienda k,modelos mdt";
    $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND mdt.stylename = '$idestilo' AND k.unido='no'";
    $sql2121 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
    $almacenA1 =  findBySqlReturnCampoUnique($sql2121, true, true, 'Pares');
    $totalparesestilo = $almacenA1['resultado'];
    $select = "SUM(saldocantidad*precio2bs) AS bs";
    $from = "historialkardextienda k,modelos mdt";
    $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND mdt.stylename = '$idestilo' AND k.unido='no'";
    $sql2121 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
    $almacenA1 =  findBySqlReturnCampoUnique($sql2121, true, true, 'bs');
    $totalbsestilo = $almacenA1['resultado'];
    $select = "dtp.iddetalleingreso";
    $from = "adiciondetalleingreso dtp, modelos mdd, coleccion col, estilos es";
    $where = "dtp.idmodelo = mdd.idmodelo AND mdd.idcoleccion = col.idcoleccion AND mdd.stylename = es.idestilo AND dtp.unido='no' AND mdd.idmarca = '$idmarca' AND mdd.stylename='$idestilo'";
    $sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where." ORDER BY CAST( `mdd`.`codigo` AS SIGNED) ASC";
    $table = dibujarTablaOfSQLinventario($idkardex,$sql25,$sql21,$row1,$idmarca,$idestilo,$rango1,$rango2,$totalparesestilo,$totalbsestilo, "2",$marcapedido);

    $html .= $table['resultado'];
    $html .= "</tr>";


    $html .= "</table>";
    $html .= "</body>";
    $html .= "</html>";
    if($return == true)
    {
        return $html;
    }
    else
    {
        echo $html;
    }
}


function verIngresosMarcaEstiloHTMLModelotallamestilo($idmarca,$idestilo, $modelo,$return)
{
    $html = "";
    $html .= "<tr><td colspan='4' align='center'>
    <p>Nova Moda S.RL.<br />
         <br />
         Telf. 4-258993  Fax: 4-504183
    </p>
</td></tr>";
    $html .= "<!DOCTYPE HTML PUBLIC '-//W3C//DTD HTML 4.01 Transitional//EN'>";
    $html .= "<html>";
    $html .= "<body>";
    $html .= "<tr>";

    $html .= "<table cellpadding='1' cellspacing='0' border='0' style='width:100%' font-size:11px; font-family:Tahoma;'>";
    $html .= "<td style='width:100%;height:100%;text-align:right;font-size:12px;font-family:Tahoma;'>";
    $html .= "$fecha  $tipo";
    $html .= "</td>";
    $html .= "<tr>";
    $sql = "SELECT ma.nombre AS marca,ma.talla,ma.opcionb,ma.pedido
FROM  `marcas` ma
WHERE ma.idmarca = '$idmarca'";

    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'marca');
    $marcalista = $idalmacenA2['resultado'];
    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'talla');
    $opcionmarca = $idalmacenA2['resultado'];
    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'opcionb');
    $opcionb = $idalmacenA2['resultado'];
    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'pedido');
    $marcapedido = $idalmacenA2['resultado'];
    $idsCAr = split("-", $opcionmarca);

    $sql1 = "SELECT  es.nombre AS estilo
FROM  estilos es
WHERE es.idestilo = '$idestilo'";
    $idalmacenA =  findBySqlReturnCampoUnique($sql1, true, true, 'estilo');
    $estilolista = $idalmacenA['resultado'];
    //$html .= "<tr style='width:100%height:100px;text-align:center;font-size:15px;font-family:Tahoma;'>";
    $html .= "<td style='width:100%;height:50px;text-align:center;font-size:20px;font-family:Arial;'>";
    $html .= "<b><u>INVENTARIO $marcalista</u></b><br>";

    $html .= "</td>";
    $html .= "</tr>";
    $html .= "<tr>";
    $html .= "<td style='width:100%;height:50px;text-align:left;font-size:20px;font-family:Arial;'>";
    $html .= "<b><u> $estilolista</u></b><br>";

    $html .= "</td>";
    $html .= "</tr>";
    $html .= "</table>";
    $html .= "</tr>";
    $html .= "<tr>";
    $html .= "<td colspan='3'>";
    $html .= "<table width='1250' border='0' cellspacing='0' cellpadding='0'><tr>";
    $html .= "<tr>";
    $iddet1="1";
    $iddet2="26";
    $rango1=$iddet1;
    $rango2=$iddet2;
    $select = "talla,idmodelo,iddetalleingresotalla,tallasm";
    $from = "tallasdetallem";
    $where = "iddetalleingresotalla >='$iddet1' AND iddetalleingresotalla <='$iddet2' ORDER BY iddetalleingresotalla ASC";
    $sql21 = "SELECT ".$select." FROM ".$from." WHERE ".$where;
    $row = NumeroTuplas($sql21);
    $row1= $row['resultado'];

    $select = "SUM(saldocantidad) AS Pares";
    $from = "historialkardextienda k,modelos mdt";
    $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND mdt.stylename = '$idestilo' AND k.unido='no'";
    $sql2121 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
    $almacenA1 =  findBySqlReturnCampoUnique($sql2121, true, true, 'Pares');
    $totalparesestilo = $almacenA1['resultado'];
    $select = "SUM(saldocantidad*precio2bs) AS bs";
    $from = "historialkardextienda k,modelos mdt";
    $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND mdt.stylename = '$idestilo' AND k.unido='no'";
    $sql2121 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
    $almacenA1 =  findBySqlReturnCampoUnique($sql2121, true, true, 'bs');
    $totalbsestilo = $almacenA1['resultado'];

    $select = "dtp.iddetalleingreso";
    $from = "adiciondetalleingreso dtp, modelos mdd, coleccion col, estilos es";
    $where = "dtp.idmodelo = mdd.idmodelo AND mdd.idcoleccion = col.idcoleccion AND mdd.stylename = es.idestilo AND dtp.unido='no' AND mdd.idmarca = '$idmarca' AND mdd.stylename='$idestilo' and mdd.codigo='$modelo'";
    $sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where." ORDER BY CAST( `mdd`.`codigo` AS SIGNED) ASC";

    $table = dibujarTablaOfSQLinventariotallam($modelo,$sql25,$sql21,$row1,$idmarca,$idestilo,$rango1,$rango2,$totalparesestilo,$totalbsestilo, "2",$marcapedido);
    $html .= $table['resultado'];

    $html .= "</tr>";


    $html .= "</table>";
    $html .= "</body>";
    $html .= "</html>";
    if($return == true)
    {
        return $html;
    }
    else
    {
        echo $html;
    }
}

function verCambiosproductoentradasalida($idmarca,$idestilo,$fechain,$fechaf, $return)
{
    $html = "";
    $html .= "<tr><td colspan='4' align='center'>
    <p>Nova Moda S.RL.<br />
         <br />
         Telf. 4-258993  Fax: 4-504183
    </p>
</td></tr>";
    $html .= "<!DOCTYPE HTML PUBLIC '-//W3C//DTD HTML 4.01 Transitional//EN'>";
    $html .= "<html>";
    $html .= "<body>";
    $html .= "<tr>";
    $fechafin = $fechaf;
    $fechainic = $fechain;
    $fechaactual = Date("Y-m-d");
    $formatear1 = explode( '-' , $fechaactual);
    $fechaact = $formatear1[2].'-'.$formatear1[1].'-' .$formatear1[0];
    if($fechaf == null && $fechaf  == "")
    {        $fecha = Date("Y-m-d");
        $formatear = explode( '-' , $fecha);
        $fechaf = $formatear[2].'-'.$formatear[1].'-' .$formatear[0];
    }
    if($fechain == null && $fechain  == "")
    {
        $fechaa = Date("Y-m-d");
        $formatear = explode( '-' , $fechaa);
        $fechain = $formatear[2].'-'.$formatear[1].'-' .$formatear[0];
    }
    $html .= "<table cellpadding='1' cellspacing='0' border='0' style='width:100%' font-size:11px; font-family:Tahoma;'>";
    $html .= "<td style='width:100%;height:100%;text-align:right;font-size:12px;font-family:Tahoma;'>";
    $html .= "$fecha  $tipo";
    $html .= "</td>";
    $html .= "<tr>";
    $sql = "SELECT ma.nombre AS marca,ma.talla,ma.opcionb
FROM  `marcas` ma
WHERE ma.idmarca = '$idmarca'";

    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'marca');
    $marcalista = $idalmacenA2['resultado'];
    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'talla');
    $opcionmarca = $idalmacenA2['resultado'];
    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'opcionb');
    $opcionb = $idalmacenA2['resultado'];
    $idsCAr = split("-", $opcionmarca);
    $rango1=$idsCAr[0];
    $rango2=$idsCAr[1];
    $sql1 = "SELECT  es.nombre AS estilo
FROM  estilos es
WHERE es.idestilo = '$idestilo'";
    $idalmacenA =  findBySqlReturnCampoUnique($sql1, true, true, 'estilo');
    $estilolista = $idalmacenA['resultado'];
    //$html .= "<tr style='width:100%height:100px;text-align:center;font-size:15px;font-family:Tahoma;'>";
    $html .= "<td style='width:100%;height:100px;text-align:center;font-size:15px;font-family:Tahoma;'>";
    if($idestilo == null ||$idestilo == "null" )
    {
        $html .= "CAMBIOS EN VENTAS $marcalista<br>";

        //  $sqldetalle = "SELECT ".$select." FROM ".$from. " WHERE ".$where."ORDER BY ".$order;
    }else {
        $html .= "CAMBIOS EN VENTAS $marcalista<br> Estilo $estilolista";
        $html .= "<br>Del ".$fechainic." Al ".$fechafin."";
    }

    $html .= "</td>";
    $html .= "</tr>";
    $html .= "</table>";
    $html .= "</tr>";
    $html .= "<tr>";
    $html .= "<td colspan='3'>";
    $html .= "<table width='1250' border='0' cellspacing='0' cellpadding='0'><tr>";


    //$sql1 = " SELECT ved.numero,ved.montopapeleta,ved.boleta,ved.cambiocredito,ved.credito,ved.fecha,ved.hora,
    //ved.observacion,ved.nit,ved.devuelto,ved.idempresa,ved.tipofactura,ved.numerofactura,
    //ved.hora,CONCAT( ved.nombrecliente, '-', ved.apellidocliente ) AS cliente,ved.idclienteempresa,ved.tipoventa,
    //ved.ingresototalbs,
    // ved.cantidad, ved.totalbs AS total, ved.descuento, ved.montocancelado,ved.montoapagar, ved.montocanceladosus
    //FROM ventasdetalle ved
    //WHERE ved.idventadetalle = '$idventadetalle'  "
    //    ;
    //    $tipoventafinal=$ven[0]['observacion'];
    //$cambiocredito=$ven[0]['cambiocredito'];

    $select = "idventadetalle";
    $from = "ventasdetalle";
    $where1 = "observacion='DEVOLUCION' AND cambiocredito='0' AND fecha >='$fechain' and fecha <='$fechaf'";
    $where2 = "observacion='REINTEGRO' AND cambiocredito='0' AND fecha >='$fechain' and fecha <='$fechaf'";
    $where3 = "observacion='CREDITO' AND cambiocredito='1' AND fecha >='$fechain' and fecha <='$fechaf'";
    $where4 = "observacion='REINTEGRO' AND cambiocredito='1' AND fecha >='$fechain' and fecha <='$fechaf'";
    $where5 = "observacion='DEVOLUCION' AND cambiocredito='1' AND fecha >='$fechain' and fecha <='$fechaf'";
    $where6 = "observacion='A_CUENTA' AND cambiocredito='1' AND fecha >='$fechain' and fecha <='$fechaf'";
    //    if($fechainicio != null && $fechainicio != "")
    //  { $where .= " AND p.fecha >='$fechainicio' ";}
    //      if($fechafin != null && $fechafin != "")
    //    { $where .= " AND p.fecha <='$fechafin' ";}
    //
    $sql221 = "SELECT ".$select." FROM ".$from. " WHERE ".$where1 ;
    $sql222 = "SELECT ".$select." FROM ".$from. " WHERE ".$where2 ;
    $sql223 = "SELECT ".$select." FROM ".$from. " WHERE ".$where3 ;
    $sql224 = "SELECT ".$select." FROM ".$from. " WHERE ".$where4 ;
    $sql225 = "SELECT ".$select." FROM ".$from. " WHERE ".$where5 ;
    $sql226 = "SELECT ".$select." FROM ".$from. " WHERE ".$where6 ;

    $sql2 = $sql221." UNION ALL ".$sql222." UNION ALL ".$sql223." UNION ALL ".$sql224." UNION ALL ".$sql225." UNION ALL ".$sql226;

    //   $select = "p.idempresa,UPPER(e.nombre) As nombre";
    //    $from = "empresas e,pagocredito p";
    //   $where = "p.idempresa=e.idempresa AND p.tipopago='ingreso'";
    //    if($fechainicio != null && $fechainicio != "")
    //  { $where .= " AND p.fecha >='$fechainicio' ";}
    //      if($fechafin != null && $fechafin != "")
    //    { $where .= " AND p.fecha <='$fechafin' ";}
    //    $sql2 = "SELECT ".$select." FROM ".$from." WHERE ".$where."  GROUP by p.idempresa ";
    $row = NumeroTuplas($sql2);
    $row1= $row['resultado'];
    $sql21 = getTablaToArrayOfSQL($sql2);
    $sql3 = $sql21['resultado'];
    for($i=0;$i<=$row1-1;$i++){
        $codigo = $sql3[$i];
        $idventadetalle = $codigo['idventadetalle'];
        //$nombre = $codigo['nombre'];
        $html .= "<tr>";
        $html .= "<td style='width:80%;text-align:center;font-size:12px;font-family:Tahoma;'>";
        $html .= "<table cellpadding='0' cellspacing='0' border='1' style='width:80%;border:1px solid #000000;font-size:12px;text-align:center'>";

        $html .= "<tr>";
        $html .= "<td colspan='3'>";

        $select = "CONCAT( m.nombre,'/',mdt.codigo) AS Articulo,kar.talla , emp.codigo AS vendedor, itv.cantidad, itv.precio AS Precio";
        $from = "modelos mdt, empleados emp, itemventa itv, adicionkardextienda kar,marcas m, estilos e";
        $where = "itv.idkardextienda = kar.idkardextienda
AND kar.idmodelodetalle = mdt.idmodelo
AND itv.idventa = '$idventadetalle'
AND itv.idempleado = emp.idempleado AND mdt.idmarca=m.idmarca AND mdt.stylename=e.idestilo";
        //  echo $idmarca;
        if($idmarca == null || $idmarca == "null" || $idmarca =='')
        { $where .= "";}
        else{
            $where .= " AND mdt.idmarca ='$idmarca' ";
        }
        $sqlIV = "SELECT ".$select." FROM ".$from." WHERE ".$where."";
        $table =
        $table = dibujarTablaOfSQLNormal($sqlIV, "Articulo de Reemplazo / Salida");
        $html .= $table['resultado'];

        $sql2 = " SELECT devolucion FROM itemventa
WHERE idventa = '$idventadetalle' AND estado='cambio' GROUP BY devolucion" ;
        $idalmacenA =  findBySqlReturnCampoUnique($sql2, true, true, 'devolucion');
        $itemdevuelto = $idalmacenA['resultado'];
        //echo $sql2;
        //    $sqlIV = "
        //    SELECT CONCAT( m.nombre,'/',mdt.codigo) AS Articulo,kar.talla , emp.codigo AS vendedor, itv.cantidad, itv.precio AS Precio
        //FROM modelos mdt, empleados emp, itemventa itv, adicionkardextienda kar,marcas m, estilos e
        //WHERE itv.idkardextienda = kar.idkardextienda
        //AND kar.idmodelodetalle = mdt.idmodelo
        //AND itv.iditemventa = '$itemdevuelto'
        //AND itv.idempleado = emp.idempleado AND mdt.idmarca=m.idmarca AND mdt.stylename=e.idestilo
        //                ";
        $select = "CONCAT( m.nombre,'/',mdt.codigo) AS Articulo,kar.talla , emp.codigo AS vendedor, itv.cantidad, itv.precio AS Precio";
        $from = "modelos mdt, empleados emp, itemventa itv, adicionkardextienda kar,marcas m, estilos e";
        $where = "itv.idkardextienda = kar.idkardextienda
AND kar.idmodelodetalle = mdt.idmodelo
AND itv.iditemventa = '$itemdevuelto'
AND itv.idempleado = emp.idempleado AND mdt.idmarca=m.idmarca AND mdt.stylename=e.idestilo";
        //  echo $idmarca;
        if($idmarca == null || $idmarca == "null" || $idmarca =='')
        { $where .= "";}
        else{
            $where .= " AND mdt.idmarca ='$idmarca' ";
        }
        $sqlIV = "SELECT ".$select." FROM ".$from." WHERE ".$where."";

        $table =
        $table = dibujarTablaOfSQLNormal($sqlIV, "Articulo Devuelto /Entrada");
        $html .= $table['resultado'];

        $html .= "</td>";
        $html .= "</tr>";

        $html .= "</tr>";
        $html .= "</table>";
        $html .= "</td></tr>";
    }

    $html .= "</tr>";
    $html .= "</table>";
    $html .= "</body>";
    $html .= "</html>";
    if($return == true)
    {
        return $html;
    }
    else
    {
        echo $html;
    }
}
function verDevoluciones($idmarca,$idvendedor,$fechainicio,$fechafin, $return)
{
    //echo "hola";
    $idalmacen=$_SESSION['idalmacen'];
    $fecha1 = $fechainicio;

    $fecha2 = $fechafin;
    $empresa=strtoupper($empresa1);
    $fecha22= split("-", $fechainicio);
    $y=$fecha22[0];
    $m=$fecha22[1];
    $d=$fecha22[2];
    $fechaini=$d."-".$m."-".$y;

    $fecha221= split("-", $fechafin);
    $y2=$fecha221[0];
    $m2=$fecha221[1];
    $d2=$fecha221[2];
    $fechafinn=$d2."-".$m2."-".$y2;
    $html = "";
    $html .= "<tr><td colspan='4' align='center'>
     <p>NOVA MODA SRL<br />
         Telf. 4-258993  Fax: 4-504183
    </p>
</td></tr>";
    $html .= "<!DOCTYPE HTML PUBLIC '-//W3C//DTD HTML 4.01 Transitional//EN'>";
    $html .= "<html>";
    $html .= "<body>";
    $html .= "<tr>";

    $html .= "<table cellpadding='1' cellspacing='0' border='0' style='width:110%' font-size:11px; font-family:Tahoma;'>";
    $html .= "<td style='width:110%;height:100%;text-align:right;font-size:12px;font-family:Tahoma;'>";
    $html .= "$fecha  $tipo";
    $html .= "</td>";
    $html .= "<tr>";

    //$html .= "<tr style='width:100%height:100px;text-align:center;font-size:15px;font-family:Tahoma;'>";
    $html .= "<td style='width:110%;height:100px;text-align:center;font-size:15px;font-family:Tahoma;'>";
    $html .= "DEVOLUCION<br>";
    $html .= " DEL $fechaini AL $fechafinn<br>";
    $html .= "</td>";
    $html .= "</tr>";
    $html .= "</table>";
    $html .= "</tr>";
    $html .= "<tr>";
    $html .= "<td colspan='3'>";
    $html .= "<table width='1250' border='0' cellspacing='0' cellpadding='0'><tr>";

    //    $html .= "<td style='width:100%;text-align:center;font-size:1px;font-family:Tahoma;'>";
    $html .= "<table cellpadding='0' cellspacing='0' border='0' style='width:100%;border:0px solid #000000;font-size:11px;text-align:center'>";
    $html .= "<tr>";

    $html .= "</table>";

    $html .= "</td></tr>";
    $html .= "</tr>";
    $html .= "</table>";
    $html .= "</td></tr>";
    $html .= "</table>";



    $html .= "<tr>";
    $select = "dv.estado as boleta,dv.fecha,dv.hora,mar.nombre as marca,em.codigo as vendedor,
CONCAT(cli.nombre, '-', cli.apellido) AS cliente,COUNT(d.iditemventa) as totalpares,SUM(d.valorcalzado) as totalsus,dv.estadomayor as estado";
    $from = "`marcas` mar, clientes cli,almacenes a,empleados em,detalledevolucion d,devolucion dv";
    $where = "dv.iddevolucion=d.iddevolucion and dv.idmarca=mar.idmarca and dv.idcliente=cli.idcliente and dv.idalmacen=a.idalmacen and
dv.idvendedor=em.idempleado and dv.idalmacen='$idalmacen' ";
    { $where .= " AND dv.fecha >='$fechainicio' ";}
    if($fechafin != null && $fechafin != "")
    { $where .= " AND dv.fecha <='$fechafin' ";}
    if($idmarca == null || $idmarca == 'null')
    { }else{$where .= " AND dv.idmarca ='$idmarca' "; }
    if($idvendedor == null || $idvendedor == 'null')
    { }else{$where .= " AND dv.idvendedor ='$idvendedor' "; }

    $sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where." group by dv.iddevolucion order by dv.fecha desc ,d.hora desc ";
    //echo $sql25;
    $table = dibujarTablaOfSQLNormal($sql25, "Devoluciones");
    $html .= $table['resultado'];

    $html .= "</tr>";
    $html .= "</td></tr>";
    $html .= "</tr>";

    $select1 = "COUNT(d.iditemventa) as pares";
    $from = "marcas mar, clientes cli,almacenes a,empleados em,detalledevolucion d,devolucion dv";
    $where = "dv.iddevolucion=d.iddevolucion and dv.idmarca=mar.idmarca and dv.idcliente=cli.idcliente and dv.idalmacen=a.idalmacen and
dv.idvendedor=em.idempleado and dv.idalmacen='$idalmacen' ";
    { $where .= " AND dv.fecha >='$fechainicio' ";}
    if($fechafin != null && $fechafin != "")
    { $where .= " AND dv.fecha <='$fechafin' ";}
    if($idmarca == null || $idmarca == 'null' )
    { }else{$where .= " AND dv.idmarca ='$idmarca' "; }
    if($idvendedor == null || $idvendedor == 'null' )
    { }else{$where .= " AND dv.idvendedor ='$idvendedor' "; }
    //$select1 = "SELECT SUM(v.totalpares) AS cajas";
    //$select2 = " SUM(v.totalsus) AS sus";
    $select2 = " SUM(d.valorcalzado) as sus";
    $select3 = "SUM(v.descuento) AS sus";
    $select4 = "SUM(v.montoapagar) AS sus";

    $sql4112 = "SELECT ".$select1." FROM ".$from. " WHERE ".$where." ";
    // echo $sql4112;
    $creditoA111 = findBySqlReturnCampoUnique($sql4112, true, true, "pares");
    $tpares = $creditoA111['resultado'];

    $sql12 = "SELECT ".$select2." FROM ".$from. " WHERE ".$where." ";
    $creditoA111 = findBySqlReturnCampoUnique($sql12, true, true, "sus");
    $tsus = $creditoA111['resultado'];
    $sql41 = "SELECT ".$select3." FROM ".$from. " WHERE ".$where." ";
    $creditoA111 = findBySqlReturnCampoUnique($sql41, true, true, "sus");
    $tdesc = $creditoA111['resultado'];
    $sql4 = "SELECT ".$select4." FROM ".$from. " WHERE ".$where." ";
    $creditoA111 = findBySqlReturnCampoUnique($sql4, true, true, "sus");
    $tmonto = $creditoA111['resultado'];
    $tcajas = $tpares/12;
    $tcajas = round($tcajas,2);
    $html .= "<tr>";
    $html .= "<td style='width:100%;text-align:left;font-size:14px;font-family:Tahoma;'>";
    $html .= "<table cellpadding='0' cellspacing='0' border='0' style='width:100%;border:1px solid #000000;font-size:14px;'>";
    $html .= "<tr><td style='width:10%;font-weight:bold;'>TOTAL CAJAS DEVOLUCION:</td><td style='width:10%;text-align:center;border-left: 1px solid #000000;font-weight:bold;'>".$tcajas."</td><td style='width:10%;font-weight:bold;'>TOTAL PARES DEVOLUCION:</td><td style='width:10%;text-align:center;border-left: 1px solid #000000;font-weight:bold;'>".$tpares."</td><td style='width:10%;font-weight:bold;'>TOTAL SUS DEVOLUCION:</td><td style='width:10%;text-align:center;border-left: 1px solid #000000;font-weight:bold;'>".$tsus."</td></tr>";
    $html .= "</table>";
    $html .= "</td></tr>";
    $html .= "</tr>";
    $html .= "</table>";
    $html .= "</td></tr>";
    $html .= "</table>";



    $html .= "</table>";
    $html .= "</body>";
    $html .= "</html>";
    if($return == true)
    {
        return $html;
    }
    else
    {
        echo $html;
    }
}
function verventalista($idmarca,$idvendedor,$fechainicio,$fechafin, $return)
{
    //echo "hola";
    $idalmacen=$_SESSION['idalmacen'];
    $fecha1 = $fechainicio;

    $fecha2 = $fechafin;
    $empresa=strtoupper($empresa1);
    $fecha22= split("-", $fechainicio);
    $y=$fecha22[0];
    $m=$fecha22[1];
    $d=$fecha22[2];
    $fechaini=$d."-".$m."-".$y;

    $fecha221= split("-", $fechafin);
    $y2=$fecha221[0];
    $m2=$fecha221[1];
    $d2=$fecha221[2];
    $fechafinn=$d2."-".$m2."-".$y2;
    $html = "";
    $html .= "<tr><td colspan='4' align='center'>
     <p>NOVA MODA SRL<br />
         Telf. 4-258993  Fax: 4-504183
    </p>
</td></tr>";
    $html .= "<!DOCTYPE HTML PUBLIC '-//W3C//DTD HTML 4.01 Transitional//EN'>";
    $html .= "<html>";
    $html .= "<body>";
    $html .= "<tr>";

    $html .= "<table cellpadding='1' cellspacing='0' border='0' style='width:110%' font-size:11px; font-family:Tahoma;'>";
    $html .= "<td style='width:110%;height:100%;text-align:right;font-size:12px;font-family:Tahoma;'>";
    $html .= "$fecha  $tipo";
    $html .= "</td>";
    $html .= "<tr>";

    //$html .= "<tr style='width:100%height:100px;text-align:center;font-size:15px;font-family:Tahoma;'>";
    $html .= "<td style='width:110%;height:100px;text-align:center;font-size:15px;font-family:Tahoma;'>";
    $html .= "VENTAS<br>";
    $html .= " DEL $fechaini AL $fechafinn<br>";
    $html .= "</td>";
    $html .= "</tr>";
    $html .= "</table>";
    $html .= "</tr>";
    $html .= "<tr>";
    $html .= "<td colspan='3'>";
    $html .= "<table width='1250' border='0' cellspacing='0' cellpadding='0'><tr>";

    //    $html .= "<td style='width:100%;text-align:center;font-size:1px;font-family:Tahoma;'>";
    $html .= "<table cellpadding='0' cellspacing='0' border='0' style='width:100%;border:0px solid #000000;font-size:11px;text-align:center'>";
    $html .= "<tr>";

    $html .= "<tr style='width:100%; font-size:11px;'>";
    $html .=" </td> ";
    $html .= "</tr>";
    $html .= "<tr>";
    //    echo $idmarca;

    $select = "v.boleta,v.hora,v.fecha,mar.nombre as marca,CONCAT(em.nombres,'-',em.apellidos) AS Vendedor,CONCAT(cli.nombre, '-', cli.apellido) AS cliente,
v.tcajas,SUM(iv.cantidad) AS pares,SUM(iv.precioventa) AS totalsus,(v.montoapagar-SUM(iv.precioventa)) as descincr,v.montoapagar,v.estado";
    $from = "ventas v,ventaitem iv,`marcas` mar, clientes cli,almacenes a,empleados em";
    $where = "v.idmarca=mar.idmarca and v.idcliente=cli.idcliente and v.idalmacen=a.idalmacen and
v.idvendedor=em.idempleado and iv.idventa=v.idventa and v.idalmacen='$idalmacen' ";
    { $where .= " AND v.fecha >='$fechainicio' ";}
    if($fechafin != null && $fechafin != "")
    { $where .= " AND v.fecha <='$fechafin' ";}
    if($idmarca == null || $idmarca == 'null')
    { }else{$where .= " AND v.idmarca ='$idmarca' "; }
    if($idvendedor == null || $idvendedor == 'null')
    { }else{$where .= " AND v.idvendedor ='$idvendedor' "; }

    $sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where." group by iv.idventa order by v.fecha desc ,v.hora desc ";
    //echo $sql25;
    $table = dibujarTablaOfSQLNormal($sql25, "Ventas Por fecha");
    $html .= $table['resultado'];

    $html .= "</tr>";

    //totales de totales,
    $html .= "</tr>";
    $html .= "</table>";
    $select1 = "SUM(iv.cantidad) AS pares";
    $from = "ventas v,ventaitem iv,`marcas` mar, clientes cli,almacenes a,empleados em";
    $where = "v.idmarca=mar.idmarca and v.idcliente=cli.idcliente and v.idalmacen=a.idalmacen and
v.idvendedor=em.idempleado  and iv.idventa=v.idventa and v.idalmacen='$idalmacen' ";
    { $where .= " AND v.fecha >='$fechainicio' ";}
    if($fechafin != null && $fechafin != "")
    { $where .= " AND v.fecha <='$fechafin' ";}
    if($idmarca == null || $idmarca == 'null' )
    { }else{$where .= " AND v.idmarca ='$idmarca' "; }
    if($idvendedor == null || $idvendedor == 'null' )
    { }else{$where .= " AND v.idvendedor ='$idvendedor' "; }
    //$select1 = "SELECT SUM(v.totalpares) AS cajas";
    //$select2 = " SUM(v.totalsus) AS sus";
    $select2 = " SUM(iv.precioventa) AS sus";
    $select3 = "SUM(SUM(iv.precioventa)-v.montoapagar) AS sus";
    $select4 = "SUM(v.montoapagar) AS sus";

    $sql4112 = "SELECT ".$select1." FROM ".$from. " WHERE ".$where." ";
    $creditoA111 = findBySqlReturnCampoUnique($sql4112, true, true, "pares");
    $tpares = $creditoA111['resultado'];

    $sql12 = "SELECT ".$select2." FROM ".$from. " WHERE ".$where." ";
    $creditoA111 = findBySqlReturnCampoUnique($sql12, true, true, "sus");
    $tsus = $creditoA111['resultado'];
    $sql41 = "SELECT ".$select3." FROM ".$from. " WHERE ".$where." ";
    $creditoA111 = findBySqlReturnCampoUnique($sql41, true, true, "sus");
    $tdesc = $creditoA111['resultado'];
    $sql4 = "SELECT ".$select4." FROM ".$from. " WHERE ".$where." ";
    $creditoA111 = findBySqlReturnCampoUnique($sql4, true, true, "sus");
    $tmonto = $creditoA111['resultado'];
    $tcajas = $tpares/12;
    $tcajas = round($tcajas,2);
    $html .= "<tr>";
    $html .= "<td style='width:100%;text-align:left;font-size:14px;font-family:Tahoma;'>";
    $html .= "<table cellpadding='0' cellspacing='0' border='0' style='width:100%;border:1px solid #000000;font-size:14px;'>";
//    $html .= "<tr><td style='width:10%;font-weight:bold;'>TOTAL CAJAS VENTA:</td><td style='width:10%;text-align:center;border-left: 1px solid #000000;font-weight:bold;'>".$tcajas."</td><td style='width:10%;font-weight:bold;'>TOTAL PARES VENTA:</td><td style='width:10%;text-align:center;border-left: 1px solid #000000;font-weight:bold;'>".$tpares."</td><td style='width:10%;font-weight:bold;'>TOTAL SUS VENTA:</td><td style='width:10%;text-align:center;border-left: 1px solid #000000;font-weight:bold;'>".$tsus."</td><td style='width:10%;font-weight:bold;'>TOTAL DESCINCR:</td><td style='width:10%;text-align:center;border-left: 1px solid #000000;font-weight:bold;'>".$tdesc."</td><td style='width:10%;font-weight:bold;'>TOTAL MONTO:</td><td style='width:10%;text-align:center;border-left: 1px solid #000000;font-weight:bold;'>".$tmonto."</td></tr>";
    $html .= "<tr><td style='width:10%;font-weight:bold;'>TOTAL CAJAS VENTA:</td><td style='width:10%;text-align:center;border-left: 1px solid #000000;font-weight:bold;'>".$tcajas."</td><td style='width:10%;font-weight:bold;'>TOTAL PARES VENTA:</td><td style='width:10%;text-align:center;border-left: 1px solid #000000;font-weight:bold;'>".$tpares."</td><td style='width:10%;font-weight:bold;'>TOTAL SUS VENTA:</td><td style='width:10%;text-align:center;border-left: 1px solid #000000;font-weight:bold;'>".$tsus."</td></tr>";
    $html .= "</table>";
    $html .= "</td></tr>";
    $html .= "</tr>";
    $html .= "</table>";
    $html .= "</td></tr>";
    $html .= "</table>";



    $html .= "<tr>";
    $select = "dv.estado as boleta,dv.fecha,dv.hora,mar.nombre as marca,em.codigo as vendedor,
CONCAT(cli.nombre, '-', cli.apellido) AS cliente,COUNT(d.iditemventa) as totalpares,SUM(d.valorcalzado) as totalsus";
    $from = "`marcas` mar, clientes cli,almacenes a,empleados em,detalledevolucion d,devolucion dv";
    $where = "dv.iddevolucion=d.iddevolucion and dv.idmarca=mar.idmarca and dv.idcliente=cli.idcliente and dv.idalmacen=a.idalmacen and
dv.idvendedor=em.idempleado and dv.idalmacen='$idalmacen' ";
    { $where .= " AND dv.fecha >='$fechainicio' ";}
    if($fechafin != null && $fechafin != "")
    { $where .= " AND dv.fecha <='$fechafin' ";}
    if($idmarca == null || $idmarca == 'null')
    { }else{$where .= " AND dv.idmarca ='$idmarca' "; }
    if($idvendedor == null || $idvendedor == 'null')
    { }else{$where .= " AND dv.idvendedor ='$idvendedor' "; }

    $sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where." group by dv.iddevolucion order by dv.fecha desc ,d.hora desc ";
    //echo $sql25;
    $table = dibujarTablaOfSQLNormal($sql25, "Devoluciones");
    $html .= $table['resultado'];

    $html .= "</tr>";
    $html .= "</td></tr>";
    $html .= "</tr>";

    $select1 = "COUNT(d.iditemventa) as pares";
    $from = "marcas mar, clientes cli,almacenes a,empleados em,detalledevolucion d,devolucion dv";
    $where = "dv.iddevolucion=d.iddevolucion and dv.idmarca=mar.idmarca and dv.idcliente=cli.idcliente and dv.idalmacen=a.idalmacen and
dv.idvendedor=em.idempleado and dv.idalmacen='$idalmacen' ";
    { $where .= " AND dv.fecha >='$fechainicio' ";}
    if($fechafin != null && $fechafin != "")
    { $where .= " AND dv.fecha <='$fechafin' ";}
    if($idmarca == null || $idmarca == 'null' )
    { }else{$where .= " AND dv.idmarca ='$idmarca' "; }
    if($idvendedor == null || $idvendedor == 'null' )
    { }else{$where .= " AND dv.idvendedor ='$idvendedor' "; }
    //$select1 = "SELECT SUM(v.totalpares) AS cajas";
    //$select2 = " SUM(v.totalsus) AS sus";
    $select2 = " SUM(d.valorcalzado) as sus";
    $select3 = "SUM(v.descuento) AS sus";
    $select4 = "SUM(v.montoapagar) AS sus";

    $sql4112 = "SELECT ".$select1." FROM ".$from. " WHERE ".$where." ";
    // echo $sql4112;
    $creditoA111 = findBySqlReturnCampoUnique($sql4112, true, true, "pares");
    $tpares = $creditoA111['resultado'];

    $sql12 = "SELECT ".$select2." FROM ".$from. " WHERE ".$where." ";
    $creditoA111 = findBySqlReturnCampoUnique($sql12, true, true, "sus");
    $tsus = $creditoA111['resultado'];
    $sql41 = "SELECT ".$select3." FROM ".$from. " WHERE ".$where." ";
    $creditoA111 = findBySqlReturnCampoUnique($sql41, true, true, "sus");
    $tdesc = $creditoA111['resultado'];
    $sql4 = "SELECT ".$select4." FROM ".$from. " WHERE ".$where." ";
    $creditoA111 = findBySqlReturnCampoUnique($sql4, true, true, "sus");
    $tmonto = $creditoA111['resultado'];
    $tcajas = $tpares/12;
    $tcajas = round($tcajas,2);
    $html .= "<tr>";
    $html .= "<td style='width:100%;text-align:left;font-size:14px;font-family:Tahoma;'>";
    $html .= "<table cellpadding='0' cellspacing='0' border='0' style='width:100%;border:1px solid #000000;font-size:14px;'>";
    $html .= "<tr><td style='width:10%;font-weight:bold;'>TOTAL CAJAS DEVOLUCION:</td><td style='width:10%;text-align:center;border-left: 1px solid #000000;font-weight:bold;'>".$tcajas."</td><td style='width:10%;font-weight:bold;'>TOTAL PARES DEVOLUCION:</td><td style='width:10%;text-align:center;border-left: 1px solid #000000;font-weight:bold;'>".$tpares."</td><td style='width:10%;font-weight:bold;'>TOTAL SUS DEVOLUCION:</td><td style='width:10%;text-align:center;border-left: 1px solid #000000;font-weight:bold;'>".$tsus."</td></tr>";
    $html .= "</table>";
    $html .= "</td></tr>";
    $html .= "</tr>";
    $html .= "</table>";
    $html .= "</td></tr>";
    $html .= "</table>";



    $html .= "</table>";
    $html .= "</body>";
    $html .= "</html>";
    if($return == true)
    {
        return $html;
    }
    else
    {
        echo $html;
    }
}

function verventalistavendedor($idmarca,$idvendedor,$fechainicio,$fechafin, $return)
{
    //echo "hola";
    $idalmacen=$_SESSION['idalmacen'];
    $fecha1 = $fechainicio;

    $fecha2 = $fechafin;

    //echo $fechainicio;
    $empresa=strtoupper($empresa1);
    $fecha22= split("-", $fechainicio);
    $y=$fecha22[0];
    $m=$fecha22[1];
    $d=$fecha22[2];
    $fechaini=$d."-".$m."-".$y;

    $fecha221= split("-", $fechafin);
    $y2=$fecha221[0];
    $m2=$fecha221[1];
    $d2=$fecha221[2];
    $fechafinn=$d2."-".$m2."-".$y2;
    $html = "";
    $html .= "<tr><td colspan='4' align='center'>
     <p>NOVA MODA SRL<br />
         Telf. 4-258993  Fax: 4-504183
    </p>
</td></tr>";
    $html .= "<!DOCTYPE HTML PUBLIC '-//W3C//DTD HTML 4.01 Transitional//EN'>";
    $html .= "<html>";
    $html .= "<body>";
    $html .= "<tr>";

    $html .= "<table cellpadding='1' cellspacing='0' border='0' style='width:110%' font-size:11px; font-family:Tahoma;'>";
    $html .= "<td style='width:110%;height:100%;text-align:right;font-size:12px;font-family:Tahoma;'>";
    $html .= "$fecha  $tipo";
    $html .= "</td>";
    $html .= "<tr>";

    //$html .= "<tr style='width:100%height:100px;text-align:center;font-size:15px;font-family:Tahoma;'>";
    $html .= "<td style='width:110%;height:100px;text-align:center;font-size:15px;font-family:Tahoma;'>";
    $html .= "VENTAS<br>";
    $html .= " DEL $fechaini AL $fechafinn<br>";
    $html .= "</td>";
    $html .= "</tr>";
    $html .= "</table>";
    $html .= "</tr>";
    $html .= "<tr>";
    $html .= "<td colspan='3'>";
    $html .= "<table width='1250' border='0' cellspacing='0' cellpadding='0'><tr>";

    //    $html .= "<td style='width:100%;text-align:center;font-size:1px;font-family:Tahoma;'>";
    $html .= "<table cellpadding='0' cellspacing='0' border='0' style='width:100%;border:0px solid #000000;font-size:11px;text-align:center'>";
    $html .= "<tr>";

    $html .= "<tr style='width:100%; font-size:11px;'>";
    $html .=" </td> ";
    $html .= "</tr>";
    $html .= "<tr>";

    $select = "p.idvendedor";
    $from = "empleados e,ventas p";
    $where = "p.idvendedor=e.idempleado and p.idalmacen='$idalmacen' ";
    { $where .= " AND p.fecha >='$fechainicio' ";}
    if($fechafin != null && $fechafin != "")
    { $where .= " AND p.fecha <='$fechafin' ";}
    if($idmarca == null || $idmarca == 'null')
    { }
    else{$where .= " AND p.idmarca ='$idmarca' "; }
    if($idvendedor == null || $idvendedor == 'null')
    { }else{$where .= " AND p.idvendedor ='$idvendedor' "; }
    $sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where." GROUP BY p.idvendedor";

    $table = dibujarTablaOfvendedor($sql25,$idtienda,$idvendedor,$idmarca,$codigoempleado,$nombreempleado,$fechainicio,$fechafin);

    $html .= $table['resultado'];
    $html .= "</tr>";
    $html .= "</body>";
    $html .= "</html>";
    if($return == true)
    {
        return $html;
    }
    else
    {
        echo $html;
    }
}

//function veringresolistamarca($idmarca,$idvendedor,$fechainicio,$fechafin, $return)
function veringresolistamarca($idmarca,$idvendedor,$fechainicio,$fechafin, $return)
{
    $idalmacen=$_SESSION['idalmacen'];
    $fecha1 = $fechainicio;
    $fecha2 = $fechafin;
    $empresa=strtoupper($empresa1);
    $fecha22= split("-", $fechainicio);
    $y=$fecha22[0];
    $m=$fecha22[1];
    $d=$fecha22[2];
    $fechaini=$d."-".$m."-".$y;

    $fecha221= split("-", $fechafin);
    $y2=$fecha221[0];
    $m2=$fecha221[1];
    $d2=$fecha221[2];
    $fechafinn=$d2."-".$m2."-".$y2;
    $html = "";
    $html .= "<tr><td colspan='4' align='center'>
     <p>NOVA MODA SRL<br />
         Telf. 4-258993  Fax: 4-504183
    </p>
</td></tr>";
    $html .= "<!DOCTYPE HTML PUBLIC '-//W3C//DTD HTML 4.01 Transitional//EN'>";
    $html .= "<html>";
    $html .= "<body>";
    $html .= "<tr>";

    $html .= "<table cellpadding='1' cellspacing='0' border='0' style='width:110%' font-size:11px; font-family:Tahoma;'>";
    $html .= "<td style='width:110%;height:100%;text-align:right;font-size:12px;font-family:Tahoma;'>";
    $html .= "$fecha  $tipo";
    $html .= "</td>";
    $html .= "<tr>";
    //$html .= "<tr style='width:100%height:100px;text-align:center;font-size:15px;font-family:Tahoma;'>";
    $html .= "<td style='width:110%;height:100px;text-align:center;font-size:15px;font-family:Tahoma;'>";
    $html .= "RECIBIDOS POR PROFORMA<br>";
    $html .= " DEL $fechaini AL $fechafinn<br>";
    $html .= "</td>";
    $html .= "</tr>";
    $html .= "</table>";
    $html .= "</tr>";
    $html .= "<tr>";
    $html .= "<td colspan='3'>";

    $html .= "<table cellpadding='0' cellspacing='0' border='0' style='width:100%;border:0px solid #000000;font-size:11px;text-align:center'>";
    $html .= "<tr>";
    $html .= "<tr style='width:100%; font-size:11px;'>";
    $html .=" </td> ";
    $html .= "</tr>";
    $html .= "<tr>";
    $select = "p.idmarca";
    $from = "marcas e,ingresoalmacen p";
    $where = "p.idmarca=e.idmarca and p.idalmacen='$idalmacen' ";
    if($fechainicio != null && $fechainicio != "")
    {$where .= " AND p.fecha >='$fechainicio' ";}
    if($fechafin != null && $fechafin != "")
    { $where .= " AND p.fecha <='$fechafin' ";}
    if($idmarca == null || $idmarca == 'null')
    { }else{$where .= " AND p.idmarca ='$idmarca' "; }
    $sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where." GROUP BY p.idmarca";
    $table = dibujarTablaOfingreso($sql25,$idtienda,$idempleado,$codigoempleado,$nombreempleado,$fechainicio,$fechafin);
    $html .= $table['resultado'];
    $html .= "</tr>";
    $html .= "</tr>";
    $html .= "</table>";
    //por proformas
    $html .= "<table width='1250' border='0' cellspacing='0' cellpadding='0'><tr>";
//  $select = "e.idmarca, e.nombre, e.codigo";
//    $from = "marcas e, proformas p";
//    $where = "p.idmarca = e.idmarca and p.idalmacen = '$idalmacen' ";
//    { $where .= " AND p.fecha >= '$fechainicio' ";}
//    if($fechafin != null && $fechafin != "")
//    { $where .= " AND p.fecha <= '$fechafin' ";}

    $select = "e.idmarca, e.nombre, e.codigo";
    $from = "marcas e, modelo m,proformas p";
    $where = "m.idingreso=p.id_proforma and m.idmarca = e.idmarca and m.idalmacen = '$idalmacen' ";
    //AND (DATE_FORMAT(m.fechamodelo, '%Y-%m-%d')) >= '$fechainicio' AND (DATE_FORMAT(m.fechamodelo, '%Y-%m-%d')) <= '$fechafin'
    { $where .= " AND (DATE_FORMAT(p.fecha, '%Y-%m-%d')) >= '$fechainicio' ";}
    if($fechafin != null && $fechafin != "")
    { $where .= " AND (DATE_FORMAT(p.fecha, '%Y-%m-%d')) <= '$fechafin' ";}
    if($idmarca == null || $idmarca == 'null')
    { }else{$where .= " AND m.idmarca = '$idmarca' "; }
////    if($idvendedor == null || $idvendedor == 'null')
////    { }else{$where .= " AND p.idvendedor ='$idvendedor' "; }

    $sql2 = "SELECT ".$select." FROM ".$from." WHERE ".$where." GROUP BY m.idmarca";
 //   echo $sql2;
    $row = NumeroTuplas($sql2);
    $row1= $row['resultado'];
    $sql21 = getTablaToArrayOfSQL($sql2);
    $sql3 = $sql21['resultado'];
    $row5 = NumeroTuplas($sql2);
    $row15= $row5['resultado'];
    //    $html .= "<td style='width:100%;text-align:center;font-size:1px;font-family:Tahoma;'>";
    $html .= "<table cellpadding='0' cellspacing='0' border='1' style='width:100%;border:0px solid #000000;font-size:11px;text-align:center'>";
    $html .= "<tr>";
    for($i=0;$i<=$row15;$i++){
        $codigo = $sql3[$i];
        $idmarca = $codigo['idmarca'];
        $nombremarca= $codigo['nombre'];
        $codigoempleado = $codigo['codigo'];

        $html .= "<tr style='width:100%; font-size:11px;'>";
        $html .=" </td> ";
        $html .= "</tr>";
        $html .= "<tr>";
        $select = "mo.idvendedor";
        $from = "marcas e, proformas p, modelo mo";
        $where = "mo.idingreso = p.id_proforma and p.idmarca = e.idmarca and p.idalmacen = '$idalmacen' and p.idmarca = '$idmarca'";
        if($fechainicio != null && $fechainicio != "")
        {$where .= " AND (DATE_FORMAT(p.fecha, '%Y-%m-%d')) >= '$fechainicio' ";}
        if($fechafin != null && $fechafin != "")
        { $where .= " AND (DATE_FORMAT(p.fecha, '%Y-%m-%d')) <= '$fechafin'";}

        $sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where." GROUP BY mo.idvendedor";
        //echo $sql25;
        $table = dibujarTablaproformavendedor($sql25,$idmarca,$codigoempleado,$nombremarca,$idcliente,$fechainicio,$fechafin);
        $html .= $table['resultado'];
        $html .= "</tr>";
    }

    $html .= "</tr>";
    $html .= "</table>";
    $html .= "</table>";
    $html .= "</td></tr>";
    $html .= "</table>";
    $html .= "</td></tr>";
    $html .= "</tr>";
    $html .= "</table>";
    $html .= "</body>";
    $html .= "</html>";
    if($return == true)
    {
        return $html;
    }
    else
    {
        echo $html;
    }
}
function verventalistagral($idmarca,$idvendedor,$fechainicio,$fechafin, $return)
{
    //echo "hola";
    $idalmacen=$_SESSION['idalmacen'];
    $fecha1 = $fechainicio;

    $fecha2 = $fechafin;

    //echo $fechainicio;
    $empresa=strtoupper($empresa1);
    $fecha22= split("-", $fechainicio);
    $y=$fecha22[0];
    $m=$fecha22[1];
    $d=$fecha22[2];
    $fechaini=$d."-".$m."-".$y;

    $fecha221= split("-", $fechafin);
    $y2=$fecha221[0];
    $m2=$fecha221[1];
    $d2=$fecha221[2];
    $fechafinn=$d2."-".$m2."-".$y2;
    $html = "";
    $html .= "<tr><td colspan='4' align='center'>
     <p>NOVA MODA SRL<br />
         Telf. 4-258993  Fax: 4-504183
    </p>
</td></tr>";
    $html .= "<!DOCTYPE HTML PUBLIC '-//W3C//DTD HTML 4.01 Transitional//EN'>";
    $html .= "<html>";
    $html .= "<body>";
    $html .= "<tr>";

    $html .= "<table cellpadding='1' cellspacing='0' border='0' style='width:110%' font-size:11px; font-family:Tahoma;'>";
    $html .= "<td style='width:110%;height:100%;text-align:right;font-size:12px;font-family:Tahoma;'>";
    $html .= "$fecha  $tipo";
    $html .= "</td>";
    $html .= "<tr>";

    //$html .= "<tr style='width:100%height:100px;text-align:center;font-size:15px;font-family:Tahoma;'>";
    $html .= "<td style='width:110%;height:100px;text-align:center;font-size:15px;font-family:Tahoma;'>";
    $html .= "VENTAS POR MARCA<br>";
    $html .= " DEL $fechaini AL $fechafinn<br>";
    $html .= "</td>";
    $html .= "</tr>";
    $html .= "</table>";
    $html .= "</tr>";
    $html .= "<tr>";
    $html .= "<td colspan='3'>";
    $html .= "<table width='1250' border='0' cellspacing='0' cellpadding='0'><tr>";

    //    $html .= "<td style='width:100%;text-align:center;font-size:1px;font-family:Tahoma;'>";
    $html .= "<table cellpadding='0' cellspacing='0' border='0' style='width:100%;border:0px solid #000000;font-size:11px;text-align:center'>";
    $html .= "<tr>";

    $html .= "<tr style='width:100%; font-size:11px;'>";
    $html .=" </td> ";
    $html .= "</tr>";
    $html .= "<tr>";
    //    echo $idmarca;
    $select = "p.idmarca";
    $from = "marcas e,ventas p";
    $where = "p.idmarca=e.idmarca and p.idalmacen='$idalmacen' ";
    { $where .= " AND p.fecha >='$fechainicio' ";}
    if($fechafin != null && $fechafin != "")
    { $where .= " AND p.fecha <='$fechafin' ";}
    if($idmarca == null || $idmarca == 'null')
    { }else{$where .= " AND p.idmarca ='$idmarca' "; }
    if($idvendedor == null || $idvendedor == 'null')
    { }else{$where .= " AND p.idvendedor ='$idvendedor' "; }

    $sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where." GROUP BY p.idmarca";

    //echo $sql25;
    $table = dibujarTablaOfvENTAS($sql25,$idtienda,$idempleado,$codigoempleado,$nombreempleado,$fechainicio,$fechafin);

    $html .= $table['resultado'];
    $html .= "</tr>";
    $html .= "</body>";
    $html .= "</html>";
    if($return == true)
    {
        return $html;
    }
    else
    {
        echo $html;
    }
}

function verventalistamarcamodelo($idmarca,$idvendedor,$fechainicio,$fechafin, $return)
{
    //echo $idvendedor;
    $idalmacen=$_SESSION['idalmacen'];
    $fecha1 = $fechainicio;

    $fecha2 = $fechafin;

    //echo $fechainicio;
    $empresa=strtoupper($empresa1);
    $fecha22= split("-", $fechainicio);
    $y=$fecha22[0];
    $m=$fecha22[1];
    $d=$fecha22[2];
    $fechaini=$d."-".$m."-".$y;

    $fecha221= split("-", $fechafin);
    $y2=$fecha221[0];
    $m2=$fecha221[1];
    $d2=$fecha221[2];
    $fechafinn=$d2."-".$m2."-".$y2;
    $html = "";
    $html .= "<tr><td colspan='4' align='center'>
     <p>NOVA MODA SRL<br />
         Telf. 4-258993  Fax: 4-504183
    </p>
</td></tr>";
    $html .= "<!DOCTYPE HTML PUBLIC '-//W3C//DTD HTML 4.01 Transitional//EN'>";
    $html .= "<html>";
    $html .= "<body>";
    $html .= "<tr>";

    $html .= "<table cellpadding='1' cellspacing='0' border='0' style='width:110%' font-size:11px; font-family:Tahoma;'>";
    $html .= "<td style='width:110%;height:100%;text-align:right;font-size:12px;font-family:Tahoma;'>";
    $html .= "$fecha  $tipo";
    $html .= "</td>";
    $html .= "<tr>";

    //$html .= "<tr style='width:100%height:100px;text-align:center;font-size:15px;font-family:Tahoma;'>";
    $html .= "<td style='width:110%;height:100px;text-align:center;font-size:15px;font-family:Tahoma;'>";
    $html .= "VENTAS<br>";
    $html .= " DEL $fechaini AL $fechafinn<br>";
    $html .= "</td>";
    $html .= "</tr>";
    $html .= "</table>";
    $html .= "</tr>";
    $html .= "<tr>";
    $html .= "<td colspan='3'>";
    $html .= "<table width='1250' border='0' cellspacing='0' cellpadding='0'><tr>";

    //    $html .= "<td style='width:100%;text-align:center;font-size:1px;font-family:Tahoma;'>";
    $html .= "<table cellpadding='0' cellspacing='0' border='0' style='width:100%;border:0px solid #000000;font-size:11px;text-align:center'>";
    $html .= "<tr>";

    $html .= "<tr style='width:100%; font-size:11px;'>";
    $html .=" </td> ";
    $html .= "</tr>";
    $html .= "<tr>";
    //    echo $idmarca;
    $select = "p.idmarca";
    $from = "marcas e,ventas p";
    $where = "p.idmarca=e.idmarca and p.idalmacen='$idalmacen' ";
    { $where .= " AND p.fecha >='$fechainicio' ";}
    if($fechafin != null && $fechafin != "")
    { $where .= " AND p.fecha <='$fechafin' ";}
    if($idmarca == null || $idmarca == 'null')
    { }else{$where .= " AND p.idmarca ='$idmarca' "; }
    if($idvendedor == null || $idvendedor == 'null')
    { }else{$where .= " AND p.idvendedor ='$idvendedor' "; }
    $sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where." GROUP BY p.idmarca";

    $table = dibujarTablaOfvENTASmodelo($sql25,$idmarca,$idtienda,$idvendedor,$codigoempleado,$nombreempleado,$fechainicio,$fechafin);
    //$table = dibujarTablaOfvENTAS($sql25,$idtienda,$idempleado,$codigoempleado,$nombreempleado,$fechainicio,$fechafin);

    $html .= $table['resultado'];
    $html .= "</tr>";

    //totales de totales,
    $html .= "</tr>";
    $html .= "</table>";


    $select1 = "SUM(iv.cantidad) AS pares";
    $from = "ventas v,ventaitem iv,`marcas` mar, clientes cli,almacenes a,empleados em";
    $where = "iv.idventa=v.idventa and v.idmarca=mar.idmarca and v.idcliente=cli.idcliente and v.idalmacen=a.idalmacen and
v.idvendedor=em.idempleado  and v.idalmacen='$idalmacen' ";
    { $where .= " AND v.fecha >='$fechainicio' ";}
    if($fechafin != null && $fechafin != "")
    { $where .= " AND v.fecha <='$fechafin' ";}
    if($idmarca == null || $idmarca == 'null' )
    { }else{$where .= " AND v.idmarca ='$idmarca' "; }
    if($idvendedor == null || $idvendedor == 'null' )
    { }else{$where .= " AND v.idvendedor ='$idvendedor' "; }
    //$select1 = "SELECT SUM(v.totalpares) AS cajas";
    $select2 = "SUM(iv.precioventa) AS sus";
    $select3 = "SUM(v.descuento) AS sus";
    $select4 = "SUM(v.montoapagar) AS sus";

    $sql4112 = "SELECT ".$select1." FROM ".$from. " WHERE ".$where." ";
    $creditoA111 = findBySqlReturnCampoUnique($sql4112, true, true, "pares");
    $tpares = $creditoA111['resultado'];
    //RICHY
    $sql12 = "SELECT ".$select2." FROM ".$from. " WHERE ".$where." ";
    $creditoA111 = findBySqlReturnCampoUnique($sql12, true, true, "sus");
    $tsus = $creditoA111['resultado'];
    $sql41 = "SELECT ".$select3." FROM ".$from. " WHERE ".$where." ";
    $creditoA111 = findBySqlReturnCampoUnique($sql41, true, true, "sus");
    $tdesc = $creditoA111['resultado'];
    $sql4 = "SELECT ".$select4." FROM ".$from. " WHERE ".$where." ";
    $creditoA111 = findBySqlReturnCampoUnique($sql4, true, true, "sus");
    $tmonto = $creditoA111['resultado'];
    $tcajas = $tpares/12;
    $tcajas = round($tcajas,2);
    $html .= "<tr>";
    $html .= "<td style='width:100%;text-align:left;font-size:14px;font-family:Tahoma;'>";
    $html .= "<table cellpadding='0' cellspacing='0' border='0' style='width:100%;border:1px solid #000000;font-size:14px;'>";
    $html .= "<tr><td style='width:10%;font-weight:bold;'>TOTAL CAJAS:</td><td style='width:10%;text-align:center;border-left: 1px solid #000000;font-weight:bold;'>".$tcajas."</td><td style='width:10%;font-weight:bold;'>TOTAL PARES:</td><td style='width:10%;text-align:center;border-left: 1px solid #000000;font-weight:bold;'>".$tpares."</td><td style='width:10%;font-weight:bold;'>TOTAL SUS:</td><td style='width:10%;text-align:center;border-left: 1px solid #000000;font-weight:bold;'>".$tsus."</td></tr>";
    $html .= "</table>";
    $html .= "</td></tr>";
    $html .= "</tr>";
    $html .= "</table>";
    $html .= "</td></tr>";
    $html .= "</table>";
    $html .= "</td></tr>";
    $html .= "</tr>";
    $html .= "</table>";
    $html .= "</body>";
    $html .= "</html>";
    if($return == true)
    {
        return $html;
    }
    else
    {
        echo $html;
    }
}
function veringresomarcavendedor($idmarca,$idvendedor,$fechainicio,$fechafin, $return)

//function veringresolistamarca($idmarca,$idvendedor,$fechainicio,$fechafin, $return)
{
    $idalmacen=$_SESSION['idalmacen'];
    $fecha1 = $fechainicio;
    $fecha2 = $fechafin;
    $empresa=strtoupper($empresa1);
    $fecha22= split("-", $fechainicio);
    $y=$fecha22[0];
    $m=$fecha22[1];
    $d=$fecha22[2];
    $fechaini=$d."-".$m."-".$y;

    $fecha221= split("-", $fechafin);
    $y2=$fecha221[0];
    $m2=$fecha221[1];
    $d2=$fecha221[2];
    $fechafinn=$d2."-".$m2."-".$y2;
    $html = "";
    $html .= "<tr><td colspan='4' align='center'>
     <p>NOVA MODA SRL<br />
         Telf. 4-258993  Fax: 4-504183
    </p>
</td></tr>";
    $html .= "<!DOCTYPE HTML PUBLIC '-//W3C//DTD HTML 4.01 Transitional//EN'>";
    $html .= "<html>";
    $html .= "<body>";
    $html .= "<tr>";

    $html .= "<table cellpadding='1' cellspacing='0' border='0' style='width:110%' font-size:11px; font-family:Tahoma;'>";
    $html .= "<td style='width:110%;height:100%;text-align:right;font-size:12px;font-family:Tahoma;'>";
    $html .= "$fecha  $tipo";
    $html .= "</td>";
    $html .= "<tr>";

    //$html .= "<tr style='width:100%height:100px;text-align:center;font-size:15px;font-family:Tahoma;'>";
    $html .= "<td style='width:110%;height:100px;text-align:center;font-size:15px;font-family:Tahoma;'>";
    $html .= "RECIBIDOS POR PROFORMA /MODELO<br>";
    $html .= " DEL $fechaini AL $fechafinn<br>";
    $html .= "</td>";
    $html .= "</tr>";
    $html .= "</table>";
    $html .= "</tr>";
    $html .= "<tr>";
    $html .= "<td colspan='3'>";

    $html .= "<table cellpadding='0' cellspacing='0' border='0' style='width:100%;border:0px solid #000000;font-size:11px;text-align:center'>";
    $html .= "<tr>";
    $html .= "<tr style='width:100%; font-size:11px;'>";
    $html .=" </td> ";
    $html .= "</tr>";
    $html .= "<tr>";
    $select = "p.idmarca";
    $from = "marcas e,ingresoalmacen p";
    $where = "p.idmarca=e.idmarca and p.idalmacen='$idalmacen' ";
    if($fechainicio != null && $fechainicio != "")
    {$where .= " AND p.fecha >='$fechainicio' ";}
    if($fechafin != null && $fechafin != "")
    { $where .= " AND p.fecha <='$fechafin' ";}
    if($idmarca == null || $idmarca == 'null')
    { }else{$where .= " AND p.idmarca ='$idmarca' "; }
    $sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where." GROUP BY p.idmarca";
    $table = dibujarTablaOfingreso($sql25,$idtienda,$idempleado,$codigoempleado,$nombreempleado,$fechainicio,$fechafin);
    $html .= $table['resultado'];
    $html .= "</tr>";
    $html .= "</tr>";
    $html .= "</table>";
    //por profromas
    $html .= "<table width='1250' border='0' cellspacing='0' cellpadding='0'><tr>";
    //        $select = "p.idmarca";

    $select = "e.idmarca,e.nombre,e.codigo";
    $from = "marcas e,proformas p";
    $where = "p.idmarca=e.idmarca and p.idalmacen='$idalmacen' ";
    { $where .= " AND p.fecha >='$fechainicio' ";}
    if($fechafin != null && $fechafin != "")
    { $where .= " AND p.fecha <='$fechafin' ";}
    if($idmarca == null || $idmarca == 'null')
    { }else{$where .= " AND p.idmarca ='$idmarca' "; }
    if($idvendedor == null || $idvendedor == 'null')
    { }else{$where .= " AND p.idvendedor ='$idvendedor' "; }

    $sql2 = "SELECT ".$select." FROM ".$from." WHERE ".$where." GROUP BY p.idmarca";
    //echo $sql2;
    $row = NumeroTuplas($sql2);
    $row1= $row['resultado'];
    $sql21 = getTablaToArrayOfSQL($sql2);
    $sql3 = $sql21['resultado'];
    $row5 = NumeroTuplas($sql2);
    $row15= $row5['resultado'];
    //    $html .= "<td style='width:100%;text-align:center;font-size:1px;font-family:Tahoma;'>";
    $html .= "<table cellpadding='0' cellspacing='0' border='1' style='width:100%;border:0px solid #000000;font-size:11px;text-align:center'>";
    $html .= "<tr>";
    for($i=0;$i<=$row15;$i++){
        $codigo = $sql3[$i];
        $idmarca = $codigo['idmarca'];
        $nombremarca= $codigo['nombre'];
        $codigoempleado = $codigo['codigo'];

        $html .= "<tr style='width:100%; font-size:11px;'>";
        $html .=" </td> ";
        $html .= "</tr>";
        $html .= "<tr>";
        $select = "mo.idvendedor";
        $from = "marcas e,proformas p,modelo mo";
        $where = "mo.idingreso=p.id_proforma and p.idmarca=e.idmarca and p.idalmacen='$idalmacen' and p.idmarca='$idmarca'";
        if($fechainicio != null && $fechainicio != "")
        {$where .= " AND p.fecha >='$fechainicio' ";}
        if($fechafin != null && $fechafin != "")
        { $where .= " AND p.fecha <='$fechafin' ";}
        $sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where." GROUP BY mo.idvendedor";
        //echo $sql25;
        $table = dibujarTablaOfingresosmodelo($sql25,$idmarca,$idtienda,$idvendedor,$codigoempleado,$nombreempleado,$fechainicio,$fechafin);
        //PORMODELO
        //$table = dibujarTablaproformavendedor($sql25,$idmarca,$codigoempleado,$nombremarca,$idcliente,$fechainicio,$fechafin);
        $html .= $table['resultado'];
        $html .= "</tr>";
    }

    $html .= "</tr>";

    $html .= "</table>";


    $html .= "</table>";
    $html .= "</td></tr>";

    $html .= "</table>";
    $html .= "</td></tr>";
    $html .= "</tr>";
    $html .= "</table>";
    $html .= "</body>";
    $html .= "</html>";
    if($return == true)
    {
        return $html;
    }
    else
    {
        echo $html;
    }
}

function vertraspasomarca($idmarca,$idvendedor,$fechainicio,$fechafin, $return)
{
    $idalmacen=$_SESSION['idalmacen'];
    $fecha1 = $fechainicio;
    $fecha2 = $fechafin;
    $empresa=strtoupper($empresa1);
    $fecha22= split("-", $fechainicio);
    $y=$fecha22[0];
    $m=$fecha22[1];
    $d=$fecha22[2];
    $fechaini=$d."-".$m."-".$y;

    $fecha221= split("-", $fechafin);
    $y2=$fecha221[0];
    $m2=$fecha221[1];
    $d2=$fecha221[2];
    $fechafinn=$d2."-".$m2."-".$y2;
    $html = "";
    $html .= "<tr><td colspan='4' align='center'>
     <p>NOVA MODA SRL<br />
         Telf. 4-258993  Fax: 4-504183
    </p>
</td></tr>";
    $html .= "<!DOCTYPE HTML PUBLIC '-//W3C//DTD HTML 4.01 Transitional//EN'>";
    $html .= "<html>";
    $html .= "<body>";
    $html .= "<tr>";

    $html .= "<table cellpadding='1' cellspacing='0' border='0' style='width:110%' font-size:11px; font-family:Tahoma;'>";
    $html .= "<td style='width:110%;height:100%;text-align:right;font-size:12px;font-family:Tahoma;'>";
    $html .= "$fecha  $tipo";
    $html .= "</td>";
    $html .= "<tr>";

    //$html .= "<tr style='width:100%height:100px;text-align:center;font-size:15px;font-family:Tahoma;'>";
    $html .= "<td style='width:110%;height:100px;text-align:center;font-size:15px;font-family:Tahoma;'>";
    $html .= "TRASPASOS ENVIADOS<br>";
    $html .= " DEL $fechaini AL $fechafinn<br>";
    $html .= "</td>";
    $html .= "</tr>";
    $html .= "</table>";
    $html .= "</tr>";
    $html .= "<tr>";
    $html .= "<td colspan='3'>";
    $html .= "<table width='1250' border='0' cellspacing='0' cellpadding='0'><tr>";
    $select = "e.idmarca,e.nombre,e.codigo";
    $from = "marcas e,traspaso p";
    $where = "p.idmarca=e.idmarca and p.idalmacen='$idalmacen' ";
    { $where .= " AND p.fecha >='$fechainicio' ";}
    if($fechafin != null && $fechafin != "")
    { $where .= " AND p.fecha <='$fechafin' ";}
    if($idmarca == null || $idmarca == 'null')
    { }else{$where .= " AND p.idmarca ='$idmarca' "; }
    if($idvendedor == null || $idvendedor == 'null')
    { }else{$where .= " AND p.idvendedor ='$idvendedor' "; }

    $sql2 = "SELECT ".$select." FROM ".$from." WHERE ".$where." GROUP BY p.idmarca";

    $row = NumeroTuplas($sql2);
    $row1= $row['resultado'];
    $sql21 = getTablaToArrayOfSQL($sql2);
    $sql3 = $sql21['resultado'];
    $row5 = NumeroTuplas($sql2);
    $row15= $row5['resultado'];
    //    $html .= "<td style='width:100%;text-align:center;font-size:1px;font-family:Tahoma;'>";
    $html .= "<table cellpadding='0' cellspacing='0' border='1' style='width:100%;border:0px solid #000000;font-size:11px;text-align:center'>";
    $html .= "<tr>";
    for($i=0;$i<=$row15;$i++){
        $codigo = $sql3[$i];
        $idmarca = $codigo['idmarca'];
        $nombremarca= $codigo['nombre'];
        $codigoempleado = $codigo['codigo'];
        $html .= "<tr style='width:100%; font-size:11px;'>";
        $html .=" </td> ";
        $html .= "</tr>";
        $html .= "<tr>";

        $select = "mo.idvendedor";
        $from = "traspaso tra, modelo m, marcas mar, empleados emp, empleados empo, almacenes des, almacenes ori,
 traspasodetallepar tr, modelo mo";
        $where = "tra.idmarca = mar.idmarca
AND tr.iddetalletraspaso = tra.idtraspaso
AND tr.idmodelo = m.idmodelo
AND tr.idmodeloorigen = mo.idmodelo
AND tra.idalmacen = ori.idalmacen
AND tra.idalmacendestino = des.idalmacen
AND mo.idvendedor=emp.idempleado and m.idvendedor=empo.idempleado and tra.idalmacen ='$idalmacen' and
tra.idmarca='$idmarca'";

        if($fechainicio != null && $fechainicio != "")
        { $where .= " AND tra.fecha >='$fechainicio' ";}
        if($fechafin != null && $fechafin != "")
        { $where .= " AND tra.fecha <='$fechafin' ";}
        if($idvendedor == null || $idvendedor == 'null' || $idvendedor != "null")
        { }else{$where .= " AND mo.idvendedor ='$idvendedor' "; }

        $sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where." GROUP BY mo.idvendedor";

        $table = dibujarTablatraspasosenviados($sql25,$idmarca,$codigoempleado,$nombremarca,$idcliente,$fechainicio,$fechafin);
        $html .= $table['resultado'];
        $html .= "</tr>";
    }

    $html .= "</tr>";

    $html .= "</table>";


    $html .= "</table>";
    $html .= "</td></tr>";

    $html .= "</table>";
    $html .= "</td></tr>";
    $html .= "</tr>";
    $html .= "</table>";
    $html .= "</body>";
    $html .= "</html>";
    if($return == true)
    {
        return $html;
    }
    else
    {
        echo $html;
    }
}

function dibujarTablaproformavendedor($sql,$idmarca,$codigoempleado,$nombremarca,$idcliente,$fechainicio,$fechafin)
{
    $idalmacen=$_SESSION['idalmacen'];
    if($link=new BD)
    {
        if($link->conectar())
        {
            if($re = $link->consulta($sql))
            {
                //echo mysql_num_rows($re);
                if($fi = mysql_fetch_array($re))
                {
                    $devS .= "<table cellpadding='0' cellspacing='0' border='0' style='width:100%;border:1px solid #000000;font-size:18px;'>";
                    $devS .= "<tr><td colspan='".(mysql_num_fields($re)+1)."' style='border-bottom:1px solid #000000;font-weight:bold;font-size:17px;text-align:left;'>$nombremarca</td></tr>";

                    $devS .= "</tr>";
                    $ii = 0;
                    //$totalCount = mysql_num_rows($re);
                    $z = 1;
                    $totalcajas=0;
                    $totalpares=0;
                    $totalsus=0;
                    do{
                        // $devS .= "<tr><td style='text-align:left'>".$z."</td>";
                        $porcobrar=0;
                        for($i = 0; $i< mysql_num_fields($re); $i++)
                        {   $dato = $fi[$i];
                            $idempleado = $dato;
                            $sql2 = "SELECT CONCAT( UPPER(nombres), '-', UPPER(apellidos) )AS nombre FROM empleados WHERE idempleado = '$idempleado'";
                            $idalmacenA =  findBySqlReturnCampoUnique($sql2, true, true, 'nombre');
                            $empresa1 = $idalmacenA['resultado'];
                            $empresa=strtoupper($empresa1);
                            //$devS .= "<td style='display:none;'>&nbsp;&nbsp;</td>";
                            //Traspasos de recibidos
                            if($idempleado=='emp-73'){
                                $idalmacen = 'alm-10';
                            }
                            else{
                                if($idempleado=='emp-83'){
                                    $idalmacen = 'alm-11';
                                }
                                else{
                                    $idalmacen=$_SESSION['idalmacen'];
                                }
                            }


//(DATE_FORMAT(mo.fechamodelo, '%Y-%m-%d'))
                            $select0 = "date_format(p.fecha,'%d/%m/%Y') AS Fecha, p.id_proforma as boleta, p.nro_factura,
                                        (COUNT(kp.saldocantidad)/12) as totalcajas, COUNT(kp.idkardexunico) AS Pares, SUM(kp.preciounitario) AS sus";
                            $from0 = "modelo m,kardexdetallepar kp,modelo as m2,proformas p";
                            $where0 = "kp.idmodelo=m.idmodelo and m.idingreso=p.id_proforma and m2.estadotraspaso=m.idmodelo  and m2.idvendedor='$idempleado' AND m.idmarca = '$idmarca' AND (DATE_FORMAT(p.fecha, '%Y-%m-%d')) >= '$fechainicio' AND (DATE_FORMAT(p.fecha, '%Y-%m-%d')) <= '$fechafin' AND p.idalmacen='$idalmacen'";
                                                
                            //Recibidos

                            $select1 = " date_format(p.fecha,'%d/%m/%Y') AS Fecha, p.id_proforma as boleta, p.nro_factura,
                                        (COUNT(kp.saldocantidad)/12) as totalcajas, COUNT(kp.idkardexunico) as totalpares, SUM(kp.preciounitario) as totalsus";
                            $from1 = "modelo m,kardexdetallepar kp,proformas p ";
                            $where1 = " m.idingreso=p.id_proforma and kp.idmodelo=m.idmodelo and m.estadotraspaso='ninguno' and m.idvendedor='$idempleado' AND m.idmarca = '$idmarca' AND (DATE_FORMAT(p.fecha, '%Y-%m-%d')) >= '$fechainicio' AND (DATE_FORMAT(p.fecha, '%Y-%m-%d')) <= '$fechafin'  AND p.idalmacen='$idalmacen' and m.idalmacen='$idalmacen' and kp.idalmacen='$idalmacen' and m.boleta=p.id_proforma";
                           

                            $sqlruta = "SELECT ".$select0." FROM ".$from0. " WHERE ".$where0." GROUP by p.id_proforma
                                        UNION ALL
                                        SELECT ".$select1." FROM ".$from1. " WHERE ".$where1." GROUP by p.id_proforma ORDER by FEcha";

                       
 $selectm = "COUNT(kp.idkardexunico) AS Pares, SUM(kp.preciounitario) AS sus ";
                          $fromm = "modelo m,kardexdetallepar kp,modelo as m2,proformas p";
                          $wherem = "kp.idmodelo=m.idmodelo and m.idingreso=p.id_proforma and m2.estadotraspaso=m.idmodelo";
                           { $wherem .= " and m2.idvendedor='$idempleado' AND m.idmarca = '$idmarca' AND (DATE_FORMAT(p.fecha, '%Y-%m-%d')) >= '$fechainicio' AND (DATE_FORMAT(p.fecha, '%Y-%m-%d')) <= '$fechafin' AND p.idalmacen='$idalmacen'";}
                           $sql251 = "SELECT ".$selectm." FROM ".$fromm." WHERE ".$wherem;
                      //  echo $sql251;
                            $almacenA1 =  findBySqlReturnCampoUnique($sql251, true, true, 'Pares');
                            $tpares1 = $almacenA1['resultado'];
                            $almacenA1 =  findBySqlReturnCampoUnique($sql251, true, true, 'sus');
                            $tbs1 = $almacenA1['resultado'];
 $select1 = "COUNT(kp.idkardexunico) AS Pares, SUM(kp.preciounitario) AS sus";
                            $from1 = "modelo m,kardexdetallepar kp,proformas p";
                            $where1 = "m.idingreso=p.id_proforma and kp.idmodelo=m.idmodelo and m.estadotraspaso='ninguno' ";

                            { $where1 .= "and m.idvendedor='$idempleado' AND m.idmarca = '$idmarca' AND (DATE_FORMAT(p.fecha, '%Y-%m-%d')) >= '$fechainicio' AND (DATE_FORMAT(p.fecha, '%Y-%m-%d')) <= '$fechafin' AND p.idalmacen='$idalmacen' and m.idalmacen='$idalmacen' and kp.idalmacen='$idalmacen' and m.boleta=p.id_proforma";}

                            $sql25c = "SELECT ".$select1." FROM ".$from1." WHERE ".$where1;
                            //echo $sql25c;
                            $almacenA1 =  findBySqlReturnCampoUnique($sql25c, true, true, 'Pares');
                            $tpares2 = $almacenA1['resultado'];
                            $almacenA1 =  findBySqlReturnCampoUnique($sql25c, true, true, 'sus');
                            $tbs2 = $almacenA1['resultado'];


                            $tpares = $tpares2 + $tpares1;
                            $tbs = $tbs1 + $tbs2;
                            $tcajas = redondear($tpares/12);

                            $totalcajas = $totalcajas + $tcajas;
                            $totalpares = $totalpares + $tpares;
                            $totalsus = $totalsus + $tbs;
                            $table = dibujarTablasimplesintotalestotal($sqlruta, $empresa,$tcajas,$tpares,$tbs,$tpares,$tsus);
                            $devS .= $table['resultado'];
////                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$stockanterior."&nbsp;</td>";
                        }
                        $devS .= "</tr>";
                        $ii++;
                        $z ++;
                    }while($fi = mysql_fetch_array($re));
                    //$totalmarca
                    $devS .= "<tr style='background-color:silver;'><td style='border: 1px solid #000000;font-weight:bold;font-size:25px;text-align:center;background-color:silver;'>TOTALES  </td>";
                    $devS .= "<td style='display:none;'></td>";

                    $devS .= "<td style='text-align:center;border-bottom: 1px solid #000000;font-size:12px;'>$nombremarca</td>";
                    $devS .= "<td style='text-align:center;border-bottom: 1px solid #000000;'></td>";
                    $devS .= "<td style='text-align:center;border-bottom: 1px solid #000000;'></td>";
                    $devS .= "<tr style='background-color:silver;'><td style='border: 1px solid #000000;font-weight:bold;font-size:25px;text-align:center;background-color:silver;'> : Total Cajas  </td>";
                    $devS .= "<td style='text-align:right;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$totalcajas."&nbsp;</td>";
                    $devS .= "<tr style='background-color:silver;'><td style='border: 1px solid #000000;font-weight:bold;font-size:25px;text-align:center;background-color:silver;'>  Total Pares  </td>";
                    $devS .= "<td style='text-align:right;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$totalpares."&nbsp;</td>";
                    $devS .= "<tr style='background-color:silver;'><td style='border: 1px solid #000000;font-weight:bold;font-size:25px;text-align:center;background-color:silver;'>  Total Sus  </td>";
                    $devS .= "<td style='text-align:right;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$totalsus."&nbsp;</td>";
//$devS .= "<tr><td style='border-bottom:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Totales</td><td></td><td></td><td style='border-bottom:1px solid #000000;font-weight:bold;font-size:15px;text-center:right;background-color:silver;'>$tcajas</td><td style='border-bottom:1px solid #000000;font-weight:bold;font-size:15px;text-center:right;background-color:silver;'>$tpares</td><td style='border-bottom:1px solid #000000;font-weight:bold;font-size:15px;text-align:center;background-color:silver;'>$tbs</td>";
                    $devS .= "</tr>";
                    $devS .= "</table>";

                    $dev['mensaje'] = "Existen resultados";
                    $dev['error']   = "true";
                    $dev['resultado'] = $devS;

                }
                else
                {
                    $dev['mensaje'] = "No se encontro datos en la consulta2".mysql_error();
                    $dev['error']   = "false";
                    $dev['resultado'] = "";
                }
            }
            else
            {
                $dev['mensaje'] = "Error en la consulta";
                $dev['error']   = "false";
                $dev['resultado'] = "";
            }
        }
        else
        {
            $dev['mensaje'] = "No se pudo conectar a la BD";
            $dev['error']   = "false";
            $dev['resultado'] = "";
        }
    }
    else
    {
        $dev['mensaje'] = "No se pudo crear la conexion a la BD";
        $dev['error']   = "false";
        $dev['resultado'] = "";
    }
    return $dev;
}
function dibujarTablatraspasosenviados($sql,$idmarca,$codigoempleado,$nombremarca,$idcliente,$fechainicio,$fechafin)
{
    $idalmacen=$_SESSION['idalmacen'];
    if($link=new BD)
    {
        if($link->conectar())
        {
            if($re = $link->consulta($sql))
            {
                //echo mysql_num_rows($re);
                if($fi = mysql_fetch_array($re))
                {
                    $devS .= "<table cellpadding='0' cellspacing='0' border='0' style='width:100%;border:1px solid #000000;font-size:18px;'>";
                    $devS .= "<tr><td colspan='".(mysql_num_fields($re)+1)."' style='border-bottom:1px solid #000000;font-weight:bold;font-size:16px;text-align:left;'>$nombremarca</td></tr>";

                    $devS .= "</tr>";
                    $ii = 0;
                    //$totalCount = mysql_num_rows($re);
                    $z = 1;
                    $totalcajas=0;
                    $totalpares=0;
                    $totalsus=0;
                    do{
                        // $devS .= "<tr><td style='text-align:left'>".$z."</td>";
                        $porcobrar=0;
                        for($i = 0; $i< mysql_num_fields($re); $i++)
                        {$dato = $fi[$i];
                            $idvendedor = $dato;


                            $sql2 = "SELECT CONCAT( UPPER(nombres), '-', UPPER(apellidos) )AS nombre FROM empleados WHERE idempleado = '$idvendedor'";
                            $idalmacenA =  findBySqlReturnCampoUnique($sql2, true, true, 'nombre');
                            $empresa1 = $idalmacenA['resultado'];
                            $empresa=strtoupper($empresa1);
                            $devS .= "<td style='display:none;'>&nbsp;".$dato."&nbsp;</td>";

                            $select1 = " tra.boleta,mar.nombre as marca, date_format( tra.fecha, '%d/%m/%Y' ) AS fecha, CONCAT( m.codigo, '-', m.color) AS modelo, SUM( tr.saldocantidad ) AS pares, SUM( tr.preciounitario ) AS totalsus, emp.nombres AS EnviadoPor, empo.nombres AS RecibidoPor, ori.nombre AS tiendaorigen, des.nombre AS tiendadestino";
                            $from1 = "traspaso tra, modelo m, marcas mar, empleados emp, empleados empo, almacenes des, almacenes ori,
 traspasodetallepar tr, modelo mo";
                            $where1 = "tra.idmarca = mar.idmarca
AND tr.iddetalletraspaso = tra.idtraspaso
AND tr.idmodelo = m.idmodelo
AND tr.idmodeloorigen = mo.idmodelo
AND tra.idalmacen = ori.idalmacen
AND tra.idalmacendestino = des.idalmacen
AND mo.idvendedor=emp.idempleado and m.idvendedor=empo.idempleado and tra.idalmacen ='$idalmacen' and
tra.idmarca='$idmarca' AND mo.idvendedor ='$idvendedor'  ";


                            if($fechainicio != null && $fechainicio != "")
                            { $where1 .= " AND tra.fecha >='$fechainicio' ";}
                            if($fechafin != null && $fechafin != "")
                            { $where1 .= " AND tra.fecha <='$fechafin' ";}
                            //      if($idvendedor == null || $idvendedor == 'null' || $idvendedor != "null")
                            //    { }else{$where1 .= " AND mo.idvendedor ='$idvendedor' "; }
//group by tra.boleta,tr.idmodelo
                          $sqlruta = "SELECT ".$select1." FROM ".$from1. " WHERE ".$where1." Group by tra.boleta,tr.idmodelo ORDER by emp.nombres";
                       //     $sqlruta = "SELECT ".$select1." FROM ".$from1. " WHERE ".$where1." GROUP BY tr.idmodelo ORDER by emp.nombres";
                            //echo $sqlruta;
                            $select2 = "SUM( tr.saldocantidad ) AS pares";
                            $select3 = "SUM( tr.preciounitario ) AS totalsus";

                            $sql4112 = "SELECT ".$select2." FROM ".$from1. " WHERE ".$where1." ";
                            $creditoA111 = findBySqlReturnCampoUnique($sql4112, true, true, "pares");
                            $tpares = $creditoA111['resultado'];

                            $sql12 = "SELECT ".$select3." FROM ".$from1. " WHERE ".$where1." ";
                            $creditoA111 = findBySqlReturnCampoUnique($sql12, true, true, "totalsus");
                            $tsus = $creditoA111['resultado'];


                            $table = dibujarTablasimplesintotales($sqlruta, $empresa,$tdesc,$tsus,$tcajas,$tpares,$tsus);
                            $devS .= $table['resultado'];


                            //$table = dibujarTablaOfTRASPDESP($sql25,$idtienda,$idvendedor,$codigoempleado,$nombreempleado,$fechainicio,$fechafin);
                            //  $devS .= $table['resultado'];

                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$stockanterior."&nbsp;</td>";

                        }
                        $devS .= "</tr>";
                        $ii++;
                        $z ++;
                    }while($fi = mysql_fetch_array($re));



                    //$totalmarca
                    $devS .= "<tr style='background-color:silver;'><td style='border: 1px solid #000000;font-weight:bold;font-size:25px;text-align:center;background-color:silver;'>TOTALES:</td>";
                    $devS .= "<td style='display:none;'></td>";

                    $devS .= "<td style='text-align:center;border-bottom: 1px solid #000000;font-size:12px;'>$nombremarca</td>";
                    $devS .= "<td style='text-align:center;border-bottom: 1px solid #000000;'></td>";
                    $devS .= "<td style='text-align:center;border-bottom: 1px solid #000000;'></td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$totalmarca."&nbsp;</td>";

                    $devS .= "</tr>";
                    $devS .= "</table>";

                    $dev['mensaje'] = "Existen resultados";
                    $dev['error']   = "true";
                    $dev['resultado'] = $devS;

                }
                else
                {
                    $dev['mensaje'] = "No se encontro datos en la consulta2".mysql_error();
                    $dev['error']   = "false";
                    $dev['resultado'] = "";
                }
            }
            else
            {
                $dev['mensaje'] = "Error en la consulta";
                $dev['error']   = "false";
                $dev['resultado'] = "";
            }
        }
        else
        {
            $dev['mensaje'] = "No se pudo conectar a la BD";
            $dev['error']   = "false";
            $dev['resultado'] = "";
        }
    }
    else
    {
        $dev['mensaje'] = "No se pudo crear la conexion a la BD";
        $dev['error']   = "false";
        $dev['resultado'] = "";
    }
    return $dev;
}
function dibujarTablatraspasosrecibidos($sql,$idmarca,$codigoempleado,$nombremarca,$idcliente,$fechainicio,$fechafin)
{
    $idalmacen=$_SESSION['idalmacen'];
    if($link=new BD)
    {
        if($link->conectar())
        {
            if($re = $link->consulta($sql))
            {
                //echo mysql_num_rows($re);
                if($fi = mysql_fetch_array($re))
                {
                    $devS .= "<table cellpadding='0' cellspacing='0' border='0' style='width:100%;border:1px solid #000000;font-size:18px;'>";
                    $devS .= "<tr><td colspan='".(mysql_num_fields($re)+1)."' style='border-bottom:1px solid #000000;font-weight:bold;font-size:16px;text-align:left;'>$nombremarca</td></tr>";

                    $devS .= "</tr>";
                    $ii = 0;
                    //$totalCount = mysql_num_rows($re);
                    $z = 1;
                    $totalcajas=0;
                    $totalpares=0;
                    $totalsus=0;
                    do{
                        // $devS .= "<tr><td style='text-align:left'>".$z."</td>";
                        $porcobrar=0;
                        for($i = 0; $i< mysql_num_fields($re); $i++)
                        {$dato = $fi[$i];
                            $idvendedor = $dato;


                            $sql2 = "SELECT CONCAT( UPPER(nombres), '-', UPPER(apellidos) )AS nombre FROM empleados WHERE idempleado = '$idvendedor'";
                            $idalmacenA =  findBySqlReturnCampoUnique($sql2, true, true, 'nombre');
                            $empresa1 = $idalmacenA['resultado'];
                            $empresa=strtoupper($empresa1);
                            $devS .= "<td style='display:none;'>&nbsp;".$dato."&nbsp;</td>";


                            $select1 = " tra.boleta,mar.nombre as marca, date_format( tra.fecha, '%d/%m/%Y' ) AS fecha, m.codigo AS modelo, SUM( tr.saldocantidad ) AS pares, SUM( tr.preciounitario ) AS totalsus, emp.nombres AS RecibidoPor, empo.nombres AS EnviadoPor, ori.nombre AS tiendaorigen, des.nombre AS tiendadestino";
                            $from1 = "traspaso tra, modelo mo, marcas mar, empleados emp, empleados empo, almacenes ori, almacenes des,
 traspasodetallepar tr, modelo m";
                            $where1 = "tra.idmarca = mar.idmarca
AND mo.idvendedor = empo.idempleado
AND tr.iddetalletraspaso = tra.idtraspaso
AND tr.idmodelo = m.idmodelo
AND tr.idmodeloorigen = mo.idmodelo
AND tra.idalmacen = ori.idalmacen
AND tra.idalmacendestino = des.idalmacen
AND tra.responsable = emp.idempleado and tra.idalmacendestino ='$idalmacen' and
tra.idmarca='$idmarca'  and tra.responsable='$idvendedor'";


                            if($fechainicio != null && $fechainicio != "")
                            { $where1 .= " AND tra.fecha >='$fechainicio' ";}
                            if($fechafin != null && $fechafin != "")
                            { $where1 .= " AND tra.fecha <='$fechafin' ";}
                            if($idvendedor == null || $idvendedor == 'null' || $idvendedor != "null")
                            { }else{$where1 .= " AND tra.responsable ='$idvendedor' "; }
                            //      if($idvendedor == null || $idvendedor == 'null' || $idvendedor != "null")
                            //    { }else{$where1 .= " AND mo.idvendedor ='$idvendedor' "; }
                           $sqlruta = "SELECT ".$select1." FROM ".$from1. " WHERE ".$where1." GROUP BY tra.boleta,tr.idmodelo ORDER by emp.nombres";

//                            $sqlruta = "SELECT ".$select1." FROM ".$from1. " WHERE ".$where1." GROUP BY tr.idmodelo ORDER by emp.nombres";
                            //echo $sqlruta;
                            $select2 = "SUM( tr.saldocantidad ) AS pares";
                            $select3 = "SUM( tr.preciounitario ) AS totalsus";

                            $sql4112 = "SELECT ".$select2." FROM ".$from1. " WHERE ".$where1." ";
                            $creditoA111 = findBySqlReturnCampoUnique($sql4112, true, true, "pares");
                            $tpares = $creditoA111['resultado'];

                            $sql12 = "SELECT ".$select3." FROM ".$from1. " WHERE ".$where1." ";
                            $creditoA111 = findBySqlReturnCampoUnique($sql12, true, true, "totalsus");
                            $tsus = $creditoA111['resultado'];


                            $table = dibujarTablasimplesintotales($sqlruta, $empresa,$tdesc,$tsus,$tcajas,$tpares,$tsus);
                            $devS .= $table['resultado'];


                            //$table = dibujarTablaOfTRASPDESP($sql25,$idtienda,$idvendedor,$codigoempleado,$nombreempleado,$fechainicio,$fechafin);
                            //  $devS .= $table['resultado'];

                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$stockanterior."&nbsp;</td>";

                        }
                        $devS .= "</tr>";
                        $ii++;
                        $z ++;
                    }while($fi = mysql_fetch_array($re));



                    $select = "sum(cl.porpagar) as monto";
                    $from = "creditocliente cl,clientes c";
                    $where = "cl.idcliente=c.idcliente and cl.estado='pendiente' and cl.idmarca='$idmarca'";
                    if($idcliente == "null")
                    {
                    }else{ $where .= " AND cl.idcliente='$idcliente' ";
                    }
                    $sql251 = "SELECT ".$select." FROM ".$from." WHERE ".$where." ";
                    $idalmacenA =  findBySqlReturnCampoUnique($sql251, true, true, 'monto');
                    $totalporcobrar = $idalmacenA['resultado'];

                    $devS .= "<tr style='background-color:silver;'><td style='border: 1px solid #000000;font-weight:bold;font-size:25px;text-align:center;background-color:silver;'>TOTAL SALDO:</td>";
                    $devS .= "<td style='display:none;'></td>";

                    $devS .= "<td style='text-align:center;border-bottom: 1px solid #000000;font-size:12px;'>$nombremarca</td>";
                    $devS .= "<td style='text-align:center;border-bottom: 1px solid #000000;'></td>";
                    $devS .= "<td style='text-align:center;border-bottom: 1px solid #000000;'></td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$totalporcobrar."&nbsp;</td>";

                    $devS .= "</tr>";
                    $devS .= "</table>";

                    $dev['mensaje'] = "Existen resultados";
                    $dev['error']   = "true";
                    $dev['resultado'] = $devS;

                }
                else
                {
                    $dev['mensaje'] = "No se encontro datos en la consulta2".mysql_error();
                    $dev['error']   = "false";
                    $dev['resultado'] = "";
                }
            }
            else
            {
                $dev['mensaje'] = "Error en la consulta";
                $dev['error']   = "false";
                $dev['resultado'] = "";
            }
        }
        else
        {
            $dev['mensaje'] = "No se pudo conectar a la BD";
            $dev['error']   = "false";
            $dev['resultado'] = "";
        }
    }
    else
    {
        $dev['mensaje'] = "No se pudo crear la conexion a la BD";
        $dev['error']   = "false";
        $dev['resultado'] = "";
    }
    return $dev;
}

function vertraspasomarcarecib($idmarca,$idvendedor,$fechainicio,$fechafin, $return)
{
    //echo "hola";
    $idalmacen=$_SESSION['idalmacen'];
    $fecha1 = $fechainicio;

    $fecha2 = $fechafin;

    //echo $fechainicio;
    $empresa=strtoupper($empresa1);
    $fecha22= split("-", $fechainicio);
    $y=$fecha22[0];
    $m=$fecha22[1];
    $d=$fecha22[2];
    $fechaini=$d."-".$m."-".$y;

    $fecha221= split("-", $fechafin);
    $y2=$fecha221[0];
    $m2=$fecha221[1];
    $d2=$fecha221[2];
    $fechafinn=$d2."-".$m2."-".$y2;
    $html = "";
    $html .= "<tr><td colspan='4' align='center'>
     <p>NOVA MODA SRL<br />
         Telf. 4-258993  Fax: 4-504183
    </p>
</td></tr>";
    $html .= "<!DOCTYPE HTML PUBLIC '-//W3C//DTD HTML 4.01 Transitional//EN'>";
    $html .= "<html>";
    $html .= "<body>";
    $html .= "<tr>";

    $html .= "<table cellpadding='1' cellspacing='0' border='0' style='width:110%' font-size:11px; font-family:Tahoma;'>";
    $html .= "<td style='width:110%;height:100%;text-align:right;font-size:12px;font-family:Tahoma;'>";
    $html .= "$fecha  $tipo";
    $html .= "</td>";
    $html .= "<tr>";

    //$html .= "<tr style='width:100%height:100px;text-align:center;font-size:15px;font-family:Tahoma;'>";
    $html .= "<td style='width:110%;height:100px;text-align:center;font-size:15px;font-family:Tahoma;'>";
    $html .= "TRASPASOS RECIBIDOS<br>";
    $html .= " DEL $fechaini AL $fechafinn<br>";
    $html .= "</td>";
    $html .= "</tr>";
    $html .= "</table>";
    $html .= "</tr>";
    $html .= "<tr>";
    $html .= "<td colspan='3'>";
    $html .= "<table width='1250' border='0' cellspacing='0' cellpadding='0'><tr>";

    $select = "e.idmarca,e.nombre,e.codigo";
    $from = "marcas e,traspaso p";
    $where = "p.idmarca=e.idmarca and p.idalmacendestino='$idalmacen' ";
    { $where .= " AND p.fecha >='$fechainicio' ";}
    if($fechafin != null && $fechafin != "")
    { $where .= " AND p.fecha <='$fechafin' ";}
    if($idmarca == null || $idmarca == 'null')
    { }else{$where .= " AND p.idmarca ='$idmarca' "; }
    if($idvendedor == null || $idvendedor == 'null')
    { }else{$where .= " AND p.idvendedor ='$idvendedor' "; }

    $sql2 = "SELECT ".$select." FROM ".$from." WHERE ".$where." GROUP BY p.idmarca";


    $row = NumeroTuplas($sql2);
    $row1= $row['resultado'];
    $sql21 = getTablaToArrayOfSQL($sql2);
    $sql3 = $sql21['resultado'];
    $row5 = NumeroTuplas($sql2);
    $row15= $row5['resultado'];
    //    $html .= "<td style='width:100%;text-align:center;font-size:1px;font-family:Tahoma;'>";
    $html .= "<table cellpadding='0' cellspacing='0' border='1' style='width:100%;border:0px solid #000000;font-size:11px;text-align:center'>";
    $html .= "<tr>";
    for($i=0;$i<=$row15;$i++){
        $codigo = $sql3[$i];
        $idmarca = $codigo['idmarca'];
        $nombremarca= $codigo['nombre'];
        $codigoempleado = $codigo['codigo'];
        $html .= "<tr style='width:100%; font-size:11px;'>";
        $html .=" </td> ";
        $html .= "</tr>";
        $html .= "<tr>";



        $select = "tra.responsable as idvendedor";
        $from = "traspaso tra, modelo mo, marcas mar, empleados emp, empleados empo, almacenes ori, almacenes des,
 traspasodetallepar tr, modelo m";
        $where = "tra.idmarca = mar.idmarca
AND mo.idvendedor = empo.idempleado
AND tr.iddetalletraspaso = tra.idtraspaso
AND tr.idmodelo = m.idmodelo
AND tr.idmodeloorigen = mo.idmodelo
AND tra.idalmacen = ori.idalmacen
AND tra.idalmacendestino = des.idalmacen
AND tra.responsable = emp.idempleado and tra.idalmacendestino ='$idalmacen' and
tra.idmarca='$idmarca'";

        if($fechainicio != null && $fechainicio != "")
        { $where .= " AND tra.fecha >='$fechainicio' ";}
        if($fechafin != null && $fechafin != "")
        { $where .= " AND tra.fecha <='$fechafin' ";}
        if($idvendedor == null || $idvendedor == 'null' || $idvendedor != "null")
        { }else{$where .= " AND tra.responsable ='$idvendedor' "; }

        //  $sqlruta = "SELECT ".$select1." FROM ".$from1. " WHERE ".$where1." GROUP BY tr.idmodelo ORDER by emp.nombres";


        $sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where." GROUP BY tra.responsable";

        $table = dibujarTablatraspasosrecibidos($sql25,$idmarca,$codigoempleado,$nombremarca,$idcliente,$fechainicio,$fechafin);
        $html .= $table['resultado'];
        $html .= "</tr>";
    }

    $html .= "</tr>";

    $html .= "</table>";





    $html .= "<tr>";
    $html .= "<td style='width:100%;text-align:center;font-size:12px;font-family:Tahoma;'>";
    $html .= "<table cellpadding='0' cellspacing='0' border='1' style='width:100%;border:1px solid #000000;font-size:14px;text-align:center'>";
    $sql4112 = "SELECT SUM(montoacuenta) AS totaldeuda FROM acuentaempresa WHERE tipopago='P' AND fecha >='$fechainicio' AND fecha <='$fechafin'";
    $creditoA111 = findBySqlReturnCampoUnique($sql4112, true, true, "totaldeuda");
    $totalcobradoacuenta = $creditoA111['resultado'];

    $html .= "<tr>";
    $html .= "<td style='width:100%;text-align:left;font-size:14px;font-family:Tahoma;'>";
    $html .= "<table cellpadding='0' cellspacing='0' border='0' style='width:100%;border:1px solid #000000;font-size:14px;'>";
    $html .= "<tr><td style='width:85%;font-weight:bold;'>TOTAL :</td><td style='width:20%;text-align:center;border-left: 1px solid #000000;font-weight:bold;'>".$totalcobradoacuenta."</td></tr>";
    $html .= "</table>";
    $html .= "</td></tr>";


    $html .= "</tr>";
    $html .= "</table>";
    $html .= "</td></tr>";

    $html .= "</table>";
    $html .= "</td></tr>";
    $html .= "</tr>";
    $html .= "</table>";
    $html .= "</body>";
    $html .= "</html>";
    if($return == true)
    {
        return $html;
    }
    else
    {
        echo $html;
    }
}
//function vertraspasointerno($idmarca,$idvendedor,$fechainicio,$fechafin, $return)

function vertraspasointerno($idmarca,$idvendedor,$fechainicio,$fechafin, $return)
{     $idalmacen=$_SESSION['idalmacen'];
    $html = "";
    $html .= "<tr><td colspan='4' align='center'>
    <p>Nova Moda S.RL.<br />
         <br />
         Telf. 4-258993  Fax: 4-504183
    </p>
</td></tr>";
    $html .= "<!DOCTYPE HTML PUBLIC '-//W3C//DTD HTML 4.01 Transitional//EN'>";
    $html .= "<html>";
    $html .= "<body>";
    $html .= "<tr>";
    $html .= "<table cellpadding='1' cellspacing='0' border='0' style='width:100%' font-size:11px; font-family:Tahoma;'>";
    $html .= "<td style='width:100%;height:100%;text-align:right;font-size:12px;font-family:Tahoma;'>";
    $html .= "$fecha  $tipo";
    $html .= "</td>";
    $html .= "<tr>";
      $sql = "SELECT codigo,CONCAT( nombres,'/',apellidos) AS vendedor FROM  empleados WHERE idempleado = '$idvendedor'";
    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'vendedor');
    $vendedor = $idalmacenA2['resultado'];


    $sql = "SELECT ma.nombre AS marca,ma.talla,ma.opcionb,ma.pedido FROM  `marcas` ma WHERE ma.idmarca = '$idmarca'";
    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'marca');
    $marcalista = $idalmacenA2['resultado'];
    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'talla');
    $opcionmarca = $idalmacenA2['resultado'];
    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'opcionb');
    $opcionb = $idalmacenA2['resultado'];
    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'pedido');
    $marcapedido = $idalmacenA2['resultado'];
    $idsCAr = split("-", $opcionmarca);
    $rango1=$idsCAr[0];
    $rango2=$idsCAr[1];
    if($opcionmarca="33-45"){
        $tipo="1";
    }else{
        if($opcionmarca="14-38"){
            $tipo="3";
        }
    }
    $sqlmarca = " SELECT idkardex FROM administrakardex WHERE idkardex = '$idkardex' group by mesrango";
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "idkardex");
    $idkar = $opcionkardex['resultado'];


    //$html .= "<b><u>INVENTARIO $marcalista</u></b><br>";
    $sqlmarca = " SELECT nombre FROM almacenes WHERE idalmacen = '$idalmacen' ";

    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "nombre");
    $deptocapital = $opcionkardex['resultado'];

    $html .= "<td style='width:100%;height:50px;text-align:center;font-size:15px;font-family:Tahoma;'>";
    $html .= "<b><u>TRASPASOS INTERNOS RECIBIDOS /Y VENDIDOS </u></b><br>";

    //     $html .= "Tienda $tienda";
    $html .= "</td>";
    $html .= "</tr>";
    $html .= "</table>";
    $html .= "</tr>";
    $html .= "<tr>";
    $html .= "<td colspan='3'>";

    $html .= "<table width='1250' border='0' cellspacing='0' cellpadding='0'><tr>";



  $select = "v.idmarca,m.nombre";
    $from = "traspasosinternos iv,modelo md,ventas v,marcas m";
    $where = "iv.idventa=v.idventa and iv.idmodelo=md.idmodelo and md.idmarca=m.idmarca and iv.idalmacen='$idalmacen' ";
    { $where .= " AND iv.fecha >='$fechainicio' ";}
    if($fechafin != null && $fechafin != "")
    { $where .= " AND iv.fecha <='$fechafin' ";}
    if($idmarca == null || $idmarca == 'null')
    { }else{$where .= " AND v.idmarca ='$idmarca' "; }
     $sql2 = "SELECT ".$select." FROM ".$from." WHERE ".$where." GROUP BY v.idmarca";
    $row = NumeroTuplas($sql2);
    $row1= $row['resultado'];
    $sql21 = getTablaToArrayOfSQL($sql2);
    $sql3 = $sql21['resultado'];
    $row5 = NumeroTuplas($sql2);
    $row15= $row5['resultado'];
    $html .= "<table cellpadding='0' cellspacing='0' border='0' style='width:1250px;border:0px solid #000000;font-size:13px;text-align:center'>";
    $html .= "<tr>";

    for($i=0;$i<=$row15;$i++){
        $codigo = $sql3[$i];
        $nombrecategoria = $codigo['nombre'];
         $idmarca = $codigo['idmarca'];
        $html .= "<tr style='width:100%; font-size:13px;'>";
        $html .=" <td style='font-size:14px;text-align:left'>";
        $html .=" </td> ";
        $html .= "</tr>";
        $html .= "<tr>";
        $select1 = "talla,idmodelo";
        $from1 = "tallasdetalle";
        $where1 = "talla >='$rango1' AND talla <='$rango2' AND idmodelo='2' ORDER BY talla ASC";
        $sql21 = "SELECT ".$select1." FROM ".$from1." WHERE ".$where1;
        $row = NumeroTuplas($sql21);
        $row1= $row['resultado'];

     $select = "em.idempleado as idvendedor";
    $from = "traspasosinternos iv,modelo md,ventas v,`marcas` mar, empleados em,empleados emo";
    $where = "iv.idventa=v.idventa and iv.idmodelo=md.idmodelo and v.idmarca=mar.idmarca and
iv.idvendedor=em.idempleado and iv.idvendedororigen=emo.idempleado and v.idalmacen='$idalmacen' and v.idmarca='$idmarca'";
    { $where .= " AND iv.fecha >='$fechainicio' ";}
    if($fechafin != null && $fechafin != "")
    { $where .= " AND iv.fecha <='$fechafin' ";}
//
//$select1 = " iv.idventa,iv.fecha,mar.nombre as marca,md.codigo as modelo,
//SUM(iv.saldocantidad) as totalpares,SUM(iv.preciounitario) as totalsus,em.nombres as vendidopor,emo.nombres as mercaderiade";
//$from1 = "traspasosinternos iv,modelo md,ventas v,`marcas` mar, empleados em,empleados emo";
//$where1 = " iv.idventa=v.idventa and iv.idmodelo=md.idmodelo and v.idmarca=mar.idmarca and
//iv.idvendedor=em.idempleado and iv.idvendedororigen=emo.idempleado and v.idalmacen='$idalmacen' and v.idmarca='$idmarca' and v.idvendedor='$idvendedor'";

$sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where." group by iv.idvendedor";
 $table = tablatraspasosinternos($idvendedor,$idmarca,$idkar,$sql25,$sql21,$row1,$nombrecategoria,$porcentajecat,$parestotalactualcategoria,$idalmacen,$rango1,$rango2,$totalparesestilo,$totalbsestilo, $tipo,$marcapedido,$fechainicio,$fechafin);
      $html .= $table['resultado'];
      
   }


    $html .= "</tr>";

    $html .= "</table>";

    $html .= "</td></tr>";

    $html .= "</tr>";
    $html .= "</table>";

    $html .= "</body>";
    $html .= "</html>";
    if($return == true)
    {
        return $html;
    }
    else
    {
        echo $html;
    }
}


function vertraspasointernoenviado($idmarca,$idvendedor,$fechainicio,$fechafin, $return)
{     $idalmacen=$_SESSION['idalmacen'];
    $html = "";
    $html .= "<tr><td colspan='4' align='center'>
    <p>Nova Moda S.RL.<br />
         <br />
         Telf. 4-258993  Fax: 4-504183
    </p>
</td></tr>";
    $html .= "<!DOCTYPE HTML PUBLIC '-//W3C//DTD HTML 4.01 Transitional//EN'>";
    $html .= "<html>";
    $html .= "<body>";
    $html .= "<tr>";
    $html .= "<table cellpadding='1' cellspacing='0' border='0' style='width:100%' font-size:11px; font-family:Tahoma;'>";
    $html .= "<td style='width:100%;height:100%;text-align:right;font-size:12px;font-family:Tahoma;'>";
    $html .= "$fecha  $tipo";
    $html .= "</td>";
    $html .= "<tr>";
      $sql = "SELECT codigo,CONCAT( nombres,'/',apellidos) AS vendedor FROM  empleados WHERE idempleado = '$idvendedor'";
    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'vendedor');
    $vendedor = $idalmacenA2['resultado'];


    $sql = "SELECT ma.nombre AS marca,ma.talla,ma.opcionb,ma.pedido FROM  `marcas` ma WHERE ma.idmarca = '$idmarca'";
    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'marca');
    $marcalista = $idalmacenA2['resultado'];
    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'talla');
    $opcionmarca = $idalmacenA2['resultado'];
    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'opcionb');
    $opcionb = $idalmacenA2['resultado'];
    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'pedido');
    $marcapedido = $idalmacenA2['resultado'];
    $idsCAr = split("-", $opcionmarca);
    $rango1=$idsCAr[0];
    $rango2=$idsCAr[1];
    if($opcionmarca="33-45"){
        $tipo="1";
    }else{
        if($opcionmarca="14-38"){
            $tipo="3";
        }
    }
    $sqlmarca = " SELECT idkardex FROM administrakardex WHERE idkardex = '$idkardex' group by mesrango";
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "idkardex");
    $idkar = $opcionkardex['resultado'];


    //$html .= "<b><u>INVENTARIO $marcalista</u></b><br>";
    $sqlmarca = " SELECT nombre FROM almacenes WHERE idalmacen = '$idalmacen' ";

    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "nombre");
    $deptocapital = $opcionkardex['resultado'];

    $html .= "<td style='width:100%;height:50px;text-align:center;font-size:15px;font-family:Tahoma;'>";
    $html .= "<b><u>TRASPASOS INTERNOS ENVIADOS </u></b><br>";

    //     $html .= "Tienda $tienda";
    $html .= "</td>";
    $html .= "</tr>";
    $html .= "</table>";
    $html .= "</tr>";
    $html .= "<tr>";
    $html .= "<td colspan='3'>";

    $html .= "<table width='1250' border='0' cellspacing='0' cellpadding='0'><tr>";



  $select = "v.idmarca,m.nombre";
    $from = "traspasosinternos iv,modelo md,ventas v,marcas m";
    $where = "iv.idventa=v.idventa and iv.idmodelo=md.idmodelo and md.idmarca=m.idmarca and iv.idalmacen='$idalmacen' ";
    { $where .= " AND iv.fecha >='$fechainicio' ";}
    if($fechafin != null && $fechafin != "")
    { $where .= " AND iv.fecha <='$fechafin' ";}
    if($idmarca == null || $idmarca == 'null')
    { }else{$where .= " AND v.idmarca ='$idmarca' "; }
     $sql2 = "SELECT ".$select." FROM ".$from." WHERE ".$where." GROUP BY v.idmarca";
  //   echo $sql2;
    $row = NumeroTuplas($sql2);
    $row1= $row['resultado'];
    $sql21 = getTablaToArrayOfSQL($sql2);
    $sql3 = $sql21['resultado'];
    $row5 = NumeroTuplas($sql2);
    $row15= $row5['resultado'];
    $html .= "<table cellpadding='0' cellspacing='0' border='0' style='width:1250px;border:0px solid #000000;font-size:13px;text-align:center'>";
    $html .= "<tr>";

    for($i=0;$i<=$row15;$i++){
        $codigo = $sql3[$i];
        $nombrecategoria = $codigo['nombre'];
         $idmarca = $codigo['idmarca'];
        $html .= "<tr style='width:100%; font-size:13px;'>";
        $html .=" <td style='font-size:14px;text-align:left'>";
        $html .=" </td> ";
        $html .= "</tr>";
        $html .= "<tr>";
        $select1 = "talla,idmodelo";
        $from1 = "tallasdetalle";
        $where1 = "talla >='$rango1' AND talla <='$rango2' AND idmodelo='2' ORDER BY talla ASC";
        $sql21 = "SELECT ".$select1." FROM ".$from1." WHERE ".$where1;
        $row = NumeroTuplas($sql21);
        $row1= $row['resultado'];

//     $select = "em.idempleado as idvendedor";
//    $from = "traspasosinternos iv,modelo md,ventas v,`marcas` mar, empleados em,empleados emo";
//    $where = "iv.idventa=v.idventa and iv.idmodelo=md.idmodelo and v.idmarca=mar.idmarca and
//iv.idvendedor=em.idempleado and iv.idvendedororigen=emo.idempleado and v.idalmacen='$idalmacen' and v.idmarca='$idmarca'";
//    { $where .= " AND iv.fecha >='$fechainicio' ";}
//    if($fechafin != null && $fechafin != "")
//    { $where .= " AND iv.fecha <='$fechafin' ";}

  $select = "emo.idempleado as idvendedor";
    $from = "traspasosinternos iv,modelo md,ventas v,`marcas` mar, empleados em,empleados emo";
    $where = "iv.idventa=v.idventa and iv.idmodelo=md.idmodelo and v.idmarca=mar.idmarca and
iv.idvendedor=em.idempleado and iv.idvendedororigen=emo.idempleado and v.idalmacen='$idalmacen' and v.idmarca='$idmarca'";
    { $where .= " AND iv.fecha >='$fechainicio' ";}
    if($fechafin != null && $fechafin != "")
    { $where .= " AND iv.fecha <='$fechafin' ";}

$sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where." group by iv.idvendedororigen";
// $table = tablatraspasosinternos($idvendedor,$idmarca,$idkar,$sql25,$sql21,$row1,$nombrecategoria,$porcentajecat,$parestotalactualcategoria,$idalmacen,$rango1,$rango2,$totalparesestilo,$totalbsestilo, $tipo,$marcapedido,$fechainicio,$fechafin);
//      $html .= $table['resultado'];
 $table = tablatraspasosinternosenviado($idvendedor,$idmarca,$idkar,$sql25,$sql21,$row1,$nombrecategoria,$porcentajecat,$parestotalactualcategoria,$idalmacen,$rango1,$rango2,$totalparesestilo,$totalbsestilo, $tipo,$marcapedido,$fechainicio,$fechafin);
      $html .= $table['resultado'];

   }


    $html .= "</tr>";

    $html .= "</table>";

    $html .= "</td></tr>";

    $html .= "</tr>";
    $html .= "</table>";

    $html .= "</body>";
    $html .= "</html>";
    if($return == true)
    {
        return $html;
    }
    else
    {
        echo $html;
    }
}

function habilitaciones($idmarca,$idvendedor,$fechainicio,$fechafin, $return)
{
    //echo "hola";
    $idalmacen=$_SESSION['idalmacen'];
    $fecha1 = $fechainicio;

    $fecha2 = $fechafin;

    //echo $fechainicio;
    $empresa=strtoupper($empresa1);
    $fecha22= split("-", $fechainicio);
    $y=$fecha22[0];
    $m=$fecha22[1];
    $d=$fecha22[2];
    $fechaini=$d."-".$m."-".$y;

    $fecha221= split("-", $fechafin);
    $y2=$fecha221[0];
    $m2=$fecha221[1];
    $d2=$fecha221[2];
    $fechafinn=$d2."-".$m2."-".$y2;
    $html = "";
    $html .= "<tr><td colspan='4' align='center'>
     <p>NOVA MODA SRL<br />
         Telf. 4-258993  Fax: 4-504183
    </p>
</td></tr>";
    $html .= "<!DOCTYPE HTML PUBLIC '-//W3C//DTD HTML 4.01 Transitional//EN'>";
    $html .= "<html>";
    $html .= "<body>";
    $html .= "<tr>";

    $html .= "<table cellpadding='1' cellspacing='0' border='0' style='width:110%' font-size:11px; font-family:Tahoma;'>";
    $html .= "<td style='width:110%;height:100%;text-align:right;font-size:12px;font-family:Tahoma;'>";
    $html .= "$fecha  $tipo";
    $html .= "</td>";
    $html .= "<tr>";

    //$html .= "<tr style='width:100%height:100px;text-align:center;font-size:15px;font-family:Tahoma;'>";
    $html .= "<td style='width:110%;height:100px;text-align:center;font-size:15px;font-family:Tahoma;'>";
    $html .= "HABILITACIONES DE PARES POR MAL LEVANTE DE INVENTARIO<br>";
    $html .= " DEL $fechaini AL $fechafinn<br>";
    $html .= "</td>";
    $html .= "</tr>";
    $html .= "</table>";
    $html .= "</tr>";
    $html .= "<tr>";
    $html .= "<td colspan='3'>";
    //    $html .= "<table width='1250' border='0' cellspacing='0' cellpadding='0'><tr>";

    //$table = dibujarTablamodelosventa($sql25,$idtienda,$idvendedor,$codigoempleado,$nombreempleado,$fechainicio,$fechafin);
    $html .= "<table width='1250' border='0' cellspacing='0' cellpadding='0'><tr>";

    //    $html .= "<td style='width:100%;text-align:center;font-size:1px;font-family:Tahoma;'>";
    $html .= "<table cellpadding='0' cellspacing='0' border='0' style='width:100%;border:0px solid #000000;font-size:11px;text-align:center'>";
    $html .= "<tr>";

    $html .= "<tr style='width:100%; font-size:11px;'>";
    $html .=" </td> ";
    $html .= "</tr>";
    $html .= "<tr>";
    //    echo $idmarca;


    $select = "v.idmarca";
    $from = "pareshabilitados v,empleados e";
    $where = "v.idvendedor=e.idempleado and e.idalmacen='$idalmacen' ";
    { $where .= " AND v.fecha >='$fechainicio' ";}
    if($fechafin != null && $fechafin != "")
    { $where .= " AND v.fecha <='$fechafin' ";}
    if($idmarca == null || $idmarca == 'null')
    { }else{$where .= " AND v.idmarca ='$idmarca' "; }

    $sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where." GROUP BY v.idmarca";

    //$table = dibujarTablaOfvENTAS($sql25,$idtienda,$idempleado,$codigoempleado,$nombreempleado,$fechainicio,$fechafin);
    $table = dibujarTablamodeloshabilitados($sql25,$idtienda,$idvendedor,$codigoempleado,$nombreempleado,$fechainicio,$fechafin);

    $html .= $table['resultado'];
    $html .= "</tr>";

    //totales de totales,
    $html .= "</tr>";
    $html .= "</table>";



    $html .= "<tr>";
    $html .= "<td style='width:100%;text-align:left;font-size:14px;font-family:Tahoma;'>";
    $html .= "<table cellpadding='0' cellspacing='0' border='0' style='width:100%;border:1px solid #000000;font-size:14px;'>";
    $html .= "<tr><td style='width:10%;font-weight:bold;'>TOTAL CAJAS:</td><td style='width:10%;text-align:center;border-left: 1px solid #000000;font-weight:bold;'>".$tcajas."</td><td style='width:10%;font-weight:bold;'>TOTAL PARES:</td><td style='width:10%;text-align:center;border-left: 1px solid #000000;font-weight:bold;'>".$tpares."</td><td style='width:10%;font-weight:bold;'>TOTAL SUS:</td><td style='width:10%;text-align:center;border-left: 1px solid #000000;font-weight:bold;'>".$tsus."</td></tr>";
    $html .= "</table>";
    $html .= "</td></tr>";
    $html .= "</tr>";
    $html .= "</table>";
    $html .= "</td></tr>";
    $html .= "</table>";
    $html .= "</td></tr>";
    $html .= "</tr>";
    $html .= "</table>";
    $html .= "</body>";
    $html .= "</html>";
    if($return == true)
    {
        return $html;
    }
    else
    {
        echo $html;
    }
}

function eliminacionesbit($idmarca,$idvendedor,$fechainicio,$fechafin, $return)
{
    //echo "hola";
    $idalmacen=$_SESSION['idalmacen'];
    $fecha1 = $fechainicio;

    $fecha2 = $fechafin;

    //echo $fechainicio;
    $empresa=strtoupper($empresa1);
    $fecha22= split("-", $fechainicio);
    $y=$fecha22[0];
    $m=$fecha22[1];
    $d=$fecha22[2];
    $fechaini=$d."-".$m."-".$y;

    $fecha221= split("-", $fechafin);
    $y2=$fecha221[0];
    $m2=$fecha221[1];
    $d2=$fecha221[2];
    $fechafinn=$d2."-".$m2."-".$y2;
    $html = "";
    $html .= "<tr><td colspan='4' align='center'>
     <p>NOVA MODA SRL<br />
         Telf. 4-258993  Fax: 4-504183
    </p>
</td></tr>";
    $html .= "<!DOCTYPE HTML PUBLIC '-//W3C//DTD HTML 4.01 Transitional//EN'>";
    $html .= "<html>";
    $html .= "<body>";
    $html .= "<tr>";

    $html .= "<table cellpadding='1' cellspacing='0' border='0' style='width:110%' font-size:11px; font-family:Tahoma;'>";
    $html .= "<td style='width:110%;height:100%;text-align:right;font-size:12px;font-family:Tahoma;'>";
    $html .= "$fecha  $tipo";
    $html .= "</td>";
    $html .= "<tr>";

    //$html .= "<tr style='width:100%height:100px;text-align:center;font-size:15px;font-family:Tahoma;'>";
    $html .= "<td style='width:110%;height:100px;text-align:center;font-size:15px;font-family:Tahoma;'>";
    $html .= "ELIMINACIONES MODELO<br>";
    $html .= " DEL $fechaini AL $fechafinn<br>";
    $html .= "</td>";
    $html .= "</tr>";
    $html .= "</table>";
    $html .= "</tr>";
    $html .= "<tr>";
    $html .= "<td colspan='3'>";
    //    $html .= "<table width='1250' border='0' cellspacing='0' cellpadding='0'><tr>";

    //$table = dibujarTablamodelosventa($sql25,$idtienda,$idvendedor,$codigoempleado,$nombreempleado,$fechainicio,$fechafin);
    $html .= "<table width='1250' border='0' cellspacing='0' cellpadding='0'><tr>";

    //    $html .= "<td style='width:100%;text-align:center;font-size:1px;font-family:Tahoma;'>";
    $html .= "<table cellpadding='0' cellspacing='0' border='0' style='width:100%;border:0px solid #000000;font-size:11px;text-align:center'>";
    $html .= "<tr>";

    $html .= "<tr style='width:100%; font-size:11px;'>";
    $html .=" </td> ";
    $html .= "</tr>";
    $html .= "<tr>";
    //    echo $idmarca;


    $select = "v.idmarca";
    $from = "pareshabilitados v,empleados e";
    $where = "v.idvendedor=e.idempleado and e.idalmacen='$idalmacen' ";
    { $where .= " AND v.fecha >='$fechainicio' ";}
    if($fechafin != null && $fechafin != "")
    { $where .= " AND v.fecha <='$fechafin' ";}
    if($idmarca == null || $idmarca == 'null')
    { }else{$where .= " AND v.idmarca ='$idmarca' "; }

    $sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where." GROUP BY v.idmarca";

    //$table = dibujarTablaOfvENTAS($sql25,$idtienda,$idempleado,$codigoempleado,$nombreempleado,$fechainicio,$fechafin);
    $table = dibujarTablamodeloshabilitados($sql25,$idtienda,$idvendedor,$codigoempleado,$nombreempleado,$fechainicio,$fechafin);

    $html .= $table['resultado'];
    $html .= "</tr>";

    //totales de totales,
    $html .= "</tr>";
    $html .= "</table>";



    $html .= "<tr>";
    $html .= "<td style='width:100%;text-align:left;font-size:14px;font-family:Tahoma;'>";
    $html .= "<table cellpadding='0' cellspacing='0' border='0' style='width:100%;border:1px solid #000000;font-size:14px;'>";
    $html .= "<tr><td style='width:10%;font-weight:bold;'>TOTAL CAJAS:</td><td style='width:10%;text-align:center;border-left: 1px solid #000000;font-weight:bold;'>".$tcajas."</td><td style='width:10%;font-weight:bold;'>TOTAL PARES:</td><td style='width:10%;text-align:center;border-left: 1px solid #000000;font-weight:bold;'>".$tpares."</td><td style='width:10%;font-weight:bold;'>TOTAL SUS:</td><td style='width:10%;text-align:center;border-left: 1px solid #000000;font-weight:bold;'>".$tsus."</td></tr>";
    $html .= "</table>";
    $html .= "</td></tr>";
    $html .= "</tr>";
    $html .= "</table>";
    $html .= "</td></tr>";
    $html .= "</table>";
    $html .= "</td></tr>";
    $html .= "</tr>";
    $html .= "</table>";
    $html .= "</body>";
    $html .= "</html>";
    if($return == true)
    {
        return $html;
    }
    else
    {
        echo $html;
    }
}

function dibujarTablaOfvendedor($sql,$idtienda,$idvendedor,$idmarca,$codigoempleado,$nombreempleado,$fechainicio,$fechafin)
{
    $idalmacen=$_SESSION['idalmacen'];
    if($link=new BD)
    {
        if($link->conectar())
        {
            if($re = $link->consulta($sql))
            {
                //echo mysql_num_rows($re);
                if($fi = mysql_fetch_array($re))
                {
                    $devS .= "<table cellpadding='0' cellspacing='0' border='0' style='width:100%;border:1px solid #000000;font-size:13px;'>";
                    $devS .= "<tr><td colspan='".(mysql_num_fields($re)+1)."' style='border-bottom:1px solid #000000;font-weight:bold;font-size:16px;text-align:left;'>$nombreempleado</td></tr>";
                    $devS .= "</tr>";
                    $ii = 0;
                    $z = 1;
                    $totalcajas=0;
                    $totalpares=0;
                    $totalsus=0;
                    do{
                        for($i = 0; $i< mysql_num_fields($re); $i++)
                        {$dato = $fi[$i];
                            $idvendedor = $dato;
                            $sql2 = "SELECT CONCAT( UPPER(cli.nombres), '-', UPPER(cli.apellidos) )AS nombre FROM empleados cli WHERE cli.idempleado = '$idvendedor'";
                            $idalmacenA =  findBySqlReturnCampoUnique($sql2, true, true, 'nombre');
                            $empresa1 = $idalmacenA['resultado'];
                            $empresa=strtoupper($empresa1);
                            //oodfjodf

                            $select1 = " date_format(v.fecha,'%d/%m/%Y') AS Fecha, CONCAT( UPPER(cli.nombre), '-', UPPER(cli.apellido) )AS Cliente,
                                        mar.nombre as marca, v.tcajas,SUM(iv.cantidad) as totalpares, SUM(iv.precioventa) as totalsus,
                                        (v.montoapagar - SUM(iv.precioventa)) as descincr, v.montoapagar";
                            $from1 = "ventas v, ventaitem iv,`marcas` mar, clientes cli, almacenes a, empleados em";
                            $where1 = " iv.idventa = v.idventa and v.idmarca = mar.idmarca and v.idcliente = cli.idcliente and v.idalmacen = a.idalmacen and
                                        v.idvendedor = em.idempleado  and v.idalmacen = '$idalmacen' and v.idvendedor = '$idvendedor' ";
                            { $where1 .= " AND v.fecha >= '$fechainicio' ";}
                            if($fechafin != null && $fechafin != "")
                            { $where1 .= " AND v.fecha <= '$fechafin' ";}
                            if($idmarca == null || $idmarca == 'null')
                            { }
                            else{$where1 .= " AND v.idmarca = '$idmarca' "; }

                            $sqlruta = "SELECT ".$select1." FROM ".$from1. " WHERE ".$where1." group by iv.idventa ORDER by Fecha";
                            //echo $sqlruta;
                            $select1 = "SUM(iv.cantidad) AS pares";
                            $from = "ventas v, ventaitem iv, marcas mar, clientes cli, almacenes a, empleados em";
                            $where = "iv.idventa = v.idventa and v.idmarca = mar.idmarca and v.idcliente = cli.idcliente and v.idalmacen = a.idalmacen and
                                      v.idvendedor = em.idempleado  and v.idalmacen = '$idalmacen' and v.idvendedor = '$idvendedor'";
                            { $where .= " AND v.fecha >= '$fechainicio' ";}
                            if($fechafin != null && $fechafin != "")
                            { $where .= " AND v.fecha <= '$fechafin' ";}
                            if($idmarca == null || $idmarca == 'null')
                            { }
                            else{$where .= " AND v.idmarca ='$idmarca' "; }

                            //$select1 = "SELECT SUM(v.totalpares) AS cajas";
                            $select2 = "SUM(iv.precioventa) AS sus";
                            //$select3 = "SUM(v.descuento) AS sus";                            

                            $sql4112 = "SELECT ".$select1." FROM ".$from. " WHERE ".$where." ";
                            $creditoA111 = findBySqlReturnCampoUnique($sql4112, true, true, "pares");
                            $tpares = $creditoA111['resultado'];

                            $sql12 = "SELECT ".$select2." FROM ".$from. " WHERE ".$where." ";
                            $creditoA111 = findBySqlReturnCampoUnique($sql12, true, true, "sus");
                            $tsus = $creditoA111['resultado'];
                            //$sql41 = "SELECT ".$select3." FROM ".$from. " WHERE ".$where." ";
                            //$creditoA111 = findBySqlReturnCampoUnique($sql41, true, true, "sus");
                            //$tdesc = $creditoA111['resultado'];
                            $select4 = "SUM(v.montoapagar) AS sus";
                            $from = "ventas v, marcas mar, clientes cli, almacenes a, empleados em";
                            $where = "v.idmarca = mar.idmarca and v.idcliente = cli.idcliente and v.idalmacen = a.idalmacen and
                                      v.idvendedor = em.idempleado and v.idalmacen = '$idalmacen' and v.idvendedor = '$idvendedor'";
                            { $where .= " AND v.fecha >= '$fechainicio' ";}
                            if($fechafin != null && $fechafin != "")
                            { $where .= " AND v.fecha <= '$fechafin' ";}
                            if($idmarca == null || $idmarca == 'null')
                            { }
                            else{$where .= " AND v.idmarca ='$idmarca' "; }
                            $sql4 = "SELECT ".$select4." FROM ".$from. " WHERE ".$where." ";
                            $creditoA111 = findBySqlReturnCampoUnique($sql4, true, true, "sus");
                            $tmonto = $creditoA111['resultado'];
                            $tdesc = round(($tmonto-$tsus),2);
                            $tcajas = $tpares/12;
                            $tcajas = round($tcajas,2);
                            $totalcajas = $totalcajas + $tcajas;
                            $totalpares = $totalpares + $tpares;
                            $totalsus = $totalsus + $tsus;
                            $table = dibujarTablaparaventascredito($sqlruta, $empresa,$tcajas,$tpares,$tsus,$tdesc,$tmonto);
                            $devS .= $table['resultado'];

                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$stockanterior."&nbsp;</td>";

                        }
                        $devS .= "</tr>";
                        $ii++;
                        $z ++;
                    }while($fi = mysql_fetch_array($re));
                    $devS .= "<tr>";
                    $devS .= "<td style='width:100%;text-align:left;font-size:14px;font-family:Tahoma;'>";
                    $devS .= "<table cellpadding='0' cellspacing='0' border='0' style='width:100%;border:1px solid #000000;font-size:14px;'>";
                    $devS .= "<tr><td style='width:10%;font-weight:bold;'>TOTAL CAJAS:</td><td style='width:10%;text-align:center;border-left: 1px solid #000000;font-weight:bold;'>".$totalcajas."</td><td style='width:10%;font-weight:bold;'>TOTAL PARES:</td><td style='width:10%;text-align:center;border-left: 1px solid #000000;font-weight:bold;'>".$totalpares."</td><td style='width:10%;font-weight:bold;'>TOTAL SUS:</td><td style='width:10%;text-align:center;border-left: 1px solid #000000;font-weight:bold;'>".$totalsus."</td></tr>";
                    $devS .= "</table>";
                    $devS .= "</td></tr>";
                    $devS .= "</tr>";

                    //$sql4111 = "SELECT SUM(monto) AS totaldeuda FROM pagocredito WHERE tipopago='ingreso' AND idtienda='$idempleado' AND fecha >='$fechainicio' AND fecha <='$fechafin'";
                    //$creditoA1111 = findBySqlReturnCampoUnique($sql4111, true, true, "totaldeuda");
                    //$totalcomisioncobrado = $creditoA1111['resultado'];

                    //if($totalcomisioncobrado==NULL || $totalcomisioncobrado =='' || $totalcomisioncobrado == ""){ $totalcomisioncobrado="0.00"; }

                    $devS .= "</table>";

                    $dev['mensaje'] = "Existen resultados";
                    $dev['error']   = "true";
                    $dev['resultado'] = $devS;

                }
                else
                {
                    $dev['mensaje'] = "No se encontro datos en la consulta2".mysql_error();
                    $dev['error']   = "false";
                    $dev['resultado'] = "";
                }
            }
            else
            {
                $dev['mensaje'] = "Error en la consulta";
                $dev['error']   = "false";
                $dev['resultado'] = "";
            }
        }
        else
        {
            $dev['mensaje'] = "No se pudo conectar a la BD";
            $dev['error']   = "false";
            $dev['resultado'] = "";
        }
    }
    else
    {
        $dev['mensaje'] = "No se pudo crear la conexion a la BD";
        $dev['error']   = "false";
        $dev['resultado'] = "";
    }
    return $dev;
}

function dibujarTablaOfvENTAS($sql,$idtienda,$idvendedor,$codigoempleado,$nombreempleado,$fechainicio,$fechafin)
{
    $idalmacen=$_SESSION['idalmacen'];
    if($link=new BD)
    {
        if($link->conectar())
        {
            if($re = $link->consulta($sql))
            {
                //echo mysql_num_rows($re);
                if($fi = mysql_fetch_array($re))
                {
                    $devS .= "<table cellpadding='0' cellspacing='0' border='0' style='width:100%;border:1px solid #000000;font-size:13px;'>";
                    $devS .= "<tr><td colspan='".(mysql_num_fields($re)+1)."' style='border-bottom:1px solid #000000;font-weight:bold;font-size:16px;text-align:left;'>$nombreempleado</td></tr>";
                    $devS .= "</tr>";
                    $ii = 0;
                    $z = 1;
                    $totalcajas=0;
                    $totalpares=0;
                    $totalsus=0;
                    do{
                        for($i = 0; $i< mysql_num_fields($re); $i++)
                        {$dato = $fi[$i];
                            $idmarca = $dato;
                            $sql2 = "SELECT nombre FROM marcas WHERE idmarca = '$idmarca'";
                            $idalmacenA =  findBySqlReturnCampoUnique($sql2, true, true, 'nombre');
                            $empresa1 = $idalmacenA['resultado'];
                            $empresa=strtoupper($empresa1);

                            $select1 = " date_format(v.fecha,'%d/%m/%Y') AS Fecha, CONCAT( UPPER(cli.nombre), '-', UPPER(cli.apellido) )AS Cliente,
                                        CONCAT( UPPER(em.nombres), '-', UPPER(em.apellidos) )AS Vendedor,v.tcajas, SUM(iv.cantidad) AS totalpares,
                                        SUM(iv.precioventa) AS totalsus, (v.montoapagar-SUM(iv.precioventa)) as descincr, v.montoapagar";
                            //v.fechacancelacion,v.estado,mar.nombre as marca";
                            $from1 = "ventas v, ventaitem iv, marcas mar, clientes cli, almacenes a, empleados em";
                            $where1 = " iv.idventa = v.idventa and v.idmarca = mar.idmarca and v.idcliente = cli.idcliente and v.idalmacen = a.idalmacen and
                                        v.idvendedor = em.idempleado and v.idalmacen = '$idalmacen' and v.idmarca = '$idmarca' ";
                            if($idvendedor == null || $idvendedor == 'null' || $idvendedor != "null")
                            { }else{$where1 .= " AND v.idvendedor ='$idvendedor' "; }

                            if($fechainicio != null && $fechainicio != "")

                            { $where1 .= " AND v.fecha >='$fechainicio' ";}
                            if($fechafin != null && $fechafin != "")
                            { $where1 .= " AND v.fecha <='$fechafin' ";}


                            $sqlruta = "SELECT ".$select1." FROM ".$from1. " WHERE ".$where1." GROUP by iv.idventa ORDER by FEcha";

                            $select1 = "SUM(iv.cantidad) AS pares";
                            $from = "ventas v,ventaitem iv,marcas mar, clientes cli,almacenes a,empleados em";
                            $where = "iv.idventa=v.idventa and v.idmarca=mar.idmarca and v.idcliente=cli.idcliente and v.idalmacen=a.idalmacen and
                                      v.idvendedor = em.idempleado  and v.idalmacen = '$idalmacen' and v.idmarca='$idmarca'";
                            if($idvendedor == null || $idvendedor == 'null' || $idvendedor != "null")
                            { }else{$where .= " AND v.idvendedor ='$idvendedor' "; }
                            if($fechainicio != null && $fechainicio != "")
                            { $where .= " AND v.fecha >='$fechainicio' ";}
                            if($fechafin != null && $fechafin != "")
                            { $where .= " AND v.fecha <='$fechafin' ";}
                            //$select1 = "SELECT SUM(v.totalpares) AS cajas";
                            $select2 = "SUM(iv.precioventa) AS sus";
                            ////$select3 = "SUM(v.descuento) AS sus";


                            //$tcajas = 0;  $tpares = 0;  $tsus = 0;  $tmonto = 0;  $tdesc = 0;
                            $sql4112 = "SELECT ".$select1." FROM ".$from. " WHERE ".$where." ";
                            //echo "pares $sql4112";
                            $creditoA111 = findBySqlReturnCampoUnique($sql4112, true, true, "pares");
                            $tpares = $creditoA111['resultado'];
                            //echo"pares $tpares";
                            $sql12 = "SELECT ".$select2." FROM ".$from. " WHERE ".$where." ";
                            //echo "sus $sql12";
                            $creditoA111 = findBySqlReturnCampoUnique($sql12, true, true, "sus");
                            $tsus = $creditoA111['resultado'];
                            //echo"sus $tsus";
                            ////$sql41 = "SELECT ".$select3." FROM ".$from. " WHERE ".$where." ";
                            ////$creditoA111 = findBySqlReturnCampoUnique($sql41, true, true, "sus");
                            ////$tdesc = $creditoA111['resultado'];
                            $select4 = "SUM(v.montoapagar) AS monto";
                            $from = "ventas v,marcas mar, clientes cli,almacenes a,empleados em";
                            $where = "v.idmarca=mar.idmarca and v.idcliente=cli.idcliente and v.idalmacen=a.idalmacen and
                                      v.idvendedor=em.idempleado  and v.idalmacen='$idalmacen' and v.idmarca='$idmarca'";
                            if($idvendedor == null || $idvendedor == 'null' || $idvendedor != "null")
                            { }else{$where .= " AND v.idvendedor ='$idvendedor' "; }
                            if($fechainicio != null && $fechainicio != "")
                            { $where .= " AND v.fecha >='$fechainicio' ";}
                            if($fechafin != null && $fechafin != "")
                            { $where .= " AND v.fecha <='$fechafin' ";}

                            $sql4 = "SELECT ".$select4." FROM ".$from. " WHERE ".$where." ";
                            //echo "montoapagar $sql4";
                            $creditoA111 = findBySqlReturnCampoUnique($sql4, true, true, "monto");
                            $tmonto = $creditoA111['resultado'];
                            //echo "monto $tmonto";
                            $tdesc = round(($tmonto-$tsus),2);
                            //echo "desc $tdesc";
                            $tcajas = $tpares/12;
                            $tcajas = round($tcajas,2);
                            $totalcajas = $totalcajas + $tcajas;
                            $totalpares = $totalpares + $tpares;
                            $totalsus = $totalsus + $tsus;

                            $table = dibujarTablaparaventascredito($sqlruta, $empresa,$tcajas,$tpares,$tsus,$tdesc,$tmonto);
                            $devS .= $table['resultado'];

                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$stockanterior."&nbsp;</td>";

                        }
                        $devS .= "</tr>";
                        $ii++;
                        $z ++;
                    }while($fi = mysql_fetch_array($re));
                    $devS .= "<tr>";
                    $devS .= "<td style='width:100%;text-align:left;font-size:14px;font-family:Tahoma;'>";
                    $devS .= "<table cellpadding='0' cellspacing='0' border='0' style='width:100%;border:1px solid #000000;font-size:14px;'>";
                    $devS .= "<tr><td style='width:10%;font-weight:bold;'>TOTAL CAJAS:</td><td style='width:10%;text-align:center;border-left: 1px solid #000000;font-weight:bold;'>".$totalcajas."</td><td style='width:10%;font-weight:bold;'>TOTAL PARES:</td><td style='width:10%;text-align:center;border-left: 1px solid #000000;font-weight:bold;'>".$totalpares."</td><td style='width:10%;font-weight:bold;'>TOTAL SUS:</td><td style='width:10%;text-align:center;border-left: 1px solid #000000;font-weight:bold;'>".$totalsus."</td></tr>";
                    $devS .= "</table>";
                    $devS .= "</td></tr>";
                    $devS .= "</tr>";
//                    $sql4111 = "SELECT SUM(monto) AS totaldeuda FROM pagocredito WHERE tipopago='ingreso' AND idtienda='$idempleado' AND fecha >='$fechainicio' AND fecha <='$fechafin'";
//                    $creditoA1111 = findBySqlReturnCampoUnique($sql4111, true, true, "totaldeuda");
//                    $totalcomisioncobrado = $creditoA1111['resultado'];

//                    if($totalcomisioncobrado==NULL || $totalcomisioncobrado =='' || $totalcomisioncobrado == ""){ $totalcomisioncobrado="0.00"; }

                    $devS .= "</table>";

                    $dev['mensaje'] = "Existen resultados";
                    $dev['error']   = "true";
                    $dev['resultado'] = $devS;

                }
                else
                {
                    $dev['mensaje'] = "No se encontro datos en la consulta2".mysql_error();
                    $dev['error']   = "false";
                    $dev['resultado'] = "";
                }
            }
            else
            {
                $dev['mensaje'] = "Error en la consulta";
                $dev['error']   = "false";
                $dev['resultado'] = "";
            }
        }
        else
        {
            $dev['mensaje'] = "No se pudo conectar a la BD";
            $dev['error']   = "false";
            $dev['resultado'] = "";
        }
    }
    else
    {
        $dev['mensaje'] = "No se pudo crear la conexion a la BD";
        $dev['error']   = "false";
        $dev['resultado'] = "";
    }
    return $dev;
}

function dibujarTablaOfvENTASmodelo($sql,$idmarca,$idtienda,$idvendedor,$codigoempleado,$nombreempleado,$fechainicio,$fechafin)
{
    $idalmacen=$_SESSION['idalmacen'];
    if($link=new BD)
    {
        if($link->conectar())
        {
            if($re = $link->consulta($sql))
            {
                //echo mysql_num_rows($re);
                if($fi = mysql_fetch_array($re))
                {
                    $devS .= "<table cellpadding='0' cellspacing='0' border='0' style='width:100%;border:1px solid #000000;font-size:13px;'>";
                    $devS .= "<tr><td colspan='".(mysql_num_fields($re)+1)."' style='border-bottom:1px solid #000000;font-weight:bold;font-size:16px;text-align:left;'>$nombreempleado</td></tr>";
                    $devS .= "</tr>";
                    $ii = 0;
                    $z = 1;
                    $totalcajas=0;
                    $totalpares=0;
                    $totalsus=0;
                    do{
                        for($i = 0; $i< mysql_num_fields($re); $i++)
                        {$dato = $fi[$i];
                            $idmarca = $dato;
                            $sql2 = "SELECT nombre FROM marcas WHERE idmarca = '$idmarca'";
                            $idalmacenA =  findBySqlReturnCampoUnique($sql2, true, true, 'nombre');
                            $empresa1 = $idalmacenA['resultado'];
                            $empresa=strtoupper($empresa1);

                            $select1 = " date_format(v.fecha,'%d/%m/%Y') AS Fecha,v.boleta,m.fechaingreso as proforma,
CONCAT( UPPER(cli.nombre), '-', UPPER(cli.apellido) )AS Cliente,CONCAT( UPPER(em.nombres), '-', UPPER(em.apellidos) )AS Vendedor,
v.tcajas,SUM(vi.cantidad) AS totalpares,v.totalsus,m.codigo as modelo ,m.color,m.material";
                            $from1 = "ventas v,`marcas` mar, clientes cli,empleados em,ventaitem vi,modelo m,kardexdetallepar kp";
                            $where1 = " v.idmarca=mar.idmarca and v.idventa=vi.idventa and vi.idkardexunico=kp.idkardexunico and vi.idmodelo=m.idmodelo and v.idcliente=cli.idcliente  and
v.idvendedor=em.idempleado  and v.idalmacen='$idalmacen' and v.idmarca='$idmarca' ";
                            { $where1 .= " AND v.fecha >='$fechainicio' ";}
                            if($fechafin != null && $fechafin != "")
                            { $where1 .= " AND v.fecha <='$fechafin' ";}
                            if($idmarca == null || $idmarca == 'null')
                            { }else{$where1 .= " AND v.idmarca ='$idmarca' "; }
                            if($idvendedor == null || $idvendedor == 'null')
                            { }else{$where1 .= " AND v.idvendedor ='$idvendedor' "; }

                            //echo $idvendedor;

                            $sqlruta = "SELECT ".$select1." FROM ".$from1. " WHERE ".$where1."  GROUP BY vi.idmodelo ORDER by FEcha,v.boleta";
                            //echo $sqlruta;
                            $select1 = "SUM(v.totalpares) AS pares";
                            $from = "ventas v,`marcas` mar, clientes cli,almacenes a,empleados em";
                            $where = "v.idmarca=mar.idmarca and v.idcliente=cli.idcliente and v.idalmacen=a.idalmacen and
v.idvendedor=em.idempleado  and v.idalmacen='$idalmacen' and v.idmarca='$idmarca'";
                            { $where .= " AND v.fecha >='$fechainicio' ";}
                            if($fechafin != null && $fechafin != "")
                            { $where .= " AND v.fecha <='$fechafin' ";}
                            if($idvendedor == null || $idvendedor == 'null' || $idvendedor != "null")
                            { }else{$where .= " AND v.idvendedor ='$idvendedor' "; }
                            //$select1 = "SELECT SUM(v.totalpares) AS cajas";
                            // $select2 = " SUM(v.totalsus) AS sus";
                            $select2 = " SUM(iv.precioventa) AS sus";
                            $select3 = "SUM(v.descuento) AS sus";
                            $select4 = "SUM(v.montoapagar) AS sus";

                            $sql4112 = "SELECT ".$select1." FROM ".$from. " WHERE ".$where." ";
                            $creditoA111 = findBySqlReturnCampoUnique($sql4112, true, true, "pares");
                            $tpares = $creditoA111['resultado'];

                            $sql12 = "SELECT ".$select2." FROM ".$from. " WHERE ".$where." ";
                            $creditoA111 = findBySqlReturnCampoUnique($sql12, true, true, "sus");
                            $tsus = $creditoA111['resultado'];
                            $sql41 = "SELECT ".$select3." FROM ".$from. " WHERE ".$where." ";
                            $creditoA111 = findBySqlReturnCampoUnique($sql41, true, true, "sus");
                            $tdesc = $creditoA111['resultado'];
                            $sql4 = "SELECT ".$select4." FROM ".$from. " WHERE ".$where." ";
                            $creditoA111 = findBySqlReturnCampoUnique($sql4, true, true, "sus");
                            $tmonto = $creditoA111['resultado'];
                            $tcajas = $tpares/12;
                            $tcajas = round($tcajas,2);

                            $table = dibujarTablaparaventasmodelo($sqlruta, $empresa,$tcajas,$tpares,$tsus,$tdesc,$tmonto);
                            $devS .= $table['resultado'];

                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$stockanterior."&nbsp;</td>";

                        }
                        $devS .= "</tr>";
                        $ii++;
                        $z ++;
                    }while($fi = mysql_fetch_array($re));

                    $sql4111 = "SELECT SUM(monto) AS totaldeuda FROM pagocredito WHERE tipopago='ingreso' AND idtienda='$idempleado' AND fecha >='$fechainicio' AND fecha <='$fechafin'";
                    $creditoA1111 = findBySqlReturnCampoUnique($sql4111, true, true, "totaldeuda");
                    $totalcomisioncobrado = $creditoA1111['resultado'];

                    if($totalcomisioncobrado==NULL || $totalcomisioncobrado =='' || $totalcomisioncobrado == ""){ $totalcomisioncobrado="0.00"; }

                    $devS .= "</table>";

                    $dev['mensaje'] = "Existen resultados";
                    $dev['error']   = "true";
                    $dev['resultado'] = $devS;

                }
                else
                {
                    $dev['mensaje'] = "No se encontro datos en la consulta2".mysql_error();
                    $dev['error']   = "false";
                    $dev['resultado'] = "";
                }
            }
            else
            {
                $dev['mensaje'] = "Error en la consulta";
                $dev['error']   = "false";
                $dev['resultado'] = "";
            }
        }
        else
        {
            $dev['mensaje'] = "No se pudo conectar a la BD";
            $dev['error']   = "false";
            $dev['resultado'] = "";
        }
    }
    else
    {
        $dev['mensaje'] = "No se pudo crear la conexion a la BD";
        $dev['error']   = "false";
        $dev['resultado'] = "";
    }
    return $dev;
}
function dibujarTablaOfingresosmodelo($sql,$idmarca,$idtienda,$idvendedor,$codigoempleado,$nombreempleado,$fechainicio,$fechafin)
{
    $idalmacen=$_SESSION['idalmacen'];
    if($link=new BD)
    {
        if($link->conectar())
        {
            if($re = $link->consulta($sql))
            {
                //echo mysql_num_rows($re);
                if($fi = mysql_fetch_array($re))
                {
                    $devS .= "<table cellpadding='0' cellspacing='0' border='0' style='width:100%;border:1px solid #000000;font-size:13px;'>";
                    $devS .= "<tr><td colspan='".(mysql_num_fields($re)+1)."' style='border-bottom:1px solid #000000;font-weight:bold;font-size:16px;text-align:left;'>$nombreempleado</td></tr>";
                    $devS .= "</tr>";
                    $ii = 0;
                    $z = 1;
                    $totalcajas=0;
                    $totalpares=0;
                    $totalsus=0;
                    do{
                        for($i = 0; $i< mysql_num_fields($re); $i++)
                        {$dato = $fi[$i];
                            $idingreso = $dato;
                            $select = "vi.idmodelo";
                            $from = "modelo vi";
                            $where = "idingreso='$idingreso' Group by vi.idmodelo";
                            $sql25 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                            //revisar
                            //  echo $sql25;
                            //  $idkardex
                            $sqlmarca = " SELECT idkardex FROM administrakardex WHERE idalmacen = '$idalmacen' and estado='pendiente' ";
                            $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "tabla");
                            $idkardex = $opcionkardex['resultado'];
                            $sqlmarca = " SELECT formatomayor FROM marcas WHERE idmarca = '$idmarca'  ";
                            $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "formatomayor");
                            $formatomayor = $opcionkardex['resultado'];
                            $sqlmarca = " SELECT boleta,fecha FROM ingresoalmacen WHERE idingreso = '$idingreso'  ";
                            $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "boleta");
                            $boleta = $opcionkardex['resultado'];
                            $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "fecha");
                            $fecharegistro = $opcionkardex['resultado'];

                            $table = dibujarTablaitemingresopares($boleta,$fecharegistro,$idkardex,$sql25,$sql21,$row1,$idmarca,$rango1,$rango2,$total1,$total2,$idingreso,$formatomayor);
                            $devS .= $table['resultado'];

                            //   $table = dibujarTablaparaventasmodelo($sqlruta, $empresa,$tcajas,$tpares,$tsus,$tdesc,$tmonto);
                            //   $devS .= $table['resultado'];

                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$stockanterior."&nbsp;</td>";

                        }
                        $devS .= "</tr>";
                        $ii++;
                        $z ++;
                    }while($fi = mysql_fetch_array($re));

                    //   $sql4111 = "SELECT SUM(monto) AS totaldeuda FROM pagocredito WHERE tipopago='ingreso' AND idtienda='$idempleado' AND fecha >='$fechainicio' AND fecha <='$fechafin'";
                    //   $creditoA1111 = findBySqlReturnCampoUnique($sql4111, true, true, "totaldeuda");
                    //   $totalcomisioncobrado = $creditoA1111['resultado'];
                    //
                    //   if($totalcomisioncobrado==NULL || $totalcomisioncobrado =='' || $totalcomisioncobrado == ""){ $totalcomisioncobrado="0.00"; }

                    $devS .= "</table>";

                    $dev['mensaje'] = "Existen resultados";
                    $dev['error']   = "true";
                    $dev['resultado'] = $devS;

                }
                else
                {
                    $dev['mensaje'] = "No se encontro datos en la consulta2".mysql_error();
                    $dev['error']   = "false";
                    $dev['resultado'] = "";
                }
            }
            else
            {
                $dev['mensaje'] = "Error en la consulta";
                $dev['error']   = "false";
                $dev['resultado'] = "";
            }
        }
        else
        {
            $dev['mensaje'] = "No se pudo conectar a la BD";
            $dev['error']   = "false";
            $dev['resultado'] = "";
        }
    }
    else
    {
        $dev['mensaje'] = "No se pudo crear la conexion a la BD";
        $dev['error']   = "false";
        $dev['resultado'] = "";
    }
    return $dev;
}

function dibujarTablaitemingresopares($boleta,$fecharegistro,$idkardex,$sql,$sql21,$row1,$idmarca,$rango1,$rango2,$total1,$total2,$idingreso,$formatomayor)
{set_time_limit(0);
    $idalmacen = $_SESSION['idalmacen'];


    if($fechafin==null ||$fechafin == ""){
        $fechafin = Date("Y-m-d");
    }


    $sql211 = getTablaToArrayOfSQL($sql21);
    $sql3 = $sql211['resultado'];
    if($link=new BD)
    {
        if($link->conectar())
        {
            if($re = $link->consulta($sql))
            {
                //echo mysql_num_rows($re);
                if($fi = mysql_fetch_array($re))
                {
                    $devS .= "<table cellpadding='0' cellspacing='0' border='0' style='width:750px;border:1px solid #000000;font-size:13px;font-family:Arial;'>";

                    //                    $devS .= "<table cellpadding='0' cellspacing='0' border='0' style='width:1250px;border:1px solid #000000;font-size:13px;font-family:Arial'>";
                    $devS .= "<tr><td style='border-bottom:1px solid #000000;font-weight:bold;font-size:10px;text-align:center;background-color:silver;'>Nro</td>";
                    $devS .= "<td style='display:none;'>".mysql_field_name($re, $zz)."</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:12px;text-align:center;background-color:silver;'>Fecha Ingreso</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:12px;text-align:center;background-color:silver;'>Boleta</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:12px;text-align:center;background-color:silver;'>Modelo</td>";

                    switch($formatomayor){

                        case '7':
                            $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Talla</td>";
                            $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Material</td>";

                            break;
                        default:
                            $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Color</td>";
                            $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Material</td>";
                            break;
                    }
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Item</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Vendedor</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Ingreso</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:12px;text-align:center;background-color:silver;'>Cajas</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:12px;text-align:center;background-color:silver;'>Precio Venta</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Unitario</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Pares o U</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Total Sus</td>";

                    switch($formatomayor){
                        case '10':
                            $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:13px;text-align:center;background-color:silver;'>U</td>";
                            $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:13px;text-align:center;background-color:silver;'>XS</td>";
                            $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:13px;text-align:center;background-color:silver;'>S</td>";
                            $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:13px;text-align:center;background-color:silver;'>P</td>";
                            $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:13px;text-align:center;background-color:silver;'>M</td>";

                            $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:13px;text-align:center;background-color:silver;'>L</td>";
                            $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:13px;text-align:center;background-color:silver;'>XL</td>";


                            break;
                        default:

                            for($hi=0;$hi<$row1;$hi++){
                                $codigo = $sql3[$hi];
                                $idmodelo = $codigo['idmodelo'];

                                $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:13px;text-align:center;background-color:silver;'>$idmmarca</td>";
                                $ji++;
                            }
                            break;
                    }


                    $devS .= "</tr>";
                    $ii = 0;
                    //$totalCount = mysql_num_rows($re);
                    $z = 1;

                    $totalcajas=0;
                    $totalpares=0;
                    $totalsus=0;
                    do{
                        $devS .= "<tr><td style='text-align:left'>".$z."</td>";

                        for($i = 0; $i< mysql_num_fields($re); $i++)
                        {$dato = $fi[$i];
                            //  $iddetalleingreso = $fi[$i]['idmodelo'];

                            $devS .= "<td style='display:none;'>&nbsp;".$dato."&nbsp;</td>";

                            switch($formatomayor){
                                case '7':
                                    $select =" mdd.codigo,CONCAT( e.nombres, '-', e.apellidos) AS vendedor,
 mdd.color,mdd.material,mdd.cliente,mdd.talla as color,  mdd.precioventa AS precio, mdd.numerocajas as totalcajas,SUM( kp.preciounitario * kp.saldocantidad ) AS totalparesbs, SUM( kp.saldocantidad ) AS totalparescaja, SUM( kp.saldocantidad ) AS totalpares,kp.preciounitario,mdd.fechaingreso as fecha,mdd.talla";
                                    $from = "modelo mdd,kardexdetallepar kp,empleados e";
                                    $where = "kp.idmodelo=mdd.idmodelo and mdd.idvendedor=e.idempleado
AND mdd.estado ='Activo' AND mdd.idalmacen='$idalmacen' and kp.idmodelo='$dato' GROUP by kp.idmodelo";


                                    break;
                                case '1':
                                    //   if($estadokardex=="pendiente"){
                                    $select ="CONCAT( c.detalle, '-', mdd.codigo) AS codigo,CONCAT( e.nombres, '-', e.apellidos) AS vendedor,
 mdd.color,mdd.material,mdd.cliente,mdd.talla,  mdd.precioventa AS precio, mdd.numerocajas as totalcajas,SUM( kp.preciounitario * kp.saldocantidad ) AS totalparesbs, SUM( kp.saldocantidad ) AS totalparescaja, SUM( kp.saldocantidad ) AS totalpares,kp.preciounitario,mdd.fechaingreso as fecha,mdd.talla";
                                    $from = "modelo mdd,kardexdetallepar kp,coleccion c,empleados e";
                                    $where = "mdd.idcoleccion=c.idcoleccion and kp.idmodelo=mdd.idmodelo and mdd.idvendedor=e.idempleado
AND mdd.estado ='Activo' AND mdd.idalmacen='$idalmacen' and kp.idmodelo='$dato' GROUP by kp.idmodelo";

                                    break;
                                case '11':
                                    $select =" mdd.codigo,CONCAT( e.nombres, '-', e.apellidos) AS vendedor,
 mdd.color,mdd.material,mdd.cliente,mdd.talla,  mdd.precioventa AS precio, mdd.numerocajas as totalcajas,SUM( kp.preciounitario * kp.saldocantidad ) AS totalparesbs, SUM( kp.saldocantidad ) AS totalparescaja, SUM( kp.saldocantidad ) AS totalpares,kp.preciounitario,mdd.fechaingreso as fecha,mdd.talla";
                                    $from = "modelo mdd,kardexdetallepar kp,empleados e";
                                    $where = "kp.idmodelo=mdd.idmodelo and mdd.idvendedor=e.idempleado
AND mdd.estado ='Activo' AND mdd.idalmacen='$idalmacen' and kp.idmodelo='$dato' GROUP by kp.idmodelo";

                                    break;
                                //aqui
                                default:

                                    $select =" mdd.codigo,CONCAT( e.nombres, '-', e.apellidos) AS vendedor,
 mdd.color,mdd.material,mdd.cliente,mdd.talla,  mdd.precioventa AS precio, mdd.numerocajas as totalcajas,
SUM( kp.preciounitario * kp.saldocantidad ) AS totalparesbs, SUM( kp.saldocantidad ) AS totalparescaja,
 SUM( kp.saldocantidad ) AS totalpares,kp.preciounitario,mdd.fechaingreso as fecha,mdd.talla";
                                    $from = "modelo mdd,kardexdetallepar kp,empleados e";
                                    $where = "kp.idmodelo=mdd.idmodelo and mdd.idvendedor=e.idempleado
AND mdd.estado ='Activo' AND mdd.idalmacen='$idalmacen' and kp.idmodelo='$dato' GROUP by kp.idmodelo";


                                    break;
                            }
                            $sql2p1 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                            //echo $sql2p1;

                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p1, true, true, 'codigo');
                            $modelo = $almacenA1['resultado'];

                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p1, true, true, 'color');
                            $color = $almacenA1['resultado'];
                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p1, true, true, 'material');
                            $material = $almacenA1['resultado'];
                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p1, true, true, 'vendedor');
                            $vendedor = $almacenA1['resultado'];
                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p1, true, true, 'cliente');
                            $cliente = $almacenA1['resultado'];
                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p1, true, true, 'talla');
                            $talla = $almacenA1['resultado'];
                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p1, true, true, 'fecha');
                            $fechaingreso = $almacenA1['resultado'];
                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p1, true, true, 'totalpares');
                            $pares = $almacenA1['resultado'];
                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p1, true, true, 'precio');
                            $precioventa = $almacenA1['resultado'];
                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p1, true, true, 'preciounitario');
                            $unitario = $almacenA1['resultado'];
                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p1, true, true, 'totalparesbs');
                            $totalSus = $almacenA1['resultado'];
                            //  $totalSus = $preciou*$pares;
                            //echo $sql2p1;
                            $cajas = $pares/12;
                            $cajas=round($cajas,2);
                            $totalcajas =$totalcajas + $cajas;
                            $totalpares =$totalpares + $pares;
                            $totalsus =$totalsus + $totalSus;
                            //  $html .= "<tr><td style='font-size:11px;font-weight:bold;'>$direccion</td><td></td><td style='font-size:11px;font-weight:bold;'></td><td></td></tr>";
                            $devS .= "<td style='font-size:12px;text-align:left;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$fecharegistro."&nbsp;</td>";
                            $devS .= "<td style='font-size:12px;text-align:left;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$boleta."&nbsp;</td>";

                            $devS .= "<td style='font-size:12px;text-align:left;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$modelo."&nbsp;</td>";
                            switch($formatomayor){
                                case '5':
                                    break;
                                default:
                                    $devS .= "<td style='text-align:left;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$color."&nbsp;</td>";
                                    $devS .= "<td style='text-align:left;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$material."&nbsp;</td>";
                                    break;
                            }
                            $devS .= "<td style='text-align:left;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$cliente."&nbsp;</td>";
                            $devS .= "<td style='text-align:left;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$vendedor."&nbsp;</td>";
                            $devS .= "<td style='text-align:left;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$fechaingreso."&nbsp;</td>";
                            $devS .= "<td style='text-align:left;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$cajas."&nbsp;</td>";
                            $devS .= "<td style='text-align:left;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$precioventa."&nbsp;</td>";

                            $devS .= "<td style='text-align:left;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$unitario."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$pares."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$totalSus."&nbsp;</td>";
                            switch($formatomayor){
                                case '10':

                                    $select1 = "SUM(vi.saldocantidad)AS pares";
                                    $from1 = "modelo mdd,kardexdetallepar vi";
                                    $where1 = "mdd.idmodelo = vi.idmodelo  and vi.idmodelo='$dato' AND vi.talla='U'";
                                    $sql21 = "SELECT ".$select1." FROM ".$from1. " WHERE ".$where1. " group by  vi.talla";
                                    $almacenA1 =  findBySqlReturnCampoUnique($sql21, true, true, 'pares');
                                    $pares1 = $almacenA1['resultado'];
                                    $select1 = "SUM(vi.saldocantidad)AS pares";
                                    $from1 = "modelo mdd,kardexdetallepar vi";
                                    $where1 = "mdd.idmodelo = vi.idmodelo  and vi.idmodelo='$dato' AND vi.talla='XS'";
                                    $sql21 = "SELECT ".$select1." FROM ".$from1. " WHERE ".$where1. " group by  vi.talla";
                                    $almacenA1 =  findBySqlReturnCampoUnique($sql21, true, true, 'pares');
                                    $pares2 = $almacenA1['resultado'];
                                    $select1 = "SUM(vi.saldocantidad)AS pares";
                                    $from1 = "modelo mdd,kardexdetallepar vi";
                                    $where1 = "mdd.idmodelo = vi.idmodelo  and vi.idmodelo='$dato' AND vi.talla='S'";
                                    $sql21 = "SELECT ".$select1." FROM ".$from1. " WHERE ".$where1. " group by  vi.talla";
                                    $almacenA1 =  findBySqlReturnCampoUnique($sql21, true, true, 'pares');
                                    $pares3 = $almacenA1['resultado'];
                                    $select1 = "SUM(vi.saldocantidad)AS pares";
                                    $from1 = "modelo mdd,kardexdetallepar vi";
                                    $where1 = "mdd.idmodelo = vi.idmodelo  and vi.idmodelo='$dato' AND vi.talla='P'";
                                    $sql21 = "SELECT ".$select1." FROM ".$from1. " WHERE ".$where1. " group by  vi.talla";
                                    $almacenA1 =  findBySqlReturnCampoUnique($sql21, true, true, 'pares');
                                    $pares4 = $almacenA1['resultado'];
                                    $select1 = "SUM(vi.saldocantidad)AS pares";
                                    $from1 = "modelo mdd,kardexdetallepar vi";
                                    $where1 = "mdd.idmodelo = vi.idmodelo  and vi.idmodelo='$dato' AND vi.talla='M'";
                                    $sql21 = "SELECT ".$select1." FROM ".$from1. " WHERE ".$where1. " group by  vi.talla";
                                    $almacenA1 =  findBySqlReturnCampoUnique($sql21, true, true, 'pares');
                                    $pares5 = $almacenA1['resultado'];
                                    $select1 = "SUM(vi.saldocantidad)AS pares";
                                    $from1 = "modelo mdd,kardexdetallepar vi";
                                    $where1 = "mdd.idmodelo = vi.idmodelo  and vi.idmodelo='$dato' AND vi.talla='L'";
                                    $sql21 = "SELECT ".$select1." FROM ".$from1. " WHERE ".$where1. " group by  vi.talla";
                                    $almacenA1 =  findBySqlReturnCampoUnique($sql21, true, true, 'pares');
                                    $pares6 = $almacenA1['resultado'];
                                    $select1 = "SUM(vi.saldocantidad)AS pares";
                                    $from1 = "modelo mdd,kardexdetallepar vi";
                                    $where1 = "mdd.idmodelo = vi.idmodelo  and vi.idmodelo='$dato' AND vi.talla='XL'";
                                    $sql21 = "SELECT ".$select1." FROM ".$from1. " WHERE ".$where1. " group by  vi.talla";
                                    $almacenA1 =  findBySqlReturnCampoUnique($sql21, true, true, 'pares');
                                    $pares7 = $almacenA1['resultado'];

                                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$pares1."&nbsp;</td>";
                                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$pares2."&nbsp;</td>";
                                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$pares3."&nbsp;</td>";
                                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$pares4."&nbsp;</td>";
                                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$pares5."&nbsp;</td>";
                                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$pares6."&nbsp;</td>";
                                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$pares7."&nbsp;</td>";

                                    break;

                                default:
                                    for($h=0;$h<$row1;$h++){
                                        $codigo = $sql3[$h];
                                        $idmmarca = $codigo['codigo'];
                                        if($estadokardex=="pendiente"){
                                            $select1 = "SUM(vi.saldocantidad)AS pares";
                                            $from1 = "modelo mdd,kardexdetallepar vi";
                                            $where1 = "mdd.idmodelo = vi.idmodelo  and vi.idmodelo='$dato' AND vi.talla='$idmmarca'";
                                            $sql21 = "SELECT ".$select1." FROM ".$from1. " WHERE ".$where1. " group by  vi.talla";
                                            $almacenA1 =  findBySqlReturnCampoUnique($sql21, true, true, 'pares');
                                            $pares1 = $almacenA1['resultado'];
                                        }else{

                                            $select1 = "SUM(h.saldocantidad)AS pares";
                                            $from1 = "modelo mdd,kardexdetallepar vi,historialkardex h";
                                            $where1 = "vi.idkardexunico=h.idkardexunico and h.idkardex='$idkardex' and mdd.idmodelo = vi.idmodelo  and vi.idmodelo='$dato' AND h.talla='$idmmarca'";
                                            $sql21 = "SELECT ".$select1." FROM ".$from1. " WHERE ".$where1. " group by  h.talla";
                                            $almacenA1 =  findBySqlReturnCampoUnique($sql21, true, true, 'pares');
                                            $pares1 = $almacenA1['resultado'];
                                        }

                                        //echo $sql21;
                                        $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$pares1."&nbsp;</td>";
                                        $j++;
                                    }
                                    break;
                            }


                            //  if($trasdesp==NULL || $trasdesp =='' || $trasdesp == ""){ $trasdesp="0"; }

                        }
                        $devS .= "</tr>";
                        $ii++;
                        $z ++;
                    }while($fi = mysql_fetch_array($re));
                    //$devS .= "<tr><td style='border:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Total</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td style='border:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>$totalparesestilo</td><td style='border:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>$totalbsestilo</td>";
                    $devS .= "<tr style='background-color:silver;'><td style='border: 1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'></td>";
                    $devS .= "<td style='display:none;'></td>";
                    $fechatoday = Date("d-m-Y");
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'></td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'></td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'></td>";
                    switch($formatomayor){
                        case '5':
                            break;
                        default:
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'></td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'></td>";
                            break;
                    }
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'></td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'></td>";

                    $devS .= "<td style='text-align:center;border-bottom: 1px solid #000000;background-color:silver;'>TOTAL</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$totalcajas."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>PARES</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'></td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$totalpares."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$totalsus."&nbsp;</td>";

                    for($h=0;$h<$row1;$h++){
                        $devS .= "<td style='text-align:center;border-bottom: 1px solid #000000;'></td>";
                        $j++;
                    }


                    // $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$totalbsactual."&nbsp;</td>";

                    $devS .= "</tr>";

                    $devS .= "</table>";

                    $dev['mensaje'] = "Existen resultados";
                    $dev['error']   = "true";
                    $dev['resultado'] = $devS;

                }
                else
                {
                    $dev['mensaje'] = "No se encontro datos en la consulta2".mysql_error();
                    $dev['error']   = "false";
                    $dev['resultado'] = "";
                }
            }
            else
            {
                $dev['mensaje'] = "Error en la consulta";
                $dev['error']   = "false";
                $dev['resultado'] = "";
            }
        }
        else
        {
            $dev['mensaje'] = "No se pudo conectar a la BD";
            $dev['error']   = "false";
            $dev['resultado'] = "";
        }
    }
    else
    {
        $dev['mensaje'] = "No se pudo crear la conexion a la BD";
        $dev['error']   = "false";
        $dev['resultado'] = "";
    }
    return $dev;
}
function dibujarTablaOfingreso($sql,$idtienda,$idempleado,$codigoempleado,$nombreempleado,$fechainicio,$fechafin)
{
    $idalmacen=$_SESSION['idalmacen'];
    if($link=new BD)
    {
        if($link->conectar())
        {
            if($re = $link->consulta($sql))
            {
                //echo mysql_num_rows($re);
                if($fi = mysql_fetch_array($re))
                {
                    $devS .= "<table cellpadding='0' cellspacing='0' border='0' style='width:100%;border:1px solid #000000;font-size:13px;'>";
                    $devS .= "<tr><td colspan='".(mysql_num_fields($re)+1)."' style='border-bottom:1px solid #000000;font-weight:bold;font-size:16px;text-align:left;'>$nombreempleado</td></tr>";
                    $devS .= "</tr>";
                    $ii = 0;
                    $z = 1;
                    $totalcajas=0;
                    $totalpares=0;
                    $totalsus=0;
                    do{
                        for($i = 0; $i< mysql_num_fields($re); $i++)
                        {$dato = $fi[$i];
                            $idmarca = $dato;
                            $sql2 = "SELECT nombre FROM marcas WHERE idmarca = '$idmarca'";
                            $idalmacenA =  findBySqlReturnCampoUnique($sql2, true, true, 'nombre');
                            $empresa1 = $idalmacenA['resultado'];
                            $empresa=strtoupper($empresa1);
                            // $devS .= "<td style='display:none;'>&nbsp;".$dato."&nbsp;</td>";

                            $select1 = " date_format(ing.fecha,'%d/%m/%Y') AS Fecha, ing.boleta, ing.nro_factura, SUM(kp.saldocantidad) as totalpares,
                                        (SUM(kp.saldocantidad)/12) as totalcajas, SUM(kp.saldocantidad*kp.preciounitario) as totalSus";
                            $from1 = "ingresoalmacen ing, marcas mad,almacenes alm,kardexdetallepar kp";
                            $where1 = " ing.estado='ACTIVO' and ing.idingreso=kp.idingreso AND ing.idalmacen=alm.idalmacen and
                                        ing.idmarca = mad.idmarca and ing.idalmacen='$idalmacen' and ing.idmarca='$idmarca' ";
                            if($fechainicio != null && $fechainicio != "")
                            { $where1 .= " AND ing.fecha >='$fechainicio' ";}
                            if($fechafin != null && $fechafin != "")
                            { $where1 .= " AND ing.fecha <='$fechafin' ";}
                            if($idvendedor == null || $idvendedor == 'null' || $idvendedor != "null")
                            { }else{$where1 .= " AND ing.idvendedor ='$idvendedor' "; }

                            $sqlruta = "SELECT ".$select1." FROM ".$from1. " WHERE ".$where1." GROUP by ing.idingreso ORDER by FEcha";
                            //echo $sqlruta;
                            $select1 = "SUM(kp.saldocantidad) as totalpares";
                            $from = "ingresoalmacen ing, marcas mad,almacenes alm,kardexdetallepar kp";
                            $where = "ing.estado='ACTIVO' and ing.idingreso=kp.idingreso AND ing.idalmacen=alm.idalmacen and
                                      ing.idmarca = mad.idmarca and ing.idalmacen='$idalmacen' and ing.idmarca='$idmarca'";
                            { $where .= " AND ing.fecha >='$fechainicio' ";}
                            if($fechafin != null && $fechafin != "")
                            { $where .= " AND ing.fecha <='$fechafin' ";}
                            if($idvendedor == null || $idvendedor == 'null' || $idvendedor != "null")
                            { }else{$where .= " AND v.idvendedor ='$idvendedor' "; }
                            //$select1 = "SELECT SUM(v.totalpares) AS cajas";
                            $select2 = "SUM(kp.saldocantidad*kp.preciounitario) as totalbs";

                            $sql4112 = "SELECT ".$select1." FROM ".$from. " WHERE ".$where." ";
                            $creditoA111 = findBySqlReturnCampoUnique($sql4112, true, true, "totalpares");
                            $tpares = $creditoA111['resultado'];

                            $sql12 = "SELECT ".$select2." FROM ".$from. " WHERE ".$where." ";
                            $creditoA111 = findBySqlReturnCampoUnique($sql12, true, true, "totalbs");
                            $tsus = $creditoA111['resultado'];

                            $tcajas = $tpares/12;
                            $tcajas = round($tcajas,2);

                            $table = dibujarTablaparaingresos($sqlruta, $empresa,$tcajas,$tpares,$tsus);
                            $devS .= $table['resultado'];

                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$stockanterior."&nbsp;</td>";

                        }
                        $devS .= "</tr>";
                        $ii++;
                        $z ++;
                    }while($fi = mysql_fetch_array($re));

                    $sql4111 = "SELECT SUM(monto) AS totaldeuda FROM pagocredito WHERE tipopago='ingreso' AND idtienda='$idempleado' AND fecha >='$fechainicio' AND fecha <='$fechafin'";
                    $creditoA1111 = findBySqlReturnCampoUnique($sql4111, true, true, "totaldeuda");
                    $totalcomisioncobrado = $creditoA1111['resultado'];

                    if($totalcomisioncobrado==NULL || $totalcomisioncobrado =='' || $totalcomisioncobrado == ""){ $totalcomisioncobrado="0.00"; }

                    $devS .= "</table>";

                    $dev['mensaje'] = "Existen resultados";
                    $dev['error']   = "true";
                    $dev['resultado'] = $devS;

                }
                else
                {
                    $dev['mensaje'] = "No se encontro datos en la consulta2".mysql_error();
                    $dev['error']   = "false";
                    $dev['resultado'] = "";
                }
            }
            else
            {
                $dev['mensaje'] = "Error en la consulta";
                $dev['error']   = "false";
                $dev['resultado'] = "";
            }
        }
        else
        {
            $dev['mensaje'] = "No se pudo conectar a la BD";
            $dev['error']   = "false";
            $dev['resultado'] = "";
        }
    }
    else
    {
        $dev['mensaje'] = "No se pudo crear la conexion a la BD";
        $dev['error']   = "false";
        $dev['resultado'] = "";
    }
    return $dev;
}

function dibujarTablaOfingresoproforma($sql,$idtienda,$idempleado,$codigoempleado,$nombreempleado,$fechainicio,$fechafin)
{
    $idalmacen=$_SESSION['idalmacen'];
    if($link=new BD)
    {
        if($link->conectar())
        {
            if($re = $link->consulta($sql))
            {
                //echo mysql_num_rows($re);
                if($fi = mysql_fetch_array($re))
                {
                    $devS .= "<table cellpadding='0' cellspacing='0' border='0' style='width:100%;border:1px solid #000000;font-size:13px;'>";
                    $devS .= "<tr><td colspan='".(mysql_num_fields($re)+1)."' style='border-bottom:1px solid #000000;font-weight:bold;font-size:16px;text-align:left;'>$nombreempleado</td></tr>";
                    $devS .= "</tr>";
                    $ii = 0;
                    $z = 1;
                    $totalcajas=0;
                    $totalpares=0;
                    $totalsus=0;
                    do{
                        for($i = 0; $i< mysql_num_fields($re); $i++)
                        {$dato = $fi[$i];
                            $idmarca = $dato;
                            $sql2 = "SELECT nombre FROM marcas WHERE idmarca = '$idmarca'";
                            $idalmacenA =  findBySqlReturnCampoUnique($sql2, true, true, 'nombre');
                            $empresa1 = $idalmacenA['resultado'];
                            $empresa=strtoupper($empresa1);
                            // $devS .= "<td style='display:none;'>&nbsp;".$dato."&nbsp;</td>";
                            //ojito
                            //    $select = "SUM(kp.preciounitario) AS sus";
                            //    $from = "kardexdetallepar kp,proformas p,modelo m";
                            //   $where = "kp.idingreso=p.id_proforma and m.idingreso=p.id_proforma and kp.idmodelo=m.idmodelo and p.nombre!='00/2016'";
                            //   { $where .= " and m.idvendedor='$idempleado' AND p.idmarca = '$idmarca'  AND p.fecha >= '$fechainicio' AND
                            //   p.fecha <= '$fechafin' and kp.idalmacen='$idalmacen'";}
                            //   $sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where;
                            //fin ob

                            $select1 = " date_format(ing.fecha,'%d/%m/%Y') AS Fecha, ing.id_proforma as boleta,COUNT(kp.idkardexunico) as totalpares,
 (SUM(kp.saldocantidad)/12) as totalcajas, SUM(kp.preciounitario) as totalbs,  ing.responsable, mad.nombre AS marca";
                            $from1 = "proformas ing, marcas mad,kardexdetallepar kp,modelo m";
                            $where1 = " kp.idingreso=ing.id_proforma and m.idingreso=ing.id_proforma AND kp.idmodelo=m.idmodelo and ing.idmarca = mad.idmarca and
kp.idalmacen='$idalmacen' and ing.idmarca='$idmarca' ";
                            if($fechainicio != null && $fechainicio != "")
                            { $where1 .= " AND ing.fecha >='$fechainicio' ";}
                            if($fechafin != null && $fechafin != "")
                            { $where1 .= " AND ing.fecha <='$fechafin' ";}
                            //      if($idvendedor == null || $idvendedor == 'null' || $idvendedor != "null")
                            //    { }else{$where1 .= " AND m.idvendedor ='$idvendedor' "; }

                            $sqlruta = "SELECT ".$select1." FROM ".$from1. " WHERE ".$where1." GROUP by id_proforma ORDER by FEcha";
                            //echo $sqlruta;
                            $select1 = "COUNT(kp.saldocantidad) as totalpares";
                            $from = "proformas ing, marcas mad,kardexdetallepar kp,modelo m";
                            $where = "kp.idingreso=ing.id_proforma and m.idingreso=ing.id_proforma AND kp.idmodelo=m.idmodelo and ing.idmarca = mad.idmarca and
kp.idalmacen='$idalmacen' and ing.idmarca='$idmarca'";
                            { $where .= " AND ing.fecha >='$fechainicio' ";}
                            if($fechafin != null && $fechafin != "")
                            { $where .= " AND ing.fecha <='$fechafin' ";}
                            //     if($idvendedor == null || $idvendedor == 'null' || $idvendedor != "null")
                            //    { }else{$where .= " AND m.idvendedor ='$idvendedor' "; }
                            //$select1 = "SELECT SUM(v.totalpares) AS cajas";
                            $select2 = "SUM(kp.preciounitario) as totalbs";

                            $sql4112 = "SELECT ".$select1." FROM ".$from. " WHERE ".$where." ";
                            $creditoA111 = findBySqlReturnCampoUnique($sql4112, true, true, "totalpares");
                            $tpares = $creditoA111['resultado'];

                            $sql12 = "SELECT ".$select2." FROM ".$from. " WHERE ".$where." ";
                            $creditoA111 = findBySqlReturnCampoUnique($sql12, true, true, "totalbs");
                            $tsus = $creditoA111['resultado'];

                            $tcajas = $tpares/12;
                            $tcajas = round($tcajas,2);

                            $table = dibujarTablaparaingresos($sqlruta, $empresa,$tcajas,$tpares,$tsus);
                            $devS .= $table['resultado'];

                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$stockanterior."&nbsp;</td>";

                        }
                        $devS .= "</tr>";
                        $ii++;
                        $z ++;
                    }while($fi = mysql_fetch_array($re));

                    $sql4111 = "SELECT SUM(monto) AS totaldeuda FROM pagocredito WHERE tipopago='ingreso' AND idtienda='$idempleado' AND fecha >='$fechainicio' AND fecha <='$fechafin'";
                    $creditoA1111 = findBySqlReturnCampoUnique($sql4111, true, true, "totaldeuda");
                    $totalcomisioncobrado = $creditoA1111['resultado'];

                    if($totalcomisioncobrado==NULL || $totalcomisioncobrado =='' || $totalcomisioncobrado == ""){ $totalcomisioncobrado="0.00"; }

                    $devS .= "</table>";

                    $dev['mensaje'] = "Existen resultados";
                    $dev['error']   = "true";
                    $dev['resultado'] = $devS;

                }
                else
                {
                    $dev['mensaje'] = "No se encontro datos en la consulta2".mysql_error();
                    $dev['error']   = "false";
                    $dev['resultado'] = "";
                }
            }
            else
            {
                $dev['mensaje'] = "Error en la consulta";
                $dev['error']   = "false";
                $dev['resultado'] = "";
            }
        }
        else
        {
            $dev['mensaje'] = "No se pudo conectar a la BD";
            $dev['error']   = "false";
            $dev['resultado'] = "";
        }
    }
    else
    {
        $dev['mensaje'] = "No se pudo crear la conexion a la BD";
        $dev['error']   = "false";
        $dev['resultado'] = "";
    }
    return $dev;
}

function dibujarTablaOfTRASPrec($sql,$idtienda,$idvendedor,$codigoempleado,$nombreempleado,$fechainicio,$fechafin)
{
    $idalmacen=$_SESSION['idalmacen'];
    if($link=new BD)
    {
        if($link->conectar())
        {
            if($re = $link->consulta($sql))
            {
                //echo mysql_num_rows($re);
                if($fi = mysql_fetch_array($re))
                {
                    $devS .= "<table cellpadding='0' cellspacing='0' border='0' style='width:100%;border:1px solid #000000;font-size:13px;'>";
                    $devS .= "<tr><td colspan='".(mysql_num_fields($re)+1)."' style='border-bottom:1px solid #000000;font-weight:bold;font-size:16px;text-align:left;'>$nombreempleado</td></tr>";
                    $devS .= "</tr>";
                    $ii = 0;
                    $z = 1;
                    $totalcajas=0;
                    $totalpares=0;
                    $totalsus=0;
                    do{
                        for($i = 0; $i< mysql_num_fields($re); $i++)
                        {$dato = $fi[$i];
                            $idmarca = $dato;
                            $sql2 = "SELECT nombre FROM marcas WHERE idmarca = '$idmarca'";
                            $idalmacenA =  findBySqlReturnCampoUnique($sql2, true, true, 'nombre');
                            $empresa1 = $idalmacenA['resultado'];
                            $empresa=strtoupper($empresa1);
                            //richy
                            $select1 = " tra.boleta,mar.nombre as marca, date_format( tra.fecha, '%d/%m/%Y' ) AS fecha, m.codigo AS modelo, SUM( tr.saldocantidad ) AS pares, SUM( tr.preciounitario ) AS totalsus, emp.nombres AS RecibidoPor, empo.nombres AS EnviadoPor, ori.nombre AS tiendaorigen, des.nombre AS tiendadestino";
                            $from1 = "traspaso tra, modelo mo, marcas mar, empleados emp, empleados empo, almacenes ori, almacenes des,
 traspasodetallepar tr, modelo m";
                            $where1 = "tra.idmarca = mar.idmarca
AND mo.idvendedor = empo.idempleado
AND tr.iddetalletraspaso = tra.idtraspaso
AND tr.idmodelo = m.idmodelo
AND tr.idmodeloorigen = mo.idmodelo
AND tra.idalmacen = ori.idalmacen
AND tra.idalmacendestino = des.idalmacen
AND tra.responsable = emp.idempleado and tra.idalmacendestino ='$idalmacen' and
tra.idmarca='$idmarca' ";


                            if($fechainicio != null && $fechainicio != "")
                            { $where1 .= " AND tra.fecha >='$fechainicio' ";}
                            if($fechafin != null && $fechafin != "")
                            { $where1 .= " AND tra.fecha <='$fechafin' ";}


                            $sqlruta = "SELECT ".$select1." FROM ".$from1. " WHERE ".$where1." GROUP BY tr.idmodelo ORDER by emp.nombres";
                            //echo $sqlruta;
                            $table = dibujarTablaparaventascredito($sqlruta, $empresa,$tdesc,$tmonto,$tcajas,$tpares,$tsus);
                            $devS .= $table['resultado'];

                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$stockanterior."&nbsp;</td>";

                        }
                        $devS .= "</tr>";
                        $ii++;
                        $z ++;
                    }while($fi = mysql_fetch_array($re));

                    $devS .= "</table>";

                    $dev['mensaje'] = "Existen resultados";
                    $dev['error']   = "true";
                    $dev['resultado'] = $devS;

                }
                else
                {
                    $dev['mensaje'] = "No se encontro datos en la consulta2".mysql_error();
                    $dev['error']   = "false";
                    $dev['resultado'] = "";
                }
            }
            else
            {
                $dev['mensaje'] = "Error en la consulta";
                $dev['error']   = "false";
                $dev['resultado'] = "";
            }
        }
        else
        {
            $dev['mensaje'] = "No se pudo conectar a la BD";
            $dev['error']   = "false";
            $dev['resultado'] = "";
        }
    }
    else
    {
        $dev['mensaje'] = "No se pudo crear la conexion a la BD";
        $dev['error']   = "false";
        $dev['resultado'] = "";
    }
    return $dev;
}
function dibujarTablamodelosventa($sql,$idtienda,$idvendedor,$codigoempleado,$nombreempleado,$fechainicio,$fechafin)
{
    $idalmacen=$_SESSION['idalmacen'];
    if($link=new BD)
    {
        if($link->conectar())
        {
            if($re = $link->consulta($sql))
            {
                //echo mysql_num_rows($re);
                if($fi = mysql_fetch_array($re))
                {
                    $devS .= "<table cellpadding='0' cellspacing='0' border='0' style='width:100%;border:1px solid #000000;font-size:13px;'>";
                    $devS .= "<tr><td colspan='".(mysql_num_fields($re)+1)."' style='border-bottom:1px solid #000000;font-weight:bold;font-size:16px;text-align:left;'>$nombreempleado</td></tr>";
                    $devS .= "</tr>";
                    $ii = 0;
                    $z = 1;
                    $totalcajas=0;
                    $totalpares=0;
                    $totalsus=0;
                    do{
                        for($i = 0; $i< mysql_num_fields($re); $i++)
                        {$dato = $fi[$i];
                            $idmarca = $dato;
                            $sql2 = "SELECT nombre FROM marcas WHERE idmarca = '$idmarca'";
                            $idalmacenA =  findBySqlReturnCampoUnique($sql2, true, true, 'nombre');
                            $empresa1 = $idalmacenA['resultado'];
                            $empresa=strtoupper($empresa1);


                            $select1 = " iv.numero,iv.idventa,iv.fecha,mar.nombre as marca,md.codigo as modelo,
SUM(iv.saldocantidad) as totalpares,SUM(iv.preciounitario) as totalsus,em.nombres as vendidopor,emo.nombres as mercaderiade";
                            $from1 = "traspasosinternos iv,modelo md,ventas v,`marcas` mar, empleados em,empleados emo";
                            $where1 = " iv.idventa=v.idventa and iv.idmodelo=md.idmodelo and v.idmarca=mar.idmarca and
iv.idvendedor=em.idempleado and iv.idvendedororigen=emo.idempleado and v.idalmacen='$idalmacen' and v.idmarca='$idmarca'";

                            if($fechainicio != null && $fechainicio != "")
                            { $where1 .= " AND iv.fecha >='$fechainicio' ";}
                            if($fechafin != null && $fechafin != "")
                            { $where1 .= " AND iv.fecha <='$fechafin' ";}

                            $sqlruta = "SELECT ".$select1." FROM ".$from1. " WHERE ".$where1." Group by iv.idmodelo order by em.nombres ";


                            $table = dibujarTablasimplesintotales($sqlruta, $empresa,$tdesc,$tmonto,$tcajas,$tpares,$tsus);
                            $devS .= $table['resultado'];

                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$stockanterior."&nbsp;</td>";

                        }
                        $devS .= "</tr>";
                        $ii++;
                        $z ++;
                    }while($fi = mysql_fetch_array($re));


                    $devS .= "</table>";

                    $dev['mensaje'] = "Existen resultados";
                    $dev['error']   = "true";
                    $dev['resultado'] = $devS;

                }
                else
                {
                    $dev['mensaje'] = "No se encontro datos en la consulta2".mysql_error();
                    $dev['error']   = "false";
                    $dev['resultado'] = "";
                }
            }
            else
            {
                $dev['mensaje'] = "Error en la consulta";
                $dev['error']   = "false";
                $dev['resultado'] = "";
            }
        }
        else
        {
            $dev['mensaje'] = "No se pudo conectar a la BD";
            $dev['error']   = "false";
            $dev['resultado'] = "";
        }
    }
    else
    {
        $dev['mensaje'] = "No se pudo crear la conexion a la BD";
        $dev['error']   = "false";
        $dev['resultado'] = "";
    }
    return $dev;
}

function dibujarTablamodeloshabilitados($sql,$idtienda,$idvendedor,$codigoempleado,$nombreempleado,$fechainicio,$fechafin)
{
    $idalmacen=$_SESSION['idalmacen'];
    if($link=new BD)
    {
        if($link->conectar())
        {
            if($re = $link->consulta($sql))
            {
                //echo mysql_num_rows($re);
                if($fi = mysql_fetch_array($re))
                {
                    $devS .= "<table cellpadding='0' cellspacing='0' border='0' style='width:100%;border:1px solid #000000;font-size:13px;'>";
                    $devS .= "<tr><td colspan='".(mysql_num_fields($re)+1)."' style='border-bottom:1px solid #000000;font-weight:bold;font-size:16px;text-align:left;'>$nombreempleado</td></tr>";
                    $devS .= "</tr>";
                    $ii = 0;
                    $z = 1;
                    $totalcajas=0;
                    $totalpares=0;
                    $totalsus=0;
                    do{
                        for($i = 0; $i< mysql_num_fields($re); $i++)
                        {$dato = $fi[$i];
                            $idmarca = $dato;
                            $sql2 = "SELECT nombre FROM marcas WHERE idmarca = '$idmarca'";
                            $idalmacenA =  findBySqlReturnCampoUnique($sql2, true, true, 'nombre');
                            $empresa1 = $idalmacenA['resultado'];
                            $empresa=strtoupper($empresa1);

                            $select1 = " iv.fecha,md.codigo as modelo,CONCAT(md.color, '-',md.material) as detalle,mar.nombre as marca,em.nombres as vendedor,iv.pares,iv.preciounitario,(iv.pares*iv.preciounitario) as total";
                            $from1 = "pareshabilitados iv,modelo md,`marcas` mar, empleados em";
                            $where1 = " iv.idmodelo=md.idmodelo and iv.idmarca=mar.idmarca and
iv.idvendedor=em.idempleado and em.idalmacen='$idalmacen' and iv.idmarca='$idmarca'";

                            if($fechainicio != null && $fechainicio != "")
                            { $where1 .= " AND iv.fecha >='$fechainicio' ";}
                            if($fechafin != null && $fechafin != "")
                            { $where1 .= " AND iv.fecha <='$fechafin' ";}

                            $sqlruta = "SELECT ".$select1." FROM ".$from1. " WHERE ".$where1." order by em.nombres ";

                            $table = dibujarTablasimplesintotales($sqlruta, $empresa,$tdesc,$tmonto,$tcajas,$tpares,$tsus);
                            $devS .= $table['resultado'];

                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$stockanterior."&nbsp;</td>";

                        }
                        $devS .= "</tr>";
                        $ii++;
                        $z ++;
                    }while($fi = mysql_fetch_array($re));


                    $devS .= "</table>";

                    $dev['mensaje'] = "Existen resultados";
                    $dev['error']   = "true";
                    $dev['resultado'] = $devS;

                }
                else
                {
                    $dev['mensaje'] = "No se encontro datos en la consulta2".mysql_error();
                    $dev['error']   = "false";
                    $dev['resultado'] = "";
                }
            }
            else
            {
                $dev['mensaje'] = "Error en la consulta";
                $dev['error']   = "false";
                $dev['resultado'] = "";
            }
        }
        else
        {
            $dev['mensaje'] = "No se pudo conectar a la BD";
            $dev['error']   = "false";
            $dev['resultado'] = "";
        }
    }
    else
    {
        $dev['mensaje'] = "No se pudo crear la conexion a la BD";
        $dev['error']   = "false";
        $dev['resultado'] = "";
    }
    return $dev;
}

function dibujarTablasimplesintotales($sql, $titulo,$tcajas,$tpares,$tsus,$tpares,$tsus)
{
    if($link=new BD)
    {
        if($link->conectar())
        {
            if($re = $link->consulta($sql))
            {
                //echo mysql_num_rows($re);
                if($fi = mysql_fetch_array($re))
                {
                    $devS .= "<table cellpadding='0' cellspacing='0' border='0' style='width:75%;border:1px solid #000000;font-size:12px;'>";
                    if($titulo != "ninguno")
                    {
                        $devS .= "<tr><td colspan='".(mysql_num_fields($re)+1)."' style='border-bottom:1px solid #000000;font-weight:bold;font-size:20px;text-align:left;background-color:silver;'>$titulo</td></tr>";
                        //           $devvS .= "<td><td colspan='".(mysql_num_fields($re)-1)."' style='border-bottom:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>$total</td></tr>";

                    }
                    $devS .= "<tr><td style='border-bottom:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Nro</td>";
                    for($zz = 0; $zz < mysql_num_fields($re); $zz++)
                    {
                        $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:12px;text-align:center;background-color:silver;'>".mysql_field_name($re, $zz)."</td>";
                    }
                    $devS .= "</tr>";
                    $ii = 0;
                    //$totalCount = mysql_num_rows($re);
                    $z = 1;
                    do{
                        $devS .= "<tr><td style='text-align:center'>".$z."</td>";
                        for($i = 0; $i< mysql_num_fields($re); $i++)
                        {
                            if(mysql_field_type($re, $i) == "real")
                            {
                                $dato = $fi[$i];
                                if(mysql_field_name($re, $i) == "precio" || mysql_field_name($re, $i) == "importe")
                                {
                                    //                                    $dato = $fi[$i]/$tc;
                                    $dato = $fi[$i];
                                }
                                //$devS .= "<td style='line-height:150%;text-align:right;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$total."&nbsp;</td>";

                                $devS .= "<td style='line-height:150%;text-align:right;border-left: 1px solid #000000;'>&nbsp;".redondear($dato)."&nbsp;</td>";
                            }
                            else
                            {

                                $devS .= "<td style='line-height:150%;border-left: 1px solid #000000;'>&nbsp;".$fi[$i]."&nbsp;</td>";
                            }
                        }
                        $devS .= "</tr>";
                        $ii++;
                        $z ++;
                    }while($fi = mysql_fetch_array($re));
                    //dibujamos pie
                    $devS .= "<tr><td style='border-bottom:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Totales</td><td></td><td></td><td></td><td></td></td><td style='border-bottom:1px solid #000000;font-weight:bold;font-size:15px;text-align:center;background-color:silver;'>$tpares</td><td style='border-bottom:1px solid #000000;font-weight:bold;font-size:15px;text-center:right;background-color:silver;'>$tsus</td>";
                    $devS .= "</tr>";
                    $devS .= "</table>";

                    $dev['mensaje'] = "Existen resultados";
                    $dev['error']   = "true";
                    $dev['resultado'] = $devS;

                }
                else
                {
                    $dev['mensaje'] = "No se encontro datos en la consulta2".mysql_error();
                    $dev['error']   = "false";
                    $dev['resultado'] = "";
                }
            }
            else
            {
                $dev['mensaje'] = "Error en la consulta";
                $dev['error']   = "false";
                $dev['resultado'] = "";
            }
        }
        else
        {
            $dev['mensaje'] = "No se pudo conectar a la BD";
            $dev['error']   = "false";
            $dev['resultado'] = "";
        }
    }
    else
    {
        $dev['mensaje'] = "No se pudo crear la conexion a la BD";
        $dev['error']   = "false";
        $dev['resultado'] = "";
    }
    return $dev;
}
function dibujarTablasimplesintotalestotal($sql, $titulo,$tcajas,$tpares,$tbs,$tpares,$tsus)
{
    if($link=new BD)
    {
        if($link->conectar())
        {
            if($re = $link->consulta($sql))
            {
                //echo mysql_num_rows($re);
                if($fi = mysql_fetch_array($re))
                {
                    $devS .= "<table cellpadding='0' cellspacing='0' border='0' style='width:75%;border:1px solid #000000;font-size:12px;'>";
                    if($titulo != "ninguno")
                    {
                        $devS .= "<tr><td colspan='".(mysql_num_fields($re)+1)."' style='border-bottom:1px solid #000000;font-weight:bold;font-size:20px;text-align:left;background-color:silver;'>$titulo</td></tr>";
                        //           $devvS .= "<td><td colspan='".(mysql_num_fields($re)-1)."' style='border-bottom:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>$total</td></tr>";

                    }
                    $devS .= "<tr><td style='border-bottom:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Nro</td>";
                    for($zz = 0; $zz < mysql_num_fields($re); $zz++)
                    {
                        $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:12px;text-align:center;background-color:silver;'>".mysql_field_name($re, $zz)."</td>";
                    }
                    $devS .= "</tr>";
                    $ii = 0;
                    //$totalCount = mysql_num_rows($re);
                    $z = 1;
                    do{
                        $devS .= "<tr><td style='text-align:center'>".$z."</td>";
                        for($i = 0; $i< mysql_num_fields($re); $i++)
                        {
                            if(mysql_field_type($re, $i) == "real")
                            {
                                $dato = $fi[$i];
                                if(mysql_field_name($re, $i) == "precio" || mysql_field_name($re, $i) == "importe")
                                {
                                    //                                    $dato = $fi[$i]/$tc;
                                    $dato = $fi[$i];
                                }
                                //$devS .= "<td style='line-height:150%;text-align:right;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$total."&nbsp;</td>";

                                $devS .= "<td style='line-height:150%;text-align:right;border-left: 1px solid #000000;'>&nbsp;".redondear($dato)."&nbsp;</td>";
                            }
                            else
                            {

                                $devS .= "<td style='line-height:150%;border-left: 1px solid #000000;'>&nbsp;".$fi[$i]."&nbsp;</td>";
                            }
                        }
                        $devS .= "</tr>";
                        $ii++;
                        $z ++;
                    }while($fi = mysql_fetch_array($re));
                    //dibujamos pie
                    $devS .= "<tr><td style='border-bottom:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Totales</td><td></td><td></td><td style='border-bottom:1px solid #000000;font-weight:bold;font-size:15px;text-center:right;background-color:silver;'>$tcajas</td><td style='border-bottom:1px solid #000000;font-weight:bold;font-size:15px;text-center:right;background-color:silver;'>$tpares</td><td style='border-bottom:1px solid #000000;font-weight:bold;font-size:15px;text-align:center;background-color:silver;'>$tbs</td>";
                    $devS .= "</tr>";
                    $devS .= "</table>";

                    $dev['mensaje'] = "Existen resultados";
                    $dev['error']   = "true";
                    $dev['resultado'] = $devS;

                }
                else
                {
                    $dev['mensaje'] = "No se encontro datos en la consulta2".mysql_error();
                    $dev['error']   = "false";
                    $dev['resultado'] = "";
                }
            }
            else
            {
                $dev['mensaje'] = "Error en la consulta";
                $dev['error']   = "false";
                $dev['resultado'] = "";
            }
        }
        else
        {
            $dev['mensaje'] = "No se pudo conectar a la BD";
            $dev['error']   = "false";
            $dev['resultado'] = "";
        }
    }
    else
    {
        $dev['mensaje'] = "No se pudo crear la conexion a la BD";
        $dev['error']   = "false";
        $dev['resultado'] = "";
    }
    return $dev;
}


function dibujarTablaparaventascredito($sql, $titulo,$tcajas,$tpares,$tsus,$tdesc,$tmonto)
{
    if($link=new BD)
    {
        if($link->conectar())
        {
            if($re = $link->consulta($sql))
            {
                //echo mysql_num_rows($re);
                if($fi = mysql_fetch_array($re))
                {
                    $devS .= "<table cellpadding='0' cellspacing='0' border='0' style='width:75%;border:1px solid #000000;font-size:12px;'>";
                    if($titulo != "ninguno")
                    {
                        $devS .= "<tr><td colspan='".(mysql_num_fields($re)+1)."' style='border-bottom:1px solid #000000;font-weight:bold;font-size:20px;text-align:left;background-color:silver;'>$titulo</td></tr>";
                        //           $devvS .= "<td><td colspan='".(mysql_num_fields($re)-1)."' style='border-bottom:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>$total</td></tr>";

                    }
                    $devS .= "<tr><td style='border-bottom:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Nro</td>";
                    for($zz = 0; $zz < mysql_num_fields($re); $zz++)
                    {
                        $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:12px;text-align:center;background-color:silver;'>".mysql_field_name($re, $zz)."</td>";
                    }
                    $devS .= "</tr>";
                    $ii = 0;
                    //$totalCount = mysql_num_rows($re);
                    $z = 1;
                    do{
                        $devS .= "<tr><td style='text-align:center'>".$z."</td>";
                        for($i = 0; $i< mysql_num_fields($re); $i++)
                        {
                            if(mysql_field_type($re, $i) == "real")
                            {
                                $dato = $fi[$i];
                                if(mysql_field_name($re, $i) == "precio" || mysql_field_name($re, $i) == "importe")
                                {
                                    //                                    $dato = $fi[$i]/$tc;
                                    $dato = $fi[$i];
                                }
                                //$devS .= "<td style='line-height:150%;text-align:right;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$total."&nbsp;</td>";

                                $devS .= "<td style='line-height:150%;text-align:right;border-left: 1px solid #000000;'>&nbsp;".redondear($dato)."&nbsp;</td>";
                            }
                            else
                            {

                                $devS .= "<td style='line-height:150%;border-left: 1px solid #000000;'>&nbsp;".$fi[$i]."&nbsp;</td>";
                            }
                        }
                        $devS .= "</tr>";
                        $ii++;
                        $z ++;
                    }while($fi = mysql_fetch_array($re));
                    //dibujamos pie
                    if($pie != "ninguno")
                    {
                        $devS .= "<tr><td colspan='".(mysql_num_fields($re)+1)."' style='border-bottom:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'></td></tr>";
                    }
                    $devS .= "<tr><td style='border-bottom:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Totales</td><td></td><td></td><td></td><td style='border-bottom:1px solid #000000;font-weight:bold;font-size:15px;text-align:center;background-color:silver;'>$tcajas</td><td style='border-bottom:1px solid #000000;font-weight:bold;font-size:15px;text-align:center;background-color:silver;'>$tpares</td><td style='border-bottom:1px solid #000000;font-weight:bold;font-size:15px;text-center:right;background-color:silver;'>$tsus</td><td style='border-bottom:1px solid #000000;font-weight:bold;font-size:15px;text-align:center;background-color:silver;'>$tdesc</td><td style='border-bottom:1px solid #000000;font-weight:bold;font-size:15px;text-align:center;background-color:silver;'>$tmonto</td>";
                    $devS .= "</tr>";

                    $devS .= "</table>";

                    $dev['mensaje'] = "Existen resultados";
                    $dev['error']   = "true";
                    $dev['resultado'] = $devS;

                }
                else
                {
                    $dev['mensaje'] = "No se encontro datos en la consulta2".mysql_error();
                    $dev['error']   = "false";
                    $dev['resultado'] = "";
                }
            }
            else
            {
                $dev['mensaje'] = "Error en la consulta";
                $dev['error']   = "false";
                $dev['resultado'] = "";
            }
        }
        else
        {
            $dev['mensaje'] = "No se pudo conectar a la BD";
            $dev['error']   = "false";
            $dev['resultado'] = "";
        }
    }
    else
    {
        $dev['mensaje'] = "No se pudo crear la conexion a la BD";
        $dev['error']   = "false";
        $dev['resultado'] = "";
    }
    return $dev;
}

function dibujarTablaparaingresos($sql, $titulo,$tcajas,$tpares,$tsus)
{
    if($link=new BD)
    {
        if($link->conectar())
        {
            if($re = $link->consulta($sql))
            {
                //echo mysql_num_rows($re);
                if($fi = mysql_fetch_array($re))
                {
                    $devS .= "<table cellpadding='0' cellspacing='0' border='0' style='width:75%;border:1px solid #000000;font-size:12px;'>";
                    if($titulo != "ninguno")
                    {
                        $devS .= "<tr><td colspan='".(mysql_num_fields($re)+1)."' style='border-bottom:1px solid #000000;font-weight:bold;font-size:20px;text-align:left;background-color:silver;'>$titulo</td></tr>";
                        //           $devvS .= "<td><td colspan='".(mysql_num_fields($re)-1)."' style='border-bottom:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>$total</td></tr>";

                    }
                    $devS .= "<tr><td style='border-bottom:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Nro</td>";
                    for($zz = 0; $zz < mysql_num_fields($re); $zz++)
                    {
                        $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:12px;text-align:center;background-color:silver;'>".mysql_field_name($re, $zz)."</td>";
                    }
                    $devS .= "</tr>";
                    $ii = 0;
                    //$totalCount = mysql_num_rows($re);
                    $z = 1;
                    do{
                        $devS .= "<tr><td style='text-align:center'>".$z."</td>";
                        for($i = 0; $i< mysql_num_fields($re); $i++)
                        {
                            if(mysql_field_type($re, $i) == "real")
                            {
                                $dato = $fi[$i];
                                if(mysql_field_name($re, $i) == "precio" || mysql_field_name($re, $i) == "importe")
                                {
                                    //                                    $dato = $fi[$i]/$tc;
                                    $dato = $fi[$i];
                                }
                                //$devS .= "<td style='line-height:150%;text-align:right;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$total."&nbsp;</td>";

                                $devS .= "<td style='line-height:150%;text-align:right;border-left: 1px solid #000000;'>&nbsp;".redondear($dato)."&nbsp;</td>";
                            }
                            else
                            {

                                $devS .= "<td style='line-height:150%;border-left: 1px solid #000000;'>&nbsp;".$fi[$i]."&nbsp;</td>";
                            }
                        }
                        $devS .= "</tr>";
                        $ii++;
                        $z ++;
                    }while($fi = mysql_fetch_array($re));
                    //dibujamos pie
                    if($pie != "ninguno")
                    {
                        $devS .= "<tr><td colspan='".(mysql_num_fields($re)+1)."' style='border-bottom:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'></td></tr>";
                    }
                    $devS .= "<tr><td style='border-bottom:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Totales</td><td></td><td></td><td style='border-bottom:1px solid #000000;font-weight:bold;font-size:15px;text-align:center;background-color:silver;'>$tpares</td><td style='border-bottom:1px solid #000000;font-weight:bold;font-size:15px;text-align:center;background-color:silver;'>$tcajas</td><td style='border-bottom:1px solid #000000;font-weight:bold;font-size:15px;text-center:right;background-color:silver;'>$tsus</td><td style='border-bottom:1px solid #000000;font-weight:bold;font-size:15px;text-align:center;background-color:silver;'>$tdesc</td><td style='border-bottom:1px solid #000000;font-weight:bold;font-size:15px;text-align:center;background-color:silver;'>$tmonto</td>";
                    $devS .= "</tr>";

                    $devS .= "</table>";

                    $dev['mensaje'] = "Existen resultados";
                    $dev['error']   = "true";
                    $dev['resultado'] = $devS;

                }
                else
                {
                    $dev['mensaje'] = "No se encontro datos en la consulta2".mysql_error();
                    $dev['error']   = "false";
                    $dev['resultado'] = "";
                }
            }
            else
            {
                $dev['mensaje'] = "Error en la consulta";
                $dev['error']   = "false";
                $dev['resultado'] = "";
            }
        }
        else
        {
            $dev['mensaje'] = "No se pudo conectar a la BD";
            $dev['error']   = "false";
            $dev['resultado'] = "";
        }
    }
    else
    {
        $dev['mensaje'] = "No se pudo crear la conexion a la BD";
        $dev['error']   = "false";
        $dev['resultado'] = "";
    }
    return $dev;
}

function dibujarTablaparaventasmodelo($sql, $titulo,$tcajas,$tpares,$tsus,$tdesc,$tmonto)
{
    if($link=new BD)
    {
        if($link->conectar())
        {
            if($re = $link->consulta($sql))
            {
                //echo mysql_num_rows($re);
                if($fi = mysql_fetch_array($re))
                {
                    $devS .= "<table cellpadding='0' cellspacing='0' border='0' style='width:75%;border:1px solid #000000;font-size:12px;'>";
                    if($titulo != "ninguno")
                    {
                        $devS .= "<tr><td colspan='".(mysql_num_fields($re)+1)."' style='border-bottom:1px solid #000000;font-weight:bold;font-size:20px;text-align:left;background-color:silver;'>$titulo</td></tr>";
                        //           $devvS .= "<td><td colspan='".(mysql_num_fields($re)-1)."' style='border-bottom:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>$total</td></tr>";

                    }
                    $devS .= "<tr><td style='border-bottom:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Nro</td>";
                    for($zz = 0; $zz < mysql_num_fields($re); $zz++)
                    {
                        $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:12px;text-align:center;background-color:silver;'>".mysql_field_name($re, $zz)."</td>";
                    }
                    $devS .= "</tr>";
                    $ii = 0;
                    //$totalCount = mysql_num_rows($re);
                    $z = 1;
                    do{
                        $devS .= "<tr><td style='text-align:center'>".$z."</td>";
                        for($i = 0; $i< mysql_num_fields($re); $i++)
                        {
                            if(mysql_field_type($re, $i) == "real")
                            {
                                $dato = $fi[$i];
                                if(mysql_field_name($re, $i) == "precio" || mysql_field_name($re, $i) == "importe")
                                {
                                    //                                    $dato = $fi[$i]/$tc;
                                    $dato = $fi[$i];
                                }
                                //$devS .= "<td style='line-height:150%;text-align:right;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$total."&nbsp;</td>";

                                $devS .= "<td style='line-height:150%;text-align:right;border-left: 1px solid #000000;'>&nbsp;".redondear($dato)."&nbsp;</td>";
                            }
                            else
                            {

                                $devS .= "<td style='line-height:150%;border-left: 1px solid #000000;'>&nbsp;".$fi[$i]."&nbsp;</td>";
                            }
                        }
                        $devS .= "</tr>";
                        $ii++;
                        $z ++;
                    }while($fi = mysql_fetch_array($re));
                    //dibujamos pie
                    if($pie != "ninguno")
                    {
                        $devS .= "<tr><td colspan='".(mysql_num_fields($re)+1)."' style='border-bottom:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'></td></tr>";
                    }
                    //      $devS .= "<tr><td style='border-bottom:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Totales</td><td></td><td></td><td></td><td style='border-bottom:1px solid #000000;font-weight:bold;font-size:15px;text-align:center;background-color:silver;'>$tcajas</td><td style='border-bottom:1px solid #000000;font-weight:bold;font-size:15px;text-align:center;background-color:silver;'>$tpares</td><td style='border-bottom:1px solid #000000;font-weight:bold;font-size:15px;text-center:right;background-color:silver;'>$tsus</td><td style='border-bottom:1px solid #000000;font-weight:bold;font-size:15px;text-align:center;'></td><td style='border-bottom:1px solid #000000;font-weight:bold;font-size:15px;text-align:center;'></td>";
                    $devS .= "</tr>";

                    $devS .= "</table>";

                    $dev['mensaje'] = "Existen resultados";
                    $dev['error']   = "true";
                    $dev['resultado'] = $devS;

                }
                else
                {
                    $dev['mensaje'] = "No se encontro datos en la consulta2".mysql_error();
                    $dev['error']   = "false";
                    $dev['resultado'] = "";
                }
            }
            else
            {
                $dev['mensaje'] = "Error en la consulta";
                $dev['error']   = "false";
                $dev['resultado'] = "";
            }
        }
        else
        {
            $dev['mensaje'] = "No se pudo conectar a la BD";
            $dev['error']   = "false";
            $dev['resultado'] = "";
        }
    }
    else
    {
        $dev['mensaje'] = "No se pudo crear la conexion a la BD";
        $dev['error']   = "false";
        $dev['resultado'] = "";
    }
    return $dev;
}

function dibujarTablaObjectoOfSQLinventario($producto, $tc = 1)
{
    //echo mysql_num_rows($re);
    //lol
    $devS .= "<table cellpadding='0' cellspacing='0' border='0' style='width:750px;border:1px solid #000000;font-size:14px;'>";
    $devS .= "<tr><td style='border-bottom:1px solid #000000;font-weight:bold;font-size:14px;text-align:center;background-color:silver;'>Nro</td>";

    //dibjamos las cabeceras
    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:14px;text-align:center;background-color:silver;'>Vendedor</td>";
    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:14px;text-align:center;background-color:silver;'>Vendedor1</td>";
    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:14px;text-align:center;background-color:silver;'>Vendedor2</td>";
    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:14px;text-align:center;background-color:silver;'>Vendedor1</td>";
    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:14px;text-align:center;background-color:silver;'>Vendedor1</td>";
    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:14px;text-align:center;background-color:silver;'>Vendedor1</td>";
    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:14px;text-align:center;background-color:silver;'>Vendedor1</td>";
    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:14px;text-align:center;background-color:silver;'>Vendedor1</td>";
    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:14px;text-align:center;background-color:silver;'>Vendedor1</td>";

    $devS .= "</tr>";
    $ii = 0;
    $z = 1;
    for($j=0;$j<count($producto);$j++){
        $col = $producto[$j]->idempleado;
        $mod = $producto[$j]->codigo;
        $colo = $producto[$j]->vendedor;
        $col1 = $producto[$j]->idempleado;
        $mod1 = $producto[$j]->codigo;
        $colo1 = $producto[$j]->vendedor;
        $col2 = $producto[$j]->idempleado;
        $mod2 = $producto[$j]->codigo;
        $colo2 = $producto[$j]->vendedor;
        $devS .= "<tr><td style='text-align:center'>".$z."</td>";


        $devS .= "<td style='border-left: 1px solid #000000;'>&nbsp;$col&nbsp;</td>";
        $devS .= "<td style='border-left: 1px solid #000000;'>&nbsp;$mod&nbsp;</td>";
        $devS .= "<td style='border-left: 1px solid #000000;'>&nbsp;$colo&nbsp;</td>";
        $devS .= "<td style='border-left: 1px solid #000000;'>&nbsp;$col1&nbsp;</td>";
        $devS .= "<td style='border-left: 1px solid #000000;'>&nbsp;$mod1&nbsp;</td>";
        $devS .= "<td style='border-left: 1px solid #000000;'>&nbsp;$colo1&nbsp;</td>";
        $devS .= "<td style='border-left: 1px solid #000000;'>&nbsp;$col2&nbsp;</td>";
        $devS .= "<td style='border-left: 1px solid #000000;'>&nbsp;$mod2&nbsp;</td>";
        $devS .= "<td style='border-left: 1px solid #000000;'>&nbsp;$colo2&nbsp;</td>";
        $devS .= "</tr>";
        $ii++;
        $z ++;
    }
    $devS .= "</table>";

    $dev['mensaje'] = "Existen resultados";
    $dev['error']   = "true";
    $dev['resultado'] = $devS;




    return $dev;
}

function dibujarTablaOfSQLinventariotallam($modelo,$sql,$sql21,$row1,$idmarca,$idestilo,$rango1,$rango2,$totalpar1,$totalbs1, $tipo,$marcapedido)
{$mimodelo= $modelo;
    $sqlmarca = " SELECT tabla,mesrango,idperiodo,fechainicio,fechafin FROM administrakardex WHERE tabla= 'adicionkardextienda' ";
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "tabla");
    $tabla = $opcionkardex['resultado'];
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "mesrango");
    $mesrango = $opcionkardex['resultado'];
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "idperiodo");
    $idperiodo = $opcionkardex['resultado'];
    //echo $tabla;
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "fechainicio");
    $fechainicio = $opcionkardex['resultado'];
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "fechafin");
    $fechafin = $opcionkardex['resultado'];
    if($fechafin==null ||$fechafin == ""){
        $fechafin = Date("Y-m-d");
    }

    if($tabla=="historialkardextienda"){
    }else{
        $sqlInv = "SELECT MAX(idperiodo)AS numero
FROM administrakardex where tabla='historialkardextienda'";
        $almacenA1 =  findBySqlReturnCampoUnique($sqlInv, true, true, 'numero');
        $idperiodoant = $almacenA1['resultado'];
        $sqlmarca = " SELECT tabla,mesrango,idperiodo,fechainicio,fechafin FROM administrakardex WHERE idperiodo = '$idperiodoant' ";
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "fechainicio");
        // $fechainicio = $opcionkardex['resultado'];
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "fechafin");
        // $fechafin = $opcionkardex['resultado'];
    }
    $sql211 = getTablaToArrayOfSQL($sql21);
    $sql3 = $sql211['resultado'];
    if($link=new BD)
    {
        if($link->conectar())
        {
            if($re = $link->consulta($sql))
            {
                //echo mysql_num_rows($re);
                if($fi = mysql_fetch_array($re))
                {
                    $devS .= "<table cellpadding='0' cellspacing='0' border='0' style='width:1250px;border:1px solid #000000;font-size:13px;font-family:Arial;'>";

                    //                    $devS .= "<table cellpadding='0' cellspacing='0' border='0' style='width:750px;border:1px solid #000000;font-size:11px;'>";
                    $devS .= "<tr><td style='border-bottom:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Nro</td>";
                    $devS .= "<td style='display:none;'>".mysql_field_name($re, $zz)."</td>";
                    // $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Modelo</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Modelo</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Color</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Precio</td>";
                    for($hi=0;$hi<$row1;$hi++){
                        $codigo = $sql3[$hi];
                        $idmmarca = $codigo['talla'];

                        $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>$idmmarca</td>";
                        $ji++;
                    }
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Stock Anterior</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Recib</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Trasp Rec</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Dev</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Trasp Desp</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Venta</td>";

                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Stock Actual</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Bs</td>";

                    $devS .= "</tr>";
                    $ii = 0;
                    //$totalCount = mysql_num_rows($re);
                    $z = 1;
                    do{
                        $devS .= "<tr><td style='text-align:left'>".$z."</td>";
                        for($i = 0; $i< mysql_num_fields($re); $i++)
                        {$dato = $fi[$i];
                            $iddetalleingreso = $fi[$i]['iddetalleingreso'];
                            $devS .= "<td style='display:none;'>&nbsp;".$dato."&nbsp;</td>";
                            // echo $marcapedido;
                            $select = "dtp.totalbs AS precio";
                            $from = "adiciondetalleingreso dtp, modelos mdd, coleccion col, estilos es";
                            $where = "dtp.idmodelo = mdd.idmodelo AND mdd.idcoleccion = col.idcoleccion AND mdd.stylename = es.idestilo AND dtp.iddetalleingreso='$dato'";

                            if($marcapedido=='CODIGO-COLOR-MATERIAL'){
                                $select .= ",concat(col.detalle,'-',mdd.codigo) AS codigo, dtp.color";
                            }else{
                                if($marcapedido=="CODIGO-MATERIAL"){
                                    $select .= ",concat(mdd.codigo,'-',dtp.material) AS codigo, dtp.color";
                                }else{
                                    if(($marcapedido=="CODIGO-COLOR")||($marcapedido=="CODIGO")){
                                        $select .= ",mdd.codigo, dtp.color";
                                    }else{
                                        if($marcapedido=="CODIGO-COLOR-STYLENAME"){
                                            $select .= ",concat(mdd.codigo,'-',dtp.color) AS codigo, dtp.material AS color";
                                        }else{
                                            if($marcapedido=="LINEA-CODIGO-COLOR"){
                                                $select .= ",concat(mdd.codigo,'-',dtp.color) AS codigo, dtp.material AS color";
                                                $from .= ",lineas l";
                                                $where .= ",AND mdd.idlinea = l.idlinea";

                                            }
                                        }

                                    }
                                }
                            }

                            // $from = "adiciondetalleingreso dtp, modelos mdd, coleccion col, estilos es";
                            //$where = "dtp.idmodelo = mdd.idmodelo AND mdd.idcoleccion = col.idcoleccion AND mdd.stylename = es.idestilo AND dtp.iddetalleingreso='$dato'";
                            $sql2p1 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                            // echo $sql2p1;
                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p1, true, true, 'codigo');
                            $modelo = $almacenA1['resultado'];
                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p1, true, true, 'color');
                            $color = $almacenA1['resultado'];
                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p1, true, true, 'precio');
                            $precio = $almacenA1['resultado'];
                            $devS .= "<td style='text-align:left;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$modelo."&nbsp;</td>";
                            $devS .= "<td style='text-align:left;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$color."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$precio."&nbsp;</td>";


                            for($h=0;$h<$row1;$h++){
                                $codigo = $sql3[$h];
                                $idmmarca = $codigo['talla'];

                                $select1 = "saldocantidad AS Pares";
                                $from1 = "adicionkardextienda";
                                $where1 = "idcalzado = '$dato' AND talla='$idmmarca' and unido='no'";
                                //if($ltienda != "Todos"){ $where .= " AND ve.idtienda = '$ltienda' ";}
                                $sql21 = "SELECT ".$select1." FROM ".$from1. " WHERE ".$where1;

                                $almacenA1 =  findBySqlReturnCampoUnique($sql21, true, true, 'Pares');
                                $pares1 = $almacenA1['resultado'];

                                // if($pares1==NULL || $pares1 =='' || $pares1 == ""){ $pares1="0"; }
                                $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$pares1."&nbsp;</td>";
                                $j++;
                            }


                            $sqlInv = "SELECT MAX(idperiodo)AS numero
FROM administrakardex where tabla='historialkardextienda'";
                            $almacenA1 =  findBySqlReturnCampoUnique($sqlInv, true, true, 'numero');
                            $idperiodoant = $almacenA1['resultado'];
                            //  echo $idperiodoant;
                            $select = "SUM(saldocantidad) AS Pares";
                            $from = "historialkardextienda k";
                            $where = " k.idcalzado='$dato' AND k.idperiodo='$idperiodoant' AND k.unido='no'";
                            $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                            $stockanterior = $almacenA1['resultado'];

                            if($stockanterior==NULL || $stockanterior =='' || $stockanterior == ""){ $stockanterior="0"; }


                            $select = "SUM( dtpt.cantidad ) AS Pares";
                            $from = "adicioningresotienda k, adiciondetalleingresotalla dtpt, adiciondetalleingreso ad, modelos mdd";
                            $where = "k.idingreso = dtpt.idingreso AND dtpt.idmodelo = mdd.idmodelo
AND dtpt.iddetalleingreso = ad.iddetalleingreso";
                            { $where .= " AND k.fecha >= '$fechainicio' AND
k.fecha <= '$fechafin' AND  dtpt.iddetalleingreso='$dato'";}
                            if($idestilo !="null")
                            { $where .= " AND mdd.stylename = '$idestilo'";}
                            if($idestilo!=null || $idestilo!='')
                            { $where .= " AND mdd.stylename = '$idestilo'";}
                            $sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where;
                            $almacenA1 =  findBySqlReturnCampoUnique($sql25, true, true, 'Pares');
                            $recibido = $almacenA1['resultado'];

                            //  if($recibido==NULL || $recibido =='' || $recibido == ""){ $recibido="0"; }
                            $select = "SUM(i.cantidad) AS Pares";
                            $from = "ingresos i,adicionkardextienda k";
                            $where = " k.idcalzado='$dato' AND k.idkardextienda=i.idkardextienda AND i.fecha >= '$fechainicio'
    AND i.fecha <= '$fechafin' AND i.detalle2!='ingresoalmacen' ";
                            $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                            $trasrecibido = $almacenA1['resultado'];
                            //if($trasrecibido==NULL || $trasrecibido =='' || $trasrecibido == ""){ $trasrecibido="0"; }

                            $select = "SUM(i.cantidad) AS Pares";
                            $from = "detalletraspaso i,adicionkardextienda k,traspasos tr";
                            $where = " k.idcalzado='$dato' AND k.idkardextienda=i.idkardextienda ANd i.idtraspaso=tr.idtraspaso AND tr.fecha >= '$fechainicio'
    AND tr.fecha <= '$fechafin' ";
                            $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                            $trasdesp = $almacenA1['resultado'];

                            if($trasdesp==NULL || $trasdesp =='' || $trasdesp == ""){ $trasdesp="0"; }
                            $select = "SUM(i.cantidad) AS Pares";
                            $from = "itemventa i,adicionkardextienda k, ventasdetalle v";
                            $where = " k.idcalzado='$dato' AND k.idkardextienda=i.idkardextienda ANd i.idventa=v.idventadetalle AND  i.estado!='cambiado'
and v.fecha >= '$fechainicio'
    AND v.fecha <= '$fechafin' ";
                            $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                            $venta = $almacenA1['resultado'];
                            // $pares=$totalparesiddetalleingreso;
                            if($venta==NULL || $venta =='' || $venta == ""){ $venta="0"; }
                            if($tabla=="historialkardextienda"){

                                $select = "SUM(saldocantidad) AS Pares";
                                $from = "historialkardextienda k";
                                $where = " k.idcalzado='$dato' and k.unido='no' AND k.idperiodo='$idperiodo'";
                                $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                                $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                                $pares = $almacenA1['resultado'];
                            }else{
                                $select = "SUM(saldocantidad) AS Pares";
                                $from = "adicionkardextienda k";
                                $where = " k.idcalzado='$dato' and k.unido='no'";
                                $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                                $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                                $pares = $almacenA1['resultado'];

                            }

                            $select = "SUM(saldocantidad*precio2bs) AS bs";
                            $from = "adicionkardextienda k";
                            $where = " k.idcalzado='$dato' and k.unido='no'";
                            $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'bs');
                            $totalbs = $almacenA1['resultado'];


                            if($totalbs==NULL || $totalbs =='' || $totalbs == ""){ $totalbs="0"; }
                            if($paresactual==NULL || $paresactual =='' || $paresactual == ""){ $paresactual="0"; }
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$stockanterior."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$recibido."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$trasprec."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$dev."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$trasdesp."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$venta."&nbsp;</td>";

                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$pares."&nbsp;</td>";

                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$totalbs."&nbsp;</td>";

                        }
                        $devS .= "</tr>";
                        $ii++;
                        $z ++;
                    }while($fi = mysql_fetch_array($re));
                    $devS .= "<tr style='background-color:silver;'><td style='border: 1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>TOTAL</td>";
                    $devS .= "<td style='display:none;'></td>";
                    $fechatoday = Date("d-m-Y");
                    $devS .= "<td style='text-align:center;border-bottom: 1px solid #000000;'></td>";
                    $devS .= "<td style='text-align:center;border-bottom: 1px solid #000000;'></td>";
                    $devS .= "<td style='text-align:center;border-bottom: 1px solid #000000;'></td>";

                    for($h=0;$h<$row1;$h++){
                        $codigo = $sql3[$h];
                        $idmmarca = $codigo['idmarca'];

                        $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'></td>";
                        $j++;
                    }



                    $sqlInv = "SELECT MAX(idperiodo)AS numero
FROM administrakardex where tabla='historialkardextienda'";
                    $almacenA1 =  findBySqlReturnCampoUnique($sqlInv, true, true, 'numero');
                    $idperiodoant = $almacenA1['resultado'];
                    $select = "SUM(saldocantidad) AS Pares";
                    $from = "historialkardextienda k,modelos mdt";
                    $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.codigo LIKE '%$mimodelo%' AND mdt.idmarca = '$idmarca' AND mdt.stylename = '$idestilo' AND k.idperiodo='$idperiodoant' AND k.unido='no'";
                    $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                    $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                    $tstockant = $almacenA1['resultado'];

                    // reseteo
                    $select = "SUM( dtpt.cantidad ) AS Pares";
                    $from = "adicioningresotienda k, adiciondetalleingresotalla dtpt, adiciondetalleingreso ad, modelos mdd";
                    $where = "k.idingreso = dtpt.idingreso AND dtpt.idmodelo = mdd.idmodelo
AND dtpt.iddetalleingreso = ad.iddetalleingreso";
                    { $where .= " AND mdd.stylename = '$idestilo' AND mdd.codigo LIKE '%$mimodelo%'AND k.fecha >= '$fechainicio' AND
k.fecha <= '$fechafin' ";}

                    $sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where;

                    $almacenA1 =  findBySqlReturnCampoUnique($sql25, true, true, 'Pares');
                    $recibido = $almacenA1['resultado'];
                    if($recibido==NULL || $recibido =='' || $recibido == ""){ $recibido="0"; }
                    $select = "SUM(i.cantidad) AS Pares";
                    $from = "ingresos i,adicionkardextienda k,modelos mdt";
                    $where = "k.idkardextienda=i.idkardextienda AND i.fecha >= '$fechainicio'
    AND i.fecha <= '$fechafin' and k.idmodelodetalle=mdt.idmodelo AND mdt.codigo LIKE '%$mimodelo%' and mdt.stylename = '$idestilo' AND i.detalle2!='ingresoalmacen' ";
                    $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                    $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                    $trasrecibido = $almacenA1['resultado'];
                    //  if($trasrecibido==NULL || $trasrecibido =='' || $trasrecibido == ""){ $trasrecibido="0"; }

                    $select = "SUM(i.cantidad) AS Pares";
                    $from = "detalletraspaso i,adicionkardextienda k,traspasos tr,modelos mdt";
                    $where = "  k.idkardextienda=i.idkardextienda ANd i.idtraspaso=tr.idtraspaso  and k.idmodelodetalle=mdt.idmodelo and mdt.stylename = '$idestilo'
AND tr.fecha >= '$fechainicio'
    AND tr.fecha <= '$fechafin' AND mdt.codigo='$mimodelo' ";
                    $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                    $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                    $trasdesp = $almacenA1['resultado'];

                    //  if($trasdesp==NULL || $trasdesp =='' || $trasdesp == ""){ $trasdesp="0"; }
                    $select = "SUM(i.cantidad) AS Pares";
                    $from = "itemventa i,adicionkardextienda k, ventasdetalle v,modelos mdt";
                    $where = "k.idkardextienda=i.idkardextienda ANd i.idventa=v.idventadetalle AND k.idmodelodetalle=mdt.idmodelo  and mdt.stylename = '$idestilo'
and i.estado!='cambiado' AND v.fecha >= '$fechainicio'
    AND v.fecha <= '$fechafin' AND mdt.codigo LIKE '%$mimodelo%' ";

                    $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                    //  echo $sql2p;
                    //    d
                    $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                    $venta = $almacenA1['resultado'];
                    // $pares=$totalparesiddetalleingreso;
                    if($venta==NULL || $venta =='' || $venta == ""){ $venta="0"; }



                    $select = "SUM(k.saldocantidad) AS Pares";
                    $from = "adicionkardextienda k,modelos mdt";
                    $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.codigo LIKE '%$mimodelo%' AND mdt.stylename = '$idestilo'  AND k.unido='no'";
                    $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                    $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                    $tstockactual = $almacenA1['resultado'];


                    if($tstockactual==NULL || $tstockactual =='' || $tstockactual == ""){ $tstockactual="0"; }
                    //fin

                    $select = "SUM(k.saldocantidad*precio2bs) AS Pares";
                    $from = "adicionkardextienda k,modelos mdt";
                    $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.codigo LIKE '%$mimodelo%' AND mdt.stylename = '$idestilo'  AND k.unido='no'";
                    $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                    $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                    $totalbsactual = $almacenA1['resultado'];


                    if($tstockactual==NULL || $tstockactual =='' || $tstockactual == ""){ $tstockactual="0"; }
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$tstockant."&nbsp;</td>";

                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$recibido."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$trasrecibido."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$dev."&nbsp;</td>";

                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$trasdesp."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$venta."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$tstockactual."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$totalbsactual."&nbsp;</td>";

                    $devS .= "</tr>";
                    $devS .= "</table>";

                    $dev['mensaje'] = "Existen resultados";
                    $dev['error']   = "true";
                    $dev['resultado'] = $devS;

                }
                else
                {
                    $dev['mensaje'] = "No se encontro datos en la consulta2".mysql_error();
                    $dev['error']   = "false";
                    $dev['resultado'] = "";
                }
            }
            else
            {
                $dev['mensaje'] = "Error en la consulta";
                $dev['error']   = "false";
                $dev['resultado'] = "";
            }
        }
        else
        {
            $dev['mensaje'] = "No se pudo conectar a la BD";
            $dev['error']   = "false";
            $dev['resultado'] = "";
        }
    }
    else
    {
        $dev['mensaje'] = "No se pudo crear la conexion a la BD";
        $dev['error']   = "false";
        $dev['resultado'] = "";
    }
    return $dev;
}
function dibujarTablaOfSQLinventario($idkardex,$sql,$sql21,$row1,$idmarca,$idestilo,$rango1,$rango2,$totalpar1,$totalbs1, $tipo,$marcapedido)
{
    $sqlmarca = " SELECT tabla,mesrango,idperiodo,fechainicio,fechafin FROM administrakardex WHERE idkardex = '$idkardex' ";
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "tabla");
    $tabla = $opcionkardex['resultado'];
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "mesrango");
    $mesrango = $opcionkardex['resultado'];
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "idperiodo");
    $idperiodo = $opcionkardex['resultado'];
    //echo $tabla;
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "fechainicio");
    $fechainicio = $opcionkardex['resultado'];
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "fechafin");
    $fechafin = $opcionkardex['resultado'];
    if($fechafin==null ||$fechafin == ""){
        $fechafin = Date("Y-m-d");
    }

    if($tabla=="historialkardextienda"){
    }else{
        $sqlInv = "SELECT MAX(idperiodo)AS numero
FROM administrakardex where tabla='historialkardextienda'";
        $almacenA1 =  findBySqlReturnCampoUnique($sqlInv, true, true, 'numero');
        $idperiodoant = $almacenA1['resultado'];
        $sqlmarca = " SELECT tabla,mesrango,idperiodo,fechainicio,fechafin FROM administrakardex WHERE idperiodo = '$idperiodoant' ";
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "fechainicio");
        // $fechainicio = $opcionkardex['resultado'];
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "fechafin");
        // $fechafin = $opcionkardex['resultado'];
    }
    $sql211 = getTablaToArrayOfSQL($sql21);
    $sql3 = $sql211['resultado'];
    if($link=new BD)
    {
        if($link->conectar())
        {
            if($re = $link->consulta($sql))
            {
                //echo mysql_num_rows($re);
                if($fi = mysql_fetch_array($re))
                {
                    $devS .= "<table cellpadding='0' cellspacing='0' border='0' style='width:750px;border:1px solid #000000;font-size:11px;'>";
                    $devS .= "<tr><td style='border-bottom:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Nro</td>";
                    $devS .= "<td style='display:none;'>".mysql_field_name($re, $zz)."</td>";
                    // $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Modelo</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Modelo</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Color</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Precio</td>";
                    for($hi=0;$hi<$row1;$hi++){
                        $codigo = $sql3[$hi];
                        $idmmarca = $codigo['talla'];

                        $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>$idmmarca</td>";
                        $ji++;
                    }
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Stock Anterior</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Recib</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Trasp REc</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Dev</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Trasp Desp</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Venta</td>";

                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Stock Actual</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>SBs</td>";

                    $devS .= "</tr>";
                    $ii = 0;
                    //$totalCount = mysql_num_rows($re);
                    $z = 1;
                    do{
                        $devS .= "<tr><td style='text-align:left'>".$z."</td>";
                        for($i = 0; $i< mysql_num_fields($re); $i++)
                        {$dato = $fi[$i];
                            $iddetalleingreso = $fi[$i]['iddetalleingreso'];
                            $devS .= "<td style='display:none;'>&nbsp;".$dato."&nbsp;</td>";
                            // echo $marcapedido;
                            $select = "dtp.totalbs AS precio";
                            $from = "adiciondetalleingreso dtp, modelos mdd, coleccion col, estilos es";
                            $where = "dtp.idmodelo = mdd.idmodelo AND mdd.idcoleccion = col.idcoleccion AND mdd.stylename = es.idestilo AND dtp.iddetalleingreso='$dato'";

                            if($marcapedido=='CODIGO-COLOR-MATERIAL'){
                                $select .= ",concat(col.detalle,'-',mdd.codigo) AS codigo, dtp.color";
                            }else{
                                if($marcapedido=="CODIGO-MATERIAL"){
                                    $select .= ",concat(mdd.codigo,'-',dtp.material) AS codigo, dtp.color";
                                }else{
                                    if(($marcapedido=="CODIGO-COLOR")||($marcapedido=="CODIGO")){
                                        $select .= ",mdd.codigo, dtp.color";
                                    }else{
                                        if($marcapedido=="CODIGO-COLOR-STYLENAME"){
                                            $select .= ",concat(mdd.codigo,'-',dtp.color) AS codigo, dtp.material AS color";
                                        }else{
                                            if($marcapedido=="LINEA-CODIGO-COLOR"){
                                                $select .= ",concat(mdd.codigo,'-',dtp.color) AS codigo, dtp.material AS color";
                                                $from .= ",lineas l";
                                                $where .= ",AND mdd.idlinea = l.idlinea";

                                            }
                                        }

                                    }
                                }
                            }

                            // $from = "adiciondetalleingreso dtp, modelos mdd, coleccion col, estilos es";
                            //$where = "dtp.idmodelo = mdd.idmodelo AND mdd.idcoleccion = col.idcoleccion AND mdd.stylename = es.idestilo AND dtp.iddetalleingreso='$dato'";
                            $sql2p1 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                            // echo $sql2p1;
                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p1, true, true, 'codigo');
                            $modelo = $almacenA1['resultado'];
                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p1, true, true, 'color');
                            $color = $almacenA1['resultado'];
                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p1, true, true, 'precio');
                            $precio = $almacenA1['resultado'];
                            $devS .= "<td style='text-align:left;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$modelo."&nbsp;</td>";
                            $devS .= "<td style='text-align:left;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$color."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$precio."&nbsp;</td>";


                            for($h=0;$h<$row1;$h++){
                                $codigo = $sql3[$h];
                                $idmmarca = $codigo['talla'];
                                if($tabla=="historialkardextienda"){

                                    $select1 = "saldocantidad AS Pares";
                                    $from1 = "historialkardextienda";
                                    $where1 = "idcalzado = '$dato' AND talla='$idmmarca' AND idperiodo='$idperiodo'";
                                    //if($ltienda != "Todos"){ $where .= " AND ve.idtienda = '$ltienda' ";}
                                    $sql21 = "SELECT ".$select1." FROM ".$from1. " WHERE ".$where1;
                                    //echo $sql21;
                                    $almacenA1 =  findBySqlReturnCampoUnique($sql21, true, true, 'Pares');
                                    $pares1 = $almacenA1['resultado'];
                                }else{
                                    $select1 = "saldocantidad AS Pares";
                                    $from1 = "adicionkardextienda";
                                    $where1 = "idcalzado = '$dato' AND talla='$idmmarca'";
                                    //if($ltienda != "Todos"){ $where .= " AND ve.idtienda = '$ltienda' ";}
                                    $sql21 = "SELECT ".$select1." FROM ".$from1. " WHERE ".$where1;

                                    $almacenA1 =  findBySqlReturnCampoUnique($sql21, true, true, 'Pares');
                                    $pares1 = $almacenA1['resultado'];

                                }
                                // if($pares1==NULL || $pares1 =='' || $pares1 == ""){ $pares1="0"; }
                                $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$pares1."&nbsp;</td>";
                                $j++;
                            }

                            if($tabla=="historialkardextienda"){
                                $sqlInv = "SELECT MAX(idperiodo)AS numero
FROM administrakardex where tabla='historialkardextienda'";
                                $almacenA1 =  findBySqlReturnCampoUnique($sqlInv, true, true, 'numero');
                                $idperiodoant = $almacenA1['resultado'];
                                $idper = $idperiodoant - 1;
                                $select = "SUM(saldocantidad) AS Pares";
                                $from = "historialkardextienda k";
                                $where = " k.idcalzado='$dato' AND k.idperiodo='$idper' AND k.unido='no'";
                                $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                                $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                                $stockanterior = $almacenA1['resultado'];
                            }
                            else{
                                $sqlInv = "SELECT MAX(idperiodo)AS numero
FROM administrakardex where tabla='historialkardextienda'";
                                $almacenA1 =  findBySqlReturnCampoUnique($sqlInv, true, true, 'numero');
                                $idperiodoant = $almacenA1['resultado'];
                                //  echo $idperiodoant;
                                $select = "SUM(saldocantidad) AS Pares";
                                $from = "historialkardextienda k";
                                $where = " k.idcalzado='$dato' AND k.idperiodo='$idperiodoant' AND k.unido='no'";
                                $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                                $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                                $stockanterior = $almacenA1['resultado'];

                            }
                            if($stockanterior==NULL || $stockanterior =='' || $stockanterior == ""){ $stockanterior="0"; }


                            $select = "SUM( dtpt.cantidad ) AS Pares";
                            $from = "adicioningresotienda k, adiciondetalleingresotalla dtpt, adiciondetalleingreso ad, modelos mdd";
                            $where = "k.idingreso = dtpt.idingreso AND dtpt.idmodelo = mdd.idmodelo
AND dtpt.iddetalleingreso = ad.iddetalleingreso";
                            { $where .= " AND k.fecha >= '$fechainicio' AND
k.fecha <= '$fechafin' AND  dtpt.iddetalleingreso='$dato'";}
                            if($idestilo !="null")
                            { $where .= " AND mdd.stylename = '$idestilo'";}
                            if($idestilo!=null || $idestilo!='')
                            { $where .= " AND mdd.stylename = '$idestilo'";}
                            $sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where;
                            $almacenA1 =  findBySqlReturnCampoUnique($sql25, true, true, 'Pares');
                            $recibido = $almacenA1['resultado'];

                            //  if($recibido==NULL || $recibido =='' || $recibido == ""){ $recibido="0"; }
                            $select = "SUM(i.cantidad) AS Pares";
                            $from = "ingresos i,adicionkardextienda k";
                            $where = " k.idcalzado='$dato' AND k.idkardextienda=i.idkardextienda AND i.fecha >= '$fechainicio'
    AND i.fecha <= '$fechafin' AND i.detalle2!='ingresoalmacen' ";
                            $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                            $trasrecibido = $almacenA1['resultado'];
                            if($trasrecibido==NULL || $trasrecibido =='' || $trasrecibido == ""){ $trasrecibido="0"; }

                            $select = "SUM(i.cantidad) AS Pares";
                            $from = "detalletraspaso i,adicionkardextienda k,traspasos tr";
                            $where = " k.idcalzado='$dato' AND k.idkardextienda=i.idkardextienda ANd i.idtraspaso=tr.idtraspaso AND tr.fecha >= '$fechainicio'
    AND tr.fecha <= '$fechafin' ";
                            $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                            $trasdesp = $almacenA1['resultado'];

                            if($trasdesp==NULL || $trasdesp =='' || $trasdesp == ""){ $trasdesp="0"; }
                            $select = "SUM(i.cantidad) AS Pares";
                            $from = "itemventa i,adicionkardextienda k, ventasdetalle v";
                            $where = " k.idcalzado='$dato' AND k.idkardextienda=i.idkardextienda ANd i.idventa=v.idventadetalle AND  i.estado!='cambiado'
and v.fecha >= '$fechainicio'
    AND v.fecha <= '$fechafin' ";
                            $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                            $venta = $almacenA1['resultado'];
                            // $pares=$totalparesiddetalleingreso;
                            if($venta==NULL || $venta =='' || $venta == ""){ $venta="0"; }
                            if($tabla=="historialkardextienda"){

                                $select = "SUM(saldocantidad) AS Pares";
                                $from = "historialkardextienda k";
                                $where = " k.idcalzado='$dato' and k.unido='no' AND k.idperiodo='$idperiodo'";
                                $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                                $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                                $pares = $almacenA1['resultado'];
                            }else{
                                $select = "SUM(saldocantidad) AS Pares";
                                $from = "adicionkardextienda k";
                                $where = " k.idcalzado='$dato' and k.unido='no'";
                                $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                                $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                                $pares = $almacenA1['resultado'];

                            }
                            if($tabla=="historialkardextienda"){
                                $select = "SUM(saldocantidad*precio2bs) AS Pares";
                                $from = "historialkardextienda k";
                                $where = " k.idcalzado='$dato' and k.unido='no' AND k.idperiodo='$idperiodo'";
                                $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                                $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                                $totalbs = $almacenA1['resultado'];
                            }else{
                                $select = "SUM(saldocantidad*precio2bs) AS bs";
                                $from = "adicionkardextienda k";
                                $where = " k.idcalzado='$dato' and k.unido='no'";
                                $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                                $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'bs');
                                $totalbs = $almacenA1['resultado'];
                            }
                            // $pares=$totalparesiddetalleingreso;

                            if($pares==NULL || $pares =='' || $pares == ""){ $pares="0"; }


                            if($totalbs==NULL || $totalbs =='' || $totalbs == ""){ $totalbs="0"; }
                            if($paresactual==NULL || $paresactual =='' || $paresactual == ""){ $paresactual="0"; }
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$stockanterior."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$recibido."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$trasprec."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$dev."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$trasdesp."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$venta."&nbsp;</td>";

                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$pares."&nbsp;</td>";

                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$totalbs."&nbsp;</td>";

                        }
                        $devS .= "</tr>";
                        $ii++;
                        $z ++;
                    }while($fi = mysql_fetch_array($re));
                    $devS .= "<tr style='background-color:silver;'><td style='border: 1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>TOTAL</td>";
                    $devS .= "<td style='display:none;'></td>";
                    $fechatoday = Date("d-m-Y");
                    $devS .= "<td style='text-align:center;border-bottom: 1px solid #000000;'></td>";
                    $devS .= "<td style='text-align:center;border-bottom: 1px solid #000000;'></td>";
                    $devS .= "<td style='text-align:center;border-bottom: 1px solid #000000;'></td>";

                    for($h=0;$h<$row1;$h++){
                        $codigo = $sql3[$h];
                        $idmmarca = $codigo['idmarca'];

                        $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'></td>";
                        $j++;
                    }


                    if($tabla=="historialkardextienda"){
                        $sqlInv = "SELECT MAX(idperiodo)AS numero
FROM administrakardex where tabla='historialkardextienda'";
                        $almacenA1 =  findBySqlReturnCampoUnique($sqlInv, true, true, 'numero');
                        $idperiodoant = $almacenA1['resultado'];
                        $idper = $idperiodoant - 1;
                        $select = "SUM(saldocantidad) AS Pares";
                        $from = "historialkardextienda k,modelos mdt";
                        $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND mdt.stylename = '$idestilo' AND k.idperiodo='$idper' AND k.unido='no'";
                        $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                        $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                        $tstockant = $almacenA1['resultado'];
                    }
                    else{
                        $sqlInv = "SELECT MAX(idperiodo)AS numero
FROM administrakardex where tabla='historialkardextienda'";
                        $almacenA1 =  findBySqlReturnCampoUnique($sqlInv, true, true, 'numero');
                        $idperiodoant = $almacenA1['resultado'];
                        $select = "SUM(saldocantidad) AS Pares";
                        $from = "historialkardextienda k,modelos mdt";
                        $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND mdt.stylename = '$idestilo' AND k.idperiodo='$idperiodoant' AND k.unido='no'";
                        $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                        //echo $sql2p;
                        $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                        $tstockant = $almacenA1['resultado'];
                    }
                    // reseteo
                    $select = "SUM( dtpt.cantidad ) AS Pares";
                    $from = "adicioningresotienda k, adiciondetalleingresotalla dtpt, adiciondetalleingreso ad, modelos mdd";
                    $where = "k.idingreso = dtpt.idingreso AND dtpt.idmodelo = mdd.idmodelo
AND dtpt.iddetalleingreso = ad.iddetalleingreso";
                    { $where .= " AND mdd.stylename = '$idestilo' AND k.fecha >= '$fechainicio' AND
k.fecha <= '$fechafin' ";}

                    $sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where;

                    $almacenA1 =  findBySqlReturnCampoUnique($sql25, true, true, 'Pares');
                    $recibido = $almacenA1['resultado'];
                    if($recibido==NULL || $recibido =='' || $recibido == ""){ $recibido="0"; }
                    $select = "SUM(i.cantidad) AS Pares";
                    $from = "ingresos i,adicionkardextienda k,modelos mdt";
                    $where = "k.idkardextienda=i.idkardextienda AND i.fecha >= '$fechainicio'
    AND i.fecha <= '$fechafin' and k.idmodelodetalle=mdt.idmodelo and mdt.stylename = '$idestilo' AND i.detalle2!='ingresoalmacen' ";
                    $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                    $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                    $trasrecibido = $almacenA1['resultado'];
                    //  if($trasrecibido==NULL || $trasrecibido =='' || $trasrecibido == ""){ $trasrecibido="0"; }

                    $select = "SUM(i.cantidad) AS Pares";
                    $from = "detalletraspaso i,adicionkardextienda k,traspasos tr,modelos mdt";
                    $where = "  k.idkardextienda=i.idkardextienda ANd i.idtraspaso=tr.idtraspaso  and k.idmodelodetalle=mdt.idmodelo and mdt.stylename = '$idestilo'
AND tr.fecha >= '$fechainicio'
    AND tr.fecha <= '$fechafin' ";
                    $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                    $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                    $trasdesp = $almacenA1['resultado'];

                    //  if($trasdesp==NULL || $trasdesp =='' || $trasdesp == ""){ $trasdesp="0"; }
                    $select = "SUM(i.cantidad) AS Pares";
                    $from = "itemventa i,adicionkardextienda k, ventasdetalle v,modelos mdt";
                    $where = "k.idkardextienda=i.idkardextienda ANd i.idventa=v.idventadetalle AND k.idmodelodetalle=mdt.idmodelo  and mdt.stylename = '$idestilo'
and i.estado!='cambiado' AND v.fecha >= '$fechainicio'
    AND v.fecha <= '$fechafin' ";

                    $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                    //  echo $sql2p;
                    //    d
                    $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                    $venta = $almacenA1['resultado'];
                    // $pares=$totalparesiddetalleingreso;
                    if($venta==NULL || $venta =='' || $venta == ""){ $venta="0"; }



                    if($tabla=="historialkardextienda"){
                        $select = "SUM(k.saldocantidad) AS Pares";
                        $from = "historialkardextienda k,modelos mdt";
                        $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.stylename = '$idestilo'  AND k.unido='no' AND k.idperiodo='$idperiodo'";
                        $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                        $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                        $tstockactual = $almacenA1['resultado'];

                    }else{
                        $select = "SUM(k.saldocantidad) AS Pares";
                        $from = "adicionkardextienda k,modelos mdt";
                        $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.stylename = '$idestilo'  AND k.unido='no'";
                        $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                        $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                        $tstockactual = $almacenA1['resultado'];

                    }

                    if($tstockactual==NULL || $tstockactual =='' || $tstockactual == ""){ $tstockactual="0"; }
                    //fin
                    if($tabla=="historialkardextienda"){

                        $select = "SUM(saldocantidad*precio2bs) AS bs";
                        $from = "historialkardextienda k,modelos mdt";
                        $where = "k.idmodelodetalle=mdt.idmodelo AND mdt.stylename = '$idestilo' and k.unido='no' AND k.idperiodo='$idperiodo'";
                        $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                        $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'bs');
                        $totalbsactual = $almacenA1['resultado'];

                    }else{
                        $select = "SUM(k.saldocantidad*precio2bs) AS Pares";
                        $from = "adicionkardextienda k,modelos mdt";
                        $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.stylename = '$idestilo'  AND k.unido='no'";
                        $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                        $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                        $totalbsactual = $almacenA1['resultado'];

                    }

                    if($tstockactual==NULL || $tstockactual =='' || $tstockactual == ""){ $tstockactual="0"; }
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$tstockant."&nbsp;</td>";

                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$recibido."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$trasrecibido."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$dev."&nbsp;</td>";

                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$trasdesp."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$venta."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$tstockactual."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$totalbsactual."&nbsp;</td>";

                    $devS .= "</tr>";
                    $devS .= "</table>";

                    $dev['mensaje'] = "Existen resultados";
                    $dev['error']   = "true";
                    $dev['resultado'] = $devS;

                }
                else
                {
                    $dev['mensaje'] = "No se encontro datos en la consulta2".mysql_error();
                    $dev['error']   = "false";
                    $dev['resultado'] = "";
                }
            }
            else
            {
                $dev['mensaje'] = "Error en la consulta";
                $dev['error']   = "false";
                $dev['resultado'] = "";
            }
        }
        else
        {
            $dev['mensaje'] = "No se pudo conectar a la BD";
            $dev['error']   = "false";
            $dev['resultado'] = "";
        }
    }
    else
    {
        $dev['mensaje'] = "No se pudo crear la conexion a la BD";
        $dev['error']   = "false";
        $dev['resultado'] = "";
    }
    return $dev;
}

function dibujarTablaOfSQLinventarioVentasTotal($idkardex,$sql,$sql21,$row1,$idmarca,$idestilo,$rango1,$rango2,$total1,$total2, $tipo,$marcapedido)
{
    //reportegrande
    $sqlmarca = " SELECT tabla,mesrango,idperiodo,fechainicio,fechafin FROM administrakardex WHERE idkardex = '$idkardex' ";
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "tabla");
    $tabla = $opcionkardex['resultado'];
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "mesrango");
    $mesrango = $opcionkardex['resultado'];
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "idperiodo");
    $idperiodo = $opcionkardex['resultado'];
    //echo $tabla;
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "fechainicio");
    $fechainicio = $opcionkardex['resultado'];
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "fechafin");
    $fechafin = $opcionkardex['resultado'];
    //AND k.idperiodo='$idperiodo'

    if($fechafin==null ||$fechafin == ""){
        $fechafin = Date("Y-m-d");
    }
    if($tabla=="historialkardextienda"){
    }else{
        $sqlInv = "SELECT MAX(idperiodo)AS numero
FROM administrakardex where tabla='historialkardextienda'";
        $almacenA1 =  findBySqlReturnCampoUnique($sqlInv, true, true, 'numero');
        $idperiodoant = $almacenA1['resultado'];
        $sqlmarca = " SELECT tabla,mesrango,idperiodo,fechainicio,fechafin FROM administrakardex WHERE idperiodo = '$idperiodoant' ";
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "fechainicio");
        // $fechainicio = $opcionkardex['resultado'];
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "fechafin");
        // $fechafin = $opcionkardex['resultado'];
    }
    $sql211 = getTablaToArrayOfSQL($sql21);
    $sql3 = $sql211['resultado'];
    if($link=new BD)
    {
        if($link->conectar())
        {
            if($re = $link->consulta($sql))
            {
                //echo mysql_num_rows($re);
                if($fi = mysql_fetch_array($re))
                {
                    $devS .= "<table cellpadding='0' cellspacing='0' border='0' style='width:750px;border:1px solid #000000;font-size:11px;'>";
                    $devS .= "<tr><td style='border-bottom:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Nro</td>";
                    $devS .= "<td style='display:none;'>".mysql_field_name($re, $zz)."</td>";
                    // $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Modelo</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Modelo</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Color</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Precio</td>";
                    for($hi=0;$hi<$row1;$hi++){
                        $codigo = $sql3[$hi];
                        $idmmarca = $codigo['talla'];

                        $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>$idmmarca</td>";
                        $ji++;
                    }
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Anterior</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Rec</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Tras.Rec</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Dev</td>";

                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Tras.Des</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Venta</td>";


                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Prs Actual</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Bs</td>";

                    $devS .= "</tr>";
                    $ii = 0;
                    //$totalCount = mysql_num_rows($re);
                    $z = 1;
                    do{
                        $devS .= "<tr><td style='text-align:left'>".$z."</td>";
                        for($i = 0; $i< mysql_num_fields($re); $i++)
                        {$dato = $fi[$i];
                            $iddetalleingreso = $fi[$i]['iddetalleingreso'];

                            $devS .= "<td style='display:none;'>&nbsp;".$dato."&nbsp;</td>";
                            // echo $marcapedido;
                            $select = "dtp.totalbs AS precio";
                            $from = "adiciondetalleingreso dtp, modelos mdd, coleccion col, estilos es";
                            $where = "dtp.idmodelo = mdd.idmodelo AND mdd.idcoleccion = col.idcoleccion AND mdd.stylename = es.idestilo AND dtp.iddetalleingreso='$dato'";

                            if($marcapedido=='CODIGO-COLOR-MATERIAL'){
                                $select .= ",mdd.codigo, dtp.color";
                                // $select .= ",concat(col.detalle,'-',mdd.codigo) AS codigo, dtp.color";
                            }else{
                                if($marcapedido=="CODIGO-MATERIAL"){
                                    $select .= ",concat(mdd.codigo,'-',dtp.material) AS codigo, dtp.color";
                                }else{
                                    if(($marcapedido=="CODIGO-COLOR")||($marcapedido=="CODIGO")){
                                        $select .= ",mdd.codigo, dtp.color";
                                    }else{
                                        if($marcapedido=="CODIGO-COLOR-STYLENAME"){
                                            $select .= ",concat(mdd.codigo,'-',dtp.color) AS codigo, dtp.material AS color";
                                        }else{
                                            if($marcapedido=="LINEA-CODIGO-COLOR"){
                                                $select .= ",concat(l.codigo,'-',mdd.codigo) AS codigo, dtp.color AS color";
                                                //  $select .= ",concat(mdd.codigo,'-',dtp.color) AS codigo, dtp.material AS color";

                                                $from .= ",lineas l";
                                                $where .= "AND mdd.idlinea = l.idlinea";

                                            }
                                        }

                                    }
                                }
                            }
                            //lor
                            // $from = "adiciondetalleingreso dtp, modelos mdd, coleccion col, estilos es";
                            //$where = "dtp.idmodelo = mdd.idmodelo AND mdd.idcoleccion = col.idcoleccion AND mdd.stylename = es.idestilo AND dtp.iddetalleingreso='$dato'";
                            $sql2p1 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                            //echo $sql2p1;
                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p1, true, true, 'codigo');
                            $modelo = $almacenA1['resultado'];
                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p1, true, true, 'color');
                            $color = $almacenA1['resultado'];
                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p1, true, true, 'precio');
                            $precio = $almacenA1['resultado'];
                            $devS .= "<td style='text-align:left;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$modelo."&nbsp;</td>";
                            $devS .= "<td style='text-align:left;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$color."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$precio."&nbsp;</td>";

                            //lorg
                            for($h=0;$h<$row1;$h++){
                                $codigo = $sql3[$h];
                                $idmmarca = $codigo['talla'];

                                if($tabla=="historialkardextienda"){

                                    $select1 = "saldocantidad AS Pares";
                                    $from1 = "historialkardextienda";
                                    $where1 = "idcalzado = '$dato' AND talla='$idmmarca' AND idperiodo='$idperiodo'";
                                    //if($ltienda != "Todos"){ $where .= " AND ve.idtienda = '$ltienda' ";}
                                    $sql21 = "SELECT ".$select1." FROM ".$from1. " WHERE ".$where1;
                                    //echo $sql21;
                                    $almacenA1 =  findBySqlReturnCampoUnique($sql21, true, true, 'Pares');
                                    $pares1 = $almacenA1['resultado'];
                                }else{
                                    $select1 = "saldocantidad AS Pares";
                                    $from1 = "adicionkardextienda";
                                    $where1 = "idcalzado = '$dato' AND talla='$idmmarca'";
                                    //if($ltienda != "Todos"){ $where .= " AND ve.idtienda = '$ltienda' ";}
                                    $sql21 = "SELECT ".$select1." FROM ".$from1. " WHERE ".$where1;

                                    $almacenA1 =  findBySqlReturnCampoUnique($sql21, true, true, 'Pares');
                                    $pares1 = $almacenA1['resultado'];

                                }

                                //  if($pares1==NULL || $pares1 =='' || $pares1 == ""){ $pares1="0"; }
                                $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$pares1."&nbsp;</td>";
                                $j++;
                            }

                            if($tabla=="historialkardextienda"){
                                $sqlInv = "SELECT MAX(idperiodo)AS numero
FROM administrakardex where tabla='historialkardextienda'";
                                $almacenA1 =  findBySqlReturnCampoUnique($sqlInv, true, true, 'numero');
                                $idperiodoant = $almacenA1['resultado'];
                                $idper = $idperiodoant - 1;
                                $select = "SUM(saldocantidad) AS Pares";
                                $from = "historialkardextienda k";
                                $where = " k.idcalzado='$dato' AND k.idperiodo='$idper' AND k.unido='no'";
                                $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                                $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                                $stockanterior = $almacenA1['resultado'];
                            }
                            else{
                                $sqlInv = "SELECT MAX(idperiodo)AS numero
FROM administrakardex where tabla='historialkardextienda'";
                                $almacenA1 =  findBySqlReturnCampoUnique($sqlInv, true, true, 'numero');
                                $idperiodoant = $almacenA1['resultado'];
                                //  echo $idperiodoant;
                                $select = "SUM(saldocantidad) AS Pares";
                                $from = "historialkardextienda k";
                                $where = " k.idcalzado='$dato' AND k.idperiodo='$idperiodoant' AND k.unido='no'";
                                $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                                $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                                $stockanterior = $almacenA1['resultado'];

                            }

                            // $pares=$totalparesiddetalleingreso;
                            // echo $sql2p;
                            if($stockanterior==NULL || $stockanterior =='' || $stockanterior == ""){ $stockanterior="0"; }


                            $select = "SUM( dtpt.cantidad ) AS Pares";
                            $from = "adicioningresotienda k, adiciondetalleingresotalla dtpt, adiciondetalleingreso ad, modelos mdd";
                            $where = "k.idingreso = dtpt.idingreso AND dtpt.idmodelo = mdd.idmodelo
AND dtpt.iddetalleingreso = ad.iddetalleingreso";
                            { $where .= " AND k.fecha >= '$fechainicio' AND
k.fecha <= '$fechafin' AND  dtpt.iddetalleingreso='$dato'";}
                            if($idestilo !="null")
                            { $where .= " AND mdd.stylename = '$idestilo'";}
                            if($idestilo!=null || $idestilo!='')
                            { $where .= " AND mdd.stylename = '$idestilo'";}
                            $sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where;
                            $almacenA1 =  findBySqlReturnCampoUnique($sql25, true, true, 'Pares');
                            $recibido = $almacenA1['resultado'];

                            $select = "SUM(i.cantidad) AS Pares";
                            $from = "ingresos i,adicionkardextienda k";
                            $where = " k.idcalzado='$dato' AND k.idkardextienda=i.idkardextienda AND i.fecha >= '$fechainicio'
    AND i.fecha <= '$fechafin' AND i.detalle2!='ingresoalmacen' ";
                            $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                            $trasrecibido = $almacenA1['resultado'];
                            //     if($trasrecibido==NULL || $trasrecibido =='' || $trasrecibido == ""){ $trasrecibido="0";   }
                            $select = "SUM(i.cantidad) AS Pares";
                            $from = "itemventa i,adicionkardextienda k, ventasdetalle v";
                            $where = " k.idcalzado='$dato' AND k.idkardextienda=i.idkardextienda ANd i.idventa=v.idventadetalle AND  i.estado='cambiado'
and v.fecha >= '$fechainicio'
    AND v.fecha <= '$fechafin' ";
                            $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                            $devueltos = $almacenA1['resultado'];
                            // $pares=$totalparesiddetalleingreso;
                            // if($devueltos==NULL || $devueltos =='' || $devueltos == ""){ $devueltos="0"; }


                            $select = "SUM(i.cantidad) AS Pares";
                            $from = "detalletraspaso i,adicionkardextienda k,traspasos tr";
                            $where = " k.idcalzado='$dato' AND k.idkardextienda=i.idkardextienda ANd i.idtraspaso=tr.idtraspaso AND tr.fecha >= '$fechainicio'
    AND tr.fecha <= '$fechafin' ";
                            $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                            $trasdesp = $almacenA1['resultado'];

                            //  if($trasdesp==NULL || $trasdesp =='' || $trasdesp == ""){ $trasdesp="0"; }
                            $select = "SUM(i.cantidad) AS Pares";
                            $from = "itemventa i,adicionkardextienda k, ventasdetalle v";
                            $where = " k.idcalzado='$dato' AND k.idkardextienda=i.idkardextienda ANd i.idventa=v.idventadetalle AND  i.estado!='cambiado'
and v.fecha >= '$fechainicio'
    AND v.fecha <= '$fechafin' ";
                            $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                            $venta = $almacenA1['resultado'];
                            // $pares=$totalparesiddetalleingreso;
                            if($venta==NULL || $venta =='' || $venta == ""){ $venta="0"; }
                            if($tabla=="historialkardextienda"){

                                $select = "SUM(saldocantidad) AS Pares";
                                $from = "historialkardextienda k";
                                $where = " k.idcalzado='$dato' and k.unido='no' AND k.idperiodo='$idperiodo'";
                                $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                                $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                                $pares = $almacenA1['resultado'];
                            }else{
                                $select = "SUM(saldocantidad) AS Pares";
                                $from = "adicionkardextienda k";
                                $where = " k.idcalzado='$dato' and k.unido='no'";
                                $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                                $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                                $pares = $almacenA1['resultado'];

                            }
                            if($tabla=="historialkardextienda"){
                                $select = "SUM(saldocantidad*precio2bs) AS Pares";
                                $from = "historialkardextienda k";
                                $where = " k.idcalzado='$dato' and k.unido='no' AND k.idperiodo='$idperiodo'";
                                $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                                $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                                $totalbs = $almacenA1['resultado'];
                            }else{
                                $select = "SUM(saldocantidad*precio2bs) AS bs";
                                $from = "adicionkardextienda k";
                                $where = " k.idcalzado='$dato' and k.unido='no'";
                                $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                                $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'bs');
                                $totalbs = $almacenA1['resultado'];
                            }
                            // $pares=$totalparesiddetalleingreso;

                            if($pares==NULL || $pares =='' || $pares == ""){ $pares="0"; }


                            if($totalbs==NULL || $totalbs =='' || $totalbs == ""){ $totalbs="0"; }

                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$stockanterior."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$recibido."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$trasrecibido."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$devueltos."&nbsp;</td>";

                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$trasdesp."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$venta."&nbsp;</td>";

                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$pares."&nbsp;</td>";

                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$totalbs."&nbsp;</td>";

                        }
                        $devS .= "</tr>";
                        $ii++;
                        $z ++;
                    }while($fi = mysql_fetch_array($re));
                    //$devS .= "<tr><td style='border:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Total</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td style='border:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>$totalparesestilo</td><td style='border:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>$totalbsestilo</td>";
                    $devS .= "<tr style='background-color:silver;'><td style='border: 1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>TOTAL</td>";
                    $devS .= "<td style='display:none;'></td>";
                    $fechatoday = Date("d-m-Y");
                    $devS .= "<td style='text-align:center;border-bottom: 1px solid #000000;'></td>";
                    $devS .= "<td style='text-align:center;border-bottom: 1px solid #000000;'></td>";
                    $devS .= "<td style='text-align:center;border-bottom: 1px solid #000000;'></td>";

                    for($h=0;$h<$row1;$h++){
                        $codigo = $sql3[$h];
                        $idmmarca = $codigo['idmarca'];

                        $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'></td>";
                        $j++;
                    }

                    if($tabla=="historialkardextienda"){
                        $sqlInv = "SELECT MAX(idperiodo)AS numero
FROM administrakardex where tabla='historialkardextienda'";
                        $almacenA1 =  findBySqlReturnCampoUnique($sqlInv, true, true, 'numero');
                        $idperiodoant = $almacenA1['resultado'];
                        $idper = $idperiodoant - 1;
                        $select = "SUM(saldocantidad) AS Pares";
                        $from = "historialkardextienda k,modelos mdt";
                        $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND mdt.stylename = '$idestilo' AND k.idperiodo='$idper' AND k.unido='no'";
                        $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                        $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                        $tstockant = $almacenA1['resultado'];
                    }
                    else{
                        $sqlInv = "SELECT MAX(idperiodo)AS numero
FROM administrakardex where tabla='historialkardextienda'";
                        $almacenA1 =  findBySqlReturnCampoUnique($sqlInv, true, true, 'numero');
                        $idperiodoant = $almacenA1['resultado'];
                        $select = "SUM(saldocantidad) AS Pares";
                        $from = "historialkardextienda k,modelos mdt";
                        $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND mdt.stylename = '$idestilo' AND k.idperiodo='$idperiodoant' AND k.unido='no'";
                        $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                        //echo $sql2p;
                        $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                        $tstockant = $almacenA1['resultado'];
                    }

                    //reseteo
                    $select = "SUM( dtpt.cantidad ) AS Pares";
                    $from = "adicioningresotienda k, adiciondetalleingresotalla dtpt, adiciondetalleingreso ad, modelos mdd";
                    $where = "k.idingreso = dtpt.idingreso AND dtpt.idmodelo = mdd.idmodelo
AND dtpt.iddetalleingreso = ad.iddetalleingreso";
                    { $where .= " AND mdd.stylename = '$idestilo' AND k.fecha >= '$fechainicio' AND
k.fecha <= '$fechafin' ";}

                    $sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where;

                    $almacenA1 =  findBySqlReturnCampoUnique($sql25, true, true, 'Pares');
                    $recibido = $almacenA1['resultado'];
                    if($recibido==NULL || $recibido =='' || $recibido == ""){ $recibido="0"; }

                    $select = "SUM(i.cantidad) AS Pares";
                    $from = "ingresos i,adicionkardextienda k,modelos mdt";
                    $where = "k.idkardextienda=i.idkardextienda AND i.fecha >= '$fechainicio'
    AND i.fecha <= '$fechafin' and k.idmodelodetalle=mdt.idmodelo and mdt.stylename = '$idestilo' AND i.detalle2!='ingresoalmacen' ";
                    $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                    $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                    $trasrecibido = $almacenA1['resultado'];
                    if($trasrecibido==NULL || $trasrecibido =='' || $trasrecibido == ""){ $trasrecibido="0"; }

                    //$select = "SUM(i.cantidad) AS Pares";
                    //    $from = "itemventa i,adicionkardextienda k, ventasdetalle v,modelos mdt";
                    //    $where = "k.idkardextienda=i.idkardextienda ANd i.idventa=v.idventadetalle AND k.idmodelodetalle=mdt.idmodelo  and mdt.stylename = '$idestilo'
                    //and i.estado!='cambiado' AND v.fecha >= '$fechainicio'
                    //    AND v.fecha <= '$fechafin' ";

                    $select = "SUM(i.cantidad) AS Pares";
                    $from = "itemventa i,adicionkardextienda k, ventasdetalle v,modelos mdt";
                    $where = " k.idkardextienda=i.idkardextienda ANd i.idventa=v.idventadetalle AND k.idmodelodetalle=mdt.idmodelo  and mdt.stylename = '$idestilo'
AND  i.estado='cambiado'
and v.fecha >= '$fechainicio'
    AND v.fecha <= '$fechafin' ";
                    $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                    $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                    $devueltos = $almacenA1['resultado'];
                    // $pares=$totalparesiddetalleingreso;
                    if($devueltos==NULL || $devueltos =='' || $devueltos == ""){ $devueltos="0"; }


                    $select = "SUM(i.cantidad) AS Pares";
                    $from = "detalletraspaso i,adicionkardextienda k,traspasos tr,modelos mdt";
                    $where = "  k.idkardextienda=i.idkardextienda ANd i.idtraspaso=tr.idtraspaso  and k.idmodelodetalle=mdt.idmodelo and mdt.stylename = '$idestilo'
AND tr.fecha >= '$fechainicio'
    AND tr.fecha <= '$fechafin' ";
                    $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                    $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                    $trasdesp = $almacenA1['resultado'];

                    if($trasdesp==NULL || $trasdesp =='' || $trasdesp == ""){ $trasdesp="0"; }
                    $select = "SUM(i.cantidad) AS Pares";
                    $from = "itemventa i,adicionkardextienda k, ventasdetalle v,modelos mdt";
                    $where = "k.idkardextienda=i.idkardextienda ANd i.idventa=v.idventadetalle AND k.idmodelodetalle=mdt.idmodelo  and mdt.stylename = '$idestilo'
and i.estado!='cambiado' AND v.fecha >= '$fechainicio'
    AND v.fecha <= '$fechafin' ";

                    $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                    //  echo $sql2p;
                    //    d
                    $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                    $venta = $almacenA1['resultado'];
                    // $pares=$totalparesiddetalleingreso;
                    if($venta==NULL || $venta =='' || $venta == ""){ $venta="0"; }



                    if($tabla=="historialkardextienda"){
                        $select = "SUM(k.saldocantidad) AS Pares";
                        $from = "historialkardextienda k,modelos mdt";
                        $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.stylename = '$idestilo'  AND k.unido='no' AND k.idperiodo='$idperiodo'";
                        $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                        $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                        $tstockactual = $almacenA1['resultado'];

                    }else{
                        $select = "SUM(k.saldocantidad) AS Pares";
                        $from = "adicionkardextienda k,modelos mdt";
                        $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.stylename = '$idestilo'  AND k.unido='no'";
                        $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                        $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                        $tstockactual = $almacenA1['resultado'];

                    }

                    if($tstockactual==NULL || $tstockactual =='' || $tstockactual == ""){ $tstockactual="0"; }
                    //fin
                    if($tabla=="historialkardextienda"){

                        $select = "SUM(saldocantidad*precio2bs) AS bs";
                        $from = "historialkardextienda k,modelos mdt";
                        $where = "k.idmodelodetalle=mdt.idmodelo AND mdt.stylename = '$idestilo' and k.unido='no' AND k.idperiodo='$idperiodo'";
                        $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                        $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'bs');
                        $totalbsactual = $almacenA1['resultado'];

                    }else{
                        $select = "SUM(k.saldocantidad*precio2bs) AS Pares";
                        $from = "adicionkardextienda k,modelos mdt";
                        $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.stylename = '$idestilo'  AND k.unido='no'";
                        $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                        $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                        $totalbsactual = $almacenA1['resultado'];

                    }

                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$tstockant."&nbsp;</td>";

                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$recibido."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$trasrecibido."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$devueltos."&nbsp;</td>";

                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$trasdesp."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$venta."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$tstockactual."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$totalbsactual."&nbsp;</td>";

                    $devS .= "</tr>";

                    $devS .= "</table>";

                    $dev['mensaje'] = "Existen resultados";
                    $dev['error']   = "true";
                    $dev['resultado'] = $devS;

                }
                else
                {
                    $dev['mensaje'] = "No se encontro datos en la consulta2".mysql_error();
                    $dev['error']   = "false";
                    $dev['resultado'] = "";
                }
            }
            else
            {
                $dev['mensaje'] = "Error en la consulta";
                $dev['error']   = "false";
                $dev['resultado'] = "";
            }
        }
        else
        {
            $dev['mensaje'] = "No se pudo conectar a la BD";
            $dev['error']   = "false";
            $dev['resultado'] = "";
        }
    }
    else
    {
        $dev['mensaje'] = "No se pudo crear la conexion a la BD";
        $dev['error']   = "false";
        $dev['resultado'] = "";
    }
    return $dev;
}


function dibujarTablaOfSQLinventarioVacio($idkardex,$sql,$sql21,$row1,$idmarca,$idestilo,$rango1,$rango2,$total1,$total2, $tipo,$marcapedido)
{
    //reportegrande
    $sqlmarca = " SELECT tabla,mesrango,idperiodo,fechainicio,fechafin FROM administrakardex WHERE idkardex = '$idkardex' ";
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "tabla");
    $tabla = $opcionkardex['resultado'];
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "mesrango");
    $mesrango = $opcionkardex['resultado'];
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "idperiodo");
    $idperiodo = $opcionkardex['resultado'];
    //echo $tabla;
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "fechainicio");
    $fechainicio = $opcionkardex['resultado'];
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "fechafin");
    $fechafin = $opcionkardex['resultado'];
    //AND k.idperiodo='$idperiodo'

    if($fechafin==null ||$fechafin == ""){
        $fechafin = Date("Y-m-d");
    }
    if($tabla=="historialkardextienda"){
    }else{
        $sqlInv = "SELECT MAX(idperiodo)AS numero
FROM administrakardex where tabla='historialkardextienda'";
        $almacenA1 =  findBySqlReturnCampoUnique($sqlInv, true, true, 'numero');
        $idperiodoant = $almacenA1['resultado'];
        $sqlmarca = " SELECT tabla,mesrango,idperiodo,fechainicio,fechafin FROM administrakardex WHERE idperiodo = '$idperiodoant' ";
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "fechainicio");
        // $fechainicio = $opcionkardex['resultado'];
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "fechafin");
        // $fechafin = $opcionkardex['resultado'];
    }
    $sql211 = getTablaToArrayOfSQL($sql21);
    $sql3 = $sql211['resultado'];
    if($link=new BD)
    {
        if($link->conectar())
        {
            if($re = $link->consulta($sql))
            {
                //echo mysql_num_rows($re);
                if($fi = mysql_fetch_array($re))
                {
                    $devS .= "<table cellpadding='0' cellspacing='0' border='0' style='width:750px;border:1px solid #000000;font-size:11px;'>";
                    $devS .= "<tr><td style='border-bottom:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Nro</td>";
                    $devS .= "<td style='display:none;'>".mysql_field_name($re, $zz)."</td>";
                    // $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Modelo</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Modelo</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Color</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Precio</td>";
                    for($hi=0;$hi<$row1;$hi++){
                        $codigo = $sql3[$hi];
                        $idmmarca = $codigo['talla'];

                        $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>$idmmarca</td>";
                        $ji++;
                    }
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Anterior</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Rec</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Tras.Rec</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Dev</td>";

                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Tras.Des</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Venta</td>";


                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Stock Actual</td>";

                    $devS .= "</tr>";
                    $ii = 0;
                    //$totalCount = mysql_num_rows($re);
                    $z = 1;
                    do{
                        $devS .= "<tr><td style='text-align:left'>".$z."</td>";
                        for($i = 0; $i< mysql_num_fields($re); $i++)
                        {$dato = $fi[$i];
                            $iddetalleingreso = $fi[$i]['iddetalleingreso'];

                            $devS .= "<td style='display:none;'>&nbsp;".$dato."&nbsp;</td>";
                            // echo $marcapedido;
                            $select = "dtp.totalbs AS precio";
                            $from = "adiciondetalleingreso dtp, modelos mdd, coleccion col, estilos es";
                            $where = "dtp.idmodelo = mdd.idmodelo AND mdd.idcoleccion = col.idcoleccion AND mdd.stylename = es.idestilo AND dtp.iddetalleingreso='$dato'";

                            if($marcapedido=='CODIGO-COLOR-MATERIAL'){
                                $select .= ",mdd.codigo, dtp.color";
                                // $select .= ",concat(col.detalle,'-',mdd.codigo) AS codigo, dtp.color";
                            }else{
                                if($marcapedido=="CODIGO-MATERIAL"){
                                    $select .= ",concat(mdd.codigo,'-',dtp.material) AS codigo, dtp.color";
                                }else{
                                    if(($marcapedido=="CODIGO-COLOR")||($marcapedido=="CODIGO")){
                                        $select .= ",mdd.codigo, dtp.color";
                                    }else{
                                        if($marcapedido=="CODIGO-COLOR-STYLENAME"){
                                            $select .= ",concat(mdd.codigo,'-',dtp.color) AS codigo, dtp.material AS color";
                                        }else{
                                            if($marcapedido=="LINEA-CODIGO-COLOR"){
                                                $select .= ",concat(l.codigo,'-',mdd.codigo) AS codigo, dtp.color AS color";
                                                //  $select .= ",concat(mdd.codigo,'-',dtp.color) AS codigo, dtp.material AS color";

                                                $from .= ",lineas l";
                                                $where .= "AND mdd.idlinea = l.idlinea";

                                            }
                                        }

                                    }
                                }
                            }
                            //lor
                            // $from = "adiciondetalleingreso dtp, modelos mdd, coleccion col, estilos es";
                            //$where = "dtp.idmodelo = mdd.idmodelo AND mdd.idcoleccion = col.idcoleccion AND mdd.stylename = es.idestilo AND dtp.iddetalleingreso='$dato'";
                            $sql2p1 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                            //echo $sql2p1;
                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p1, true, true, 'codigo');
                            $modelo = $almacenA1['resultado'];
                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p1, true, true, 'color');
                            $color = $almacenA1['resultado'];
                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p1, true, true, 'precio');
                            $precio = $almacenA1['resultado'];
                            $devS .= "<td style='text-align:left;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$modelo."&nbsp;</td>";
                            $devS .= "<td style='text-align:left;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$color."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$precio."&nbsp;</td>";

                            //lorg
                            for($h=0;$h<$row1;$h++){
                                $codigo = $sql3[$h];
                                $idmmarca = $codigo['talla'];

                                if($tabla=="historialkardextienda"){


                                }else{


                                }

                                //  if($pares1==NULL || $pares1 =='' || $pares1 == ""){ $pares1="0"; }
                                $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$pares1."&nbsp;</td>";
                                $j++;
                            }

                            if($tabla=="historialkardextienda"){
                                $sqlInv = "SELECT MAX(idperiodo)AS numero
FROM administrakardex where tabla='historialkardextienda'";
                                $almacenA1 =  findBySqlReturnCampoUnique($sqlInv, true, true, 'numero');
                                $idperiodoant = $almacenA1['resultado'];
                                $idper = $idperiodoant - 1;
                                $select = "SUM(saldocantidad) AS Pares";
                                $from = "historialkardextienda k";
                                $where = " k.idcalzado='$dato' AND k.idperiodo='$idper' AND k.unido='no'";
                                $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                                $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                                $stockanterior = $almacenA1['resultado'];
                            }
                            else{
                                $sqlInv = "SELECT MAX(idperiodo)AS numero
FROM administrakardex where tabla='historialkardextienda'";
                                $almacenA1 =  findBySqlReturnCampoUnique($sqlInv, true, true, 'numero');
                                $idperiodoant = $almacenA1['resultado'];
                                //  echo $idperiodoant;
                                $select = "SUM(saldocantidad) AS Pares";
                                $from = "historialkardextienda k";
                                $where = " k.idcalzado='$dato' AND k.idperiodo='$idperiodoant' AND k.unido='no'";
                                $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                                $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                                $stockanterior = $almacenA1['resultado'];

                            }

                            // $pares=$totalparesiddetalleingreso;
                            // echo $sql2p;
                            //  if($stockanterior==NULL || $stockanterior =='' || $stockanterior == ""){ $stockanterior="0"; }


                            $select = "SUM( dtpt.cantidad ) AS Pares";
                            $from = "adicioningresotienda k, adiciondetalleingresotalla dtpt, adiciondetalleingreso ad, modelos mdd";
                            $where = "k.idingreso = dtpt.idingreso AND dtpt.idmodelo = mdd.idmodelo
AND dtpt.iddetalleingreso = ad.iddetalleingreso";
                            { $where .= " AND k.fecha >= '$fechainicio' AND
k.fecha <= '$fechafin' AND  dtpt.iddetalleingreso='$dato'";}
                            if($idestilo !="null")
                            { $where .= " AND mdd.stylename = '$idestilo'";}
                            if($idestilo!=null || $idestilo!='')
                            { $where .= " AND mdd.stylename = '$idestilo'";}
                            $sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where;
                            $almacenA1 =  findBySqlReturnCampoUnique($sql25, true, true, 'Pares');
                            $recibido = $almacenA1['resultado'];

                            $select = "SUM(i.cantidad) AS Pares";
                            $from = "ingresos i,adicionkardextienda k";
                            $where = " k.idcalzado='$dato' AND k.idkardextienda=i.idkardextienda AND i.fecha >= '$fechainicio'
    AND i.fecha <= '$fechafin' AND i.detalle2!='ingresoalmacen' ";
                            $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                            $trasrecibido = $almacenA1['resultado'];
                            //     if($trasrecibido==NULL || $trasrecibido =='' || $trasrecibido == ""){ $trasrecibido="0";   }
                            $select = "SUM(i.cantidad) AS Pares";
                            $from = "itemventa i,adicionkardextienda k, ventasdetalle v";
                            $where = " k.idcalzado='$dato' AND k.idkardextienda=i.idkardextienda ANd i.idventa=v.idventadetalle AND  i.estado='cambiado'
and v.fecha >= '$fechainicio'
    AND v.fecha <= '$fechafin' ";
                            $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                            $devueltos = $almacenA1['resultado'];
                            // $pares=$totalparesiddetalleingreso;
                            // if($devueltos==NULL || $devueltos =='' || $devueltos == ""){ $devueltos="0"; }


                            $select = "SUM(i.cantidad) AS Pares";
                            $from = "detalletraspaso i,adicionkardextienda k,traspasos tr";
                            $where = " k.idcalzado='$dato' AND k.idkardextienda=i.idkardextienda ANd i.idtraspaso=tr.idtraspaso AND tr.fecha >= '$fechainicio'
    AND tr.fecha <= '$fechafin' ";
                            $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                            $trasdesp = $almacenA1['resultado'];

                            // $pares=$totalparesiddetalleingreso;
                            //   if($venta==NULL || $venta =='' || $venta == ""){ $venta="0"; }
                            if($tabla=="historialkardextienda"){

                                $select = "SUM(saldocantidad) AS Pares";
                                $from = "historialkardextienda k";
                                $where = " k.idcalzado='$dato' and k.unido='no' AND k.idperiodo='$idperiodo'";
                                $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                                $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                                $pares = $almacenA1['resultado'];
                            }else{
                                $select = "SUM(saldocantidad) AS Pares";
                                $from = "adicionkardextienda k";
                                $where = " k.idcalzado='$dato' and k.unido='no'";
                                $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                                $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                                $pares = $almacenA1['resultado'];

                            }

                            $pares = "";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$stockanterior."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$recibido."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$trasrecibido."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$devueltos."&nbsp;</td>";

                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$trasdesp."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$venta."&nbsp;</td>";

                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$pares."&nbsp;</td>";

                            //$devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$totalbs."&nbsp;</td>";

                        }
                        $devS .= "</tr>";
                        $ii++;
                        $z ++;
                    }while($fi = mysql_fetch_array($re));
                    //$devS .= "<tr><td style='border:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Total</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td style='border:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>$totalparesestilo</td><td style='border:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>$totalbsestilo</td>";
                    $devS .= "<tr style='background-color:silver;'><td style='border: 1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'></td>";
                    $devS .= "<td style='display:none;'></td>";
                    $fechatoday = Date("d-m-Y");
                    $devS .= "<td style='text-align:center;border-bottom: 1px solid #000000;'>TOTAL</td>";
                    $devS .= "<td style='text-align:center;border-bottom: 1px solid #000000;'></td>";
                    $devS .= "<td style='text-align:center;border-bottom: 1px solid #000000;'></td>";

                    for($h=0;$h<$row1;$h++){
                        $codigo = $sql3[$h];
                        $idmmarca = $codigo['idmarca'];

                        $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'></td>";
                        $j++;
                    }

                    if($tabla=="historialkardextienda"){
                        $sqlInv = "SELECT MAX(idperiodo)AS numero
FROM administrakardex where tabla='historialkardextienda'";
                        $almacenA1 =  findBySqlReturnCampoUnique($sqlInv, true, true, 'numero');
                        $idperiodoant = $almacenA1['resultado'];
                        $idper = $idperiodoant - 1;
                        $select = "SUM(saldocantidad) AS Pares";
                        $from = "historialkardextienda k,modelos mdt";
                        $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND mdt.stylename = '$idestilo' AND k.idperiodo='$idper' AND k.unido='no'";
                        $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                        $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                        $tstockant = $almacenA1['resultado'];
                    }
                    else{
                        $sqlInv = "SELECT MAX(idperiodo)AS numero
FROM administrakardex where tabla='historialkardextienda'";
                        $almacenA1 =  findBySqlReturnCampoUnique($sqlInv, true, true, 'numero');
                        $idperiodoant = $almacenA1['resultado'];
                        $select = "SUM(saldocantidad) AS Pares";
                        $from = "historialkardextienda k,modelos mdt";
                        $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND mdt.stylename = '$idestilo' AND k.idperiodo='$idperiodoant' AND k.unido='no'";
                        $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                        //echo $sql2p;
                        $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                        $tstockant = $almacenA1['resultado'];
                    }

                    //reseteo
                    $select = "SUM( dtpt.cantidad ) AS Pares";
                    $from = "adicioningresotienda k, adiciondetalleingresotalla dtpt, adiciondetalleingreso ad, modelos mdd";
                    $where = "k.idingreso = dtpt.idingreso AND dtpt.idmodelo = mdd.idmodelo
AND dtpt.iddetalleingreso = ad.iddetalleingreso";
                    { $where .= " AND mdd.stylename = '$idestilo' AND k.fecha >= '$fechainicio' AND
k.fecha <= '$fechafin' ";}

                    $sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where;

                    $almacenA1 =  findBySqlReturnCampoUnique($sql25, true, true, 'Pares');
                    $recibido = $almacenA1['resultado'];
                    //  if($recibido==NULL || $recibido =='' || $recibido == ""){ $recibido="0"; }

                    $select = "SUM(i.cantidad) AS Pares";
                    $from = "ingresos i,adicionkardextienda k,modelos mdt";
                    $where = "k.idkardextienda=i.idkardextienda AND i.fecha >= '$fechainicio'
    AND i.fecha <= '$fechafin' and k.idmodelodetalle=mdt.idmodelo and mdt.stylename = '$idestilo' AND i.detalle2!='ingresoalmacen' ";
                    $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                    $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                    $trasrecibido = $almacenA1['resultado'];
                    //  if($trasrecibido==NULL || $trasrecibido =='' || $trasrecibido == ""){ $trasrecibido="0"; }

                    //$select = "SUM(i.cantidad) AS Pares";
                    //    $from = "itemventa i,adicionkardextienda k, ventasdetalle v,modelos mdt";
                    //    $where = "k.idkardextienda=i.idkardextienda ANd i.idventa=v.idventadetalle AND k.idmodelodetalle=mdt.idmodelo  and mdt.stylename = '$idestilo'
                    //and i.estado!='cambiado' AND v.fecha >= '$fechainicio'
                    //    AND v.fecha <= '$fechafin' ";

                    $select = "SUM(i.cantidad) AS Pares";
                    $from = "itemventa i,adicionkardextienda k, ventasdetalle v,modelos mdt";
                    $where = " k.idkardextienda=i.idkardextienda ANd i.idventa=v.idventadetalle AND k.idmodelodetalle=mdt.idmodelo  and mdt.stylename = '$idestilo'
AND  i.estado='cambiado'
and v.fecha >= '$fechainicio'
    AND v.fecha <= '$fechafin' ";
                    $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                    $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                    $devueltos = $almacenA1['resultado'];
                    // $pares=$totalparesiddetalleingreso;
                    //    if($devueltos==NULL || $devueltos =='' || $devueltos == ""){ $devueltos="0"; }


                    $select = "SUM(i.cantidad) AS Pares";
                    $from = "detalletraspaso i,adicionkardextienda k,traspasos tr,modelos mdt";
                    $where = "  k.idkardextienda=i.idkardextienda ANd i.idtraspaso=tr.idtraspaso  and k.idmodelodetalle=mdt.idmodelo and mdt.stylename = '$idestilo'
AND tr.fecha >= '$fechainicio'
    AND tr.fecha <= '$fechafin' ";
                    $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                    $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                    $trasdesp = $almacenA1['resultado'];



                    if($tabla=="historialkardextienda"){
                        $select = "SUM(k.saldocantidad) AS Pares";
                        $from = "historialkardextienda k,modelos mdt";
                        $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.stylename = '$idestilo'  AND k.unido='no' AND k.idperiodo='$idperiodo'";
                        $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                        $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                        $tstockactual = $almacenA1['resultado'];

                    }else{
                        $select = "SUM(k.saldocantidad) AS Pares";
                        $from = "adicionkardextienda k,modelos mdt";
                        $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.stylename = '$idestilo'  AND k.unido='no'";
                        $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                        $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                        $tstockactual = $almacenA1['resultado'];

                    }
                    $tstockactual = "";

                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$tstockant."&nbsp;</td>";

                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$recibido."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$trasrecibido."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$devueltos."&nbsp;</td>";

                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$trasdesp."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$venta."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$tstockactual."&nbsp;</td>";

                    $devS .= "</tr>";

                    $devS .= "</table>";

                    $dev['mensaje'] = "Existen resultados";
                    $dev['error']   = "true";
                    $dev['resultado'] = $devS;

                }
                else
                {
                    $dev['mensaje'] = "No se encontro datos en la consulta2".mysql_error();
                    $dev['error']   = "false";
                    $dev['resultado'] = "";
                }
            }
            else
            {
                $dev['mensaje'] = "Error en la consulta";
                $dev['error']   = "false";
                $dev['resultado'] = "";
            }
        }
        else
        {
            $dev['mensaje'] = "No se pudo conectar a la BD";
            $dev['error']   = "false";
            $dev['resultado'] = "";
        }
    }
    else
    {
        $dev['mensaje'] = "No se pudo crear la conexion a la BD";
        $dev['error']   = "false";
        $dev['resultado'] = "";
    }
    return $dev;
}


function dibujarTablaOfSQLmodelos($modelo,$sql,$sql21,$row1,$idmarca,$idestilo,$rango1,$rango2,$total1,$total2, $tipo,$marcapedido)
{

    $sqlmarca = " SELECT tabla,mesrango,idperiodo,fechainicio,fechafin FROM administrakardex WHERE tabla = 'adicionkardextienda' ";
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "tabla");
    $tabla = $opcionkardex['resultado'];
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "mesrango");
    $mesrango = $opcionkardex['resultado'];
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "idperiodo");
    $idperiodo = $opcionkardex['resultado'];
    //echo $tabla;
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "fechainicio");
    $fechainicio = $opcionkardex['resultado'];
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "fechafin");
    $fechafin = $opcionkardex['resultado'];
    //AND k.idperiodo='$idperiodo'

    if($fechafin==null ||$fechafin == ""){
        $fechafin = Date("Y-m-d");
    }
    if($tabla=="historialkardextienda"){
    }else{
        $sqlInv = "SELECT MAX(idperiodo)AS numero
FROM administrakardex where tabla='historialkardextienda'";
        $almacenA1 =  findBySqlReturnCampoUnique($sqlInv, true, true, 'numero');
        $idperiodoant = $almacenA1['resultado'];
        $sqlmarca = " SELECT tabla,mesrango,idperiodo,fechainicio,fechafin FROM administrakardex WHERE idperiodo = '$idperiodoant' ";
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "fechainicio");
        // $fechainicio = $opcionkardex['resultado'];
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "fechafin");
        // $fechafin = $opcionkardex['resultado'];
    }
    $sql211 = getTablaToArrayOfSQL($sql21);
    $sql3 = $sql211['resultado'];
    if($link=new BD)
    {
        if($link->conectar())
        {
            if($re = $link->consulta($sql))
            {
                //echo mysql_num_rows($re);
                if($fi = mysql_fetch_array($re))
                {
                    $devS .= "<table cellpadding='0' cellspacing='0' border='0' style='width:1250px;border:1px solid #000000;font-size:13px;'>";
                    $devS .= "<tr><td style='border-bottom:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Nro</td>";
                    $devS .= "<td style='display:none;'>".mysql_field_name($re, $zz)."</td>";
                    // $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Modelo</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Modelo</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Color</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Precio</td>";
                    for($hi=0;$hi<$row1;$hi++){
                        $codigo = $sql3[$hi];
                        $idmmarca = $codigo['talla'];

                        $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>$idmmarca</td>";
                        $ji++;
                    }
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Anterior</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Rec</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Tras.Rec</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Dev</td>";

                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Tras.Des</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Venta</td>";


                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Prs Actual</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Bs</td>";

                    $devS .= "</tr>";
                    $ii = 0;
                    //$totalCount = mysql_num_rows($re);
                    $z = 1;
                    do{
                        $devS .= "<tr><td style='text-align:left'>".$z."</td>";
                        for($i = 0; $i< mysql_num_fields($re); $i++)
                        {$dato = $fi[$i];
                            $iddetalleingreso = $fi[$i]['iddetalleingreso'];

                            $devS .= "<td style='display:none;'>&nbsp;".$dato."&nbsp;</td>";
                            // echo $marcapedido;
                            $select = "dtp.totalbs AS precio";
                            $from = "adiciondetalleingreso dtp, modelos mdd, coleccion col, estilos es";
                            $where = "dtp.idmodelo = mdd.idmodelo AND mdd.idcoleccion = col.idcoleccion AND mdd.stylename = es.idestilo AND dtp.iddetalleingreso='$dato'";

                            if($marcapedido=='CODIGO-COLOR-MATERIAL'){
                                $select .= ",mdd.codigo, dtp.color";
                                // $select .= ",concat(col.detalle,'-',mdd.codigo) AS codigo, dtp.color";
                            }else{
                                if($marcapedido=="CODIGO-MATERIAL"){
                                    $select .= ",concat(mdd.codigo,'-',dtp.material) AS codigo, dtp.color";
                                }else{
                                    if(($marcapedido=="CODIGO-COLOR")||($marcapedido=="CODIGO")){
                                        $select .= ",mdd.codigo, dtp.color";
                                    }else{
                                        if($marcapedido=="CODIGO-COLOR-STYLENAME"){
                                            $select .= ",concat(mdd.codigo,'-',dtp.color) AS codigo, dtp.material AS color";
                                        }else{
                                            if($marcapedido=="LINEA-CODIGO-COLOR"){
                                                $select .= ",concat(l.codigo,'-',mdd.codigo) AS codigo, dtp.color AS color";
                                                //  $select .= ",concat(mdd.codigo,'-',dtp.color) AS codigo, dtp.material AS color";

                                                $from .= ",lineas l";
                                                $where .= "AND mdd.idlinea = l.idlinea";

                                            }
                                        }

                                    }
                                }
                            }
                            //lor
                            // $from = "adiciondetalleingreso dtp, modelos mdd, coleccion col, estilos es";
                            //$where = "dtp.idmodelo = mdd.idmodelo AND mdd.idcoleccion = col.idcoleccion AND mdd.stylename = es.idestilo AND dtp.iddetalleingreso='$dato'";
                            $sql2p1 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                            //echo $sql2p1;
                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p1, true, true, 'codigo');
                            $modelo = $almacenA1['resultado'];
                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p1, true, true, 'color');
                            $color = $almacenA1['resultado'];
                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p1, true, true, 'precio');
                            $precio = $almacenA1['resultado'];
                            $devS .= "<td style='text-align:left;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$modelo."&nbsp;</td>";
                            $devS .= "<td style='text-align:left;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$color."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$precio."&nbsp;</td>";

                            for($h=0;$h<$row1;$h++){
                                $codigo = $sql3[$h];
                                $idmmarca = $codigo['talla'];


                                $select1 = "saldocantidad AS Pares";
                                $from1 = "adicionkardextienda";
                                $where1 = "idcalzado = '$dato' AND talla='$idmmarca'";
                                //if($ltienda != "Todos"){ $where .= " AND ve.idtienda = '$ltienda' ";}
                                $sql21 = "SELECT ".$select1." FROM ".$from1. " WHERE ".$where1;

                                $almacenA1 =  findBySqlReturnCampoUnique($sql21, true, true, 'Pares');
                                $pares1 = $almacenA1['resultado'];
                                //  if($pares1==NULL || $pares1 =='' || $pares1 == ""){ $pares1="0"; }
                                $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$pares1."&nbsp;</td>";
                                $j++;
                            }


                            $sqlInv = "SELECT MAX(idperiodo)AS numero
FROM administrakardex where tabla='historialkardextienda'";
                            $almacenA1 =  findBySqlReturnCampoUnique($sqlInv, true, true, 'numero');
                            $idperiodoant = $almacenA1['resultado'];
                            //  echo $idperiodoant;
                            $select = "SUM(saldocantidad) AS Pares";
                            $from = "historialkardextienda k";
                            $where = " k.idcalzado='$dato' AND k.idperiodo='$idperiodoant' AND k.unido='no'";
                            $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                            $stockanterior = $almacenA1['resultado'];
                            if($stockanterior==NULL || $stockanterior =='' || $stockanterior == ""){ $stockanterior="0"; }


                            $select = "SUM( dtpt.cantidad ) AS Pares";
                            $from = "adicioningresotienda k, adiciondetalleingresotalla dtpt, adiciondetalleingreso ad, modelos mdd";
                            $where = "k.idingreso = dtpt.idingreso AND dtpt.idmodelo = mdd.idmodelo
AND dtpt.iddetalleingreso = ad.iddetalleingreso";
                            { $where .= " AND k.fecha >= '$fechainicio' AND
k.fecha <= '$fechafin' AND  dtpt.iddetalleingreso='$dato'";}
                            if($idestilo !="null")
                            { $where .= " AND mdd.stylename = '$idestilo'";}
                            if($idestilo!=null || $idestilo!='')
                            { $where .= " AND mdd.stylename = '$idestilo'";}
                            $sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where;
                            $almacenA1 =  findBySqlReturnCampoUnique($sql25, true, true, 'Pares');
                            $recibido = $almacenA1['resultado'];

                            $select = "SUM(i.cantidad) AS Pares";
                            $from = "ingresos i,adicionkardextienda k";
                            $where = " k.idcalzado='$dato' AND k.idkardextienda=i.idkardextienda AND i.fecha >= '$fechainicio'
    AND i.fecha <= '$fechafin' AND i.detalle2!='ingresoalmacen' ";
                            $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                            $trasrecibido = $almacenA1['resultado'];
                            //     if($trasrecibido==NULL || $trasrecibido =='' || $trasrecibido == ""){ $trasrecibido="0";   }
                            $select = "SUM(i.cantidad) AS Pares";
                            $from = "itemventa i,adicionkardextienda k, ventasdetalle v";
                            $where = " k.idcalzado='$dato' AND k.idkardextienda=i.idkardextienda ANd i.idventa=v.idventadetalle AND  i.estado='cambiado'
and v.fecha >= '$fechainicio'
    AND v.fecha <= '$fechafin' ";
                            $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                            $devueltos = $almacenA1['resultado'];
                            // $pares=$totalparesiddetalleingreso;
                            // if($devueltos==NULL || $devueltos =='' || $devueltos == ""){ $devueltos="0"; }


                            $select = "SUM(i.cantidad) AS Pares";
                            $from = "detalletraspaso i,adicionkardextienda k,traspasos tr";
                            $where = " k.idcalzado='$dato' AND k.idkardextienda=i.idkardextienda ANd i.idtraspaso=tr.idtraspaso AND tr.fecha >= '$fechainicio'
    AND tr.fecha <= '$fechafin' ";
                            $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                            $trasdesp = $almacenA1['resultado'];

                            //  if($trasdesp==NULL || $trasdesp =='' || $trasdesp == ""){ $trasdesp="0"; }
                            $select = "SUM(i.cantidad) AS Pares";
                            $from = "itemventa i,adicionkardextienda k, ventasdetalle v";
                            $where = " k.idcalzado='$dato' AND k.idkardextienda=i.idkardextienda ANd i.idventa=v.idventadetalle AND  i.estado!='cambiado'
and v.fecha >= '$fechainicio'
    AND v.fecha <= '$fechafin' ";
                            $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                            $venta = $almacenA1['resultado'];
                            // $pares=$totalparesiddetalleingreso;
                            if($venta==NULL || $venta =='' || $venta == ""){ $venta="0"; }

                            $select = "SUM(saldocantidad) AS Pares";
                            $from = "adicionkardextienda k";
                            $where = " k.idcalzado='$dato' and k.unido='no'";
                            $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                            $pares = $almacenA1['resultado'];

                            $select = "SUM(saldocantidad*precio2bs) AS bs";
                            $from = "adicionkardextienda k";
                            $where = " k.idcalzado='$dato' and k.unido='no'";
                            $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'bs');
                            $totalbs = $almacenA1['resultado'];

                            // $pares=$totalparesiddetalleingreso;

                            if($pares==NULL || $pares =='' || $pares == ""){ $pares="0"; }


                            if($totalbs==NULL || $totalbs =='' || $totalbs == ""){ $totalbs="0"; }

                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$stockanterior."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$recibido."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$trasrecibido."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$devueltos."&nbsp;</td>";

                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$trasdesp."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$venta."&nbsp;</td>";

                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$pares."&nbsp;</td>";

                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$totalbs."&nbsp;</td>";

                        }
                        $devS .= "</tr>";
                        $ii++;
                        $z ++;
                    }while($fi = mysql_fetch_array($re));
                    //$devS .= "<tr><td style='border:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Total</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td style='border:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>$totalparesestilo</td><td style='border:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>$totalbsestilo</td>";
                    $devS .= "<tr style='background-color:silver;'><td style='border: 1px solid #000000;font-weight:bold;font-size:12px;text-align:center;background-color:silver;'>TOTAL</td>";
                    $devS .= "<td style='display:none;'></td>";
                    $fechatoday = Date("d-m-Y");
                    $devS .= "<td style='text-align:center;border-bottom: 1px solid #000000;'></td>";
                    $devS .= "<td style='text-align:center;border-bottom: 1px solid #000000;'></td>";
                    $devS .= "<td style='text-align:center;border-bottom: 1px solid #000000;'></td>";

                    for($h=0;$h<$row1;$h++){
                        $codigo = $sql3[$h];
                        $idmmarca = $codigo['idmarca'];

                        $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'></td>";
                        $j++;
                    }


                    $sqlInv = "SELECT MAX(idperiodo)AS numero
FROM administrakardex where tabla='historialkardextienda'";
                    $almacenA1 =  findBySqlReturnCampoUnique($sqlInv, true, true, 'numero');
                    $idperiodoant = $almacenA1['resultado'];
                    //AND m.codigo LIKE '%$modelo%'
                    //and mdt.codigo='$modelo'
                    $select = "SUM(saldocantidad) AS Pares";
                    $from = "historialkardextienda k,modelos mdt";
                    $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.codigo LIKE '%$modelo%' AND mdt.idmarca = '$idmarca' AND mdt.stylename = '$idestilo' AND k.idperiodo='$idperiodoant' AND k.unido='no'";
                    $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                    $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                    $tstockant = $almacenA1['resultado'];
                    //echo $sql2p;

                    //reseteo
                    $select = "SUM( dtpt.cantidad ) AS Pares";
                    $from = "adicioningresotienda k, adiciondetalleingresotalla dtpt, adiciondetalleingreso ad, modelos mdd";
                    $where = "k.idingreso = dtpt.idingreso AND dtpt.idmodelo = mdd.idmodelo and AND mdd.codigo LIKE '%$modelo%'
AND dtpt.iddetalleingreso = ad.iddetalleingreso";
                    { $where .= " AND mdd.stylename = '$idestilo' AND k.fecha >= '$fechainicio' AND
k.fecha <= '$fechafin' ";}

                    $sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where;

                    $almacenA1 =  findBySqlReturnCampoUnique($sql25, true, true, 'Pares');
                    $recibido = $almacenA1['resultado'];
                    if($recibido==NULL || $recibido =='' || $recibido == ""){ $recibido="0"; }

                    $select = "SUM(i.cantidad) AS Pares";
                    $from = "ingresos i,adicionkardextienda k,modelos mdt";
                    $where = "k.idkardextienda=i.idkardextienda AND i.fecha >= '$fechainicio' AND mdt.codigo LIKE '%$modelo%'
    AND i.fecha <= '$fechafin' and k.idmodelodetalle=mdt.idmodelo and mdt.stylename = '$idestilo' AND i.detalle2!='ingresoalmacen' ";
                    $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                    $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                    $trasrecibido = $almacenA1['resultado'];
                    if($trasrecibido==NULL || $trasrecibido =='' || $trasrecibido == ""){ $trasrecibido="0"; }


                    $select = "SUM(i.cantidad) AS Pares";
                    $from = "itemventa i,adicionkardextienda k, ventasdetalle v,modelos mdt";
                    $where = " k.idkardextienda=i.idkardextienda ANd i.idventa=v.idventadetalle AND mdt.codigo LIKE '%$modelo%' AND k.idmodelodetalle=mdt.idmodelo  and mdt.stylename = '$idestilo'
AND  i.estado='cambiado'
and v.fecha >= '$fechainicio'
    AND v.fecha <= '$fechafin' ";
                    $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                    $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                    $devueltos = $almacenA1['resultado'];
                    // $pares=$totalparesiddetalleingreso;
                    if($devueltos==NULL || $devueltos =='' || $devueltos == ""){ $devueltos="0"; }


                    $select = "SUM(i.cantidad) AS Pares";
                    $from = "detalletraspaso i,adicionkardextienda k,traspasos tr,modelos mdt";
                    $where = "  k.idkardextienda=i.idkardextienda ANd i.idtraspaso=tr.idtraspaso AND mdt.codigo LIKE '%$modelo%' and k.idmodelodetalle=mdt.idmodelo and mdt.stylename = '$idestilo'
AND tr.fecha >= '$fechainicio'
    AND tr.fecha <= '$fechafin' ";
                    $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                    $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                    $trasdesp = $almacenA1['resultado'];

                    if($trasdesp==NULL || $trasdesp =='' || $trasdesp == ""){ $trasdesp="0"; }
                    $select = "SUM(i.cantidad) AS Pares";
                    $from = "itemventa i,adicionkardextienda k, ventasdetalle v,modelos mdt";
                    $where = "k.idkardextienda=i.idkardextienda ANd i.idventa=v.idventadetalle AND mdt.codigo LIKE '%$modelo%' AND k.idmodelodetalle=mdt.idmodelo  and mdt.stylename = '$idestilo'
and i.estado!='cambiado' AND v.fecha >= '$fechainicio'
    AND v.fecha <= '$fechafin' ";

                    $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                    //    d
                    $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                    $venta = $almacenA1['resultado'];
                    // $pares=$totalparesiddetalleingreso;
                    if($venta==NULL || $venta =='' || $venta == ""){ $venta="0"; }



                    $select = "SUM(k.saldocantidad) AS Pares";
                    $from = "adicionkardextienda k,modelos mdt";
                    $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.stylename = '$idestilo' AND mdt.codigo LIKE '%$modelo%' AND k.unido='no'";
                    $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                    $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                    $tstockactual = $almacenA1['resultado'];


                    if($tstockactual==NULL || $tstockactual =='' || $tstockactual == ""){ $tstockactual="0"; }
                    //fin

                    $select = "SUM(k.saldocantidad*precio2bs) AS Pares";
                    $from = "adicionkardextienda k,modelos mdt";
                    $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.stylename = '$idestilo' AND mdt.codigo LIKE '%$modelo%' AND k.unido='no'";
                    $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                    $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                    $totalbsactual = $almacenA1['resultado'];

                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$tstockant."&nbsp;</td>";

                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$recibido."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$trasrecibido."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$devueltos."&nbsp;</td>";

                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$trasdesp."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$venta."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$tstockactual."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$totalbsactual."&nbsp;</td>";

                    $devS .= "</tr>";

                    $devS .= "</table>";

                    $dev['mensaje'] = "Existen resultados";
                    $dev['error']   = "true";
                    $dev['resultado'] = $devS;

                }
                else
                {
                    $dev['mensaje'] = "No se encontro datos en la consulta2".mysql_error();
                    $dev['error']   = "false";
                    $dev['resultado'] = "";
                }
            }
            else
            {
                $dev['mensaje'] = "Error en la consulta";
                $dev['error']   = "false";
                $dev['resultado'] = "";
            }
        }
        else
        {
            $dev['mensaje'] = "No se pudo conectar a la BD";
            $dev['error']   = "false";
            $dev['resultado'] = "";
        }
    }
    else
    {
        $dev['mensaje'] = "No se pudo crear la conexion a la BD";
        $dev['error']   = "false";
        $dev['resultado'] = "";
    }
    return $dev;
}
function dibujarTablaOfDetalleLector($idkardex,$sql,$sql21,$row1,$idmarca,$idestilo,$rango1,$rango2,$total1,$total2, $tipo,$marcapedido)
{
    //reportegrande
    $sqlmarca = " SELECT tabla,mesrango,idperiodo,fechainicio,fechafin FROM administrakardex WHERE idkardex = '$idkardex' ";
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "tabla");
    $tabla = $opcionkardex['resultado'];
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "mesrango");
    $mesrango = $opcionkardex['resultado'];
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "idperiodo");
    $idperiodo = $opcionkardex['resultado'];
    //echo $tabla;
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "fechainicio");
    $fechainicio = $opcionkardex['resultado'];
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "fechafin");
    $fechafin = $opcionkardex['resultado'];
    //AND k.idperiodo='$idperiodo'

    if($fechafin==null ||$fechafin == ""){
        $fechafin = Date("Y-m-d");
    }
    if($tabla=="historialkardextienda"){
    }else{
        $sqlInv = "SELECT MAX(idperiodo)AS numero
FROM administrakardex where tabla='historialkardextienda'";
        $almacenA1 =  findBySqlReturnCampoUnique($sqlInv, true, true, 'numero');
        $idperiodoant = $almacenA1['resultado'];
        $sqlmarca = " SELECT tabla,mesrango,idperiodo,fechainicio,fechafin FROM administrakardex WHERE idperiodo = '$idperiodoant' ";
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "fechainicio");
        // $fechainicio = $opcionkardex['resultado'];
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "fechafin");
        // $fechafin = $opcionkardex['resultado'];
    }

    $sql211 = getTablaToArrayOfSQL($sql21);
    $sql3 = $sql211['resultado'];
    if($link=new BD)
    {
        if($link->conectar())
        {
            if($re = $link->consulta($sql))
            {
                //echo mysql_num_rows($re);
                if($fi = mysql_fetch_array($re))
                {
                    $devS .= "<table cellpadding='0' cellspacing='0' border='0' style='width:750px;border:1px solid #000000;font-size:11px;'>";
                    $devS .= "<tr><td style='border-bottom:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Nro</td>";
                    $devS .= "<td style='display:none;'>".mysql_field_name($re, $zz)."</td>";
                    // $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Modelo</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Modelo</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Color</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Precio</td>";
                    for($hi=0;$hi<$row1;$hi++){
                        $codigo = $sql3[$hi];
                        $idmmarca = $codigo['talla'];

                        $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>$idmmarca</td>";
                        $ji++;
                    }
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Stock Anterior</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Stock Actual en sistema</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Cantidad Lector</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Diferencia</td>";

                    $devS .= "</tr>";
                    $ii = 0;
                    //$totalCount = mysql_num_rows($re);
                    $z = 1;
                    do{
                        $devS .= "<tr><td style='text-align:left'>".$z."</td>";
                        for($i = 0; $i< mysql_num_fields($re); $i++)
                        {$dato = $fi[$i];
                            $iddetalleingreso = $fi[$i]['iddetalleingreso'];

                            $devS .= "<td style='display:none;'>&nbsp;".$dato."&nbsp;</td>";
                            // echo $marcapedido;
                            $select = "dtp.totalbs AS precio";
                            $from = "adiciondetalleingreso dtp, modelos mdd, coleccion col, estilos es";
                            $where = "dtp.idmodelo = mdd.idmodelo AND mdd.idcoleccion = col.idcoleccion AND mdd.stylename = es.idestilo AND dtp.iddetalleingreso='$dato'";

                            if($marcapedido=='CODIGO-COLOR-MATERIAL'){
                                $select .= ",mdd.codigo, dtp.color";
                                // $select .= ",concat(col.detalle,'-',mdd.codigo) AS codigo, dtp.color";
                            }else{
                                if($marcapedido=="CODIGO-MATERIAL"){
                                    $select .= ",concat(mdd.codigo,'-',dtp.material) AS codigo, dtp.color";
                                }else{
                                    if(($marcapedido=="CODIGO-COLOR")||($marcapedido=="CODIGO")){
                                        $select .= ",mdd.codigo, dtp.color";
                                    }else{
                                        if($marcapedido=="CODIGO-COLOR-STYLENAME"){
                                            $select .= ",concat(mdd.codigo,'-',dtp.color) AS codigo, dtp.material AS color";
                                        }else{
                                            if($marcapedido=="LINEA-CODIGO-COLOR"){
                                                $select .= ",concat(l.codigo,'-',mdd.codigo) AS codigo, dtp.color AS color";
                                                //  $select .= ",concat(mdd.codigo,'-',dtp.color) AS codigo, dtp.material AS color";

                                                $from .= ",lineas l";
                                                $where .= "AND mdd.idlinea = l.idlinea";

                                            }
                                        }

                                    }
                                }
                            }
                            //lor
                            $sql2p1 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                            //echo $sql2p1;
                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p1, true, true, 'codigo');
                            $modelo = $almacenA1['resultado'];
                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p1, true, true, 'color');
                            $color = $almacenA1['resultado'];
                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p1, true, true, 'precio');
                            $precio = $almacenA1['resultado'];
                            $devS .= "<td style='text-align:left;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$modelo."&nbsp;</td>";
                            $devS .= "<td style='text-align:left;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$color."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$precio."&nbsp;</td>";

                            //lorg
                            for($h=0;$h<$row1;$h++){
                                $codigo = $sql3[$h];
                                $idmmarca = $codigo['talla'];

                                if($tabla=="historialkardextienda"){

                                    $select1 = "cantidadlector AS Pares";
                                    $from1 = "historialkardextienda";
                                    $where1 = "idcalzado = '$dato' AND talla='$idmmarca' AND idperiodo='$idperiodo'";
                                    //if($ltienda != "Todos"){ $where .= " AND ve.idtienda = '$ltienda' ";}
                                    $sql21 = "SELECT ".$select1." FROM ".$from1. " WHERE ".$where1;

                                    $almacenA1 =  findBySqlReturnCampoUnique($sql21, true, true, 'Pares');
                                    $pares1 = $almacenA1['resultado'];
                                }else{
                                    $select1 = "cantidadlector AS Pares";
                                    $from1 = "adicionkardextienda";
                                    $where1 = "idcalzado = '$dato' AND talla='$idmmarca'";
                                    //if($ltienda != "Todos"){ $where .= " AND ve.idtienda = '$ltienda' ";}
                                    $sql21 = "SELECT ".$select1." FROM ".$from1. " WHERE ".$where1;

                                    $almacenA1 =  findBySqlReturnCampoUnique($sql21, true, true, 'Pares');
                                    $pares1 = $almacenA1['resultado'];

                                }

                                //  if($pares1==NULL || $pares1 =='' || $pares1 == ""){ $pares1="0"; }
                                $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$pares1."&nbsp;</td>";
                                $j++;
                            }

                            if($tabla=="historialkardextienda"){
                                $sqlInv = "SELECT MAX(idperiodo)AS numero
FROM administrakardex where tabla='historialkardextienda'";
                                $almacenA1 =  findBySqlReturnCampoUnique($sqlInv, true, true, 'numero');
                                $idperiodoant = $almacenA1['resultado'];
                                $idper = $idperiodoant - 1;
                                $select = "SUM(saldocantidad) AS Pares";
                                $from = "historialkardextienda k";
                                $where = " k.idcalzado='$dato' AND k.idperiodo='$idper' AND k.unido='no'";
                                $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                                $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                                $stockanterior = $almacenA1['resultado'];


                                $select = "SUM(saldocantidad) AS Pares";
                                $from = "historialkardextienda k";
                                $where = " k.idcalzado='$dato' AND k.idperiodo='$idperiodoant' AND k.unido='no'";
                                $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                                $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                                $stockactual = $almacenA1['resultado'];

                                $select = "SUM(cantidadlector) AS Pares";
                                $from = "historialkardextienda k";
                                $where = " k.idcalzado='$dato' AND k.idperiodo='$idperiodoant' AND k.unido='no'";
                                $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                                $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                                $cantidadlector = $almacenA1['resultado'];

                                $diferencia = $cantidadlector - $stockactual;
                            }
                            else{
                                $sqlInv = "SELECT MAX(idperiodo)AS numero
FROM administrakardex where tabla='historialkardextienda'";
                                $almacenA1 =  findBySqlReturnCampoUnique($sqlInv, true, true, 'numero');
                                $idperiodoant = $almacenA1['resultado'];
                                //  echo $idperiodoant;
                                $select = "SUM(saldocantidad) AS Pares";
                                $from = "historialkardextienda k";
                                $where = " k.idcalzado='$dato' AND k.idperiodo='$idperiodoant' AND k.unido='no'";
                                $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                                $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                                $stockanterior = $almacenA1['resultado'];

                                $select = "SUM(saldocantidad) AS Pares";
                                $from = "adicionkardextienda k";
                                $where = " k.idcalzado='$dato' and k.unido='no'";
                                $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                                $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                                $stockactual = $almacenA1['resultado'];

                                $select = "SUM(cantidadlector) AS Pares";
                                $from = "adicionkardextienda k";
                                $where = " k.idcalzado='$dato' and k.unido='no'";
                                $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                                $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                                $cantidadlector = $almacenA1['resultado'];
                                $diferencia = $cantidadlector - $stockactual;
                            }


                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$stockanterior."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$stockactual."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$cantidadlector."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$diferencia."&nbsp;</td>";

                        }
                        $devS .= "</tr>";
                        $ii++;
                        $z ++;
                    }while($fi = mysql_fetch_array($re));
                    //$devS .= "<tr><td style='border:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Total</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td style='border:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>$totalparesestilo</td><td style='border:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>$totalbsestilo</td>";
                    $devS .= "<tr style='background-color:silver;'><td style='border: 1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>TOTAL</td>";
                    $devS .= "<td style='display:none;'></td>";
                    $fechatoday = Date("d-m-Y");
                    $devS .= "<td style='text-align:center;border-bottom: 1px solid #000000;'></td>";
                    $devS .= "<td style='text-align:center;border-bottom: 1px solid #000000;'></td>";
                    $devS .= "<td style='text-align:center;border-bottom: 1px solid #000000;'></td>";

                    for($h=0;$h<$row1;$h++){
                        $codigo = $sql3[$h];
                        $idmmarca = $codigo['idmarca'];

                        $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'></td>";
                        $j++;
                    }

                    if($tabla=="historialkardextienda"){
                        $sqlInv = "SELECT MAX(idperiodo)AS numero
FROM administrakardex where tabla='historialkardextienda'";
                        $almacenA1 =  findBySqlReturnCampoUnique($sqlInv, true, true, 'numero');
                        $idperiodoant = $almacenA1['resultado'];
                        $idper = $idperiodoant - 1;
                        $select = "SUM(saldocantidad) AS Pares";
                        $from = "historialkardextienda k,modelos mdt";
                        $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND mdt.stylename = '$idestilo' AND k.idperiodo='$idper' AND k.unido='no'";
                        $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                        $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                        $tstockant = $almacenA1['resultado'];

                        $select = "SUM(saldocantidad) AS Pares";
                        $from = "historialkardextienda k,modelos mdt";
                        $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND mdt.stylename = '$idestilo' AND k.idperiodo='$idperiodoant' AND k.unido='no'";
                        $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                        $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                        $tstockactual = $almacenA1['resultado'];

                        $select = "SUM(cantidadlector) AS Pares";
                        $from = "historialkardextienda k,modelos mdt";
                        $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND mdt.stylename = '$idestilo' AND k.idperiodo='$idperiodoant' AND k.unido='no'";
                        $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                        $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                        $tlector = $almacenA1['resultado'];
                        $tdiferencia = $tlector - $tstockactual;
                    }
                    else{
                        $sqlInv = "SELECT MAX(idperiodo)AS numero
FROM administrakardex where tabla='historialkardextienda'";
                        $almacenA1 =  findBySqlReturnCampoUnique($sqlInv, true, true, 'numero');
                        $idperiodoant = $almacenA1['resultado'];
                        $select = "SUM(saldocantidad) AS Pares";
                        $from = "historialkardextienda k,modelos mdt";
                        $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND mdt.stylename = '$idestilo' AND k.idperiodo='$idperiodoant' AND k.unido='no'";
                        $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                        //echo $sql2p;
                        $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                        $tstockant = $almacenA1['resultado'];
                        $select = "SUM(k.saldocantidad) AS Pares";
                        $from = "adicionkardextienda k,modelos mdt";
                        $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.stylename = '$idestilo'  AND k.unido='no'";
                        $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                        $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                        $tstockactual = $almacenA1['resultado'];

                        $select = "SUM(k.cantidadlector) AS Pares";
                        $from = "adicionkardextienda k,modelos mdt";
                        $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.stylename = '$idestilo'  AND k.unido='no'";
                        $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                        $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                        $tlector = $almacenA1['resultado'];
                        $tdiferencia = $tlector - $tstockactual;
                    }
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$tstockant."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$tstockactual."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$tlector."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$tdiferencia."&nbsp;</td>";

                    $devS .= "</tr>";

                    $devS .= "</table>";

                    $dev['mensaje'] = "Existen resultados";
                    $dev['error']   = "true";
                    $dev['resultado'] = $devS;

                }
                else
                {
                    $dev['mensaje'] = "No se encontro datos en la consulta2".mysql_error();
                    $dev['error']   = "false";
                    $dev['resultado'] = "";
                }
            }
            else
            {
                $dev['mensaje'] = "Error en la consulta";
                $dev['error']   = "false";
                $dev['resultado'] = "";
            }
        }
        else
        {
            $dev['mensaje'] = "No se pudo conectar a la BD";
            $dev['error']   = "false";
            $dev['resultado'] = "";
        }
    }
    else
    {
        $dev['mensaje'] = "No se pudo crear la conexion a la BD";
        $dev['error']   = "false";
        $dev['resultado'] = "";
    }
    return $dev;
}


function dibujarTablaOfSQLmarcarecapitulacion($idkardex,$sql,$sql21,$row1,$nombrecategoria,$porcentajecat,$parestotalactualcategoria,$idalmacen,$rango1,$rango2,$totalparesestilo,$totalbsestilo, $tipo,$marcapedido)
{   $idalmacen=$_SESSION['idalmacen'];
    $sqlmarca = " SELECT idperiodo,idkardex FROM administrakardex WHERE idkardex = '$idkardex' group by idkardex";
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "idkardex");
    $idkar = $opcionkardex['resultado'];
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "idperiodo");
    $idperiodo = $opcionkardex['resultado'];

    if($idkar==null || $idkar==''){
        $sqlmarca = " SELECT * FROM administrakardex WHERE  mesrango= '$idkardex' group by idkardex";
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "idkardex");
        $idkar = $opcionkardex['resultado'];
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "tabla");
        $tabla = $opcionkardex['resultado'];
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "mesrango");
        $mesrango = $opcionkardex['resultado'];
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "idperiodo");
        $idperiodo = $opcionkardex['resultado'];
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "mesanterior");
        $mesanterior = $opcionkardex['resultado'];
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "estado");
        $estado = $opcionkardex['resultado'];
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "fechainicio");
        $fechainicio = $opcionkardex['resultado'];
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "fechafin");
        $fechafin = $opcionkardex['resultado'];
    }else{
        $sqlmarca = " SELECT * FROM administrakardex WHERE idkardex = '$idkar' group by idkardex";
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "idkardex");
        $idkar = $opcionkardex['resultado'];
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "tabla");
        $tabla = $opcionkardex['resultado'];
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "mesrango");
        $mesrango = $opcionkardex['resultado'];
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "idperiodo");
        $idperiodo = $opcionkardex['resultado'];
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "mesanterior");
        $mesanterior = $opcionkardex['resultado'];
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "estado");
        $estado = $opcionkardex['resultado'];
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "fechainicio");
        $fechainicio = $opcionkardex['resultado'];
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "fechafin");
        $fechafin = $opcionkardex['resultado'];
    }
    if($fechafin==null ||$fechafin == ""){
        $fechafin = Date("Y-m-d");
    }
    $sql211 = getTablaToArrayOfSQL($sql21);
    $sql3 = $sql211['resultado'];
    if($link=new BD)
    {
        if($link->conectar())
        {
            if($re = $link->consulta($sql))
            {
                if($fi = mysql_fetch_array($re))
                {
                    $devS .= "<table cellpadding='0' cellspacing='0' border='0' style='width:1250px;border:1px solid #000000;font-size:13px;font-family:Arial;'>";
                    $devS .= "<tr><td style='border-bottom:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'></td>";
                    $devS .= "<td style='display:none;'>".mysql_field_name($re, $zz)."</td>";
                    $devS .= "<td style='width:120px;border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:13px;text-align:center;'>MARCAS</td>";
                    $devS .= "<td colspan='3' align='center' style='border:1px solid #000000'>STOCK MERCADERIA</td>";
                    $devS .= "<td colspan='3' align='center'  style='border:1px solid #000000' >RECIBIDOS</td>";
                    $devS .= "<td colspan='3' align='center'  style='border:1px solid #000000'>TRASP REC.</td>";
                    $devS .= "<td colspan='3' align='center'  style='border:1px solid #000000'>TRASP DESP.</td>";
                    $devS .= "<td colspan='3' align='center'  style='border:1px solid #000000' >VENTAS</td>";
                    $devS .= "<td colspan='3' align='center'  style='border:1px solid #000000' >DEVOLUCION</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;'>Cobros</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;'>Cuentas</td>";
                    $devS .= "<td colspan='3' align='center'  style='border:1px solid #000000' >STOCK ACTUAL</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;'>Rebajas</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;'>Fallas</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;'>-</td>";
                    $devS .= "</tr>";
                    $devS .= "<tr><td style='border-bottom:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>#</td>";
                    $devS .= "<td style='display:none;'>".mysql_field_name($re, $zz)."</td>";
                    $devS .= "<td style='width:120px;border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:13px;text-align:center;background-color:silver;'></td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Cjs</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Prs</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Sus.</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Cjs</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Prs</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Sus.</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Cjs</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Prs</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Sus.</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Cjs</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Prs</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Sus.</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Cjs</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Prs</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Sus.</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Cjs</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Prs</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Sus.</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Sus</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>P/C</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Cjs</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Prs</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Sus.</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'></td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'></td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>-</td>";
                    $devS .= "</tr>";
                    $ii = 0;
                    $z = 1;

                    $tcajasstant =0;
                    $tparesstant =0;
                    $ttotalbsstant =0;
                    $ttotalcajasrecibido =0;
                    $ttotalparesrecibido =0;
                    $ttotalbsrecibido =0;

                    $tcajastrasrec =0;
                    $tparestrasrec =0;
                    $ttotalbstrasrec =0;
                    $tcajastraspdesp =0;
                    $tparestraspdesp =0;
                    $ttotalbstraspdesp =0;
                    $ttotalcajasventa =0;
                    $ttotalparesventa =0;
                    $ttotalbsventa =0;
                    $ttotalcajasdev =0;
                    $ttotalparesdev =0;
                    $ttotalbsdev =0;
                    $tcobros =0;
                    $trebajas= 0;
                    $tcuentas =0;
                    $tcajasstact =0;
                    $tparesstact =0;
                    $ttotalbsstact =0;
                    $ttotalbs =0;
                    $trebaja =0;
                    $trebajainventario =0;
                    $tporcentaje =0;
                    do{
                        $devS .= "<tr><td style='text-align:left'>".$z."</td>";
                        for($i = 0; $i< mysql_num_fields($re); $i++)
                        {$dato = $fi[$i];
                            $iddetalleingreso = $fi[$i]['idmarca'];
                            $idmarca =$dato;
                            //ojo
                            $sql = "SELECT ma.nombre AS marca,ma.talla,ma.opcionb,ma.pedido FROM  `marcas` ma WHERE ma.idmarca = '$dato'";
                            $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'marca');
                            $marcalista = $idalmacenA2['resultado'];
                            $devS .= "<td style='display:none;'>".$dato."</td>";
                            $devS .= "<td style='width:120px;text-align:left;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>".$marcalista."</td>";
                            if($cajasstant==NULL || $cajasstant =='' || $cajasstant == ""){ $cajasstant="0"; }
                            if($paresstant==NULL || $paresstant =='' || $paresstant == ""){ $paresstant="0"; }
                            if($totalbsstant==NULL || $totalbsstant =='' || $totalbsstant == ""){ $totalbsstant="0"; }
                          $select = "SUM(k.totalcajas) AS Pares";
                            $from = "ingresoalmacen k";
                            $where = "";
                            { $where .= " k.idmarca = '$idmarca'  AND k.fecha >= '$fechainicio' AND k.fecha <= '$fechafin' ";}
                            $sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where;
                            $almacenA1 =  findBySqlReturnCampoUnique($sql25, true, true, 'Pares');
                            $totalcajasrecibido = $almacenA1['resultado'];
                            //  echo $sqlEgreso;
                            $select = "SUM(kp.saldocantidad) AS Pares";
                            $from = "ingresoalmacen i,kardexdetalleparingreso kp";
                            $where = "";
                            { $where .= " i.idingreso=kp.idingreso and i.idmarca = '$idmarca'  AND i.fecha >= '$fechainicio' AND i.fecha <= '$fechafin'";}
                            $sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where;
                            $almacenA1 =  findBySqlReturnCampoUnique($sql25, true, true, 'Pares');
                            $totalparesrecibido = $almacenA1['resultado'];

                            $select = "COUNT(kp.idkardexunico) AS Pares, SUM(kp.preciounitario) AS sus";
                            $from = "kardexdetallepar kp,proformas p,modelo m";
                            $where = "kp.idingreso=p.id_proforma and m.idingreso=p.id_proforma and kp.idmodelo=m.idmodelo and p.nombre!='00/2016'";
                            { $where .= " AND p.idmarca = '$idmarca'  AND m.fecha >= '$fechainicio' AND
                                          m.fecha <= '$fechafin' ";}
                            $sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where;
                            $almacenA1 =  findBySqlReturnCampoUnique($sql25, true, true, 'Pares');
                            $totalparesrecibidonuevo = $almacenA1['resultado'];
                            $almacenA1 =  findBySqlReturnCampoUnique($sql25, true, true, 'sus');
                            $totalbsrecibidonuevo = $almacenA1['resultado'];

                            $select1 = "COUNT(kp.idkardexunico) AS Pares, SUM(kp.preciounitario) AS sus";
                            $from1 = "kardexdetallepar kp,proformas p,modelo m,traspaso t,traspasodetallepar tr";
                            $where1 = "kp.idkardexunico=tr.idkardexunico and tr.idmodeloorigen=m.idmodelo and
                                       tr.iddetalletraspaso=t.idtraspaso and m.`idingreso`=p.`id_proforma` ";
                            { $where1 .= " AND p.idmarca = '$idmarca' AND m.fecha >= '$fechainicio' AND
                                           m.fecha <= '$fechafin' ";}

                            $sql25c = "SELECT ".$select1." FROM ".$from1." WHERE ".$where1;
                            //echo $sql25c;
                            $almacenA1 =  findBySqlReturnCampoUnique($sql25c, true, true, 'Pares');
                            $totalparesrecibidonuevotraspaso = $almacenA1['resultado'];
                            $almacenA1 =  findBySqlReturnCampoUnique($sql25c, true, true, 'sus');
                            $totalbsrecibidonuevotraspaso = $almacenA1['resultado'];
                            $totalparesrecibido =$totalparesrecibido + $totalparesrecibidonuevo + $totalparesrecibidonuevotraspaso;

                            $select = "SUM(k.totalbs) AS totalprecio";
                            $from = "ingresoalmacen k";
                            $where = "";
                            { $where .= "k.idmarca = '$idmarca'  AND k.fecha >= '$fechainicio' AND
                                         k.fecha <= '$fechafin' ";}
                            $sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where;
                            $almacenA1 =  findBySqlReturnCampoUnique($sql25, true, true, 'totalprecio');
                            $totalbsrecibido = $almacenA1['resultado'];

                            $totalbsrecibido = $totalbsrecibido + $totalbsrecibidonuevo + $totalbsrecibidonuevotraspaso;
                            $totalcajasnuevo = $totalparesrecibido/12;
                            $totalcajasrecibido = $totalcajasrecibido + $totalcajasnuevo;
                            $totalcajasrecibido = round($totalcajasrecibido,2);

                            //traspasos entregados
                            $sqlEgreso ="SELECT SUM(iv.saldocantidad) AS Pares, SUM(iv.preciounitario) AS TotalBs
FROM traspasosinternos iv,modelo md,ventas v, empleados em,empleados emo
WHERE iv.idventa=v.idventa and iv.idmodelo=md.idmodelo and iv.idvendedor=em.idempleado and iv.idvendedororigen=emo.idempleado AND md.idmarca = '$idmarca'
AND iv.fecha >= '$fechainicio' AND iv.fecha <= '$fechafin'";
                            $almacenA1 =  findBySqlReturnCampoUnique($sqlEgreso, true, true, 'Pares');
                            $parestrasenvinterno= $almacenA1['resultado'];
                            $almacenA1 =  findBySqlReturnCampoUnique($sqlEgreso, true, true, 'TotalBs');
                            $bstrasenviinterno = $almacenA1['resultado'];

                            $sqlEgresoq ="SELECT SUM(it.saldocantidad) AS Pares, SUM(it.preciounitario) AS TotalBs
FROM traspaso t,traspasodetallepar it,modelo mdd
WHERE t.idtraspaso=it.iddetalletraspaso and it.idmodeloorigen=mdd.idmodelo AND mdd.idmarca = '$idmarca' and t.fecha >= '$fechainicio' AND t.fecha <= '$fechafin'
   ";
                            $almacenA1 =  findBySqlReturnCampoUnique($sqlEgresoq, true, true, 'Pares');
                            $partraspenv = $almacenA1['resultado'];
                            $partraspenv=$partraspenv+$parestrasenvinterno;
                            $almacenA1 =  findBySqlReturnCampoUnique($sqlEgresoq, true, true, 'TotalBs');
                            $sustraspenv = $almacenA1['resultado'];
                            $sustraspenv=$sustraspenv+$bstrasenviinterno;

                            $ctraspenv = $partraspenv/12;
                            $ctraspenv = round($ctraspenv,2);
                            //fin entregados
                            $sqlEgreso ="SELECT SUM(iv.saldocantidad) AS Pares, SUM(iv.preciounitario) AS TotalBs
FROM traspasosinternos iv,modelo md,ventas v, empleados em,empleados emo
WHERE iv.idventa=v.idventa and iv.idmodelo=md.idmodelo and iv.idvendedor=em.idempleado and iv.idvendedororigen=emo.idempleado AND md.idmarca = '$idmarca'
AND iv.fecha >= '$fechainicio' AND iv.fecha <= '$fechafin'";
                            $almacenA1 =  findBySqlReturnCampoUnique($sqlEgreso, true, true, 'Pares');
                            $parestrasrecinterno = $almacenA1['resultado'];
                            $almacenA1 =  findBySqlReturnCampoUnique($sqlEgreso, true, true, 'TotalBs');
                            $bstrasrecinterno= $almacenA1['resultado'];


                            $sqlEgreso ="SELECT  SUM(it.saldocantidad) AS Pares, SUM(it.preciounitario) AS TotalBs
FROM traspaso t,traspasodetallepar it,modelo mdd
WHERE t.idtraspaso=it.iddetalletraspaso and it.idmodelo=mdd.idmodelo AND mdd.idvendedor=t.responsable AND mdd.idmarca = '$idmarca' and t.fecha >= '$fechainicio' AND t.fecha <= '$fechafin'
   ";
                            //ojo
                            $almacenA1 =  findBySqlReturnCampoUnique($sqlEgreso, true, true, 'Pares');
                            $partrasrec = $almacenA1['resultado'];
                            $partrasrec=$partrasrec+$parestrasrecinterno;
                            $almacenA1 =  findBySqlReturnCampoUnique($sqlEgreso, true, true, 'TotalBs');
                            $sustrasrec = $almacenA1['resultado'];
                            $sustrasrec=$sustrasrec+$bstrasrecinterno;
                            $ctrasprec = $partrasrec/12;
                            $ctrasprec = round($ctrasprec,2);
                            //fin  recibidos
                            $select = "SUM(vi.cantidad) AS Pares";
                            $from = "ventas v,modelo mo,ventaitem vi";
                            $where = " v.idventa=vi.idventa AND vi.idmodelo=mo.idmodelo and mo.idmarca = '$idmarca' and v.fecha >= '$fechainicio'
    AND v.fecha <= '$fechafin'";
                            $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');

                            $totalparesventa = $almacenA1['resultado'];
                            $totalcajasventa = $totalparesventa/12;
                            $totalcajasventa = round($totalcajasventa,2);
                            $select = "sUM(vi.precioventa) AS Pares";
                            $from = "ventas v,modelo mo,ventaitem vi";
                            $where = "v.idventa=vi.idventa AND vi.idmodelo=mo.idmodelo and mo.idmarca = '$idmarca'
and v.fecha >= '$fechainicio' AND v.fecha <= '$fechafin'";
                            $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                            $totalbsventa = $almacenA1['resultado'];

                            $select = "COUNT(v.iddetalledevolucion) AS Pares";
                            $from = "detalledevolucion v,devolucion d,kardexdetallepar k";
                            $where = " v.idkardexunico=k.idkardexunico and v.iddevolucion=d.iddevolucion
    AND d.idmarca = '$idmarca' and d.fecha >= '$fechainicio' AND d.fecha <= '$fechafin'";
                            $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                            $totalparesdev = $almacenA1['resultado'];
                            $totalcajasdev = $totalparesdev/12;
                            $totalcajasdev= round($totalcajasdev,2);
                            $select = "SUM(v.valorcalzado) AS Pares";
                            $from = "detalledevolucion v,devolucion d,kardexdetallepar k";
                            $where = "v.idkardexunico=k.idkardexunico and v.iddevolucion=d.iddevolucion
     AND d.idmarca = '$idmarca' and d.fecha >= '$fechainicio' AND d.fecha <= '$fechafin'";
                            $sql2p1 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p1, true, true, 'Pares');
                            $totalbsdev = $almacenA1['resultado'];

                            $sqlEgreso ="SELECT  estado FROM periodo WHERE idperiodo= '$idperiodo'    ";
                            $almacenA1 =  findBySqlReturnCampoUnique($sqlEgreso, true, true, 'estado');
                            $estadoperiodo = $almacenA1['resultado'];

 $sqlmarca = " SELECT * FROM administrakardex WHERE mesrango='$mesrango' group by mesrango";
                                $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "mesanterior");
                                $mesanterior = $opcionkardex['resultado'];

                           if($estado=="cerrado"){
                                $select = "SUM(k.pares) AS Pares";
                                $from = "kardexresumen k,modelo m";
                                $where = " k.idmodelo=m.idmodelo AND k.idmarca = '$idmarca' and
    mes='$mesrango'";
                                $sql2p3 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                                $almacenA1 =  findBySqlReturnCampoUnique($sql2p3, true, true, 'Pares');
                                $paresstact = $almacenA1['resultado'];

                                $cajasstact = $paresstact/12;
                                $select = "SUM(k.pares*m.preciounitario) AS Precio";
                                $from = "kardexresumen k,modelo m";
                                $where = " k.idmodelo=m.idmodelo AND k.idmarca = '$idmarca' and mes='$mesrango'";
                                $sql2p3 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                                $almacenA1 =  findBySqlReturnCampoUnique($sql2p3, true, true, 'Precio');
                                $totalbsstact = $almacenA1['resultado'];

                               

                                $select = "SUM(k.pares) AS Pares";
                                $from = "kardexresumen k,modelo m";
                                $where = " k.idmodelo=m.idmodelo AND k.idmarca = '$idmarca' and mes='$mesanterior'";
                                $sql2p3 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                                $almacenA1 =  findBySqlReturnCampoUnique($sql2p3, true, true, 'Pares');
                                $paresstant = $almacenA1['resultado'];

                                $cajasstant = $paresstant/12;
                                $select = "SUM(k.pares*m.preciounitario) AS Precio";
                                $from = "kardexresumen k,modelo m";
                                $where = " k.idmodelo=m.idmodelo AND k.idmarca = '$idmarca' and mes='$mesanterior'";
                                $sql2p3 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                                $almacenA1 =  findBySqlReturnCampoUnique($sql2p3, true, true, 'Precio');
                                $totalbsstant = $almacenA1['resultado'];
                                $cajasstant =round($cajasstant,2);


                            }else{
                                $select = "SUM(ka.saldocantidad) AS Pares";
                                $from = "modelo m,kardexdetallepar ka";
                                $where = "  ka.idmodelo=m.idmodelo  aND m.idmarca = '$idmarca' ";
                                $sql2p3 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                                $almacenA1 =  findBySqlReturnCampoUnique($sql2p3, true, true, 'Pares');
                                $paresstact = $almacenA1['resultado'];

                                $cajasstact = $paresstact/12;
                                $select = "SUM(ka.saldocantidad*ka.preciounitario) AS Precio";
                                $from = "modelo m,kardexdetallepar ka";
                                $where = " ka.idmodelo=m.idmodelo  aND m.idmarca = '$idmarca' ";
                                $sql2p3 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                                $almacenA1 =  findBySqlReturnCampoUnique($sql2p3, true, true, 'Precio');
                                $totalbsstact = $almacenA1['resultado'];


                                $select = "SUM(k.pares) AS Pares";
                                $from = "kardexresumen k,modelo m";
                                $where = " k.idmodelo=m.idmodelo AND k.idmarca = '$idmarca' and k.mes='$mesanterior'";
                                $sql2p3q = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                                $almacenA1 =  findBySqlReturnCampoUnique($sql2p3q, true, true, 'Pares');
                                $paresstant = $almacenA1['resultado'];
                                //echo $sql2p3q;
                                $cajasstact = $paresstact/12;
                                $select = "SUM(k.pares*m.preciounitario) AS Precio";
                                $from = "kardexresumen k,modelo m";
                                $where = " k.idmodelo=m.idmodelo AND k.idmarca = '$idmarca' and mes='$mesanterior'";
                                $sql2p3d = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                                $almacenA1 =  findBySqlReturnCampoUnique($sql2p3d, true, true, 'Precio');
                                $totalbsstant = $almacenA1['resultado'];
                                $cajasstant = $paresstant/12;
                                $cajasstant =round($cajasstant,2);

                            }
                     //       echo $estadoperiodo;
 $cajasstact =round($cajasstact,2);
                            if($cajasstact==NULL || $cajasstact =='' || $cajasstact == ""){ $cajasstact="0"; }
                            if($paresstact==NULL || $paresstact =='' || $paresstact == ""){ $paresstact="0"; }
                            if($totalbsstact==NULL || $totalbsstact =='' || $totalbsstact == ""){ $totalbsstact="0"; }

                            $totalbsstant =round($totalbsstant,2);
                            $select = "SUM(vi.precioventa) AS Pares";
                            $from = "ventas v,modelo mo,ventaitem vi";
                            $where = "v.idventa=vi.idventa AND vi.idmodelo=mo.idmodelo and mo.idmarca = '$idmarca' and v.fecha >= '$fechainicio'
    AND v.fecha <= '$fechafin'";
                            $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                            $totalbsventa = $almacenA1['resultado'];
                            $select2 = "sum(cp.monto) as monto";
                            $from = "creditopago cp";
                            $where = "cp.idmarca='$idmarca' AND cp.fechapago >= '$fechainicio' AND cp.fechapago <= '$fechafin'";
                            $sql251 = "SELECT ".$select2." FROM ".$from." WHERE ".$where." ";
                            $idalmacenA =  findBySqlReturnCampoUnique($sql251, true, true, 'monto');
                            $cobros = $idalmacenA['resultado'];

                            $select2 = "sum(cr.monto) as monto";
                            $from = "creditorebaja cr";
                            $where = "cr.idmarca='$idmarca' AND cr.fechapago >= '$fechainicio' AND cr.fechapago <= '$fechafin'";
                            $sql251 = "SELECT ".$select2." FROM ".$from." WHERE ".$where." ";
                            $idalmacenA =  findBySqlReturnCampoUnique($sql251, true, true, 'monto');
                            $rebajas = $idalmacenA['resultado'];

                            $select = "sum(cl.porpagar) as monto";
                            $from = "creditocliente cl,clientes c";
                            $where = "cl.idcliente=c.idcliente and cl.estado='pendiente' and cl.idmarca='$idmarca'";
                            $sql251 = "SELECT ".$select." FROM ".$from." WHERE ".$where." ";
                            $idalmacenA =  findBySqlReturnCampoUnique($sql251, true, true, 'monto');
                            $cuentas = $idalmacenA['resultado'];

                            $sql3 = "SELECT SUM(vf.diferencia) as total FROM ventafinalmodelo vf, ventas v WHERE v.idventa=vf.idventa and vf.idmarca = '$idmarca' and vf.fecha >= '$fechainicio' AND vf.fecha <= '$fechafin' and v.idalmacen='$idalmacen'";
                            $idalmacenA2 =  findBySqlReturnCampoUnique($sql3, true, true, 'total');
                            $rebaja = $idalmacenA2['resultado'];
                            $rebaja = round($rebaja,2);
                            $sql3w = "SELECT SUM(vf.diferencia) as total FROM kardexrebaja vf WHERE vf.idmarca = '$idmarca' and vf.fecha >= '$fechainicio' AND vf.fecha <= '$fechafin'";
                            $idalmacenA2 =  findBySqlReturnCampoUnique($sql3w, true, true, 'total');
                            $rebajainventario = $idalmacenA2['resultado'];
                            $rebajainventario = round($rebajainventario,2);

                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$cajasstant."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$paresstant."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$totalbsstant."&nbsp;</td>";
                           $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$totalcajasrecibido."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$totalparesrecibido."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$totalbsrecibido."&nbsp;</td>";

                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$ctraspenv."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$partraspenv."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$sustraspenv."&nbsp;</td>";

                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$ctrasprec."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$partrasrec."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$sustrasrec."&nbsp;</td>";

                          $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$totalcajasventa."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$totalparesventa."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$totalbsventa."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$totalcajasdev."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$totalparesdev."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$totalbsdev."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$cobros."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$cuentas."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$cajasstact."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$paresstact."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$totalbsstact."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$totalbs."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$rebaja."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$porcentaje."&nbsp;</td>";

                           $tcajasstant =$tcajasstant+$cajasstant;
                             $tparesstant =$tparesstant+$paresstant;
                            $ttotalbsstant =$ttotalbsstant+$totalbsstant;
                            $ttotalcajasrecibido =$ttotalcajasrecibido+$totalcajasrecibido;
                            $ttotalparesrecibido =$ttotalparesrecibido+$totalparesrecibido;
                            $ttotalbsrecibido =$ttotalbsrecibido+$totalbsrecibido;

                            $tcajastrasrec =$tcajastrasrec+$ctraspenv;
                            $tparestrasrec =$tparestrasrec+$partraspenv;
                            $ttotalbstrasrec =$ttotalbstrasrec+$sustraspenv;
                            $tcajastraspdesp =$tcajastraspdesp+$ctrasprec;
                            $tparestraspdesp =$tparestraspdesp+$partrasrec;
                            $ttotalbstraspdesp =$ttotalbstraspdesp+$sustrasrec;

                            $ttotalcajasventa =$ttotalcajasventa+$totalcajasventa;
                            $ttotalparesventa =$ttotalparesventa+$totalparesventa;
                            $ttotalbsventa =$ttotalbsventa+$totalbsventa;
                            $ttotalcajasdev =$ttotalcajasdev+$totalcajasdev;
                            $ttotalparesdev =$ttotalparesdev+$totalparesdev;
                            $ttotalbsdev =$ttotalbsdev+$totalbsdev;
                            $tcobros =$tcobros+$cobros;
                            $trebajas =$trebajas+$rebajas;
                            $tcuentas =$tcuentas+$cuentas;
                            $tcajasstact =$tcajasstact+$cajasstact;
                            $tparesstact =$tparesstact+$paresstact;
                            $ttotalbsstact =$ttotalbsstact+$totalbsstact;
                            $ttotalbs =$ttotalbs+$totalbs;
                            $trebaja =$trebaja+$rebaja;
                            $trebajainventario =$trebajainventario+$rebajainventario;
                            $tporcentaje =$tporcentaje+$porcentaje;
                        }
                        $devS .= "</tr>";
                        $ii++;
                        $z ++;
                    }while($fi = mysql_fetch_array($re));
                    //$devS .= "<tr><td style='border:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Total</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td style='border:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>$totalparesestilo</td><td style='border:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>$totalbsestilo</td>";
                    $devS .= "<tr style='background-color:silver;'><td style='border: 1px solid #000000;font-weight:bold;font-size:12px;text-align:center;background-color:silver;font-family:Arial;'></td>";
                    $devS .= "<td style='display:none;'></td>";
                    $fechatoday = Date("d-m-Y");

                    $devS .= "<td style='width:120px;text-align:center;border-bottom: 1px solid #000000;font-weight:bold;font-size:12px;'>TOTAL -".$nombrecategoria."</td>";
              $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$tcajasstant."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$tparesstant."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$ttotalbsstant."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$ttotalcajasrecibido."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$ttotalparesrecibido."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$ttotalbsrecibido."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$tcajastrasrec."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$tparestrasrec."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$ttotalbstrasrec."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$tcajastraspdesp."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$tparestraspdesp."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$ttotalbstraspdesp."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$ttotalcajasventa."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$ttotalparesventa."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$ttotalbsventa."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$ttotalcajasdev."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$ttotalparesdev."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$ttotalbsdev."&nbsp;</td>";

                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$tcobros."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$trebajas."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$tcuentas."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$tcajasstact."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$tparesstact."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$ttotalbsstact."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$trebaja."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$trebajainventario."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$tporcentaje."&nbsp;</td>";
                 $devS .= "</tr>";

                    $devS .= "</tr>";
                    $devS .= "<tr><td style='border-bottom:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'></td>";
                    $devS .= "<td style='display:none;'></td>";
                    $devS .= "<td colspan='3' align='center' font-family='Arial' background-color='silver' >CAPITAL DE OPERACION</td>";
                    $cuentasporcobrar= "0.00";
                    $devS .= "<td colspan='1' align='center' font-family='Arial' background-color='silver' >".$cuentasporcobrar."</td>";
                    $devS .= "<td colspan='16' align='center' font-family='Arial' background-color='silver' ></td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;'>".$cuentasporcobrar."</td>";

                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;'>".$cuentasporcobrar."</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;'></td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;'></td>";

                    $devS .= "</tr>";
                    $devS .= "<tr><td style='border-bottom:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'></td>";
                    $devS .= "<td style='display:none;'></td>";
                    //$devS .= "<td colspan='7' align='center' font-family='Arial' background-color='silver' ></td>";
                   // $cuentasporcobrar= "0.00";

                   // $devS .= "<td colspan='2' align='center' font-family='Arial' background-color='silver' >MAS LAS 7 MARCAS</td>";
                    //$devS .= "<td colspan='2' align='center' font-family='Arial' background-color='silver' ></td>";
                   // $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;'>".$cuentasporcobrar."</td>";
                   // $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;'>".$cuentasporcobrar."</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;'></td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;'></td>";

                    $devS .= "</tr>";
                    $devS .= "</table>";

                    $dev['mensaje'] = "Existen resultados";
                    $dev['error']   = "true";
                    $dev['resultado'] = $devS;

                }
                else
                {
                    $dev['mensaje'] = "No se encontro datos en la consulta2".mysql_error();
                    $dev['error']   = "false";
                    $dev['resultado'] = "";
                }
            }
            else
            {
                $dev['mensaje'] = "Error en la consulta";
                $dev['error']   = "false";
                $dev['resultado'] = "";
            }
        }
        else
        {
            $dev['mensaje'] = "No se pudo conectar a la BD";
            $dev['error']   = "false";
            $dev['resultado'] = "";
        }
    }
    else
    {
        $dev['mensaje'] = "No se pudo crear la conexion a la BD";
        $dev['error']   = "false";
        $dev['resultado'] = "";
    }
    return $dev;
}


function dibujarTablaOfSQLmarcarecapitulacionoriginal($idkardex,$sql,$sql21,$row1,$nombrecategoria,$porcentajecat,$parestotalactualcategoria,$idalmacen,$rango1,$rango2,$totalparesestilo,$totalbsestilo, $tipo,$marcapedido,$fechainicio,$fechafin)
{ $idalmacen=$_SESSION['idalmacen'];

    //    d
    $sql211 = getTablaToArrayOfSQL($sql21);
    $sql3 = $sql211['resultado'];
    if($link=new BD)
    {
        if($link->conectar())
        {
            if($re = $link->consulta($sql))
            {
                //echo mysql_num_rows($re);
                if($fi = mysql_fetch_array($re))
                {
                    //tamano $html .= "<tr><td colspan='4' align='center' font-family='Arial'>


                    $devS .= "<table cellpadding='0' cellspacing='0' border='0' style='width:1250px;border:1px solid #000000;font-size:13px;font-family:Arial;'>";
                    $devS .= "<tr><td style='border-bottom:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'></td>";
                    $devS .= "<td style='display:none;'>".mysql_field_name($re, $zz)."</td>";
                    // $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Modelo</td>";
                    $devS .= "<td style='width:120px;border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:13px;text-align:center;'>MARCAS</td>";
                    $devS .= "<td colspan='3' align='center' style='border:1px solid #000000'>STOCK MERCADERIA</td>";
                    $devS .= "<td colspan='3' align='center'  style='border:1px solid #000000' >RECIBIDOS</td>";
                    $devS .= "<td colspan='3' align='center'  style='border:1px solid #000000'>TRASP REC.</td>";
                    $devS .= "<td colspan='3' align='center'  style='border:1px solid #000000'>TRASP DESP.</td>";
                    $devS .= "<td colspan='3' align='center'  style='border:1px solid #000000' >VENTAS</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;'>Cobros</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;'>Cuentas</td>";

                    $devS .= "<td colspan='3' align='center'  style='border:1px solid #000000' >STOCK ACTUAL</td>";
                    //  $devS .= "<td style='colspan:3 ;border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Stock Mercaderia</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;'>Rebajas</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;'>Fallas</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;'>-</td>";

                    $devS .= "</tr>";
                    $devS .= "<tr><td style='border-bottom:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>#</td>";
                    $devS .= "<td style='display:none;'>".mysql_field_name($re, $zz)."</td>";
                    // $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Modelo</td>";
                    $devS .= "<td style='width:120px;border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:13px;text-align:center;background-color:silver;'></td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Cjs</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Prs</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Sus.</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Cjs</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Prs</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Sus.</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Cjs</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Prs</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Sus.</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Cjs</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Prs</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Sus.</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Cjs</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Prs</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Sus.</td>";

                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Sus</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>P/C</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Cjs</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Prs</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Sus.</td>";

                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'></td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'></td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>-</td>";

                    $devS .= "</tr>";
                    $ii = 0;
                    //$totalCount = mysql_num_rows($re);
                    $z = 1;
                    do{
                        $devS .= "<tr><td style='text-align:left'>".$z."</td>";
                        for($i = 0; $i< mysql_num_fields($re); $i++)
                        {$dato = $fi[$i];
                            $iddetalleingreso = $fi[$i]['idmarca'];
                            $idmarca =$dato;
                            $sql = "SELECT ma.nombre AS marca,ma.talla,ma.opcionb,ma.pedido
FROM  `marcas` ma
WHERE ma.idmarca = '$dato'";

                            $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'marca');
                            $marcalista = $idalmacenA2['resultado'];
                            $devS .= "<td style='display:none;'>".$dato."</td>";
                            // echo $marcapedido;

                            $devS .= "<td style='width:120px;text-align:left;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>".$marcalista."</td>";


                            if($cajasstant==NULL || $cajasstant =='' || $cajasstant == ""){ $cajasstant="0"; }
                            if($paresstant==NULL || $paresstant =='' || $paresstant == ""){ $paresstant="0"; }
                            if($totalbsstant==NULL || $totalbsstant =='' || $totalbsstant == ""){ $totalbsstant="0"; }
                            // $pares=$totalparesiddetalleingreso;
                            //
                            //    $select = "SUM(k.totalcajas) AS Pares";
                            //    $from = "ingresoalmacen k";
                            //   $where = "k.estado='ACTIVO'";
                            //  { $where .= " AND k.idmarca = '$idmarca'  AND k.fecha >= '$fechainicio' AND
                            //k.fecha <= '$fechafin' and k.idalmacen='$idalmacen'";}
                            // $sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where;
                            //    $almacenA1 =  findBySqlReturnCampoUnique($sql25, true, true, 'Pares');
                            //    $totalcajasrecibido = $almacenA1['resultado'];
                            //    $select = "SUM(k.totalpares) AS Pares";
                            //    $from = "ingresoalmacen k";
                            //   $where = "k.estado='ACTIVO'";
                            //  { $where .= " AND k.idmarca = '$idmarca'  AND k.fecha >= '$fechainicio' AND
                            //k.fecha <= '$fechafin' and k.idalmacen='$idalmacen' ";}
                            // $sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where;
                            //    $almacenA1 =  findBySqlReturnCampoUnique($sql25, true, true, 'Pares');
                            //    $totalparesrecibido = $almacenA1['resultado'];
                            // // $html .= "<td style='width:$anchoparest;font-weight:bold;font-size:11px;'>$totalparesactual</td>";
                            //  $select = "SUM(k.totalbs) AS totalprecio";
                            //    $from = "ingresoalmacen k";
                            //   $where = "k.estado='ACTIVO'";
                            //  { $where .= " AND k.idmarca = '$idmarca'  AND k.fecha >= '$fechainicio' AND
                            //k.fecha <= '$fechafin' and k.idalmacen='$idalmacen' ";}
                            // $sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where;
                            //$almacenA1 =  findBySqlReturnCampoUnique($sql25, true, true, 'totalprecio');
                            //    $totalbsrecibido = $almacenA1['resultado'];
                            //
                            //
                            //$sqlEgreso ="SELECT  SUM(it.cantidad) AS Pares, SUM(k.precio2bs) AS TotalBs
                            //FROM ingresos it,adicionkardextienda k,modelos mdd
                            //WHERE it.idkardextienda=k.idkardextienda and k.idmodelodetalle=mdd.idmodelo AND mdd.idmarca = '$idmarca' and it.fecha >= '$fechainicio' AND it.fecha <= '$fechafin' AND it.detalle2 !='ingresoalmacen'
                            //   ";
                            //         $almacenA1 =  findBySqlReturnCampoUnique($sqlEgreso, true, true, 'Pares');
                            //    $parestrasrec = $almacenA1['resultado'];
                            //    $almacenA1 =  findBySqlReturnCampoUnique($sqlEgreso, true, true, 'TotalBs');
                            //    $totalbstrasrec = $almacenA1['resultado'];
                            //
                            //$sqlEgreso ="
                            //          SELECT  SUM(it.cantidad) AS Pares, SUM(it.preciobs2) AS TotalBs
                            //FROM traspaso tra, detalletraspaso it,adicionkardextienda k,modelos mdd
                            //WHERE it.idtraspaso = tra.idtraspaso and it.idkardextienda=k.idkardextienda and k.idmodelodetalle=mdd.idmodelo AND mdd.idmarca = '$idmarca'
                            // AND tra.fecha >= '$fechainicio' AND tra.fecha <= '$fechafin'
                            //   ";
                            //$almacenA1 =  findBySqlReturnCampoUnique($sqlEgreso, true, true, 'Pares');
                            //    $parestraspdesp = $almacenA1['resultado'];
                            //    $almacenA1 =  findBySqlReturnCampoUnique($sqlEgreso, true, true, 'TotalBs');
                            //    $totalbstraspdesp = $almacenA1['resultado'];
                            //
                            //$sqlEgreso ="
                            //          SELECT  COUNT(d.iddetalledevolucion) AS Pares
                            //FROM detalledevolucion d,adicionkardextienda kar,`modelos` mo
                            //WHERE d.idkardextienda=kar.idkardextienda AND kar.idmodelodetalle = mo.idmodelo AND mo.idmarca = '$idmarca'
                            // AND d.fecha >= '$fechainicio' AND d.fecha <= '$fechafin'
                            //   ";
                            //$almacenA1 =  findBySqlReturnCampoUnique($sqlEgreso, true, true, 'Pares');
                            //    $paresdevol = $almacenA1['resultado'];
                            //    $sqlEgreso ="
                            //          SELECT  sum(d.montodevuelto) AS Bs
                            //FROM detalledevolucion d,adicionkardextienda kar,`modelos` mo
                            //WHERE d.idkardextienda=kar.idkardextienda AND kar.idmodelodetalle = mo.idmodelo AND mo.idmarca = '$idmarca'
                            // AND d.fecha >= '$fechainicio' AND d.fecha <= '$fechafin'
                            //   ";
                            //    $almacenA1 =  findBySqlReturnCampoUnique($sqlEgreso, true, true, 'Bs');
                            //    $totalbsdevol = $almacenA1['resultado'];

                            $select1 = "SUM(v.totalpares) AS pares";
                            $from = "ventas v,`marcas` mar, clientes cli,almacenes a,empleados em";
                            $where = "v.idmarca=mar.idmarca and v.idcliente=cli.idcliente and v.idalmacen=a.idalmacen and
v.idvendedor=em.idempleado  and v.idalmacen='$idalmacen' and v.idmarca='$idmarca' AND v.fecha >='$fechainicio' AND v.fecha <='$fechafin'";
                            //  { $where .= " AND v.fecha >='$fechainicio' ";}
                            //      if($fechafin != null && $fechafin != "")
                            //    { $where .= " AND v.fecha <='$fechafin' ";}
                            //     if($idvendedor == null || $idvendedor == 'null' || $idvendedor != "null")
                            //    { }else{$where .= " AND v.idvendedor ='$idvendedor' "; }
                            //$select1 = "SELECT SUM(v.totalpares) AS cajas";
                            // $select2 = " SUM(v.totalsus) AS sus";
                            $select2 = " SUM(v.totalsus) AS sus";
                            $sql4112 = "SELECT ".$select1." FROM ".$from. " WHERE ".$where." ";
                            $creditoA111 = findBySqlReturnCampoUnique($sql4112, true, true, "pares");
                            $totalparesventa = $creditoA111['resultado'];

                            $sql12 = "SELECT ".$select2." FROM ".$from. " WHERE ".$where." ";
                            $creditoA111 = findBySqlReturnCampoUnique($sql12, true, true, "sus");
                            $totalbsventa = $creditoA111['resultado'];
                            //echo $sql12;
                            $tcajas = $totalparesventa/12;
                            $totalcajasventa = round($tcajas,2);

                            //$select = "SUM(v.tcajas) AS Pares";
                            //    $from = "ventas v,modelo mo";
                            //    $where = " v.idmarca=mo.idmarca aND v.idmarca = '$idmarca'
                            //and v.fecha >= '$fechainicio'
                            //    AND v.fecha <= '$fechafin'  and v.idalmacen='$idalmacen'";
                            //    $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                            //  $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                            // $totalcajasventa = $almacenA1['resultado'];

                            //$select = "SUM(totalpares) AS Pares";
                            //    $from = "ventas v,modelo mo";
                            //    $where = " v.idmarca=mo.idmarca aND v.idmarca = '$idmarca'
                            //and v.fecha >= '$fechainicio'
                            //    AND v.fecha <= '$fechafin' and v.idalmacen='$idalmacen'";
                            //    $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                            //     $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                            //   $totalparesventa = $almacenA1['resultado'];

                            //   $select = "sUM(montoapagar) AS Pares";
                            //    $from = "ventas v,modelo mo";
                            //    $where = "v.idmarca=mo.idmarca aND v.idmarca = '$idmarca'
                            //and v.fecha >= '$fechainicio'
                            //    AND v.fecha <= '$fechafin' and v.idalmacen='$idalmacen'";
                            //    $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                            //     $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                            //   $totalbsventa = $almacenA1['resultado'];
                            //    $totalcajasventa
                            //    $totalbsventa
                            //    $totalparesventa
                            //paresactual
                            $select1 = "SUM(k.saldocantidad) AS pares";
                            $from = "kardexdetallepar k,modelo m";
                            $where = "k.idmodelo=m.idmodelo and m.estado='Activo' and k.idalmacen='$idalmacen'  and m.idmarca='$idmarca'";

                            // if($idmarca != null && $idmarca != "")
                            //  { $where .= " AND m.idmarca ='$idmarca' ";}
                            $select2 = " SUM(k.saldocantidad*k.preciounitario) AS sus";

                            $sql4112 = "SELECT ".$select1." FROM ".$from. " WHERE ".$where." ";
                            $creditoA111 = findBySqlReturnCampoUnique($sql4112, true, true, "pares");
                            $paresstact = $creditoA111['resultado'];
                            $cajasstact = $paresstact/12;
                            $cajasstact = round($cajasstact);
                            if($cajasstact==NULL || $cajasstact =='' || $cajasstact == ""){ $cajasstact="0"; }

                            if($paresstact==NULL || $paresstact =='' || $paresstact == ""){ $paresstact="0"; }
                            if($totalbsstact==NULL || $totalbsstact =='' || $totalbsstact == ""){ $totalbsstact="0"; }

                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$cajasstant."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$paresstant."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$totalbsstant."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$totalcajasrecibido."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$totalparesrecibido."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$totalbsrecibido."&nbsp;</td>";

                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$cajastrasrec."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$parestrasrec."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$totalbstrasrec."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$cajastraspdesp."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$parestraspdesp."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$totalbstraspdesp."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$totalcajasventa."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$totalparesventa."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$totalbsventa."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$cobros."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$cuentas."&nbsp;</td>";

                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$cajasstact."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$paresstact."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$totalbsstact."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$totalbs."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$rebaja."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$porcentaje."&nbsp;</td>";

                        }
                        $devS .= "</tr>";
                        $ii++;
                        $z ++;
                    }while($fi = mysql_fetch_array($re));
                    //$devS .= "<tr><td style='border:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Total</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td style='border:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>$totalparesestilo</td><td style='border:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>$totalbsestilo</td>";
                    $devS .= "<tr style='background-color:silver;'><td style='border: 1px solid #000000;font-weight:bold;font-size:12px;text-align:center;background-color:silver;font-family:Arial;'></td>";
                    $devS .= "<td style='display:none;'></td>";

                    $fechatoday = Date("d-m-Y");
                    //font-weight:bold;font-size:12px;
                    $devS .= "<td style='width:120px;text-align:center;border-bottom: 1px solid #000000;font-weight:bold;font-size:12px;'>TOTAL -".$nombrecategoria."</td>";
                    //totalesagru
                    $select1 = "SUM(k.saldocantidad) AS pares";
                    $from = "kardexdetallepar k,modelo m";
                    $where = "k.idmodelo=m.idmodelo and m.estado='Activo' and k.idalmacen='$idalmacen'  ";

                    // if($idmarca != null && $idmarca != "")
                    //  { $where .= " AND m.idmarca ='$idmarca' ";}
                    $select2 = " SUM(k.saldocantidad*k.preciounitario) AS sus";

                    $sql4112 = "SELECT ".$select1." FROM ".$from. " WHERE ".$where." ";
                    $creditoA111 = findBySqlReturnCampoUnique($sql4112, true, true, "pares");
                    $paresstact1 = $creditoA111['resultado'];
                    $cajasstact1 = $paresstact1/12;
                    $cajasstact1 = round($cajasstact1);

                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$cajasstant."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$paresstant."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$totalbsstant."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$totalcajasrecibido."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$totalparesrecibido."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$totalbsrecibido."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$cajastrasrec."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$parestrasrec."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$totalbstrasrec."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$cajastraspdesp."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$parestraspdesp."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$totalbstraspdesp."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$totalcajasventa."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$totalparesventa."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$totalbsventa."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$cobros."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$cuentas."&nbsp;</td>";

                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$cajasstact1."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$paresstact1."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$totalbsstact1."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$totalbs."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$rebaja."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$porcentajecat."&nbsp;</td>";


                    $devS .= "</tr>";
                    $devS .= "<tr><td style='border-bottom:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'></td>";
                    $devS .= "<td style='display:none;'></td>";
                    // $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Modelo</td>";
                    // $devS .= "<td style='width:120px;border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:13px;text-align:center;'>Cuentas po</td>";
                    $devS .= "<td colspan='3' align='center' font-family='Arial' background-color='silver' >Cuentas por Cobrar</td>";
                    $cuentasporcobrar= "0.00";
                    $devS .= "<td colspan='1' align='center' font-family='Arial' background-color='silver' >".$cuentasporcobrar."</td>";
                    $devS .= "<td colspan='16' align='center' font-family='Arial' background-color='silver' ></td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;'>".$cuentasporcobrar."</td>";

                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;'></td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;'></td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;'></td>";

                    $devS .= "</tr>";
                    $devS .= "</tr>";
                    $devS .= "<tr><td style='border-bottom:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'></td>";
                    $devS .= "<td style='display:none;'></td>";
                    $devS .= "<td colspan='3' align='center' font-family='Arial' background-color='silver' >CAPITAL DE OPERACION</td>";
                    $cuentasporcobrar= "0.00";
                    $devS .= "<td colspan='1' align='center' font-family='Arial' background-color='silver' >".$cuentasporcobrar."</td>";
                    $devS .= "<td colspan='16' align='center' font-family='Arial' background-color='silver' ></td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;'>".$cuentasporcobrar."</td>";

                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;'>".$cuentasporcobrar."</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;'></td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;'></td>";

                    $devS .= "</tr>";
                    $devS .= "<tr><td style='border-bottom:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'></td>";
                    $devS .= "<td style='display:none;'></td>";
                    $devS .= "<td colspan='7' align='center' font-family='Arial' background-color='silver' ></td>";
                    $cuentasporcobrar= "0.00";

                    $devS .= "<td colspan='2' align='center' font-family='Arial' background-color='silver' >MAS LAS 7 MARCAS</td>";
                    $devS .= "<td colspan='2' align='center' font-family='Arial' background-color='silver' ></td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;'>".$cuentasporcobrar."</td>";

                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;'>".$cuentasporcobrar."</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;'></td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;'></td>";

                    $devS .= "</tr>";
                    $devS .= "</table>";

                    $dev['mensaje'] = "Existen resultados";
                    $dev['error']   = "true";
                    $dev['resultado'] = $devS;

                }
                else
                {
                    $dev['mensaje'] = "No se encontro datos en la consulta2".mysql_error();
                    $dev['error']   = "false";
                    $dev['resultado'] = "";
                }
            }
            else
            {
                $dev['mensaje'] = "Error en la consulta";
                $dev['error']   = "false";
                $dev['resultado'] = "";
            }
        }
        else
        {
            $dev['mensaje'] = "No se pudo conectar a la BD";
            $dev['error']   = "false";
            $dev['resultado'] = "";
        }
    }
    else
    {
        $dev['mensaje'] = "No se pudo crear la conexion a la BD";
        $dev['error']   = "false";
        $dev['resultado'] = "";
    }
    return $dev;
}
//fin
//$producto = dibujarTablaparesmarca($sql25,$sql21,$row1,$idmarca,$rango1,$rango2,$total1,$total2,$idingreso,$formatomayor);


function dibujarTablaparesmarca($idkardex,$sql,$sql21s,$row1,$idmarca,$rango1,$rango2,$total1,$total2,$idingreso,$formatomayor)
{
    $idalmacen=$_SESSION['idalmacen'];
    $sqlmarca = " SELECT idkardex FROM administrakardex WHERE idkardex = '$idkardex' ";
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "idkardex");
    $idkar = $opcionkardex['resultado'];
    if($idkar==null || $idkar==''){
        $sqlmarca = " SELECT idkardex,tabla,mesrango,idperiodo,fechainicio,fechafin FROM administrakardex WHERE  mesrango= '$idkardex' and idalmacen='$idalmacen'";
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "idkardex");
        $idkar = $opcionkardex['resultado'];
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "tabla");
        $tabla = $opcionkardex['resultado'];
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "mesrango");
        $mesrango = $opcionkardex['resultado'];
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "idperiodo");
        $idperiodo = $opcionkardex['resultado'];
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "fechainicio");
        $fechainicio = $opcionkardex['resultado'];
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "fechafin");
        $fechafin = $opcionkardex['resultado'];
    }else{
        $sqlmarca = " SELECT idkardex,tabla,mesrango,idperiodo,fechainicio,fechafin FROM administrakardex WHERE idkardex = '$idkardex' ";
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "idkardex");
        $idkar = $opcionkardex['resultado'];
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "tabla");
        $tabla = $opcionkardex['resultado'];
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "mesrango");
        $mesrango = $opcionkardex['resultado'];
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "idperiodo");
        $idperiodo = $opcionkardex['resultado'];
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "fechainicio");
        $fechainicio = $opcionkardex['resultado'];
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "fechafin");
        $fechafin = $opcionkardex['resultado'];
    }
    if($fechafin==null ||$fechafin == ""){
        $fechafin = Date("Y-m-d");
    }


    //    d

    if($link=new BD)
    {
        if($link->conectar())
        {
            if($re = $link->consulta($sql))
            {
                //echo mysql_num_rows($re);
                if($fi = mysql_fetch_array($re))
                {
                    //tamano $html .= "<tr><td colspan='4' align='center' font-family='Arial'>


                    $devS .= "<table cellpadding='0' cellspacing='0' border='0' style='width:1250px;border:1px solid #000000;font-size:13px;font-family:Arial;'>";
                    $devS .= "<tr><td style='border-bottom:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'></td>";
                    $devS .= "<td style='display:none;'>".mysql_field_name($re, $zz)."</td>";
                    // $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Modelo</td>";
                    $devS .= "<td style='width:120px;border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:13px;text-align:center;'>MARCAS</td>";
                    $devS .= "<td colspan='3' align='center' style='border:1px solid #000000'>STOCK MERCADERIA</td>";
                    $devS .= "<td colspan='3' align='center'  style='border:1px solid #000000' >RECIBIDOS</td>";
                    $devS .= "<td colspan='3' align='center'  style='border:1px solid #000000'>TRASP REC.</td>";
                    $devS .= "<td colspan='3' align='center'  style='border:1px solid #000000'>TRASP DESP.</td>";
                    $devS .= "<td colspan='3' align='center'  style='border:1px solid #000000' >VENTAS</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;'>Cobros</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;'>Cuentas</td>";

                    $devS .= "<td colspan='3' align='center'  style='border:1px solid #000000' >STOCK ACTUAL</td>";
                    //  $devS .= "<td style='colspan:3 ;border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Stock Mercaderia</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;'>Rebajas</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;'>Fallas</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;'>-</td>";

                    $devS .= "</tr>";
                    $devS .= "<tr><td style='border-bottom:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>#</td>";
                    $devS .= "<td style='display:none;'>".mysql_field_name($re, $zz)."</td>";
                    // $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Modelo</td>";
                    $devS .= "<td style='width:120px;border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:13px;text-align:center;background-color:silver;'></td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Cjs</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Prs</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Sus.</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Cjs</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Prs</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Sus.</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Cjs</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Prs</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Sus.</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Cjs</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Prs</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Sus.</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Cjs</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Prs</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Sus.</td>";

                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Sus</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>P/C</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Cjs</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Prs</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Sus.</td>";

                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'></td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'></td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>-</td>";

                    $devS .= "</tr>";
                    $ii = 0;
                    //$totalCount = mysql_num_rows($re);
                    $z = 1;

                    $tcajasstant =0;
                    $tparesstant=0;
                    $ttotalbsstant=0;
                    $ttotalcajasrecibido=0;
                    $ttotalparesrecibido=0;
                    $ttotalbsrecibido=0;
                    $tcajastrasrec=0;
                    $tparestrasrec=0;
                    $ttotalbstrasrec=0;
                    $tcajastraspdesp=0;
                    $tparestraspdesp=0;
                    $ttotalbstraspdesp=0;
                    $ttotalcajasventa=0;
                    $ttotalparesventa=0;
                    $ttotalbsventa=0;
                    $tcobros=0;
                    $tcuentas=0;
                    $tcajasstact=0;
                    $tparesstact=0;
                    $ttotalbsstact=0;
                    $ttotalbs=0;
                    $trebaja=0;
                    $tporcentaje=0;


                    do{
                        $devS .= "<tr><td style='text-align:left'>".$z."</td>";
                        for($i = 0; $i< mysql_num_fields($re); $i++)
                        {$dato = $fi[$i];
                            $idempleado = $dato;


                            $sql7 = "SELECT CONCAT(emp.nombres,'-',emp.apellidos) AS completo FROM  empleados emp WHERE emp.idempleado = '$dato'";
                            $idalmacenA2 =  findBySqlReturnCampoUnique($sql7, true, true, 'completo');
                            $empleado = $idalmacenA2['resultado'];
                            //echo $sql7;
                            $devS .= "<td style='display:none;'>".$dato."</td>";
                            // echo $marcapedido;

                            $devS .= "<td style='width:120px;text-align:left;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>".$empleado."</td>";


                            if($cajasstant==NULL || $cajasstant =='' || $cajasstant == ""){ $cajasstant="0"; }
                            if($paresstant==NULL || $paresstant =='' || $paresstant == ""){ $paresstant="0"; }
                            if($totalbsstant==NULL || $totalbsstant =='' || $totalbsstant == ""){ $totalbsstant="0"; }
                            // $pares=$totalparesiddetalleingreso;
                            $select = "SUM(k.cantidad) AS Pares";
                            $from = "kardexdetalleingreso k,modelo m,ingresoalmacen i";
                            $where = "k.idmodelo=m.idmodelo and i.idingreso=k.idingreso";
                            { $where .= " AND m.idmarca = '$idmarca' and m.idvendedor='$idempleado' AND i.fecha >= '$fechainicio' AND
i.fecha <= '$fechafin' and m.idalmacen='$idalmacen'";}
                            $sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where;
                            $almacenA1 =  findBySqlReturnCampoUnique($sql25, true, true, 'Pares');
                            $totalparesrecibido = $almacenA1['resultado'];
                            $totalcajasrecibido = $totalparesrecibido/12;
                            $totalparesrecibido = round($totalparesrecibido);
                            $totalcajasrecibido = round($totalcajasrecibido);
                            // $html .= "<td style='width:$anchoparest;font-weight:bold;font-size:11px;'>$totalparesactual</td>";
                            $select = "SUM(k.cantidad*k.preciounitario) AS totalprecio";
                            $from = "kardexdetalleingreso k,modelo m,ingresoalmacen i";
                            $where = "k.idmodelo=m.idmodelo and i.idingreso=k.idingreso";
                            { $where .= " AND m.idmarca = '$idmarca' and m.idvendedor='$idempleado' AND i.fecha >= '$fechainicio' AND
i.fecha <= '$fechafin' and m.idalmacen='$idalmacen'";}
                            $sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where;
                            $almacenA1 =  findBySqlReturnCampoUnique($sql25, true, true, 'totalprecio');
                            $totalbsrecibido = $almacenA1['resultado'];
                            $totalbsrecibido = round($totalbsrecibido);


                            $sqlEgreso ="SELECT SUM(it.saldocantidad) AS Pares FROM traspasodetallepar it,traspaso t,modelo mdd
WHERE it.iddetalletraspaso=t.idtraspaso and t.idalmacen='$idalmacen' and mdd.idvendedor='$idempleado' AND mdd.idmarca = '$idmarca' and t.fecha >= '$fechainicio' AND t.fecha <= '$fechafin'";
                            $almacenA1 =  findBySqlReturnCampoUnique($sqlEgreso, true, true, 'Pares');
                            $parestraspdesp = $almacenA1['resultado'];
                            //echo $sqlEgreso;
                            $cajastraspdesp = $parestraspdesp/12;
                            $sqlEgreso ="SELECT SUM(it.saldocantidad*it.preciounitario) AS Pares FROM traspasodetallepar it,traspaso t,modelo mdd
WHERE it.idmodeloorigen=mdd.idmodelo and it.iddetalletraspaso=t.idtraspaso and mdd.idvendedor='$idempleado' AND mdd.idmarca = '$idmarca' and t.fecha >= '$fechainicio' AND t.fecha <= '$fechafin'";
                            $almacenA1 =  findBySqlReturnCampoUnique($sqlEgreso, true, true, 'Pares');
                            $totalbstrasdesp = $almacenA1['resultado'];
                            //trasp rec
                            $sqlEgreso ="SELECT SUM(it.saldocantidad) AS Pares FROM traspasodetallepar it,traspaso t,modelo mdd
WHERE it.idmodelo=mdd.idmodelo and it.iddetalletraspaso=t.idtraspaso and mdd.idvendedor='$idempleado' AND mdd.idmarca = '$idmarca'
and t.fecha >= '$fechainicio' AND t.fecha <= '$fechafin'";
                            $almacenA1 =  findBySqlReturnCampoUnique($sqlEgreso, true, true, 'Pares');
                            $parestrasrec = $almacenA1['resultado'];
                            $cajastrasrec = $parestrasrec/12;
                            $sqlEgreso ="SELECT SUM(it.saldocantidad*it.preciounitario) AS Pares FROM traspasodetallepar it,traspaso t,modelo mdd
WHERE it.idmodelo=mdd.idmodelo and it.iddetalletraspaso=t.idtraspaso and mdd.idvendedor='$idempleado' AND mdd.idmarca = '$idmarca' and t.fecha >= '$fechainicio' AND t.fecha <= '$fechafin'";
                            $almacenA1 =  findBySqlReturnCampoUnique($sqlEgreso, true, true, 'Pares');
                            $totalbstrasrec = $almacenA1['resultado'];


                            $sqlEgreso ="SELECT COUNT(d.iddetalledevolucion) AS Pares
FROM detalledevolucion d,kardexdetallepar kar,`modelo` mo
WHERE d.idkardexunico=kar.idkardexunico AND kar.idmodelo = mo.idmodelo AND mo.idmarca = '$idmarca'
 AND mo.idvendedor='$idempleado' and d.fecha >= '$fechainicio' AND d.fecha <= '$fechafin'
   ";
                            $almacenA1 =  findBySqlReturnCampoUnique($sqlEgreso, true, true, 'Pares');
                            $paresdevol = $almacenA1['resultado'];
                            $sqlEgreso1 ="SELECT  SUM(kar.preciounitario) AS Pares
FROM detalledevolucion d,kardexdetallepar kar,`modelo` mo
WHERE d.idkardexunico=kar.idkardexunico AND kar.idmodelo = mo.idmodelo AND mo.idmarca = '$idmarca'
 AND mo.idvendedor='$idempleado' and d.fecha >= '$fechainicio' AND d.fecha <= '$fechafin'
   ";
                            $almacenA1 =  findBySqlReturnCampoUnique($sqlEgreso1, true, true, 'Bs');
                            $totalbsdevol = $almacenA1['resultado'];

                            //ini venta
                            $select1 = "SUM(iv.cantidad) AS pares";
                            $from = "ventas v,ventaitem iv,`marcas` mar, clientes cli,almacenes a,empleados em";
                            $where = "v.idmarca=mar.idmarca and v.idcliente=cli.idcliente and v.idalmacen=a.idalmacen and
v.idvendedor=em.idempleado and iv.idventa=v.idventa and v.idalmacen='$idalmacen'  and v.idvendedor='$idempleado'";
                            if($fechainicio != null && $fechainicio != "")
                            { $where .= " AND v.fecha >='$fechainicio' ";}
                            if($fechafin != null && $fechafin != "")
                            { $where .= " AND v.fecha <='$fechafin' ";}
                            if($idmarca != null && $idmarca != "")
                            { $where .= " AND v.idmarca ='$idmarca' ";}
                            $select2 = " SUM(iv.precioventa) AS sus";

                            $sql4112 = "SELECT ".$select1." FROM ".$from. " WHERE ".$where." ";
                            $creditoA111 = findBySqlReturnCampoUnique($sql4112, true, true, "pares");
                            $totalparesventa = $creditoA111['resultado'];
                            $totalcajasventa = $totalparesventa/12;
                            $totalcajasventa = round($totalcajasventa);
                            $sql12 = "SELECT ".$select2." FROM ".$from. " WHERE ".$where." ";
                            $creditoA111 = findBySqlReturnCampoUnique($sql12, true, true, "sus");
                            $totalbsventa = $creditoA111['resultado'];
                            $totalbsventa = round($totalbsventa);
                            //fin venta
                            $select1 = "SUM(k.saldocantidad) AS pares";
                            $from = "kardexdetallepar k,modelo m";
                            $where = "k.idmodelo=m.idmodelo and m.estado='Activo' and k.idalmacen='$idalmacen'  and m.idvendedor='$idempleado'";

                            if($idmarca != null && $idmarca != "")
                            { $where .= " AND m.idmarca ='$idmarca' ";}
                            $select2 = " SUM(k.saldocantidad*k.preciounitario) AS sus";

                            $sql4112 = "SELECT ".$select1." FROM ".$from. " WHERE ".$where." ";
                            $creditoA111 = findBySqlReturnCampoUnique($sql4112, true, true, "pares");
                            $paresstact = $creditoA111['resultado'];
                            $cajasstact = $paresstact/12;
                            $cajasstact = round($cajasstact);
                            $sql12 = "SELECT ".$select2." FROM ".$from. " WHERE ".$where." ";
                            $creditoA111 = findBySqlReturnCampoUnique($sql12, true, true, "sus");
                            $totalbsstact = $creditoA111['resultado'];
                            $totalbsstact = round($totalbsstact);

                            //$cajasstact
                            //$paresstact
                            //$totalbsstact

                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$cajasstant."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$paresstant."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$totalbsstant."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$totalcajasrecibido."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$totalparesrecibido."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$totalbsrecibido."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$cajastrasrec."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$parestrasrec."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$totalbstrasrec."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$cajastraspdesp."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$parestraspdesp."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$totalbstraspdesp."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$totalcajasventa."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$totalparesventa."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$totalbsventa."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$cobros."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$cuentas."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$cajasstact."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$paresstact."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$totalbsstact."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$totalbs."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$rebaja."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$porcentaje."&nbsp;</td>";
                            $tcajasstant =0;
                            $tparesstant=$tparesstant + $paresstant;
                            $ttotalbsstant=$ttotalbsstant +$totalbsstant;
                            $ttotalcajasrecibido=$ttotalcajasrecibido + $totalcajasrecibido;
                            $ttotalparesrecibido=$ttotalparesrecibido +$totalparesrecibido;
                            $ttotalbsrecibido=$ttotalbsrecibido + $totalbsrecibido;
                            $tcajastrasrec=$tcajastrasrec + $cajastrasrec;
                            $tparestrasrec=$tparestrasrec +$parestrasrec;
                            $ttotalbstrasrec=$ttotalbstrasrec + $totalbstrasrec;
                            $tcajastraspdesp=$tcajastraspdesp + $cajastraspdesp;
                            $tparestraspdesp=$tparestraspdesp + $parestraspdesp;
                            $ttotalbstraspdesp=$ttotalbstraspdesp +$totalbstraspdesp;
                            $ttotalcajasventa=$ttotalcajasventa +$totalcajasventa;
                            $ttotalparesventa=$ttotalparesventa + $totalparesventa;
                            $ttotalbsventa=$ttotalbsventa + $totalbsventa;
                            $tcobros=$tcobros + $cobros;
                            $tcuentas=$tcuentas + $cuentas;
                            $tcajasstact=$tcajasstact +$cajasstact;
                            $tparesstact=$tparesstact + $paresstact;
                            $ttotalbsstact=$ttotalbsstact +$totalbsstact;
                            $ttotalbs=$ttotalbs + $totalbs;
                            $trebaja=$trebaja + $rebaja;
                            $tporcentaje=$tporcentaje + $porcentaje;
                        }
                        $devS .= "</tr>";
                        $ii++;
                        $z ++;
                    }while($fi = mysql_fetch_array($re));
                    //$devS .= "<tr><td style='border:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Total</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td style='border:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>$totalparesestilo</td><td style='border:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>$totalbsestilo</td>";
                    $devS .= "<tr style='background-color:silver;'><td style='border: 1px solid #000000;font-weight:bold;font-size:12px;text-align:center;background-color:silver;font-family:Arial;'></td>";
                    $devS .= "<td style='display:none;'></td>";

                    $fechatoday = Date("d-m-Y");
                    //font-weight:bold;font-size:12px;
                    $devS .= "<td style='width:120px;text-align:center;border-bottom: 1px solid #000000;font-weight:bold;font-size:12px;'>TOTAL -".$nombrecategoria."</td>";
                    //totalesagru



                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$tcajasstant."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$tparesstant."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$ttotalbsstant."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$ttotalcajasrecibido."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$ttotalparesrecibido."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$ttotalbsrecibido."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$tcajastrasrec."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$tparestrasrec."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$ttotalbstrasrec."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$tcajastraspdesp."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$tparestraspdesp."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$ttotalbstraspdesp."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$ttotalcajasventa."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$ttotalparesventa."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$ttotalbsventa."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$tcobros."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$tcuentas."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$tcajasstact."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$tparesstact."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$ttotalbsstact."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;borsder-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$ttotalbs."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$trebaja."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$tporcentaje."&nbsp;</td>";

                    $devS .= "</tr>";
                    $devS .= "<tr><td style='border-bottom:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'></td>";
                    $devS .= "<td style='display:none;'></td>";
                    // $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Modelo</td>";
                    // $devS .= "<td style='width:120px;border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:13px;text-align:center;'>Cuentas po</td>";
                    $devS .= "<td colspan='3' align='center' font-family='Arial' background-color='silver' >Cuentas por Cobrar</td>";
                    $cuentasporcobrar= "0.00";
                    $devS .= "<td colspan='1' align='center' font-family='Arial' background-color='silver' >".$cuentasporcobrar."</td>";
                    $devS .= "<td colspan='16' align='center' font-family='Arial' background-color='silver' ></td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;'>".$cuentasporcobrar."</td>";

                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;'></td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;'></td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;'></td>";

                    $devS .= "</tr>";
                    $devS .= "</tr>";
                    $devS .= "<tr><td style='border-bottom:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'></td>";
                    $devS .= "<td style='display:none;'></td>";
                    $devS .= "<td colspan='3' align='center' font-family='Arial' background-color='silver' >CAPITAL DE OPERACION</td>";
                    $cuentasporcobrar= "0.00";
                    $devS .= "<td colspan='1' align='center' font-family='Arial' background-color='silver' >".$cuentasporcobrar."</td>";
                    $devS .= "<td colspan='16' align='center' font-family='Arial' background-color='silver' ></td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;'>".$cuentasporcobrar."</td>";

                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;'>".$cuentasporcobrar."</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;'></td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;'></td>";

                    $devS .= "</tr>";
                    $devS .= "<tr><td style='border-bottom:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'></td>";
                    $devS .= "<td style='display:none;'></td>";
                    $devS .= "<td colspan='7' align='center' font-family='Arial' background-color='silver' ></td>";
                    $cuentasporcobrar= "0.00";

                    $devS .= "<td colspan='2' align='center' font-family='Arial' background-color='silver' ></td>";
                    $devS .= "<td colspan='2' align='center' font-family='Arial' background-color='silver' ></td>";
                    //  $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;'>".$cuentasporcobrar."</td>";

                    //$devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;'>".$cuentasporcobrar."</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;'></td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;'></td>";

                    $devS .= "</tr>";
                    $devS .= "</table>";

                    $dev['mensaje'] = "Existen resultados";
                    $dev['error']   = "true";
                    $dev['resultado'] = $devS;

                }
                else
                {
                    $dev['mensaje'] = "No se encontro datos en la consulta2".mysql_error();
                    $dev['error']   = "false";
                    $dev['resultado'] = "";
                }
            }
            else
            {
                $dev['mensaje'] = "Error en la consulta";
                $dev['error']   = "false";
                $dev['resultado'] = "";
            }
        }
        else
        {
            $dev['mensaje'] = "No se pudo conectar a la BD";
            $dev['error']   = "false";
            $dev['resultado'] = "";
        }
    }
    else
    {
        $dev['mensaje'] = "No se pudo crear la conexion a la BD";
        $dev['error']   = "false";
        $dev['resultado'] = "";
    }
    return $dev;
}
function dibujarTablaOfSQLmarcarecapitulaciontotales($idkardex,$sql,$row1,$nombrecategoria,$idestilo,$rango1,$rango2,$totalparesestilo,$totalbsestilo, $tipo,$marcapedido)
{
    $sqlmarca = " SELECT tabla,mesrango,idperiodo,fechainicio,fechafin FROM administrakardex WHERE idkardex = '$idkardex' ";
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "tabla");
    $tabla = $opcionkardex['resultado'];
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "mesrango");
    $mesrango = $opcionkardex['resultado'];
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "idperiodo");
    $idperiodo = $opcionkardex['resultado'];
    //echo $tabla;
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "fechainicio");
    $fechainicio = $opcionkardex['resultado'];
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "fechafin");
    $fechafin = $opcionkardex['resultado'];
    //AND k.idperiodo='$idperiodo'
    //echo $fechainicio;
    if($fechafin==null ||$fechafin == ""){
        $fechafin = Date("Y-m-d");
    }
    if($tabla=="historialkardextienda"){
    }else{}
    //    d

    if($link=new BD)
    {
        if($link->conectar())
        {
            if($re = $link->consulta($sql))
            {
                //echo mysql_num_rows($re);
                if($fi = mysql_fetch_array($re))
                {
                    $devS .= "<table cellpadding='0' cellspacing='0' border='0' style='width:1250px;border:1px solid #000000;font-size:13px;font-family:Arial;'>";
                    $devS .= "<tr><td style='border-bottom:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'></td>";
                    $devS .= "<td style='display:none;'>".mysql_field_name($re, $zz)."</td>";
                    // $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Modelo</td>";
                    $devS .= "<td style='width:120px;border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'></td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Prs.Stock Ant</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Bs.</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Prs.Rec.</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Bs.</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Prs.Trasp.Rec.</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Bs.</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Prs.Devol.</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Bs.</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Prs.Trasp.Desp.</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Bs.</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Prs.Venta</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Bs.</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:13px;text-align:center;background-color:silver;'>Prs.Stock.Actual</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:13px;text-align:center;background-color:silver;'>Bs.</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Reb</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>%</td>";

                    $devS .= "</tr>";

                    //$devS .= "<tr><td style='border:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Total</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td style='border:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>$totalparesestilo</td><td style='border:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>$totalbsestilo</td>";
                    $devS .= "<tr style='background-color:silver;'><td style='border: 1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'></td>";
                    $devS .= "<td style='display:none;'></td>";

                    $fechatoday = Date("d-m-Y");
                    $devS .= "<td style='width:120px;text-align:center;border-bottom: 1px solid #000000;font-weight:bold;font-size:13px;'>TOTALES</td>";
                    //totalesagru

                    if($tabla=="historialkardextienda"){
                        //        $sqlInv = "SELECT MAX(idperiodo)AS numero
                        //FROM administrakardex where tabla='historialkardextienda'";
                        //           $almacenA1 =  findBySqlReturnCampoUnique($sqlInv, true, true, 'numero');
                        //    $idperiodoant = $almacenA1['resultado'];
                        $idper = $idperiodo - 1;
                        // echo $idperiodoant;
                        $select = "SUM(saldocantidad) AS Pares";
                        $from = "historialkardextienda k,modelos mdt,marcas ma";
                        $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca=ma.idmarca  AND k.unido='no' AND k.idperiodo='$idper'";
                        $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                        //   echo $sql2p;
                        $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                        $paresstant = $almacenA1['resultado'];
                        $select = "SUM(saldocantidad*precio2bs) AS bs";
                        $from = "historialkardextienda k,modelos mdt,marcas ma";
                        $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca=ma.idmarca AND k.unido='no' AND k.idperiodo='$idper'";
                        $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                        $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'bs');
                        $totalbsstant = $almacenA1['resultado'];
                    }
                    else{
                        $sqlInv = "SELECT MAX(idperiodo)AS numero
FROM administrakardex where tabla='historialkardextienda'";
                        $almacenA1 =  findBySqlReturnCampoUnique($sqlInv, true, true, 'numero');
                        $idperiodoant = $almacenA1['resultado'];
                        $select = "SUM(saldocantidad) AS Pares";
                        $from = "historialkardextienda k,modelos mdt,marcas ma";
                        $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca=ma.idmarca  AND k.unido='no' AND k.idperiodo='$idperiodoant'";
                        $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                        $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                        $paresstant = $almacenA1['resultado'];

                        if($paresstant==NULL || $paresstant =='' || $paresstant == ""){ $paresstant="0"; }
                        $select = "SUM(saldocantidad*precio2bs) AS bs";
                        $from = "historialkardextienda k,modelos mdt,marcas ma";
                        $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca=ma.idmarca AND k.unido='no' AND k.idperiodo='$idperiodoant'";
                        $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                        $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'bs');
                        $totalbsstant = $almacenA1['resultado'];

                    }

                    // $pares=$totalparesiddetalleingreso;
                    $select = "SUM( dtpt.cantidad ) AS Pares";
                    $from = "adicioningresotienda k, adiciondetalleingresotalla dtpt, adiciondetalleingreso ad, modelos mdd,marcas ma";
                    $where = "k.idingreso = dtpt.idingreso AND dtpt.idmodelo = mdd.idmodelo
AND dtpt.iddetalleingreso = ad.iddetalleingreso AND mdd.idmarca=ma.idmarca ";
                    { $where .= " AND k.fecha >= '$fechainicio' AND
k.fecha <= '$fechafin' ";}
                    $sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where;
                    $almacenA1 =  findBySqlReturnCampoUnique($sql25, true, true, 'Pares');
                    $totalparesrecibido = $almacenA1['resultado'];
                    $html .= "<td style='width:$anchoparest;font-weight:bold;font-size:11px;'>$totalparesactual</td>";
                    $select = "SUM( dtpt.cantidad*ad.totalbs ) AS totalprecio";
                    $from = "adicioningresotienda k, adiciondetalleingresotalla dtpt, adiciondetalleingreso ad, modelos mdd,marcas ma";
                    $where = "k.idingreso = dtpt.idingreso AND dtpt.idmodelo = mdd.idmodelo
AND dtpt.iddetalleingreso = ad.iddetalleingreso AND mdd.idmarca=ma.idmarca ";
                    { $where .= " AND k.fecha >= '$fechainicio' AND
k.fecha <= '$fechafin' ";}
                    $sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where;
                    $almacenA1 =  findBySqlReturnCampoUnique($sql25, true, true, 'totalprecio');
                    $totalbsrecibido = $almacenA1['resultado'];

                    $sqlEgreso ="
          SELECT  SUM(it.cantidad) AS Pares, SUM(k.precio2bs) AS TotalBs
FROM ingresos it,adicionkardextienda k,modelos mdd,marcas ma
WHERE it.idkardextienda=k.idkardextienda and k.idmodelodetalle=mdd.idmodelo AND mdd.idmarca=ma.idmarca AND it.fecha >= '$fechainicio' AND it.fecha <= '$fechafin' AND it.detalle2 !='ingresoalmacen'
   ";
                    $almacenA1 =  findBySqlReturnCampoUnique($sqlEgreso, true, true, 'Pares');
                    $parestrasrec = $almacenA1['resultado'];
                    $almacenA1 =  findBySqlReturnCampoUnique($sqlEgreso, true, true, 'TotalBs');
                    $totalbstrasrec = $almacenA1['resultado'];

                    $sqlEgreso ="
          SELECT  SUM(it.cantidad) AS Pares, SUM(it.preciobs2) AS TotalBs
FROM traspaso tra, detalletraspaso it,adicionkardextienda k,modelos mdd,marcas ma
WHERE it.idtraspaso = tra.idtraspaso and it.idkardextienda=k.idkardextienda AND mdd.idmarca=ma.idmarca  and k.idmodelodetalle=mdd.idmodelo
 AND tra.fecha >= '$fechainicio' AND tra.fecha <= '$fechafin'
   ";
                    $almacenA1 =  findBySqlReturnCampoUnique($sqlEgreso, true, true, 'Pares');
                    $parestraspdesp = $almacenA1['resultado'];
                    $almacenA1 =  findBySqlReturnCampoUnique($sqlEgreso, true, true, 'TotalBs');
                    $totalbstraspdesp = $almacenA1['resultado'];

                    $sqlEgreso ="
          SELECT  COUNT(d.iddetalledevolucion) AS Pares
FROM detalledevolucion d,adicionkardextienda kar,`modelos` mo,marcas ma
WHERE d.idkardextienda=kar.idkardextienda AND kar.idmodelodetalle = mo.idmodelo AND mo.idmarca=ma.idmarca
 AND d.fecha >= '$fechainicio' AND d.fecha <= '$fechafin'
   ";
                    $almacenA1 =  findBySqlReturnCampoUnique($sqlEgreso, true, true, 'Pares');
                    $paresdevol = $almacenA1['resultado'];
                    $sqlEgreso ="
          SELECT  sum(d.montodevuelto) AS Bs
FROM detalledevolucion d,adicionkardextienda kar,`modelos` mo,marcas ma
WHERE d.idkardextienda=kar.idkardextienda AND kar.idmodelodetalle = mo.idmodelo AND mo.idmarca=ma.idmarca
 AND d.fecha >= '$fechainicio' AND d.fecha <= '$fechafin'
   ";
                    $almacenA1 =  findBySqlReturnCampoUnique($sqlEgreso, true, true, 'Bs');
                    $totalbsdevol = $almacenA1['resultado'];



                    $select = "SUM(i.cantidad) AS Pares";
                    $from = "itemventa i,adicionkardextienda k, ventasdetalle v,modelos mo,marcas ma";
                    $where = " k.idkardextienda=i.idkardextienda and k.idmodelodetalle=mo.idmodelo AND mo.idmarca=ma.idmarca  ANd i.idventa=v.idventadetalle AND  i.varvendedor!='0'
and v.fecha >= '$fechainicio'
    AND v.fecha <= '$fechafin' ";
                    $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                    $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                    $paresventa = $almacenA1['resultado'];

                    $select = "SUM(i.precio) AS Pares";
                    $from = "itemventa i,adicionkardextienda k, ventasdetalle v,modelos mo,marcas ma";
                    $where = " k.idkardextienda=i.idkardextienda and k.idmodelodetalle=mo.idmodelo AND mo.idmarca=ma.idmarca ANd i.idventa=v.idventadetalle AND i.varvendedor!='0'
and v.fecha >= '$fechainicio'
    AND v.fecha <= '$fechafin' ";
                    $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                    $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                    $totalbsventa = $almacenA1['resultado'];

                    if($tabla=="historialkardextienda"){

                        $select = "SUM(saldocantidad) AS Pares";
                        $from = "historialkardextienda k,modelos mdt";
                        $where = " k.idmodelodetalle = mdt.idmodelo AND k.unido='no' AND k.idperiodo='$idperiodo'";
                        $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                        $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                        $paresstact = $almacenA1['resultado'];
                        if($paresstact==NULL || $paresstact =='' || $paresstact == ""){ $paresstact="0"; }

                        $select = "SUM(saldocantidad*precio2bs) AS bs";
                        $from = "historialkardextienda k,modelos mdt";
                        $where = " k.idmodelodetalle = mdt.idmodelo AND k.unido='no' AND k.idperiodo='$idperiodo'";
                        $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                        $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'bs');
                        $totalbs = $almacenA1['resultado'];
                        if($totalbs==NULL || $totalbs =='' || $totalbs == ""){ $totalbs="0"; }
                    }
                    else{
                        $select = "SUM(saldocantidad) AS Pares";
                        $from = "adicionkardextienda k,modelos mo,marcas ma";
                        $where = " k.idmodelodetalle=mo.idmodelo AND mo.idmarca=ma.idmarca and unido='no'  ";
                        $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                        $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                        $paresstact = $almacenA1['resultado'];
                        if($paresstact==NULL || $paresstact =='' || $paresstact == ""){ $paresstact="0"; }

                        $select = "SUM(k.saldocantidad*k.precio2bs) AS bs";
                        $from = "adicionkardextienda k,modelos mo,marcas ma";
                        $where = " k.idmodelodetalle=mo.idmodelo AND mo.idmarca=ma.idmarca and unido='no'  ";
                        $sql2p11 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                        $almacenA1 =  findBySqlReturnCampoUnique($sql2p11, true, true, 'bs');
                        $totalbs = $almacenA1['resultado'];
                        if($totalbs==NULL || $totalbs =='' || $totalbs == ""){ $totalbs="0"; }


                    }


                    $select = "SUM(dtp.diferencia)AS bs";
                    $from = "cambiopreciodetalle dtp, cambioprecio c, adiciondetalleingreso ad, modelos mo, marcas mar, estilos es";
                    $where = "c.idcambio = dtp.idcambio
AND dtp.iddetalleingreso = ad.iddetalleingreso
AND dtp.idmodelo = mo.idmodelo
AND dtp.idmodelo = ad.idmodelo
AND mo.idmarca = mar.idmarca
AND mo.stylename = es.idestilo AND c.fecha >= '$fechainicio' AND c.fecha <= '$fechafin' ";
                    $sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where." ORDER BY fecha DESC";
                    $almacenA1 =  findBySqlReturnCampoUnique($sql25, true, true, 'bs');
                    $rebaja = $almacenA1['resultado'];
                    //fin
                    $porcentajetotal = "100";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$paresstant."&nbsp;</td>";

                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$totalbsstant."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$totalparesrecibido."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$totalbsrecibido."&nbsp;</td>";

                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$parestrasrec."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$totalbstrasrec."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$paresdevol."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$totalbsdevol."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$parestraspdesp."&nbsp;</td>";

                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$totalbstraspdesp."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$paresventa."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$totalbsventa."&nbsp;</td>";

                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;font-weight:bold;font-size:12px;'>&nbsp;".$paresstact."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;font-weight:bold;font-size:12px;'>&nbsp;".$totalbs."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$rebaja."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$porcentajetotal."&nbsp;</td>";


                    $devS .= "</tr>";

                    $devS .= "</table>";

                    $dev['mensaje'] = "Existen resultados";
                    $dev['error']   = "true";
                    $dev['resultado'] = $devS;

                }
                else
                {
                    $dev['mensaje'] = "No se encontro datos en la consulta2".mysql_error();
                    $dev['error']   = "false";
                    $dev['resultado'] = "";
                }
            }
            else
            {
                $dev['mensaje'] = "Error en la consulta";
                $dev['error']   = "false";
                $dev['resultado'] = "";
            }
        }
        else
        {
            $dev['mensaje'] = "No se pudo conectar a la BD";
            $dev['error']   = "false";
            $dev['resultado'] = "";
        }
    }
    else
    {
        $dev['mensaje'] = "No se pudo crear la conexion a la BD";
        $dev['error']   = "false";
        $dev['resultado'] = "";
    }
    return $dev;
}

function dibujarTablaOfSQLinventarioVentas($sql,$sql21,$row1,$idmarca,$rango1,$rango2,$totalparesestilo,$totalbsestilo, $tipo,$marcapedido)
{

    //    d
    $sql211 = getTablaToArrayOfSQL($sql21);
    $sql3 = $sql211['resultado'];
    if($link=new BD)
    {
        if($link->conectar())
        {
            if($re = $link->consulta($sql))
            {
                //echo mysql_num_rows($re);
                if($fi = mysql_fetch_array($re))
                {
                    //                    s
                    $devS .= "<table cellpadding='0' cellspacing='0' border='0' style='width:750px;border:1px solid #000000;font-size:11px;'>";
                    $devS .= "<tr><td style='border-bottom:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Nro</td>";
                    $devS .= "<td style='display:none;'>".mysql_field_name($re, $zz)."</td>";
                    // $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Modelo</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Modelo</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Color</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Precio</td>";
                    for($hi=0;$hi<$row1;$hi++){
                        $codigo = $sql3[$hi];
                        $idmmarca = $codigo['talla'];

                        $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>$idmmarca</td>";
                        $ji++;
                    }
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Stock anterior</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Ventas</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Bs</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Stock Actual</td>";

                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Bs</td>";

                    $devS .= "</tr>";
                    $ii = 0;
                    //$totalCount = mysql_num_rows($re);
                    $z = 1;
                    do{
                        $devS .= "<tr><td style='text-align:left'>".$z."</td>";
                        for($i = 0; $i< mysql_num_fields($re); $i++)
                        {$dato = $fi[$i];
                            $iddetalleingreso = $fi[$i]['iddetalleingreso'];
                            $devS .= "<td style='display:none;'>&nbsp;".$dato."&nbsp;</td>";
                            // echo $marcapedido;
                            $select = "dtp.totalbs AS precio";
                            $from = "adiciondetalleingreso dtp, modelos mdd, coleccion col, estilos es";
                            $where = "dtp.idmodelo = mdd.idmodelo AND mdd.idcoleccion = col.idcoleccion AND mdd.stylename = es.idestilo AND dtp.iddetalleingreso='$dato'";

                            if($marcapedido=='CODIGO-COLOR-MATERIAL'){
                                $select .= ",concat(col.detalle,'-',mdd.codigo) AS codigo, dtp.color";
                            }else{
                                if($marcapedido=="CODIGO-MATERIAL"){
                                    $select .= ",concat(mdd.codigo,'-',dtp.material) AS codigo, dtp.color";
                                }else{
                                    if(($marcapedido=="CODIGO-COLOR")||($marcapedido=="CODIGO")){
                                        $select .= ",mdd.codigo, dtp.color";
                                    }else{
                                        if($marcapedido=="CODIGO-COLOR-STYLENAME"){
                                            $select .= ",concat(mdd.codigo,'-',dtp.color) AS codigo, dtp.material AS color";
                                        }else{
                                            if($marcapedido=="LINEA-CODIGO-COLOR"){
                                                $select .= ",concat(mdd.codigo,'-',dtp.color) AS codigo, dtp.material AS color";
                                                $from .= ",lineas l";
                                                $where .= ",AND mdd.idlinea = l.idlinea";

                                            }
                                        }

                                    }
                                }
                            }

                            // $from = "adiciondetalleingreso dtp, modelos mdd, coleccion col, estilos es";
                            //$where = "dtp.idmodelo = mdd.idmodelo AND mdd.idcoleccion = col.idcoleccion AND mdd.stylename = es.idestilo AND dtp.iddetalleingreso='$dato'";
                            $sql2p1 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                            // echo $sql2p1;
                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p1, true, true, 'codigo');
                            $modelo = $almacenA1['resultado'];
                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p1, true, true, 'color');
                            $color = $almacenA1['resultado'];
                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p1, true, true, 'precio');
                            $precio = $almacenA1['resultado'];
                            $devS .= "<td style='text-align:left;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$modelo."&nbsp;</td>";
                            $devS .= "<td style='text-align:left;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$color."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$precio."&nbsp;</td>";


                            for($h=0;$h<$row1;$h++){
                                $codigo = $sql3[$h];
                                $idmmarca = $codigo['talla'];


                                $select1 = "saldocantidad AS Pares";
                                $from1 = "adicionkardextienda";
                                $where1 = "idcalzado = '$dato' AND talla='$idmmarca' ";
                                //if($ltienda != "Todos"){ $where .= " AND ve.idtienda = '$ltienda' ";}
                                $sql21 = "SELECT ".$select1." FROM ".$from1. " WHERE ".$where1;
                                //echo $sql21;
                                $almacenA1 =  findBySqlReturnCampoUnique($sql21, true, true, 'Pares');
                                $pares1 = $almacenA1['resultado'];
                                if($pares1==NULL || $pares1 =='' || $pares1 == ""){ $pares1="0"; }
                                $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$pares1."&nbsp;</td>";
                                $j++;
                            }
                            $select = "SUM(saldocantidad) AS Pares";
                            $from = "adicionkardextienda k";
                            $where = " k.idcalzado='$dato' ";
                            $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                            $pares = $almacenA1['resultado'];
                            // $pares=$totalparesiddetalleingreso;
                            if($pares==NULL || $pares =='' || $pares == ""){ $pares="0"; }
                            $select = "SUM(saldocantidad*precio2bs) AS bs";
                            $from = "adicionkardextienda k";
                            $where = " k.idcalzado='$dato' ";
                            $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'bs');
                            $totalbs = $almacenA1['resultado'];
                            if($totalbs==NULL || $totalbs =='' || $totalbs == ""){ $totalbs="0"; }
                            $apresventa='12';
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$stokant."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$paresventa."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$bsventa."&nbsp;</td>";

                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$pares."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$totalbs."&nbsp;</td>";

                        }
                        $devS .= "</tr>";
                        $ii++;
                        $z ++;
                    }while($fi = mysql_fetch_array($re));
                    if($tipo=="1"){
                        $devS .= "<tr><td style='border:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Total</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td style='border:1px solid #000000;text-align:center;background-color:silver;'>$totalanterior</td><td style='border:1px solid #000000;text-align:center;background-color:silver;'>$totalventas</td><td style='border:1px solid #000000;text-align:center;background-color:silver;'>$totalventasbs</td><td></td><td></td><td style='border:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>$totalparesestilo</td><td style='border:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>$totalbsestilo</td>";
                    }else{
                        if($tipo=="2"){
                            $devS .= "<tr><td style='border:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Total</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td style='border-bottom:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>$totalparesestilo</td><td style='border-bottom:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>$totalbsestilo</td>";
                        }else{
                            if($tipo=="3"){
                                //   echo "ddd";

                                $devS .= "<tr><td style='border:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Total</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td style='border:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>$totalparesestilo</td><td style='border:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>$totalbsestilo</td>";
                            }


                        }
                    }
                    $devS .= "</table>";

                    $dev['mensaje'] = "Existen resultados";
                    $dev['error']   = "true";
                    $dev['resultado'] = $devS;

                }
                else
                {
                    $dev['mensaje'] = "No se encontro datos en la consulta2".mysql_error();
                    $dev['error']   = "false";
                    $dev['resultado'] = "";
                }
            }
            else
            {
                $dev['mensaje'] = "Error en la consulta";
                $dev['error']   = "false";
                $dev['resultado'] = "";
            }
        }
        else
        {
            $dev['mensaje'] = "No se pudo conectar a la BD";
            $dev['error']   = "false";
            $dev['resultado'] = "";
        }
    }
    else
    {
        $dev['mensaje'] = "No se pudo crear la conexion a la BD";
        $dev['error']   = "false";
        $dev['resultado'] = "";
    }
    return $dev;
}


function dibujarTuplaOfSQLSimpleinventario($sql, $totalpares,$totalbs)
{
    if($link=new BD)
    {
        if($link->conectar())
        {
            if($re = $link->consulta($sql))
            {
                //echo mysql_num_rows($re);
                if($fi = mysql_fetch_array($re))
                {
                    $devS .= "<table cellpadding='0' cellspacing='0' border='0' style='width:100%;border:1px solid #000000;font-size:11px;'>";

                    $ii = 0;
                    //$totalCount = mysql_num_rows($re);
                    $z = 1;
                    do{
                        for($i = 0; $i< mysql_num_fields($re); $i++)
                        {
                            $dato = $fi[$i];
                            $devS .= "<tr><td style='font-weight:bold;width:86%;'>&nbsp;&nbsp;TOTALES</td><td style='text-align:left;border: 2px solid #000000;'>".$dato."</td><td style='text-align:right;border: 2px solid #000000;'>".redondear($totalbs)."</td></tr>";

                        }
                        $devS .= "</tr>";
                        $ii++;
                        $z ++;
                    }while($fi = mysql_fetch_array($re));

                    $devS .= "</table>";

                    $dev['mensaje'] = "Existen resultados";
                    $dev['error']   = "true";
                    $dev['resultado'] = $devS;

                }
                else
                {
                    $dev['mensaje'] = "No se encontro datos en la consulta2".mysql_error();
                    $dev['error']   = "false";
                    $dev['resultado'] = "";
                }
            }
            else
            {
                $dev['mensaje'] = "Error en la consulta";
                $dev['error']   = "false";
                $dev['resultado'] = "";
            }
        }
        else
        {
            $dev['mensaje'] = "No se pudo conectar a la BD";
            $dev['error']   = "false";
            $dev['resultado'] = "";
        }
    }
    else
    {
        $dev['mensaje'] = "No se pudo crear la conexion a la BD";
        $dev['error']   = "false";
        $dev['resultado'] = "";
    }
    return $dev;
}
function verIngresosMarcaEstiloHTMLVentasnuevo($idmarca,$idestilo,$idkardex, $return)
{

    $html = "";

    $html .= "<!DOCTYPE HTML PUBLIC '-//W3C//DTD HTML 4.01 Transitional//EN'>";
    $html .= "<html>";
    $html .= "<body>";
    $html .= "<tr>";

    $html .= "<table cellpadding='1' cellspacing='0' border='0' style='width:100%' font-size:11px; font-family:Tahoma;'>";
    $html .= "<td style='width:100%;height:100%;text-align:right;font-size:12px;font-family:Tahoma;'>";
    $html .= "$fecha  $tipo";
    $html .= "</td>";
    $html .= "<tr>";
    $sql = "SELECT ma.nombre AS marca,ma.talla,ma.opcionb,ma.pedido
FROM  `marcas` ma
WHERE ma.idmarca = '$idmarca'";

    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'marca');
    $marcalista = $idalmacenA2['resultado'];
    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'talla');
    $opcionmarca = $idalmacenA2['resultado'];
    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'opcionb');
    $opcionb = $idalmacenA2['resultado'];
    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'pedido');
    $marcapedido = $idalmacenA2['resultado'];
    $idsCAr = split("-", $opcionmarca);
    $rango1=$idsCAr[0];
    $rango2=$idsCAr[1];

    if($opcionmarca="33-45"){
        $tipo="1";
        //echo $tipo;
    }else{
        if($opcionmarca="14-38"){
            $tipo="3";
        }
    }

    $sql1 = "SELECT  es.nombre AS estilo
FROM  estilos es
WHERE es.idestilo = '$idestilo'";
    $idalmacenA =  findBySqlReturnCampoUnique($sql1, true, true, 'estilo');
    $estilolista = $idalmacenA['resultado'];
    //echo $estilolista;
    $sql1 = "SELECT mesrango
FROM  administrakardex
WHERE idkardex = '$idkardex'";
    $idalmacenA =  findBySqlReturnCampoUnique($sql1, true, true, 'mesrango');
    $periodo = $idalmacenA['resultado'];
    //$html .= "<tr style='width:100%height:100px;text-align:center;font-size:15px;font-family:Tahoma;'>";
    $html .= "<td style='width:100%;height:100px;text-align:center;font-size:15px;font-family:Tahoma;'>";

    $html .= "INVENTARIO $marcalista<br> Estilo $estilolista <br> Periodo $periodo";

    $html .= "</td>";
    $html .= "</tr>";
    $html .= "</table>";
    $html .= "</tr>";
    $html .= "<tr>";
    $html .= "<td colspan='3'>";
    $html .= "<table width='1250' border='0' cellspacing='0' cellpadding='0'><tr>";

    $html .= "<tr>";
    $select1 = "talla,idmodelo";
    $from1 = "tallasdetalle";
    $where1 = "talla >='$rango1' AND talla <='$rango2' AND idmodelo='2' ORDER BY talla ASC";
    $sql21 = "SELECT ".$select1." FROM ".$from1." WHERE ".$where1;
    $row = NumeroTuplas($sql21);
    $row1= $row['resultado'];


    $select = "dtp.iddetalleingreso";
    $from = "adiciondetalleingreso dtp, modelos mdd, coleccion col, estilos es";
    $where = "dtp.idmodelo = mdd.idmodelo AND mdd.idcoleccion = col.idcoleccion AND mdd.stylename = es.idestilo AND dtp.unido='no' AND mdd.idmarca = '$idmarca' AND mdd.stylename='$idestilo'";
    $sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where." ORDER BY CAST( `mdd`.`codigo` AS SIGNED) ASC";
    $table = dibujarTablaOfSQLinventarioVentasTotalnuevo($idkardex,$sql25,$sql21,$row1,$idmarca,$idestilo,$rango1,$rango2,$totalparesestilo,$totalbsestilo, $tipo,$marcapedido);
    $html .= $table['resultado'];
    $html .= "</tr>";
    $html .= "</table>";
    $html .= "</td></tr>";
    $html .= "</tr>";
    $html .= "</table>";
    $html .= "</body>";
    $html .= "</html>";
    if($return == true)
    {
        return $html;
    }
    else
    {
        echo $html;
    }
}
function dibujarTablaOfSQLinventarioVentasTotalnuevo($idkardex,$sql,$sql21,$row1,$idmarca,$idestilo,$rango1,$rango2,$total1,$total2, $tipo,$marcapedido)
{
    $sqlmarca = " SELECT tabla,mesrango,idperiodo,fechainicio,fechafin FROM administrakardex WHERE idkardex = '$idkardex' ";
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "tabla");
    $tabla = $opcionkardex['resultado'];
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "mesrango");
    $mesrango = $opcionkardex['resultado'];
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "idperiodo");
    $idperiodo = $opcionkardex['resultado'];

    // echo $tabla;
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "fechainicio");
    $fechainicio = $opcionkardex['resultado'];
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "fechafin");
    $fechafin = $opcionkardex['resultado'];
    //AND k.idperiodo='$idperiodo'

    if($fechafin==null ||$fechafin == ""){
        $fechafin = Date("Y-m-d");
    }
    if($tabla=="historialkardextienda"){
    }else{
        $sqlInv = "SELECT MAX(idperiodo)AS numero
FROM administrakardex where tabla='historialkardextienda'";
        $almacenA1 =  findBySqlReturnCampoUnique($sqlInv, true, true, 'numero');
        $idperiodoant = $almacenA1['resultado'];
        $sqlmarca = " SELECT tabla,mesrango,idperiodo,fechainicio,fechafin FROM administrakardex WHERE idperiodo = '$idperiodoant' ";
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "fechainicio");
        // $fechainicio = $opcionkardex['resultado'];
        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "fechafin");
        // $fechafin = $opcionkardex['resultado'];
    }
    //    d
    $sql211 = getTablaToArrayOfSQL($sql21);
    $sql3 = $sql211['resultado'];
    if($link=new BD)
    {
        if($link->conectar())
        {
            if($re = $link->consulta($sql))
            {
                //echo mysql_num_rows($re);
                if($fi = mysql_fetch_array($re))
                {
                    $devS .= "<table cellpadding='0' cellspacing='0' border='0' style='width:750px;border:1px solid #000000;font-size:11px;'>";
                    $devS .= "<tr><td style='border-bottom:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Nro</td>";
                    $devS .= "<td style='display:none;'>".mysql_field_name($re, $zz)."</td>";
                    // $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Modelo</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Modelo</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Color</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Precio</td>";
                    for($hi=0;$hi<$row1;$hi++){
                        $codigo = $sql3[$hi];
                        $idmmarca = $codigo['talla'];

                        $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>$idmmarca</td>";
                        $ji++;
                    }
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Anterior</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>+Rec</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>+Tras.Rec</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>+Regul</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>-Tras.Des</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>+Dev</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>-Cambio</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>-Venta</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Prs Actual</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Bs Act</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Sumat</td>";
                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Diferencia</td>";


                    $devS .= "</tr>";
                    $ii = 0;
                    //$totalCount = mysql_num_rows($re);
                    $z = 1;
                    do{
                        $devS .= "<tr><td style='text-align:left'>".$z."</td>";
                        for($i = 0; $i< mysql_num_fields($re); $i++)
                        {$dato = $fi[$i];
                            $iddetalleingreso = $fi[$i]['iddetalleingreso'];
                            $devS .= "<td style='display:none;'>&nbsp;".$dato."&nbsp;</td>";
                            // echo $marcapedido;
                            $select = "dtp.totalbs AS precio";
                            $from = "adiciondetalleingreso dtp, modelos mdd, coleccion col, estilos es";
                            $where = "dtp.idmodelo = mdd.idmodelo AND mdd.idcoleccion = col.idcoleccion AND mdd.stylename = es.idestilo AND dtp.iddetalleingreso='$dato'";

                            if($marcapedido=='CODIGO-COLOR-MATERIAL'){
                                $select .= ",concat(col.detalle,'-',mdd.codigo) AS codigo, dtp.color";
                            }else{
                                if($marcapedido=="CODIGO-MATERIAL"){
                                    $select .= ",concat(mdd.codigo,'-',dtp.material) AS codigo, dtp.color";
                                }else{
                                    if(($marcapedido=="CODIGO-COLOR")||($marcapedido=="CODIGO")){
                                        $select .= ",mdd.codigo, dtp.color";
                                    }else{
                                        if($marcapedido=="CODIGO-COLOR-STYLENAME"){
                                            $select .= ",concat(mdd.codigo,'-',dtp.color) AS codigo, dtp.material AS color";
                                        }else{
                                            if($marcapedido=="LINEA-CODIGO-COLOR"){
                                                $select .= ",concat(mdd.codigo,'-',dtp.color) AS codigo, dtp.material AS color";
                                                $from .= ",lineas l";
                                                $where .= ",AND mdd.idlinea = l.idlinea";

                                            }
                                        }

                                    }
                                }
                            }

                            // $from = "adiciondetalleingreso dtp, modelos mdd, coleccion col, estilos es";
                            //$where = "dtp.idmodelo = mdd.idmodelo AND mdd.idcoleccion = col.idcoleccion AND mdd.stylename = es.idestilo AND dtp.iddetalleingreso='$dato'";
                            $sql2p1 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                            // echo $sql2p1;
                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p1, true, true, 'codigo');
                            $modelo = $almacenA1['resultado'];
                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p1, true, true, 'color');
                            $color = $almacenA1['resultado'];
                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p1, true, true, 'precio');
                            $precio = $almacenA1['resultado'];
                            $devS .= "<td style='text-align:left;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$modelo."&nbsp;</td>";
                            $devS .= "<td style='text-align:left;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$color."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$precio."&nbsp;</td>";


                            for($h=0;$h<$row1;$h++){
                                $codigo = $sql3[$h];
                                $idmmarca = $codigo['talla'];
                                if($tabla=="historialkardextienda"){
                                    $select1 = "saldocantidad AS Pares";
                                    $from1 = "historialkardextienda";
                                    $where1 = "idcalzado = '$dato' AND talla='$idmmarca' AND idperiodo='$idperiodo'";
                                    //if($ltienda != "Todos"){ $where .= " AND ve.idtienda = '$ltienda' ";}
                                    $sql21 = "SELECT ".$select1." FROM ".$from1. " WHERE ".$where1;
                                    //echo $sql21;
                                    $almacenA1 =  findBySqlReturnCampoUnique($sql21, true, true, 'Pares');
                                    $pares1 = $almacenA1['resultado'];
                                }else{
                                    $select1 = "saldocantidad AS Pares";
                                    $from1 = "adicionkardextienda";
                                    $where1 = "idcalzado = '$dato' AND talla='$idmmarca'";
                                    //if($ltienda != "Todos"){ $where .= " AND ve.idtienda = '$ltienda' ";}
                                    $sql21 = "SELECT ".$select1." FROM ".$from1. " WHERE ".$where1;

                                    $almacenA1 =  findBySqlReturnCampoUnique($sql21, true, true, 'Pares');
                                    $pares1 = $almacenA1['resultado'];

                                }

                                if($pares1==NULL || $pares1 =='' || $pares1 == ""){ $pares1="0"; }
                                $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$pares1."&nbsp;</td>";
                                $j++;
                            }

                            if($tabla=="historialkardextienda"){
                                $sqlInv = "SELECT MAX(idperiodo)AS numero
FROM administrakardex where tabla='historialkardextienda'";
                                $almacenA1 =  findBySqlReturnCampoUnique($sqlInv, true, true, 'numero');
                                $idperiodoant = $almacenA1['resultado'];
                                $idper = $idperiodoant - 1;

                                $select = "SUM(saldocantidad) AS Pares";
                                $from = "historialkardextienda k,modelos mdt";
                                $where = " k.idmodelodetalle = mdt.idmodelo and k.idcalzado='$dato' AND k.idperiodo='$idper' AND k.unido='no'";
                                $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                                //echo $sql2p;
                                $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                                $stockanterior = $almacenA1['resultado'];
                                if($stockanterior==NULL || $stockanterior =='' || $stockanterior == ""){ $stockanterior="0"; }

                                //1
                                $select = "SUM(totalpares) AS Pares";
                                $from = "adiciondetalleingreso k,adicioningresotienda ad,modelos mdt";
                                $where = "k.idmodelo=mdt.idmodelo and k.idcalzado='$dato' AND k.idingreso=ad.idingreso AND ad.idmarca='$idmarca'  AND ad.fecha >= '$fechainicio'
    AND ad.fecha <= '$fechafin'";
                                $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                                $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                                $recibidoingreso1 = $almacenA1['resultado'];
                                $select = "SUM(totalpares) AS Pares";
                                $from = "ingresos i,historialkardextienda k,modelos mdt";
                                $where = " k.idmodelodetalle=mdt.idmodelo and k.idcalzado='$dato' AND k.idkardextienda=i.idkardextienda  AND i.detalle2='ingresoalmacen' AND i.fecha >= '$fechainicio'
    AND i.fecha <= '$fechafin' AND k.idperiodo='$idperiodo'";

                                $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                                $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                                $ingresoalmacen2 = $almacenA1['resultado'];
                                if($ingresoalmacen2==NULL || $ingresoalmacen2 =='' || $ingresoalmacen2 == ""){ $ingresoalmacen2="0"; }
                                $recibido =$recibidoingreso1+$ingresoalmacen2;
                                //2
                                $select = "SUM(i.cantidad) AS Pares";
                                $from = "ingresos i,historialkardextienda k,modelos mdt";
                                $where = "k.idmodelodetalle=mdt.idmodelo and k.idcalzado='$dato' AND k.idkardextienda=i.idkardextienda AND i.fecha >= '$fechainicio'
    AND i.fecha <= '$fechafin' AND i.detalle2!='ingresoalmacen' AND k.idperiodo='$idperiodo'  ";
                                $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                                $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                                $trasrecibido = $almacenA1['resultado'];
                                if($trasrecibido==NULL || $trasrecibido =='' || $trasrecibido == ""){ $trasrecibido="0"; }
                                //3
                                $select = "SUM(i.cantidad) AS Pares";
                                $from = "ingresos i,historialkardextienda k,modelos mdt";
                                $where = "k.idmodelodetalle=mdt.idmodelo and k.idcalzado='$dato' AND k.idkardextienda=i.idkardextienda AND i.fecha >= '$fechainicio'
    AND i.fecha <= '$fechafin' AND i.detalle2='regularizacion' AND k.idperiodo='$idperiodo' ";
                                $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                                $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                                $regulariza = $almacenA1['resultado'];
                                if($regulariza==NULL || $regulariza =='' || $regulariza == ""){ $regulariza="0"; }
                                //4
                                $select = "SUM(i.cantidad) AS Pares";
                                $from = "detalletraspaso i,historialkardextienda k,traspaso tr,modelos mdt";
                                $where = " k.idmodelodetalle=mdt.idmodelo and k.idcalzado='$dato' AND k.idkardextienda=i.idkardextienda ANd i.idtraspaso=tr.idtraspaso AND tr.fecha >= '$fechainicio'
    AND tr.fecha <= '$fechafin' AND k.idperiodo='$idperiodo'";
                                $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                                $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                                $trasdesp = $almacenA1['resultado'];
                                if($trasdesp==NULL || $trasdesp =='' || $trasdesp == ""){ $trasdesp="0"; }
                                //5
                                $select = "SUM(i.cantidad) AS devolu";
                                $from = "itemventa i,historialkardextienda k, ventasdetalle v,modelos mdt";
                                $where = "k.idmodelodetalle=mdt.idmodelo and k.idcalzado='$dato' AND k.idkardextienda=i.idkardextienda ANd i.idventa=v.idventadetalle AND i.estado='cambiado'
and v.fecha >= '$fechainicio'
    AND v.fecha <= '$fechafin' AND k.idperiodo='$idperiodo'";
                                $sqldev = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                                $almacenA1d =  findBySqlReturnCampoUnique($sqldev, true, true, 'devolu');
                                $devol = $almacenA1d['resultado'];
                                if($devol==NULL || $devol =='' || $devol == ""){ $devol="0"; }

                                //6
                                $select = "SUM(i.cantidad) AS Pares";
                                $from = "itemventa i,historialkardextienda k, ventasdetalle v,modelos mdt";
                                $where = " k.idmodelodetalle=mdt.idmodelo and k.idcalzado='$dato' AND k.idkardextienda=i.idkardextienda ANd i.idventa=v.idventadetalle AND  i.estado='cambio'
and v.fecha >= '$fechainicio'
    AND v.fecha <= '$fechafin' AND k.idperiodo='$idperiodo'";
                                $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                                $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                                $cambio = $almacenA1['resultado'];
                                if($cambio==NULL || $cambio =='' || $cambio == ""){ $cambio="0"; }
                                //7

                                $select = "SUM(i.cantidad) AS Pares";
                                $from = "itemventa i,historialkardextienda k, ventasdetalle v";
                                $where = "k.idcalzado='$dato' AND k.idkardextienda=i.idkardextienda ANd i.idventa=v.idventadetalle AND  i.estado!='cambiado'
and v.fecha >= '$fechainicio'
    AND v.fecha <= '$fechafin' AND k.idperiodo='$idperiodo' ";
                                $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                                $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                                $venta = $almacenA1['resultado'];
                                if($venta==NULL || $venta =='' || $venta == ""){ $venta="0"; }
                                //8
                                //echo $sql2p;
                                $select = "SUM(saldocantidad) AS Pares";
                                $from = "historialkardextienda k,modelos mdt";
                                $where = " k.idmodelodetalle=mdt.idmodelo and k.idcalzado='$dato' and k.unido='no' AND k.idperiodo='$idperiodo'";
                                $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                                $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                                $pares = $almacenA1['resultado'];
                                if($pares==NULL || $pares =='' || $pares == ""){ $pares="0"; }

                                //9
                                $select = "SUM(saldocantidad*precio2bs) AS bs";
                                $from = "historialkardextienda k,modelos mdt";
                                $where = "k.idmodelodetalle=mdt.idmodelo and k.idcalzado='$dato' and k.unido='no' AND k.idperiodo='$idperiodo'";
                                $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                                $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'bs');
                                $totalbs = $almacenA1['resultado'];
                                if($totalbs==NULL || $totalbs =='' || $totalbs == ""){ $totalbs="0"; }

                                $suma = $stockanterior + $recibido +$trasrecibido + $regulariza -$trasdesp +$devol -$cambio-$venta;
                                $diferencia= $pares - $suma ;

                            }
                            else{
                                $sqlInv = "SELECT MAX(idperiodo)AS numero
FROM administrakardex where tabla='historialkardextienda'";
                                $almacenA1 =  findBySqlReturnCampoUnique($sqlInv, true, true, 'numero');
                                $idperiodoant = $almacenA1['resultado'];
                                //  echo $idperiodoant;
                                $select = "SUM(saldocantidad) AS Pares";
                                $from = "historialkardextienda k";
                                $where = " k.idcalzado='$dato' AND k.idperiodo='$idperiodoant' AND k.unido='no'";
                                $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                                $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                                $stockanterior = $almacenA1['resultado'];
                                if($stockanterior==NULL || $stockanterior =='' || $stockanterior == ""){ $stockanterior="0"; }
                                $select = "SUM(totalpares) AS Pares";
                                $from = "adiciondetalleingreso k,adicioningresotienda ad";
                                $where = " k.idcalzado='$dato' AND k.idingreso=ad.idingreso AND ad.idmarca='$idmarca'  AND ad.fecha >= '$fechainicio'
    AND ad.fecha <= '$fechafin'";
                                $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                                $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                                $recibidoingreso1 = $almacenA1['resultado'];
                                $select = "SUM(totalpares) AS Pares";
                                $from = "ingresos i,adicionkardextienda k";
                                $where = " k.idcalzado='$dato' AND k.idkardextienda=i.idkardextienda  AND i.detalle2='ingresoalmacen' AND i.fecha >= '$fechainicio'
    AND i.fecha <= '$fechafin' AND k.idperiodo='$idperiodo'";
                                $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                                $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                                $ingresoalmacen2 = $almacenA1['resultado'];
                                $recibido =$recibidoingreso1+$ingresoalmacen2;

                                if($recibido==NULL || $recibido =='' || $recibido == ""){ $recibido="0"; }
                                $select = "SUM(i.cantidad) AS Pares";
                                $from = "ingresos i,adicionkardextienda k";
                                $where = " k.idcalzado='$dato' AND k.idkardextienda=i.idkardextienda AND i.fecha >= '$fechainicio'
    AND i.fecha <= '$fechafin'  AND i.detalle2!='ingresoalmacen' ";
                                $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                                $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                                $trasrecibido = $almacenA1['resultado'];
                                if($trasrecibido==NULL || $trasrecibido =='' || $trasrecibido == ""){ $trasrecibido="0"; }

                                $select = "SUM(i.cantidad) AS Pares";
                                $from = "detalletraspaso i,adicionkardextienda k,traspasos tr";
                                $where = " k.idcalzado='$dato' AND k.idkardextienda=i.idkardextienda ANd i.idtraspaso=tr.idtraspaso AND tr.fecha >= '$fechainicio'
    AND tr.fecha <= '$fechafin' ";
                                $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                                $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                                $trasdesp = $almacenA1['resultado'];

                                if($trasdesp==NULL || $trasdesp =='' || $trasdesp == ""){ $trasdesp="0"; }

                                $select = "SUM(i.cantidad) AS Pares";
                                $from = "itemventa i,adicionkardextienda k, ventasdetalle v";
                                $where = " k.idcalzado='$dato' AND k.idkardextienda=i.idkardextienda ANd i.idventa=v.idventadetalle AND  i.estado!='cambiado'
and v.fecha >= '$fechainicio'
    AND v.fecha <= '$fechafin' ";
                                $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                                //  echo $sql2p;
                                $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                                $venta = $almacenA1['resultado'];
                                // $pares=$totalparesiddetalleingreso;
                                if($venta==NULL || $venta =='' || $venta == ""){ $venta="0"; }
                                if($tabla=="historialkardextienda"){

                                    $select = "SUM(saldocantidad) AS Pares";
                                    $from = "historialkardextienda k";
                                    $where = " k.idcalzado='$dato' and k.unido='no' AND k.idperiodo='$idperiodo'";
                                    $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                                    $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                                    $pares = $almacenA1['resultado'];
                                }else{
                                    $select = "SUM(saldocantidad) AS Pares";
                                    $from = "adicionkardextienda k";
                                    $where = " k.idcalzado='$dato' and k.unido='no'";
                                    $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                                    $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                                    $pares = $almacenA1['resultado'];

                                }

                                // $pares=$totalparesiddetalleingreso;

                                if($pares==NULL || $pares =='' || $pares == ""){ $pares="0"; }

                                $select = "SUM(saldocantidad*precio2bs) AS bs";
                                $from = "adicionkardextienda k";
                                $where = " k.idcalzado='$dato' and k.unido='no'";
                                $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                                $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'bs');
                                $totalbs = $almacenA1['resultado'];
                                if($totalbs==NULL || $totalbs =='' || $totalbs == ""){ $totalbs="0"; }
                            }
                            //items
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$stockanterior."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$recibido."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$trasrecibido."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$regulariza."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$trasdesp."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$devol."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$cambio."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$venta."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$pares."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$totalbs."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$suma."&nbsp;</td>";
                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$diferencia."&nbsp;</td>";

                        }
                        $devS .= "</tr>";
                        $ii++;
                        $z ++;
                    }while($fi = mysql_fetch_array($re));
                    //$devS .= "<tr><td style='border:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Total</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td style='border:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>$totalparesestilo</td><td style='border:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>$totalbsestilo</td>";
                    $devS .= "<tr style='background-color:silver;'><td style='border: 1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>TOTAL</td>";
                    $devS .= "<td style='display:none;'></td>";
                    $fechatoday = Date("d-m-Y");
                    $devS .= "<td style='text-align:center;border-bottom: 1px solid #000000;'></td>";
                    $devS .= "<td style='text-align:center;border-bottom: 1px solid #000000;'></td>";
                    $devS .= "<td style='text-align:center;border-bottom: 1px solid #000000;'></td>";

                    for($h=0;$h<$row1;$h++){
                        $codigo = $sql3[$h];
                        $idmmarca = $codigo['idmarca'];

                        $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'></td>";
                        $j++;
                    }
                    //totales
                    if($tabla=="historialkardextienda"){
                        $sqlInv = "SELECT MAX(idperiodo)AS numero
FROM administrakardex where tabla='historialkardextienda'";
                        $almacenA1 =  findBySqlReturnCampoUnique($sqlInv, true, true, 'numero');
                        $idperiodoant = $almacenA1['resultado'];
                        $idper = $idperiodoant - 1;
                        //$where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND mdt.stylename = '$idestilo' AND k.idperiodo='$idperiodoant' AND k.unido='no'";

                        $select = "SUM(saldocantidad) AS Pares";
                        $from = "historialkardextienda k,modelos mdt";
                        $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.stylename = '$idestilo' AND k.idperiodo='$idper' AND k.unido='no'";
                        $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                        //echo $sql2p;
                        $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                        $tstockanterior = $almacenA1['resultado'];
                        if($tstockanterior==NULL || $tstockanterior =='' || $tstockanterior == ""){ $tstockanterior="0"; }

                        //1
                        $select = "SUM(totalpares) AS Pares";
                        $from = "adiciondetalleingreso k,adicioningresotienda ad,modelos mdt";
                        $where = "k.idmodelo=mdt.idmodelo AND mdt.stylename = '$idestilo' AND k.idingreso=ad.idingreso AND ad.idmarca='$idmarca'  AND ad.fecha >= '$fechainicio'
    AND ad.fecha <= '$fechafin'";
                        $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                        $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                        $recibidoingreso1 = $almacenA1['resultado'];
                        $select = "SUM(totalpares) AS Pares";
                        $from = "ingresos i,historialkardextienda k,modelos mdt";
                        $where = " k.idmodelodetalle=mdt.idmodelo AND k.idperiodo='$idperiodo' AND mdt.stylename = '$idestilo' AND k.idkardextienda=i.idkardextienda  AND i.detalle2='ingresoalmacen' AND i.fecha >= '$fechainicio'
    AND i.fecha <= '$fechafin'";
                        $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                        $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                        $ingresoalmacen2 = $almacenA1['resultado'];
                        if($ingresoalmacen2==NULL || $ingresoalmacen2 =='' || $ingresoalmacen2 == ""){ $ingresoalmacen2="0"; }
                        $trecibido =$recibidoingreso1+$ingresoalmacen2;
                        //2
                        $select = "SUM(i.cantidad) AS Pares";
                        $from = "ingresos i,historialkardextienda k,modelos mdt";
                        $where = "k.idmodelodetalle=mdt.idmodelo AND mdt.stylename = '$idestilo' AND k.idkardextienda=i.idkardextienda AND i.fecha >= '$fechainicio'
    AND i.fecha <= '$fechafin' AND i.detalle2!='ingresoalmacen' AND k.idperiodo='$idperiodo' ";
                        $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                        $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                        $ttrasrecibido = $almacenA1['resultado'];
                        if($ttrasrecibido==NULL || $ttrasrecibido =='' || $ttrasrecibido == ""){ $ttrasrecibido="0"; }
                        //3
                        $select = "SUM(i.cantidad) AS Pares";
                        $from = "ingresos i,historialkardextienda k,modelos mdt";
                        $where = "k.idmodelodetalle=mdt.idmodelo AND mdt.stylename = '$idestilo' AND k.idkardextienda=i.idkardextienda AND i.fecha >= '$fechainicio'
    AND i.fecha <= '$fechafin' AND i.detalle2='regularizacion' AND k.idperiodo='$idperiodo' ";
                        $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                        $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                        $tregulariza = $almacenA1['resultado'];
                        if($tregulariza==NULL || $tregulariza =='' || $tregulariza == ""){ $tregulariza="0"; }
                        //4
                        $select = "SUM(i.cantidad) AS Pares";
                        $from = "detalletraspaso i,historialkardextienda k,traspaso tr,modelos mdt";
                        $where = " k.idmodelodetalle=mdt.idmodelo AND k.idperiodo='$idperiodo' AND mdt.stylename = '$idestilo' AND k.idkardextienda=i.idkardextienda ANd i.idtraspaso=tr.idtraspaso AND tr.fecha >= '$fechainicio'
    AND tr.fecha <= '$fechafin' ";
                        $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                        $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                        $ttrasdesp = $almacenA1['resultado'];
                        if($ttrasdesp==NULL || $ttrasdesp =='' || $ttrasdesp == ""){ $ttrasdesp="0"; }
                        //5
                        $select = "SUM(i.cantidad) AS devolu";
                        $from = "itemventa i,historialkardextienda k, ventasdetalle v,modelos mdt";
                        $where = "k.idmodelodetalle=mdt.idmodelo AND k.idperiodo='$idperiodo' AND mdt.stylename = '$idestilo' AND k.idkardextienda=i.idkardextienda ANd i.idventa=v.idventadetalle AND i.estado='cambiado'
and v.fecha >= '$fechainicio'
    AND v.fecha <= '$fechafin' ";
                        $sqldev = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                        $almacenA1d =  findBySqlReturnCampoUnique($sqldev, true, true, 'devolu');
                        $tdevol = $almacenA1d['resultado'];
                        if($tdevol==NULL || $tdevol =='' || $tdevol == ""){ $tdevol="0"; }

                        //6
                        $select = "SUM(i.cantidad) AS Pares";
                        $from = "itemventa i,historialkardextienda k, ventasdetalle v,modelos mdt";
                        $where = " k.idmodelodetalle=mdt.idmodelo AND mdt.stylename = '$idestilo' AND k.idkardextienda=i.idkardextienda ANd i.idventa=v.idventadetalle AND  i.estado='cambio'
and v.fecha >= '$fechainicio'
    AND v.fecha <= '$fechafin' AND k.idperiodo='$idperiodo'";
                        $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                        $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                        $tcambio = $almacenA1['resultado'];
                        if($tcambio==NULL || $tcambio =='' || $tcambio == ""){ $tcambio="0"; }
                        //7

                        $select = "SUM(i.cantidad) AS Pares";
                        $from = "itemventa i,historialkardextienda k, ventasdetalle v,modelos mdt";
                        $where = "i.idkardextienda=k.idkardextienda ANd i.idcalzado=k.idcalzado and k.idmodelodetalle=mdt.idmodelo AND mdt.stylename = '$idestilo' AND i.idventa=v.idventadetalle AND  i.estado!='cambiado'
and v.fecha >= '$fechainicio'
    AND v.fecha <= '$fechafin' AND k.idperiodo='$idperiodo'";
                        $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                        $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                        $tventa = $almacenA1['resultado'];
                        if($tventa==NULL || $tventa =='' || $tventa == ""){ $tventa="0"; }
                        //8

                        $select = "SUM(saldocantidad) AS Pares";
                        $from = "historialkardextienda k,modelos mdt";
                        $where = " k.idmodelodetalle=mdt.idmodelo AND mdt.stylename = '$idestilo' and k.unido='no' AND k.idperiodo='$idperiodo'";
                        $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                        $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                        $tpares = $almacenA1['resultado'];
                        if($tpares==NULL || $tpares =='' || $tpares == ""){ $tpares="0"; }

                        //9
                        $select = "SUM(saldocantidad*precio2bs) AS bs";
                        $from = "historialkardextienda k,modelos mdt";
                        $where = "k.idmodelodetalle=mdt.idmodelo AND mdt.stylename = '$idestilo' and k.unido='no' AND k.idperiodo='$idperiodo'";
                        $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                        $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'bs');
                        $ttotalbs = $almacenA1['resultado'];
                        if($ttotalbs==NULL || $ttotalbs =='' || $ttotalbs == ""){ $ttotalbs="0"; }

                        $tsuma = $tstockanterior + $trecibido +$ttrasrecibido + $tregulariza -$ttrasdesp +$tdevol -$tcambio-$tventa;
                        $tdiferencia= $tpares - $tsuma ;

                    }
                    else{
                        //adicionkardextienda
                        $sqlInv = "SELECT MAX(idperiodo)AS numero
FROM administrakardex where tabla='historialkardextienda'";
                        $almacenA1 =  findBySqlReturnCampoUnique($sqlInv, true, true, 'numero');
                        $idperiodoant = $almacenA1['resultado'];
                        $select = "SUM(saldocantidad) AS Pares";
                        $from = "historialkardextienda k,modelos mdt";
                        $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND mdt.stylename = '$idestilo' AND k.idperiodo='$idperiodoant' AND k.unido='no'";
                        $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                        //echo $sql2p;
                        $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                        $tstockanterior = $almacenA1['resultado'];
                        $select = "SUM(totalpares) AS Pares";
                        $from = "adiciondetalleingreso k,adicioningresotienda ad,modelos mdt";
                        $where = " k.idingreso=ad.idingreso AND ad.idmarca='$idmarca' AND mdt.stylename = '$idestilo' and k.idmodelo=mdt.idmodelo AND k.unido='no'
AND ad.fecha >= '$fechainicio'
    AND ad.fecha <= '$fechafin' ";
                        $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                        $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                        $recibidoingreso1 = $almacenA1['resultado'];
                        $select = "SUM(totalpares) AS Pares";
                        $from = "ingresos i,adicionkardextienda k,modelos mdt";
                        $where = "  k.idkardextienda=i.idkardextienda  AND k.idmodelodetalle=mdt.idmodelo and mdt.stylename = '$idestilo'
AND i.detalle2='ingresoalmacen' AND i.fecha >= '$fechainicio'
    AND i.fecha <= '$fechafin'";
                        $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                        $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                        $ingresoalmacen2 = $almacenA1['resultado'];
                        $recibido =$recibidoingreso1+$ingresoalmacen2;
                        if($recibido==NULL || $recibido =='' || $recibido == ""){ $recibido="0"; }
                        $select = "SUM(i.cantidad) AS Pares";
                        $from = "ingresos i,adicionkardextienda k,modelos mdt";
                        $where = "k.idkardextienda=i.idkardextienda AND i.fecha >= '$fechainicio'
    AND i.fecha <= '$fechafin' and k.idmodelodetalle=mdt.idmodelo and mdt.stylename = '$idestilo' AND i.detalle2!='ingresoalmacen' ";
                        $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                        $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                        $trasrecibido = $almacenA1['resultado'];
                        if($trasrecibido==NULL || $trasrecibido =='' || $trasrecibido == ""){ $trasrecibido="0"; }

                        $select = "SUM(i.cantidad) AS Pares";
                        $from = "detalletraspaso i,adicionkardextienda k,traspasos tr,modelos mdt";
                        $where = "  k.idkardextienda=i.idkardextienda ANd i.idtraspaso=tr.idtraspaso  and k.idmodelodetalle=mdt.idmodelo and mdt.stylename = '$idestilo'
AND tr.fecha >= '$fechainicio'
    AND tr.fecha <= '$fechafin' ";
                        $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                        $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                        $trasdesp = $almacenA1['resultado'];

                        if($trasdesp==NULL || $trasdesp =='' || $trasdesp == ""){ $trasdesp="0"; }
                        $select = "SUM(i.cantidad) AS Pares";
                        $from = "itemventa i,adicionkardextienda k, ventasdetalle v,modelos mdt";
                        $where = "k.idkardextienda=i.idkardextienda ANd i.idventa=v.idventadetalle AND k.idmodelodetalle=mdt.idmodelo  and mdt.stylename = '$idestilo'
and i.estado!='cambiado' AND v.fecha >= '$fechainicio'
    AND v.fecha <= '$fechafin' ";

                        $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                        //  echo $sql2p;
                        //    d
                        $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                        $venta = $almacenA1['resultado'];
                        // $pares=$totalparesiddetalleingreso;
                        if($venta==NULL || $venta =='' || $venta == ""){ $venta="0"; }




                        $select = "SUM(k.saldocantidad) AS Pares";
                        $from = "historialkardextienda k,modelos mdt";
                        $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.stylename = '$idestilo'  AND k.unido='no'";
                        $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                        $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                        $tpares = $almacenA1['resultado'];


                        if($tpares==NULL || $tpares =='' || $tpares == ""){ $tpares="0"; }
                    }



                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$tstockanterior."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$trecibido."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$ttrasrecibido."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$tregulariza."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$ttrasdesp."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$tdevol."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$tcambio."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$tventa."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$tpares."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$ttotalbs."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$tsuma."&nbsp;</td>";
                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$tdiferencia."&nbsp;</td>";
                    $devS .= "</tr>";

                    $devS .= "</table>";

                    $dev['mensaje'] = "Existen resultados";
                    $dev['error']   = "true";
                    $dev['resultado'] = $devS;

                }
                else
                {
                    $dev['mensaje'] = "No se encontro datos en la consulta2".mysql_error();
                    $dev['error']   = "false";
                    $dev['resultado'] = "";
                }
            }
            else
            {
                $dev['mensaje'] = "Error en la consulta";
                $dev['error']   = "false";
                $dev['resultado'] = "";
            }
        }
        else
        {
            $dev['mensaje'] = "No se pudo conectar a la BD";
            $dev['error']   = "false";
            $dev['resultado'] = "";
        }
    }
    else
    {
        $dev['mensaje'] = "No se pudo crear la conexion a la BD";
        $dev['error']   = "false";
        $dev['resultado'] = "";
    }
    return $dev;
}

function verdibujotablainventarioestilo($idmarca,$idestilo,$idkardex, $return)
{
    //  echo $idkardex;
    $html = "";
    $html .= "<tr><td colspan='4' align='center'>
    <p>Nova Moda S.RL.<br />
         <br />
         Telf. 4-258993  Fax: 4-504183
    </p>
</td></tr>";
    $html .= "<!DOCTYPE HTML PUBLIC '-//W3C//DTD HTML 4.01 Transitional//EN'>";
    $html .= "<html>";
    $html .= "<body>";
    $html .= "<tr>";

    $html .= "<table cellpadding='1' cellspacing='0' border='0' style='width:100%' font-size:11px; font-family:Tahoma;'>";
    $html .= "<td style='width:100%;height:100%;text-align:right;font-size:12px;font-family:Tahoma;'>";
    $html .= "$fecha  $tipo";
    $html .= "</td>";
    $html .= "<tr>";
    $sqlmarca = " SELECT tabla,mesrango,idperiodo,fechainicio,fechafin FROM administrakardex WHERE idkardex = '$idkardex' ";
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "tabla");
    $tabla = $opcionkardex['resultado'];
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "mesrango");
    $mesrango = $opcionkardex['resultado'];
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "idperiodo");
    $idperiodo = $opcionkardex['resultado'];
    //echo $tabla;
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "fechainicio");
    $fechainicio = $opcionkardex['resultado'];
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "fechafin");
    $fechafin = $opcionkardex['resultado'];
    if($fechafin==null ||$fechafin == ""){
        $fechafin = Date("Y-m-d");}

    $formatear = explode( '-' , $fechainicio);
    $fechain = $formatear[2].'-'.$formatear[1].'-' .$formatear[0];
    $formatear = explode( '-' , $fechafin);
    $fechaf = $formatear[2].'-'.$formatear[1].'-' .$formatear[0];
    $sql = "SELECT ma.nombre AS marca,ma.talla,ma.opcionb,ma.pedido,ma.numero
FROM  `marcas` ma
WHERE ma.idmarca = '$idmarca'";

    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'marca');
    $marcalista = $idalmacenA2['resultado'];
    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'talla');
    $opcionmarca = $idalmacenA2['resultado'];
    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'opcionb');
    $opcionb = $idalmacenA2['resultado'];
    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'pedido');
    $marcapedido = $idalmacenA2['resultado'];
    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'numero');
    $numero = $idalmacenA2['resultado'];
    $idsCAr = split("-", $opcionmarca);
    $rango1=$idsCAr[0];
    $rango2=$idsCAr[1];

    if($opcionmarca="33-45"){
        $tipo="1";
        //echo $tipo;
    }else{
        if($opcionmarca="14-38"){
            $tipo="3";
        }
    }

    $sql1 = "SELECT  es.nombre AS estilo
FROM  estilos es
WHERE es.idestilo = '$idestilo'";
    $idalmacenA =  findBySqlReturnCampoUnique($sql1, true, true, 'estilo');
    $estilolista = $idalmacenA['resultado'];
    $html .= "<td style='width:100%;height:50px;text-align:center;font-size:20px;font-family:Arial;'>";
    $html .= "<b><u>INVENTARIO $marcalista</u></b><br>";
    $html .= "CORRESPONDIENTE DEL $fechain AL $fechaf<br>";
    $html .= "</td>";
    $html .= "</tr>";
    $html .= "<tr>";
    $html .= "<td style='width:100%;height:40px;text-align:left;font-size:20px;font-family:Arial;'>";
    $html .= "<b><u> $estilolista</u></b><br>";
    $html .= "</td>";
    $html .= "</tr>";
    $html .= "</table>";
    $html .= "</tr>";
    $html .= "<tr>";
    $html .= "<td colspan='3'>";
    $html .= "<table width='1250' border='0' cellspacing='0' cellpadding='0'><tr>";

    $html .= "<tr>";
    $select1 = "talla,idmodelo";
    $from1 = "tallasdetalle";
    $where1 = "talla >='$rango1' AND talla <='$rango2' AND idmodelo='2' ORDER BY talla ASC";
    $sql21 = "SELECT ".$select1." FROM ".$from1." WHERE ".$where1;
    $row = NumeroTuplas($sql21);
    $row1= $row['resultado'];

    $select = "SUM(saldocantidad) AS Pares";
    $from = "adicionkardextienda k,modelos mdt";
    $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND mdt.stylename = '$idestilo' AND k.unido='no' ";
    $sql2121 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
    $almacenA1 =  findBySqlReturnCampoUnique($sql2121, true, true, 'Pares');
    $totalparesestilo = $almacenA1['resultado'];
    $select = "SUM(saldocantidad*precio2bs) AS bs";
    $from = "adicionkardextienda k,modelos mdt";
    $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND mdt.stylename = '$idestilo' AND k.unido='no'";
    $sql2121 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
    $almacenA1 =  findBySqlReturnCampoUnique($sql2121, true, true, 'bs');
    $totalbsestilo = $almacenA1['resultado'];

    $select = "dtp.iddetalleingreso";
    $from = "adiciondetalleingreso dtp, modelos mdd, coleccion col, estilos es";
    //   $where = "dtp.idmodelo = mdd.idmodelo AND mdd.idcoleccion = col.idcoleccion AND mdd.stylename = es.idestilo AND dtp.unido='no' AND mdd.idmarca = '$idmarca' AND mdd.stylename='$idestilo'";
    $where = "dtp.idmodelo = mdd.idmodelo AND mdd.idcoleccion = col.idcoleccion AND mdd.stylename = es.idestilo AND dtp.unido='no' AND dtp.estado='activo' AND mdd.idmarca = '$idmarca' AND mdd.stylename='$idestilo'";

    // $sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where." ORDER BY CAST( `mdd`.`codigo` AS SIGNED) ASC";

    //if(($marcapedido=='CODIGO-COLOR-MATERIAL')&&($numero=='1')){
    //             //      $order = "CAST(mdd.codigo AS SIGNED) ASC,dtp.material";
    //               $order = "CAST(mdd.codigo AS SIGNED) ASC,dtp.color DESC,col.detalle ASC";
    //
    //         }else{
    //  if(($marcapedido=='CODIGO-COLOR-MATERIAL')&&($numero!='1')){
    //             //      $order = "CAST(mdd.codigo AS SIGNED) ASC,dtp.material";
    //               $order = "CAST(mdd.codigo AS SIGNED) ASC,dtp.color ASC";
    //
    //         }else{
    //                    if($marcapedido=="CODIGO-MATERIAL"){
    //                     $order = "CAST(mdd.codigo AS SIGNED) ASC,dtp.material ASC";
    //                   }else{
    //                     if(($marcapedido=="CODIGO-COLOR")||($marcapedido=="CODIGO")){
    //                    $order = "CAST(mdd.codigo AS SIGNED) ASC";
    //
    //                   }else{
    //                      if($marcapedido=="CODIGO-COLOR-STYLENAME"){
    //                    $order = "CAST(mdd.codigo AS SIGNED) ASC";
    //                   }else{
    //                     if($marcapedido=="LINEA-CODIGO-COLOR"){
    //                  //   $select .= ",concat(l.codigo,'-',mdd.codigo) AS codigo, dtp.color AS color";
    //                     $from .= ",lineas l";
    //                     $where .= "AND mdd.idlinea = l.idlinea";
    //
    //                    $order = " l.codigo ASC ,mdd.codigo ASC";
    //
    //                   }
    //                 }
    //
    //                }
    //              }
    //           }
    //}
    if($idmarca=="mar-2"){
        $order = "dtp.numeracion DESC,CAST(mdd.codigo AS SIGNED) ASC,dtp.material ASC";
    }
    if($idmarca=="mar-1"){
        $order = "dtp.numeracion DESC,CAST(mdd.codigo AS SIGNED) ASC,dtp.color ASC,col.detalle ASC";
    }
    if($idmarca=="mar-5"){
        $from .= ",lineas l";
        $where .= "AND mdd.idlinea = l.idlinea";
        $order = " l.codigo ASC ,mdd.codigo ASC";
    }

    $sql25 = "SELECT ".$select." FROM ".$from. " WHERE ".$where." ORDER BY ".$order;

    //  echo $sql25;
    $table = dibujarTablaporestilototal($idkardex,$sql25,$sql21,$row1,$idmarca,$idestilo,$rango1,$rango2,$totalparesestilo,$totalbsestilo, $tipo,$marcapedido);

    //$table = dibujarTablaOfSQLinventarioVentasTotal($idkardex,$sql25,$sql21,$row1,$idmarca,$idestilo,$rango1,$rango2,$totalparesestilo,$totalbsestilo, $tipo,$marcapedido);

    $html .= $table['resultado'];
    $html .= "</tr>";
    $html .= "</table>";
    $html .= "</td></tr>";

    $html .= "</tr>";
    $html .= "</table>";
    $html .= "</body>";
    $html .= "</html>";
    if($return == true)
    {
        return $html;
    }
    else
    {
        echo $html;
    }
}
function verdibujotablainventario($idmarca,$idestilo,$idkardex, $return)
{set_time_limit(0);
    $html = "";
    $html .= "<tr><td colspan='4' align='center'>
    <p>Nova Moda S.RL.<br />
         <br />
         Telf. 4-258993  Fax: 4-504183
    </p>
</td></tr>";

    $html .= "<!DOCTYPE HTML PUBLIC '-//W3C//DTD HTML 4.01 Transitional//EN'>";
    $html .= "<html>";
    $html .= "<body>";
    $html .= "<tr>";

    $html .= "<table cellpadding='1' cellspacing='0' border='0' style='width:100%' font-size:11px; font-family:Tahoma;'>";
    $html .= "<td style='width:100%;height:100%;text-align:right;font-size:12px;font-family:Tahoma;'>";
    $html .= "$fecha  $tipo";
    $html .= "</td>";
    $html .= "<tr>";
    $sql = "SELECT ma.nombre AS marca,ma.talla,ma.opcionb,ma.pedido
FROM  `marcas` ma
WHERE ma.idmarca = '$idmarca'";

    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'marca');
    $marcalista = $idalmacenA2['resultado'];
    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'talla');
    $opcionmarca = $idalmacenA2['resultado'];
    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'opcionb');
    $opcionb = $idalmacenA2['resultado'];
    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'pedido');
    $marcapedido = $idalmacenA2['resultado'];
    $idsCAr = split("-", $opcionmarca);
    $rango1=$idsCAr[0];
    $rango2=$idsCAr[1];
    if($opcionmarca="33-45"){
        $tipo="1";
    }else{
        if($opcionmarca="14-38"){
            $tipo="3";
        }
    }
    $sqlmarca = " SELECT tabla,mesrango,idperiodo,fechainicio,fechafin FROM administrakardex WHERE idkardex = '$idkardex' ";
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "tabla");
    $tabla = $opcionkardex['resultado'];
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "mesrango");
    $mesrango = $opcionkardex['resultado'];
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "idperiodo");
    $idperiodo = $opcionkardex['resultado'];
    //echo $tabla;
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "fechainicio");
    $fechainicio = $opcionkardex['resultado'];
    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "fechafin");
    $fechafin = $opcionkardex['resultado'];
    if($fechafin==null ||$fechafin == ""){
        $fechafin = Date("Y-m-d");}

    $formatear = explode( '-' , $fechainicio);
    $fechain = $formatear[2].'-'.$formatear[1].'-' .$formatear[0];
    $formatear = explode( '-' , $fechafin);
    $fechaf = $formatear[2].'-'.$formatear[1].'-' .$formatear[0];
    $html .= "<td style='width:100%;height:50px;text-align:center;font-size:20px;font-family:Arial;'>";
    $html .= "<b><u>INVENTARIO $marcalista</u></b><br>";
    $html .= "CORRESPONDIENTE DEL $fechain AL $fechaf<br>";
    $html .= "</td>";

    // $html .= "CORRESPONDIENTE DEL $estilolista AL $fechaf<br>";

    $html .= "</tr>";
    $html .= "<tr>";
    $html .= "<td style='width:100%;height:40px;text-align:left;font-size:20px;font-family:Arial;'>";
    $html .= "<b><u> $estilolista</u></b><br>";
    $html .= "</td>";
    $html .= "</tr>";
    $html .= "</table>";
    $html .= "</tr>";
    $html .= "<tr>";
    $html .= "<td colspan='3'>";
    $html .= "<table width='1250' border='0' cellspacing='0' cellpadding='0'><tr>";

    $select = "idestilo,nombre";
    $from = "estilos";
    $where .= " descripcion = '$idmarca' and estado ='activo' ORDER BY ordennumero ASC";
    $sql2 = "SELECT ".$select." FROM ".$from." WHERE ".$where;
    $row = NumeroTuplas($sql2);
    $row1= $row['resultado'];
    $sql21 = getTablaToArrayOfSQL($sql2);
    $sql3 = $sql21['resultado'];
    $row5 = NumeroTuplas($sql2);
    $row15= $row5['resultado'];
    //    $html .= "<td style='width:100%;text-align:center;font-size:1px;font-family:Tahoma;'>";
    $html .= "<table cellpadding='0' cellspacing='0' border='0' style='width:100%;border:0px solid #000000;font-size:14px;text-align:center'>";
    $html .= "<tr>";

    for($i=0;$i<=$row15;$i++){
        $codigo = $sql3[$i];
        $idestilo = $codigo['idestilo'];
        $nombreestilo = $codigo['nombre'];
        $html .= "<tr style='width:100%; font-size:14px;'>";
        $html .=" <td style='font-size:14px;text-align:left'><b>".$nombreestilo."</b>";
        $html .=" </td> ";
        $html .= "</tr>";
        $html .= "<tr>";
        $select1 = "talla,idmodelo";
        $from1 = "tallasdetalle";
        $where1 = "talla >='$rango1' AND talla <='$rango2' AND idmodelo='2' ORDER BY talla ASC";
        $sql21 = "SELECT ".$select1." FROM ".$from1." WHERE ".$where1;
        $row = NumeroTuplas($sql21);
        $row1= $row['resultado'];

        $select = "SUM(saldocantidad) AS Pares";
        $from = "adicionkardextienda k,modelos mdt";
        $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND mdt.stylename = '$idestilo' AND k.unido='no'";
        $sql2121 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
        $almacenA1 =  findBySqlReturnCampoUnique($sql2121, true, true, 'Pares');
        $totalparesestilo = $almacenA1['resultado'];
        $select = "SUM(saldocantidad*precio2bs) AS bs";
        $from = "adicionkardextienda k,modelos mdt";
        $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND mdt.stylename = '$idestilo' AND k.unido='no' ";
        $sql2121 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
        $almacenA1 =  findBySqlReturnCampoUnique($sql2121, true, true, 'bs');
        $totalbsestilo = $almacenA1['resultado'];


        switch ($idmarca){
            case "mar-2" :
                $order = "dtp.numeracion DESC,CAST(mdd.codigo AS SIGNED) ASC,dtp.material ASC";
                break;
                case "mar-1" :
                    $order = "dtp.numeracion DESC,CAST(mdd.codigo AS SIGNED) ASC,dtp.color ASC,col.detalle ASC";
                    break;
                    case "mar-5" :
                        $from .= ",lineas l";
                        $where .= "AND mdd.idlinea = l.idlinea";
                        $order = " l.codigo ASC ,mdd.codigo ASC";
                        break;
                        case "mar-28" :
                            $order = "CAST(mdd.codigo AS SIGNED) ASC ,dtp.color ASC";
                            break;
                            case "mar-6" :
                                $order = "dtp.numeracion ASC,CAST(mdd.codigo AS SIGNED) ASC ,dtp.color ASC";
                                break;
                                case "mar-16" :
                                    $order = "CAST(mdd.codigo AS SIGNED) ASC ,dtp.color ASC";
                                    break;
                                    case "mar-12" :
                                        $order = "CAST(mdd.codigo AS SIGNED) desc ,dtp.color desc";
                                        break;
                                        case "mar-7" :
                                            $order = "dtp.numeracion ASC, CAST(mdd.codigo AS SIGNED) ASC";
                                            break;
                                            case "mar-4" :
                                                $from .= ",lineas l";
                                                $where .= "AND mdd.idlinea = l.idlinea";
                                                $order = " l.codigo ASC ,mdd.codigo ASC";
                                                break;
                                                case "mar-8" :
                                                    $order = "dtp.numeracion ASC, mdd.codigo ASC,dtp.color ASC";
                                                    break;
                                                    case "mar-25" :
                                                        $order = "dtp.numeracion ASC, mdd.codigo ASC,dtp.color ASC";
                                                        break;
                                                        default:
                                                            $order = "CAST(mdd.codigo AS SIGNED) ASC";
                                                        }

                                                        //update lorgio UPDATE lineas SET codigo = (UPPER(codigo))
                                                        //UPDATE adiciondetalleingreso SET color = (UPPER(color))
                                                        $select = "dtp.iddetalleingreso";
                                                        $from = "adiciondetalleingreso dtp, modelos mdd, coleccion col, estilos es";
                                                        $where = "dtp.idmodelo = mdd.idmodelo AND mdd.idcoleccion = col.idcoleccion AND mdd.stylename = es.idestilo AND dtp.unido='no' AND dtp.estado='activo' AND mdd.idmarca = '$idmarca' AND mdd.stylename='$idestilo'";

                                                        // $where = "dtp.idmodelo = mdd.idmodelo AND mdd.idcoleccion = col.idcoleccion AND mdd.stylename = es.idestilo AND dtp.unido='no' AND mdd.idmarca = '$idmarca' AND mdd.stylename='$idestilo'";
                                                        // $sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where." ORDER BY CAST( `mdd`.`codigo` AS SIGNED) ASC";

                                                        $sql25 = "SELECT ".$select." FROM ".$from. " WHERE ".$where."ORDER BY ".$order;
                                                        //echo $sql25;
                                                        $table = dibujarTablaporestilototal($idkardex,$sql25,$sql21,$row1,$idmarca,$idestilo,$rango1,$rango2,$totalparesestilo,$totalbsestilo, $tipo,$marcapedido);

                                                        $html .= $table['resultado'];
                                                        $html .= "</tr>";
                                                        //       ss
                                                    }
                                                    //totales de totales
                                                    $html .= "</tr>";
                                                    $html .= "</table>";

                                                    $html .= "<table cellpadding='1' cellspacing='0' border='0' style='width:100%' font-size:25px; font-family:Tahoma;'>";
                                                    $html .= "<tr style='width:100%;height:50%;text-align:right;font-size:25px;font-family:Tahoma;'>";


                                                    if($tabla=="historialkardextienda"){
                                                        $select = "SUM( k.precio2bs * k.saldocantidad) As bs";
                                                        $from = "historialkardextienda k,modelos mdt";
                                                        $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND k.idperiodo='$idperiodo' AND k.unido='no'";
                                                        $sql2121 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                                                        $almacenA1 =  findBySqlReturnCampoUnique($sql2121, true, true, 'bs');
                                                        $totalparesbs = $almacenA1['resultado'];


                                                        $select = "SUM(k.saldocantidad) As par";
                                                        $from = "historialkardextienda k,modelos mdt";
                                                        $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND k.idperiodo='$idperiodo' AND k.unido='no'";
                                                        $sql2121 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                                                        $almacenA1 =  findBySqlReturnCampoUnique($sql2121, true, true, 'par');
                                                        $totalpares = $almacenA1['resultado'];
                                                        //echo $sql2121;
                                                    }else{
                                                        $select = "SUM( k.precio2bs * k.saldocantidad) As bs";
                                                        $from = "adicionkardextienda k,modelos mdt";
                                                        $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND k.unido='no'";
                                                        $sql2121 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                                                        $almacenA1 =  findBySqlReturnCampoUnique($sql2121, true, true, 'bs');
                                                        $totalparesbs = $almacenA1['resultado'];


                                                        $select = "SUM(k.saldocantidad) As bs";
                                                        $from = "adicionkardextienda k,modelos mdt";
                                                        $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND k.unido='no' ";
                                                        $sql2121 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                                                        $almacenA1 =  findBySqlReturnCampoUnique($sql2121, true, true, 'bs');
                                                        $totalpares = $almacenA1['resultado'];
                                                    }

                                                    $html .= "<td style='width:100%;text-align:center;font-size:1px;font-family:Tahoma;'>";
                                                    $html .= "<table cellpadding='0' cellspacing='0' border='1' style='width:100%;border:1px solid #000000;font-size:11px;text-align:center'>";

                                                    $html .= "<tr><td style='font-size:11px;font-weight:bold;'>Pares $marcalista:</td><td>".$totalpares."</td></tr>";
                                                    $html .= "<tr><td style='font-size:11px;font-weight:bold;'>Bs  $marcalista:</td><td>".$totalparesbs."</td></tr>";
                                                    $html .= "</table>";

                                                    $html .= "</td></tr>";

                                                    //    $producto2 = dibujarTuplaOfSQLSimpleinventario($sqltotalpares,$totalpares,$totalparesbs);
                                                    //    $html .= $producto2['resultado'];
                                                    //    $html .= "</tr>";
                                                    $html .= "</table>";

                                                    $html .= "</body>";
                                                    $html .= "</html>";
                                                    if($return == true)
                                                    {
                                                        return $html;
                                                    }
                                                    else
                                                    {
                                                        echo $html;
                                                    }
                                                }
                                                function dibujarTablaporestilototal($idkardex,$sql,$sql21,$row1,$idmarca,$idestilo,$rango1,$rango2,$total1,$total2, $tipo,$marcapedido)
                                                {set_time_limit(0);
                                                    //reportegrande
                                                    $sqlmarca = " SELECT tabla,mesrango,idperiodo,fechainicio,fechafin FROM administrakardex WHERE idkardex = '$idkardex' ";
                                                    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "tabla");
                                                    $tabla = $opcionkardex['resultado'];
                                                    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "mesrango");
                                                    $mesrango = $opcionkardex['resultado'];
                                                    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "idperiodo");
                                                    $idperiodo = $opcionkardex['resultado'];
                                                    //echo $tabla;
                                                    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "fechainicio");
                                                    $fechainicio = $opcionkardex['resultado'];
                                                    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "fechafin");
                                                    $fechafin = $opcionkardex['resultado'];
                                                    //AND k.idperiodo='$idperiodo'

                                                    if($fechafin==null ||$fechafin == ""){
                                                        $fechafin = Date("Y-m-d");
                                                    }
                                                    if($tabla=="historialkardextienda"){
                                                    }else{
                                                        $sqlInv = "SELECT MAX(idperiodo)AS numero
FROM administrakardex where tabla='historialkardextienda'";
                                                        $almacenA1 =  findBySqlReturnCampoUnique($sqlInv, true, true, 'numero');
                                                        $idperiodoant = $almacenA1['resultado'];
                                                        $sqlmarca = " SELECT tabla,mesrango,idperiodo,fechainicio,fechafin FROM administrakardex WHERE idperiodo = '$idperiodoant' ";
                                                        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "fechainicio");
                                                        // $fechainicio = $opcionkardex['resultado'];
                                                        $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "fechafin");
                                                        // $fechafin = $opcionkardex['resultado'];
                                                    }
                                                    $sql211 = getTablaToArrayOfSQL($sql21);
                                                    $sql3 = $sql211['resultado'];
                                                    if($link=new BD)
                                                    {
                                                        if($link->conectar())
                                                        {
                                                            if($re = $link->consulta($sql))
                                                            {
                                                                //echo mysql_num_rows($re);
                                                                if($fi = mysql_fetch_array($re))
                                                                {
                                                                    $devS .= "<table cellpadding='0' cellspacing='0' border='0' style='width:1250px;border:1px solid #000000;font-size:13px;font-family:Arial;'>";

                                                                    //                    $devS .= "<table cellpadding='0' cellspacing='0' border='0' style='width:1250px;border:1px solid #000000;font-size:13px;font-family:Arial'>";
                                                                    $devS .= "<tr><td style='border-bottom:1px solid #000000;font-weight:bold;font-size:10px;text-align:center;background-color:silver;'>Nro</td>";
                                                                    $devS .= "<td style='display:none;'>".mysql_field_name($re, $zz)."</td>";
                                                                    // $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Modelo</td>";
                                                                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:12px;text-align:center;background-color:silver;'>Modelo</td>";
                                                                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:12px;text-align:center;background-color:silver;'>Color</td>";
                                                                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:12px;text-align:center;background-color:silver;'>Precio</td>";
                                                                    for($hi=0;$hi<$row1;$hi++){
                                                                        $codigo = $sql3[$hi];
                                                                        $idmmarca = $codigo['talla'];

                                                                        $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:13px;text-align:center;background-color:silver;'>$idmmarca</td>";
                                                                        $ji++;
                                                                    }
                                                                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Anterior</td>";
                                                                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Rec</td>";
                                                                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Tras.Rec</td>";
                                                                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Dev</td>";

                                                                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Tras.Des</td>";
                                                                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Venta</td>";


                                                                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Prs Actual</td>";

                                                                    $devS .= "</tr>";
                                                                    $ii = 0;
                                                                    //$totalCount = mysql_num_rows($re);
                                                                    $z = 1;
                                                                    do{
                                                                        $devS .= "<tr><td style='text-align:left'>".$z."</td>";
                                                                        for($i = 0; $i< mysql_num_fields($re); $i++)
                                                                        {$dato = $fi[$i];
                                                                            $iddetalleingreso = $fi[$i]['iddetalleingreso'];

                                                                            $devS .= "<td style='display:none;'>&nbsp;".$dato."&nbsp;</td>";
                                                                            // echo $marcapedido;
                                                                            $sql = "SELECT ma.numero
FROM  `marcas` ma
WHERE ma.idmarca = '$idmarca'";

                                                                            $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'numero');
                                                                            $numero = $idalmacenA2['resultado'];

                                                                            $select = "dtp.totalbs AS precio";
                                                                            $from = "adiciondetalleingreso dtp, modelos mdd, coleccion col, estilos es";
                                                                            $where = "dtp.idmodelo = mdd.idmodelo AND mdd.idcoleccion = col.idcoleccion AND mdd.stylename = es.idestilo AND dtp.iddetalleingreso='$dato'";

                                                                            if(($marcapedido=='CODIGO-COLOR-MATERIAL')&&($numero=='1')){
                                                                                $select .= ",CONCAT(col.detalle,'-',mdd.codigo) AS codigo, UPPER(dtp.color) AS color";
                                                                                // $select .= ",concat(col.detalle,'-',mdd.codigo) AS codigo, dtp.color";
                                                                            }else{
                                                                                if(($marcapedido=='CODIGO-COLOR-MATERIAL')&&($numero!='1')){
                                                                                    $select .= ",UPPER(mdd.codigo) AS codigo, UPPER(dtp.color) AS color";
                                                                                    // $select .= ",concat(col.detalle,'-',mdd.codigo) AS codigo, dtp.color";
                                                                                }else{
                                                                                    if($marcapedido=="CODIGO-MATERIAL"){
                                                                                        $select .= ",mdd.codigo, UPPER(dtp.material)AS color";
                                                                                    }else{
                                                                                        if(($marcapedido=="CODIGO-COLOR")||($marcapedido=="CODIGO")){
                                                                                            $select .= ",UPPER(mdd.codigo) As codigo, UPPER(dtp.color)AS color";

                                                                                        }else{
                                                                                            if($marcapedido=="CODIGO-COLOR-STYLENAME"){
                                                                                                $select .= ",concat(mdd.codigo,'-',dtp.color) AS codigo, dtp.material AS color";
                                                                                            }else{
                                                                                                if($marcapedido=="LINEA-CODIGO-COLOR"){
                                                                                                    $select .= ",concat(l.codigo,'-',mdd.codigo) AS codigo, dtp.color AS color";
                                                                                                    //  $select .= ",concat(mdd.codigo,'-',dtp.color) AS codigo, dtp.material AS color";
                                                                                                    $from .= ",lineas l";
                                                                                                    $where .= "AND mdd.idlinea = l.idlinea";

                                                                                                }
                                                                                            }

                                                                                        }
                                                                                    }
                                                                                }
                                                                            }

                                                                            // $from = "adiciondetalleingreso dtp, modelos mdd, coleccion col, estilos es";
                                                                            //$where = "dtp.idmodelo = mdd.idmodelo AND mdd.idcoleccion = col.idcoleccion AND mdd.stylename = es.idestilo AND dtp.iddetalleingreso='$dato'";
                                                                            $sql2p1 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                                                                            //  $sql2p1 = "SELECT ".$select." FROM ".$from. " WHERE ".$where."ORDER BY ".$order;

                                                                            //      $sql2p1 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                                                                            //echo $sql2p1;
                                                                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p1, true, true, 'codigo');
                                                                            $modelo = $almacenA1['resultado'];
                                                                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p1, true, true, 'color');
                                                                            $color = $almacenA1['resultado'];
                                                                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p1, true, true, 'precio');
                                                                            $precio = $almacenA1['resultado'];
                                                                            $devS .= "<td style='text-align:left;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$modelo."&nbsp;</td>";
                                                                            $devS .= "<td style='text-align:left;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$color."&nbsp;</td>";
                                                                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$precio."&nbsp;</td>";

                                                                            //lorg
                                                                            for($h=0;$h<$row1;$h++){
                                                                                $codigo = $sql3[$h];
                                                                                $idmmarca = $codigo['talla'];

                                                                                if($tabla=="historialkardextienda"){
                                                                                    // if( saldocantidad = '0', '', saldocantidad ) AS Pares,
                                                                                    // $select1 = "saldocantidad AS Pares";
                                                                                    $select1 = "saldocantidad AS Pares";
                                                                                    $from1 = "historialkardextienda";
                                                                                    $where1 = "idcalzado = '$dato' AND talla='$idmmarca' AND idperiodo='$idperiodo'";
                                                                                    //if($ltienda != "Todos"){ $where .= " AND ve.idtienda = '$ltienda' ";}
                                                                                    $sql21 = "SELECT ".$select1." FROM ".$from1. " WHERE ".$where1;
                                                                                    //echo $sql21;
                                                                                    $almacenA1 =  findBySqlReturnCampoUnique($sql21, true, true, 'Pares');
                                                                                    $pares1 = $almacenA1['resultado'];
                                                                                }else{
                                                                                    $select1 = "saldocantidad AS Pares";
                                                                                    $from1 = "adicionkardextienda";
                                                                                    $where1 = "idcalzado = '$dato' AND talla='$idmmarca'";
                                                                                    //if($ltienda != "Todos"){ $where .= " AND ve.idtienda = '$ltienda' ";}
                                                                                    $sql21 = "SELECT ".$select1." FROM ".$from1. " WHERE ".$where1;

                                                                                    $almacenA1 =  findBySqlReturnCampoUnique($sql21, true, true, 'Pares');
                                                                                    $pares1 = $almacenA1['resultado'];

                                                                                }

                                                                                //  if($pares1==NULL || $pares1 =='' || $pares1 == ""){ $pares1="0"; }
                                                                                $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$pares1."&nbsp;</td>";
                                                                                $j++;
                                                                            }

                                                                            if($tabla=="historialkardextienda"){
                                                                                $sqlInv = "SELECT MAX(idperiodo)AS numero
FROM administrakardex where tabla='historialkardextienda'";
                                                                                $almacenA1 =  findBySqlReturnCampoUnique($sqlInv, true, true, 'numero');
                                                                                $idperiodoant = $almacenA1['resultado'];
                                                                                $idper = $idperiodoant - 1;
                                                                                $select = "SUM(saldocantidad) AS Pares";
                                                                                $from = "historialkardextienda k";
                                                                                $where = " k.idcalzado='$dato' AND k.idperiodo='$idper' AND k.unido='no'";
                                                                                $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                                                                                $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                                                                                $stockanterior = $almacenA1['resultado'];
                                                                            }
                                                                            else{
                                                                                $sqlInv = "SELECT MAX(idperiodo)AS numero
FROM administrakardex where tabla='historialkardextienda'";
                                                                                $almacenA1 =  findBySqlReturnCampoUnique($sqlInv, true, true, 'numero');
                                                                                $idperiodoant = $almacenA1['resultado'];
                                                                                //  echo $idperiodoant;
                                                                                $select = "SUM(saldocantidad) AS Pares";
                                                                                $from = "historialkardextienda k";
                                                                                $where = " k.idcalzado='$dato' AND k.idperiodo='$idperiodoant' AND k.unido='no'";
                                                                                $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                                                                                $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                                                                                $stockanterior = $almacenA1['resultado'];

                                                                            }

                                                                            // $pares=$totalparesiddetalleingreso;
                                                                            ////  echo $sqlInv;
                                                                            if($stockanterior==NULL || $stockanterior =='' || $stockanterior == ""){ $stockanterior="0"; }

                                                                            $select = "SUM( dtpt.cantidad ) AS Pares";
                                                                            $from = "adicioningresotienda k, adiciondetalleingresotalla dtpt, adiciondetalleingreso ad, modelos mdd";
                                                                            $where = "k.idingreso = dtpt.idingreso AND dtpt.idmodelo = mdd.idmodelo
AND dtpt.iddetalleingreso = ad.iddetalleingreso";
                                                                            { $where .= " AND k.fecha >= '$fechainicio' AND
k.fecha <= '$fechafin' AND  dtpt.iddetalleingreso='$dato'";}
                                                                            if($idestilo !="null")
                                                                            { $where .= " AND mdd.stylename = '$idestilo'";}
                                                                            $sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where;
                                                                            $almacenA1 =  findBySqlReturnCampoUnique($sql25, true, true, 'Pares');
                                                                            $recibido = $almacenA1['resultado'];

                                                                            $select = "SUM(i.cantidad) AS Pares";
                                                                            $from = "ingresos i,adicionkardextienda k";
                                                                            $where = " k.idcalzado='$dato' AND k.idkardextienda=i.idkardextienda AND i.fecha >= '$fechainicio'
    AND i.fecha <= '$fechafin' AND i.detalle2!='ingresoalmacen' ";
                                                                            $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                                                                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                                                                            $trasrecibido = $almacenA1['resultado'];
                                                                            //     if($trasrecibido==NULL || $trasrecibido =='' || $trasrecibido == ""){ $trasrecibido="0";   }
                                                                            $select = "SUM(i.cantidad) AS Pares";
                                                                            $from = "itemventa i,adicionkardextienda k, ventasdetalle v";
                                                                            $where = " k.idcalzado='$dato' AND k.idkardextienda=i.idkardextienda ANd i.idventa=v.idventadetalle AND  i.estado='cambiado'
and v.fecha >= '$fechainicio'
    AND v.fecha <= '$fechafin' ";
                                                                            $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                                                                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                                                                            $devueltos = $almacenA1['resultado'];
                                                                            // $pares=$totalparesiddetalleingreso;
                                                                            // if($devueltos==NULL || $devueltos =='' || $devueltos == ""){ $devueltos="0"; }


                                                                            $select = "SUM(i.cantidad) AS Pares";
                                                                            $from = "detalletraspaso i,adicionkardextienda k,traspasos tr";
                                                                            $where = " k.idcalzado='$dato' AND k.idkardextienda=i.idkardextienda ANd i.idtraspaso=tr.idtraspaso AND tr.fecha >= '$fechainicio'
    AND tr.fecha <= '$fechafin' ";
                                                                            $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                                                                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                                                                            $trasdesp = $almacenA1['resultado'];

                                                                            //  if($trasdesp==NULL || $trasdesp =='' || $trasdesp == ""){ $trasdesp="0"; }
                                                                            $select = "SUM(i.cantidad) AS Pares";
                                                                            $from = "itemventa i,adicionkardextienda k, ventasdetalle v";
                                                                            $where = " k.idcalzado='$dato' AND k.idkardextienda=i.idkardextienda ANd i.idventa=v.idventadetalle AND  i.estado!='cambiado'
and v.fecha >= '$fechainicio'
    AND v.fecha <= '$fechafin' ";
                                                                            $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                                                                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                                                                            $venta = $almacenA1['resultado'];
                                                                            // $pares=$totalparesiddetalleingreso;
                                                                            if($venta==NULL || $venta =='' || $venta == ""){ $venta="0"; }
                                                                            if($tabla=="historialkardextienda"){

                                                                                $select = "SUM(saldocantidad) AS Pares";
                                                                                $from = "historialkardextienda k";
                                                                                $where = " k.idcalzado='$dato' and k.unido='no' AND k.idperiodo='$idperiodo'";
                                                                                $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                                                                                $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                                                                                $pares = $almacenA1['resultado'];
                                                                            }else{
                                                                                $select = "SUM(saldocantidad) AS Pares";
                                                                                $from = "adicionkardextienda k";
                                                                                $where = " k.idcalzado='$dato' and k.unido='no'";
                                                                                $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                                                                                $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                                                                                $pares = $almacenA1['resultado'];

                                                                            }
                                                                            if($tabla=="historialkardextienda"){
                                                                                $select = "SUM(saldocantidad*precio2bs) AS Pares";
                                                                                $from = "historialkardextienda k";
                                                                                $where = " k.idcalzado='$dato' and k.unido='no' AND k.idperiodo='$idperiodo'";
                                                                                $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                                                                                $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                                                                                $totalbs = $almacenA1['resultado'];
                                                                            }else{
                                                                                $select = "SUM(saldocantidad*precio2bs) AS bs";
                                                                                $from = "adicionkardextienda k";
                                                                                $where = " k.idcalzado='$dato' and k.unido='no'";
                                                                                $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                                                                                $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'bs');
                                                                                $totalbs = $almacenA1['resultado'];
                                                                            }
                                                                            // $pares=$totalparesiddetalleingreso;

                                                                            // if($pares==NULL || $pares =='' || $pares == ""){ $pares="0"; }



                                                                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$stockanterior."&nbsp;</td>";
                                                                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$recibido."&nbsp;</td>";
                                                                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$trasrecibido."&nbsp;</td>";
                                                                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$devueltos."&nbsp;</td>";

                                                                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$trasdesp."&nbsp;</td>";
                                                                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$venta."&nbsp;</td>";

                                                                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$pares."</td>";

                                                                            //$devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$totalbs."&nbsp;</td>";

                                                                        }
                                                                        $devS .= "</tr>";
                                                                        $ii++;
                                                                        $z ++;
                                                                    }while($fi = mysql_fetch_array($re));
                                                                    //$devS .= "<tr><td style='border:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Total</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td style='border:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>$totalparesestilo</td><td style='border:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>$totalbsestilo</td>";
                                                                    $devS .= "<tr style='background-color:silver;'><td style='border: 1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'></td>";
                                                                    $devS .= "<td style='display:none;'></td>";
                                                                    $fechatoday = Date("d-m-Y");
                                                                    $devS .= "<td style='text-align:center;border-bottom: 1px solid #000000;background-color:silver;'>TOTAL</td>";
                                                                    $devS .= "<td style='text-align:center;border-bottom: 1px solid #000000;'></td>";
                                                                    $devS .= "<td style='text-align:center;border-bottom: 1px solid #000000;'></td>";

                                                                    for($h=0;$h<$row1;$h++){
                                                                        $codigo = $sql3[$h];
                                                                        $idmmarca = $codigo['idmarca'];

                                                                        $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'></td>";
                                                                        $j++;
                                                                    }

                                                                    if($tabla=="historialkardextienda"){
                                                                        $sqlInv = "SELECT MAX(idperiodo)AS numero
FROM administrakardex where tabla='historialkardextienda'";
                                                                        $almacenA1 =  findBySqlReturnCampoUnique($sqlInv, true, true, 'numero');
                                                                        $idperiodoant = $almacenA1['resultado'];
                                                                        $idper = $idperiodoant - 1;
                                                                        $select = "SUM(saldocantidad) AS Pares";
                                                                        $from = "historialkardextienda k,modelos mdt";
                                                                        $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND mdt.stylename = '$idestilo' AND k.idperiodo='$idper' AND k.unido='no'";
                                                                        $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                                                                        $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                                                                        $tstockant = $almacenA1['resultado'];
                                                                    }
                                                                    else{
                                                                        $sqlInv = "SELECT MAX(idperiodo)AS numero
FROM administrakardex where tabla='historialkardextienda'";
                                                                        $almacenA1 =  findBySqlReturnCampoUnique($sqlInv, true, true, 'numero');
                                                                        $idperiodoant = $almacenA1['resultado'];
                                                                        $select = "SUM(saldocantidad) AS Pares";
                                                                        $from = "historialkardextienda k,modelos mdt";
                                                                        $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND mdt.stylename = '$idestilo' AND k.idperiodo='$idperiodoant' AND k.unido='no'";
                                                                        $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                                                                        //echo $sql2p;
                                                                        $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                                                                        $tstockant = $almacenA1['resultado'];
                                                                    }

                                                                    //reseteo
                                                                    $select = "SUM( dtpt.cantidad ) AS Pares";
                                                                    $from = "adicioningresotienda k, adiciondetalleingresotalla dtpt, adiciondetalleingreso ad, modelos mdd";
                                                                    $where = "k.idingreso = dtpt.idingreso AND dtpt.idmodelo = mdd.idmodelo
AND dtpt.iddetalleingreso = ad.iddetalleingreso";
                                                                    { $where .= " AND mdd.stylename = '$idestilo' AND k.fecha >= '$fechainicio' AND
k.fecha <= '$fechafin' ";}

                                                                    $sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where;

                                                                    $almacenA1 =  findBySqlReturnCampoUnique($sql25, true, true, 'Pares');
                                                                    $recibido = $almacenA1['resultado'];
                                                                    if($recibido==NULL || $recibido =='' || $recibido == ""){ $recibido="0"; }

                                                                    $select = "SUM(i.cantidad) AS Pares";
                                                                    $from = "ingresos i,adicionkardextienda k,modelos mdt";
                                                                    $where = "k.idkardextienda=i.idkardextienda AND i.fecha >= '$fechainicio'
    AND i.fecha <= '$fechafin' and k.idmodelodetalle=mdt.idmodelo and mdt.stylename = '$idestilo' AND i.detalle2!='ingresoalmacen' ";
                                                                    $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                                                                    $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                                                                    $trasrecibido = $almacenA1['resultado'];
                                                                    if($trasrecibido==NULL || $trasrecibido =='' || $trasrecibido == ""){ $trasrecibido="0"; }

                                                                    //$select = "SUM(i.cantidad) AS Pares";
                                                                    //    $from = "itemventa i,adicionkardextienda k, ventasdetalle v,modelos mdt";
                                                                    //    $where = "k.idkardextienda=i.idkardextienda ANd i.idventa=v.idventadetalle AND k.idmodelodetalle=mdt.idmodelo  and mdt.stylename = '$idestilo'
                                                                    //and i.estado!='cambiado' AND v.fecha >= '$fechainicio'
                                                                    //    AND v.fecha <= '$fechafin' ";

                                                                    $select = "SUM(i.cantidad) AS Pares";
                                                                    $from = "itemventa i,adicionkardextienda k, ventasdetalle v,modelos mdt";
                                                                    $where = " k.idkardextienda=i.idkardextienda ANd i.idventa=v.idventadetalle AND k.idmodelodetalle=mdt.idmodelo  and mdt.stylename = '$idestilo'
AND  i.estado='cambiado'
and v.fecha >= '$fechainicio'
    AND v.fecha <= '$fechafin' ";
                                                                    $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                                                                    $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                                                                    $devueltos = $almacenA1['resultado'];
                                                                    // $pares=$totalparesiddetalleingreso;
                                                                    if($devueltos==NULL || $devueltos =='' || $devueltos == ""){ $devueltos="0"; }


                                                                    $select = "SUM(i.cantidad) AS Pares";
                                                                    $from = "detalletraspaso i,adicionkardextienda k,traspasos tr,modelos mdt";
                                                                    $where = "  k.idkardextienda=i.idkardextienda ANd i.idtraspaso=tr.idtraspaso  and k.idmodelodetalle=mdt.idmodelo and mdt.stylename = '$idestilo'
AND tr.fecha >= '$fechainicio'
    AND tr.fecha <= '$fechafin' ";
                                                                    $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                                                                    $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                                                                    $trasdesp = $almacenA1['resultado'];

                                                                    if($trasdesp==NULL || $trasdesp =='' || $trasdesp == ""){ $trasdesp="0"; }
                                                                    $select = "SUM(i.cantidad) AS Pares";
                                                                    $from = "itemventa i,adicionkardextienda k, ventasdetalle v,modelos mdt";
                                                                    $where = "k.idkardextienda=i.idkardextienda ANd i.idventa=v.idventadetalle AND k.idmodelodetalle=mdt.idmodelo  and mdt.stylename = '$idestilo'
and i.estado!='cambiado' AND v.fecha >= '$fechainicio'
    AND v.fecha <= '$fechafin' ";

                                                                    $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                                                                    //  echo $sql2p;
                                                                    //    d
                                                                    $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                                                                    $venta = $almacenA1['resultado'];
                                                                    // $pares=$totalparesiddetalleingreso;
                                                                    if($venta==NULL || $venta =='' || $venta == ""){ $venta="0"; }



                                                                    if($tabla=="historialkardextienda"){
                                                                        $select = "SUM(k.saldocantidad) AS Pares";
                                                                        $from = "historialkardextienda k,modelos mdt";
                                                                        $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.stylename = '$idestilo'  AND k.unido='no' AND k.idperiodo='$idperiodo'";
                                                                        $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                                                                        $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                                                                        $tstockactual = $almacenA1['resultado'];

                                                                    }else{
                                                                        $select = "SUM(k.saldocantidad) AS Pares";
                                                                        $from = "adicionkardextienda k,modelos mdt";
                                                                        $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.stylename = '$idestilo'  AND k.unido='no'";
                                                                        $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                                                                        $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                                                                        $tstockactual = $almacenA1['resultado'];

                                                                    }

                                                                    if($tstockactual==NULL || $tstockactual =='' || $tstockactual == ""){ $tstockactual="0"; }
                                                                    //fin
                                                                    if($tabla=="historialkardextienda"){

                                                                        $select = "SUM(saldocantidad*precio2bs) AS bs";
                                                                        $from = "historialkardextienda k,modelos mdt";
                                                                        $where = "k.idmodelodetalle=mdt.idmodelo AND mdt.stylename = '$idestilo' and k.unido='no' AND k.idperiodo='$idperiodo'";
                                                                        $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                                                                        $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'bs');
                                                                        $totalbsactual = $almacenA1['resultado'];

                                                                    }else{
                                                                        $select = "SUM(k.saldocantidad*precio2bs) AS Pares";
                                                                        $from = "adicionkardextienda k,modelos mdt";
                                                                        $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.stylename = '$idestilo'  AND k.unido='no'";
                                                                        $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                                                                        $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                                                                        $totalbsactual = $almacenA1['resultado'];

                                                                    }

                                                                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$tstockant."&nbsp;</td>";

                                                                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$recibido."&nbsp;</td>";
                                                                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$trasrecibido."&nbsp;</td>";
                                                                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$devueltos."&nbsp;</td>";

                                                                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$trasdesp."&nbsp;</td>";
                                                                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$venta."&nbsp;</td>";
                                                                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$tstockactual."&nbsp;</td>";
                                                                    // $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$totalbsactual."&nbsp;</td>";

                                                                    $devS .= "</tr>";

                                                                    $devS .= "</table>";

                                                                    $dev['mensaje'] = "Existen resultados";
                                                                    $dev['error']   = "true";
                                                                    $dev['resultado'] = $devS;

                                                                }
                                                                else
                                                                {
                                                                    $dev['mensaje'] = "No se encontro datos en la consulta2".mysql_error();
                                                                    $dev['error']   = "false";
                                                                    $dev['resultado'] = "";
                                                                }
                                                            }
                                                            else
                                                            {
                                                                $dev['mensaje'] = "Error en la consulta";
                                                                $dev['error']   = "false";
                                                                $dev['resultado'] = "";
                                                            }
                                                        }
                                                        else
                                                        {
                                                            $dev['mensaje'] = "No se pudo conectar a la BD";
                                                            $dev['error']   = "false";
                                                            $dev['resultado'] = "";
                                                        }
                                                    }
                                                    else
                                                    {
                                                        $dev['mensaje'] = "No se pudo crear la conexion a la BD";
                                                        $dev['error']   = "false";
                                                        $dev['resultado'] = "";
                                                    }
                                                    return $dev;
                                                }

                                                function verdibujotablainventarioestilotallam($idmarca,$idestilo, $idkardex,$return)
                                                {set_time_limit(0);
                                                    $html = "";
                                                    $html .= "<tr><td colspan='4' align='center'>
    <p>Nova Moda S.RL.<br />
         <br />
         Telf. 4-258993  Fax: 4-504183
    </p>
</td></tr>";
                                                    $html .= "<!DOCTYPE HTML PUBLIC '-//W3C//DTD HTML 4.01 Transitional//EN'>";
                                                    $html .= "<html>";
                                                    $html .= "<body>";
                                                    $html .= "<tr>";

                                                    $html .= "<table cellpadding='1' cellspacing='0' border='0' style='width:100%' font-size:11px; font-family:Tahoma;'>";
                                                    $html .= "<td style='width:100%;height:100%;text-align:right;font-size:12px;font-family:Tahoma;'>";
                                                    $html .= "$fecha  $tipo";
                                                    $html .= "</td>";
                                                    $html .= "<tr>";
                                                    $sqlmarca = " SELECT tabla,mesrango,idperiodo,fechainicio,fechafin FROM administrakardex WHERE idkardex = '$idkardex' ";
                                                    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "tabla");
                                                    $tabla = $opcionkardex['resultado'];
                                                    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "mesrango");
                                                    $mesrango = $opcionkardex['resultado'];
                                                    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "idperiodo");
                                                    $idperiodo = $opcionkardex['resultado'];
                                                    //echo $tabla;
                                                    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "fechainicio");
                                                    $fechainicio = $opcionkardex['resultado'];
                                                    $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "fechafin");
                                                    $fechafin = $opcionkardex['resultado'];
                                                    if($fechafin==null ||$fechafin == ""){
                                                        $fechafin = Date("Y-m-d");}

                                                    $formatear = explode( '-' , $fechainicio);
                                                    $fechain = $formatear[2].'-'.$formatear[1].'-' .$formatear[0];
                                                    $formatear = explode( '-' , $fechafin);
                                                    $fechaf = $formatear[2].'-'.$formatear[1].'-' .$formatear[0];

                                                    $sql = "SELECT ma.nombre AS marca,ma.talla,ma.opcionb,ma.pedido
FROM  `marcas` ma
WHERE ma.idmarca = '$idmarca'";

                                                    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'marca');
                                                    $marcalista = $idalmacenA2['resultado'];
                                                    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'talla');
                                                    $opcionmarca = $idalmacenA2['resultado'];
                                                    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'opcionb');
                                                    $opcionb = $idalmacenA2['resultado'];
                                                    $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'pedido');
                                                    $marcapedido = $idalmacenA2['resultado'];
                                                    $idsCAr = split("-", $opcionmarca);

                                                    $sql1 = "SELECT  es.nombre AS estilo
FROM  estilos es
WHERE es.idestilo = '$idestilo'";
                                                    $idalmacenA =  findBySqlReturnCampoUnique($sql1, true, true, 'estilo');
                                                    $estilolista = $idalmacenA['resultado'];
                                                    //paratoma
                                                    $html .= "<td style='width:100%;height:50px;text-align:center;font-size:20px;font-family:Arial;'>";
                                                    $html .= "<b><u>INVENTARIO $marcalista</u></b><br>";
                                                    $html .= "CORRESPONDIENTE DEL $fechain AL $fechaf<br>";
                                                    $html .= "</td>";
                                                    $html .= "</tr>";
                                                    $html .= "<tr>";
                                                    $html .= "<td style='width:100%;height:40px;text-align:left;font-size:20px;font-family:Arial;'>";
                                                    $html .= "<b><u> $estilolista</u></b><br>";
                                                    $html .= "</td>";
                                                    $html .= "</tr>";
                                                    $html .= "</table>";
                                                    $html .= "</tr>";
                                                    $html .= "<tr>";
                                                    $html .= "<td colspan='3'>";
                                                    $html .= "<table width='1250' border='0' cellspacing='0' cellpadding='0'><tr>";
                                                    $html .= "<tr>";
                                                    if($idestilo=="est-19"){
                                                        $iddet1="11";
                                                        $iddet2="26";
                                                    }
                                                    if($idestilo=="est-20"){
                                                        $iddet1="9";
                                                        $iddet2="21";
                                                    }
                                                    if($idestilo=="est-21"){
                                                        $iddet1="1";
                                                        $iddet2="26";
                                                    }
                                                    if($idestilo=="est-102"){
                                                        $iddet1="1";
                                                        $iddet2="26";
                                                    }
                                                    //$iddet1="1";
                                                    //$iddet2="26";
                                                    $rango1=$iddet1;
                                                    $rango2=$iddet2;
                                                    $select = "talla,idmodelo,iddetalleingresotalla,tallasm";
                                                    $from = "tallasdetallem";
                                                    $where = "iddetalleingresotalla >='$iddet1' AND iddetalleingresotalla <='$iddet2' ORDER BY iddetalleingresotalla ASC";
                                                    $sql21 = "SELECT ".$select." FROM ".$from." WHERE ".$where;
                                                    $row = NumeroTuplas($sql21);
                                                    $row1= $row['resultado'];

                                                    $select = "SUM(saldocantidad) AS Pares";
                                                    $from = "historialkardextienda k,modelos mdt";
                                                    $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND mdt.stylename = '$idestilo' AND k.unido='no'";
                                                    $sql2121 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                                                    $almacenA1 =  findBySqlReturnCampoUnique($sql2121, true, true, 'Pares');
                                                    $totalparesestilo = $almacenA1['resultado'];
                                                    $select = "SUM(saldocantidad*precio2bs) AS bs";
                                                    $from = "historialkardextienda k,modelos mdt";
                                                    $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND mdt.stylename = '$idestilo' AND k.unido='no'";
                                                    $sql2121 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                                                    $almacenA1 =  findBySqlReturnCampoUnique($sql2121, true, true, 'bs');
                                                    $totalbsestilo = $almacenA1['resultado'];
                                                    $select = "dtp.iddetalleingreso";
                                                    $from = "adiciondetalleingreso dtp, modelos mdd, coleccion col, estilos es";
                                                    //   $where = "dtp.idmodelo = mdd.idmodelo AND mdd.idcoleccion = col.idcoleccion AND mdd.stylename = es.idestilo AND dtp.unido='no' AND mdd.idmarca = '$idmarca' AND mdd.stylename='$idestilo'";
                                                    $where = "dtp.idmodelo = mdd.idmodelo AND mdd.idcoleccion = col.idcoleccion AND mdd.stylename = es.idestilo AND dtp.unido='no' AND dtp.estado='activo' AND mdd.idmarca = '$idmarca' AND mdd.stylename='$idestilo'";
                                                    switch ($idmarca){
                                                        case "mar-11" :
                                                            $order = "CAST(mdd.codigo AS SIGNED) ASC ,dtp.color ASC";
                                                            break;
                                                            case "mar-13" :
                                                                $order = "CAST(mdd.codigo AS SIGNED) ASC ,dtp.color ASC";
                                                                break;
                                                                case "mar-14" :
                                                                    $order = "CAST(mdd.codigo AS SIGNED) ASC ,dtp.color ASC";
                                                                    break;
                                                                    case "mar-15" :
                                                                        $order = "CAST(mdd.codigo AS SIGNED) ASC ,dtp.color ASC";
                                                                        break;
                                                                        case "mar-27" :
                                                                            $order = "CAST(mdd.codigo AS SIGNED) ASC ,dtp.color ASC";
                                                                            break;
                                                                            case "mar-3" :
                                                                                $order = "CAST(mdd.codigo AS SIGNED) ASC ,dtp.color ASC";
                                                                                break;
                                                                                default:
                                                                                    $order = "CAST(mdd.codigo AS SIGNED) ASC";
                                                                                }

                                                                                $sql25 = "SELECT ".$select." FROM ".$from. " WHERE ".$where."ORDER BY ".$order;
                                                                                $select1 = "COUNT(dtp.iddetalleingreso) AS filas";
                                                                                $from1 = "adiciondetalleingreso dtp, modelos mdd, coleccion col, estilos es";
                                                                                $where1 = "dtp.idmodelo = mdd.idmodelo AND mdd.idcoleccion = col.idcoleccion AND mdd.stylename = es.idestilo AND dtp.unido='no' AND dtp.estado='activo' AND mdd.idmarca = '$idmarca' AND mdd.stylename='$idestilo'";
                                                                                $sql2121 = "SELECT ".$select1." FROM ".$from1. " WHERE ".$where1;
                                                                                $almacenA1 =  findBySqlReturnCampoUnique($sql2121, true, true, 'filas');
                                                                                $numfilas = $almacenA1['resultado'];
                                                                                //echo $sql25;

                                                                                $table = dibujarTuplaOfSQLSimpleinventariotallamnuevo($idkardex,$sql25,$sql21,$row1,$idmarca,$idestilo,$rango1,$rango2,$totalparesestilo,$totalbsestilo, "2",$marcapedido);


                                                                                $html .= $table['resultado'];
                                                                                $html .= "</tr>";


                                                                                $html .= "</table>";
                                                                                $html .= "</body>";
                                                                                $html .= "</html>";
                                                                                if($return == true)
                                                                                {
                                                                                    return $html;
                                                                                }
                                                                                else
                                                                                {
                                                                                    echo $html;
                                                                                }
                                                                            }

                                                                            function verdibujotablainventariotallam($idmarca,$idestilo,$idkardex, $return)
                                                                            {
                                                                                // face="Comic Sans MS, Arial, MS Sans Serif"
                                                                                $html = "";
                                                                                $html .= "<tr><td colspan='4' align='center' font-family='Arial'>
    <p>Nova Moda S.RL.<br />
         <br />
         Telf. 4-258993  Fax: 4-504183
    </p>
</td></tr>";

                                                                                $html .= "<!DOCTYPE HTML PUBLIC '-//W3C//DTD HTML 4.01 Transitional//EN'>";
                                                                                $html .= "<html>";
                                                                                $html .= "<body>";
                                                                                $html .= "<tr>";

                                                                                $html .= "<table cellpadding='1' cellspacing='0' border='0' style='width:100%' font-size:11px; font-family:Tahoma;'>";
                                                                                $html .= "<td style='width:100%;height:100%;text-align:right;font-size:12px;font-family:Tahoma;'>";
                                                                                $html .= "$fecha  $tipo";
                                                                                $html .= "</td>";
                                                                                $html .= "<tr>";
                                                                                $sql = "SELECT ma.nombre AS marca,ma.talla,ma.opcionb,ma.pedido
FROM  `marcas` ma
WHERE ma.idmarca = '$idmarca'";

                                                                                $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'marca');
                                                                                $marcalista = $idalmacenA2['resultado'];
                                                                                $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'talla');
                                                                                $opcionmarca = $idalmacenA2['resultado'];
                                                                                $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'opcionb');
                                                                                $opcionb = $idalmacenA2['resultado'];
                                                                                $idalmacenA2 =  findBySqlReturnCampoUnique($sql, true, true, 'pedido');
                                                                                $marcapedido = $idalmacenA2['resultado'];
                                                                                $idsCAr = split("-", $opcionmarca);
                                                                                $rango1=$idsCAr[0];
                                                                                $rango2=$idsCAr[1];
                                                                                if($opcionmarca="33-45"){
                                                                                    $tipo="1";
                                                                                }else{
                                                                                    if($opcionmarca="14-38"){
                                                                                        $tipo="3";
                                                                                    }
                                                                                }
                                                                                $sqlmarca = " SELECT tabla,mesrango,idperiodo,fechainicio,fechafin FROM administrakardex WHERE idkardex = '$idkardex' ";
                                                                                $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "tabla");
                                                                                $tabla = $opcionkardex['resultado'];
                                                                                $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "mesrango");
                                                                                $mesrango = $opcionkardex['resultado'];
                                                                                $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "idperiodo");
                                                                                $idperiodo = $opcionkardex['resultado'];
                                                                                //echo $tabla;
                                                                                $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "fechainicio");
                                                                                $fechainicio = $opcionkardex['resultado'];
                                                                                $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "fechafin");
                                                                                $fechafin = $opcionkardex['resultado'];
                                                                                if($fechafin==null ||$fechafin == ""){
                                                                                    $fechafin = Date("Y-m-d");}

                                                                                $formatear = explode( '-' , $fechainicio);
                                                                                $fechain = $formatear[2].'-'.$formatear[1].'-' .$formatear[0];
                                                                                $formatear = explode( '-' , $fechafin);
                                                                                $fechaf = $formatear[2].'-'.$formatear[1].'-' .$formatear[0];
                                                                                $html .= "<td style='width:100%;height:100px;text-align:center;font-size:20px;font-family:Arial;'>";
                                                                                $html .= "<b><u>INVENTARIO $marcalista</u></b><br>";
                                                                                $html .= "CORRESPONDIENTE DEL $fechain AL $fechaf<br>";
                                                                                $html .= "</td>";

                                                                                $html .= "</tr>";
                                                                                $html .= "</table>";
                                                                                $html .= "</tr>";
                                                                                $html .= "<tr>";
                                                                                $html .= "<td colspan='3'>";
                                                                                $html .= "<table width='1250' border='0' cellspacing='0' cellpadding='0'><tr>";

                                                                                $select = "idestilo,nombre";
                                                                                $from = "estilos";
                                                                                $where .= " descripcion = '$idmarca' ORDER BY ordennumero ASC";
                                                                                $sql2 = "SELECT ".$select." FROM ".$from." WHERE ".$where;
                                                                                $row = NumeroTuplas($sql2);
                                                                                $row1= $row['resultado'];
                                                                                $sql21 = getTablaToArrayOfSQL($sql2);
                                                                                $sql3 = $sql21['resultado'];
                                                                                $row5 = NumeroTuplas($sql2);
                                                                                $row15= $row5['resultado'];
                                                                                //    $html .= "<td style='width:100%;text-align:center;font-size:1px;font-family:Tahoma;'>";
                                                                                $html .= "<table cellpadding='0' cellspacing='0' border='0' style='width:100%;border:0px solid #000000;font-size:11px;text-align:center'>";
                                                                                $html .= "<tr>";
                                                                                for($i=0;$i<=$row15;$i++){
                                                                                    $codigo = $sql3[$i];
                                                                                    $idestilo = $codigo['idestilo'];
                                                                                    $nombreestilo = $codigo['nombre'];
                                                                                    $html .= "<tr style='width:100%; font-size:13px;'>";
                                                                                    $html .=" <td style='font-size:14px;text-align:left'><b>".$nombreestilo."</b>";
                                                                                    $html .=" </td> ";
                                                                                    $html .= "</tr>";
                                                                                    $html .= "<tr>";
                                                                                    $iddet1="1";
                                                                                    $iddet2="26";
                                                                                    $rango1=$iddet1;
                                                                                    $rango2=$iddet2;
                                                                                    $select = "talla,idmodelo,iddetalleingresotalla,tallasm";
                                                                                    $from = "tallasdetallem";
                                                                                    $where = "iddetalleingresotalla >='$iddet1' AND iddetalleingresotalla <='$iddet2' ORDER BY iddetalleingresotalla ASC";
                                                                                    $sql21 = "SELECT ".$select." FROM ".$from." WHERE ".$where;
                                                                                    $row = NumeroTuplas($sql21);
                                                                                    $row1= $row['resultado'];

                                                                                    $select = "SUM(saldocantidad) AS Pares";
                                                                                    $from = "adicionkardextienda k,modelos mdt";
                                                                                    $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND mdt.stylename = '$idestilo' AND k.unido='no'";
                                                                                    $sql2121 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                                                                                    $almacenA1 =  findBySqlReturnCampoUnique($sql2121, true, true, 'Pares');
                                                                                    $totalparesestilo = $almacenA1['resultado'];
                                                                                    $select = "SUM(saldocantidad*precio2bs) AS bs";
                                                                                    $from = "adicionkardextienda k,modelos mdt";
                                                                                    $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND mdt.stylename = '$idestilo' AND k.unido='no'";
                                                                                    $sql2121 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                                                                                    $almacenA1 =  findBySqlReturnCampoUnique($sql2121, true, true, 'bs');
                                                                                    $totalbsestilo = $almacenA1['resultado'];
                                                                                    if($marcapedido=='CODIGO-COLOR-MATERIAL'){
                                                                                        $order = "mdd.codigo DESC";
                                                                                    }else{
                                                                                        if($marcapedido=="CODIGO-MATERIAL"){
                                                                                            $order = "mdd.codigo DESC";
                                                                                        }else{
                                                                                            if(($marcapedido=="CODIGO-COLOR")||($marcapedido=="CODIGO")){
                                                                                                $order = "mdd.codigo ASC,dtp.color ASC";
                                                                                            }else{
                                                                                                if($marcapedido=="CODIGO-COLOR-STYLENAME"){
                                                                                                    $order = "mdd.codigo DESC";
                                                                                                }else{
                                                                                                    if($marcapedido=="LINEA-CODIGO-COLOR"){
                                                                                                        $order = "mdd.codigo DESC";

                                                                                                    }
                                                                                                }

                                                                                            }
                                                                                        }
                                                                                    }

                                                                                    $select = "dtp.iddetalleingreso";
                                                                                    $from = "adiciondetalleingreso dtp, modelos mdd, coleccion col, estilos es";
                                                                                    $where = "dtp.idmodelo = mdd.idmodelo AND mdd.idcoleccion = col.idcoleccion AND mdd.stylename = es.idestilo AND dtp.unido='no' AND dtp.estado='activo'AND mdd.idmarca = '$idmarca' AND mdd.stylename='$idestilo'";
                                                                                    //$sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where." ORDER BY CAST( `mdd`.`codigo` AS SIGNED) ASC";

                                                                                    $sql25 = "SELECT ".$select." FROM ".$from. " WHERE ".$where."ORDER BY ".$order;
                                                                                    //  echo $sql25;

                                                                                    $table = dibujarTuplaOfSQLSimpleinventariotallamnuevo($idkardex,$sql25,$sql21,$row1,$idmarca,$idestilo,$rango1,$rango2,$totalparesestilo,$totalbsestilo, "2",$marcapedido);

                                                                                    $html .= $table['resultado'];
                                                                                    $html .= "</tr>";
                                                                                    //       ss
                                                                                }
                                                                                //totales de totales
                                                                                $html .= "</tr>";
                                                                                $html .= "</table>";

                                                                                $html .= "<table cellpadding='1' cellspacing='0' border='0' style='width:100%' font-size:25px; font-family:Tahoma;'>";
                                                                                $html .= "<tr style='width:50%;height:50%;text-align:right;font-size:25px;font-family:Tahoma;'>";


                                                                                //   if($tabla=="historialkardextienda"){
                                                                                // $select = "SUM( k.precio2bs * k.saldocantidad) As bs";
                                                                                //    $from = "historialkardextienda k,modelos mdt";
                                                                                //    $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND k.idperiodo='$idperiodo' AND k.unido='no'";
                                                                                //    $sql2121 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                                                                                //
                                                                                //     $almacenA1 =  findBySqlReturnCampoUnique($sql2121, true, true, 'bs');
                                                                                //    $totalparesbs = $almacenA1['resultado'];
                                                                                //
                                                                                //
                                                                                //    $select = "SUM(k.saldocantidad) As par";
                                                                                //    $from = "historialkardextienda k,modelos mdt";
                                                                                //    $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND k.idperiodo='$idperiodo' AND k.unido='no'";
                                                                                //    $sql2121 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                                                                                //
                                                                                //     $almacenA1 =  findBySqlReturnCampoUnique($sql2121, true, true, 'par');
                                                                                //    $totalpares = $almacenA1['resultado'];
                                                                                //    //echo $sql2121;
                                                                                //}else{
                                                                                $select = "SUM( k.precio2bs * k.saldocantidad) As bs";
                                                                                $from = "adicionkardextienda k,modelos mdt";
                                                                                $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND k.unido='no'";
                                                                                $sql2121 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                                                                                $almacenA1 =  findBySqlReturnCampoUnique($sql2121, true, true, 'bs');
                                                                                $totalparesbs = $almacenA1['resultado'];


                                                                                $select = "SUM(k.saldocantidad) As bs";
                                                                                $from = "adicionkardextienda k,modelos mdt";
                                                                                $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND k.unido='no' ";
                                                                                $sql2121 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                                                                                $almacenA1 =  findBySqlReturnCampoUnique($sql2121, true, true, 'bs');
                                                                                $totalpares = $almacenA1['resultado'];
                                                                                //}

                                                                                $html .= "<td style='width:100%;text-align:center;font-size:1px;font-family:Tahoma;'>";
                                                                                $html .= "<table cellpadding='0' cellspacing='0' border='1' style='width:100%;border:1px solid #000000;font-size:11px;text-align:center'>";

                                                                                $html .= "<tr><td style='font-size:11px;font-weight:bold;'>Pares:</td><td>".$totalpares."</td></tr>";
                                                                                $html .= "<tr><td style='font-size:11px;font-weight:bold;'>Bs:</td><td>".$totalparesbs."</td></tr>";
                                                                                $html .= "</table>";

                                                                                $html .= "</td></tr>";

                                                                                //    $producto2 = dibujarTuplaOfSQLSimpleinventario($sqltotalpares,$totalpares,$totalparesbs);
                                                                                //    $html .= $producto2['resultado'];
                                                                                //    $html .= "</tr>";
                                                                                $html .= "</table>";

                                                                                $html .= "</body>";
                                                                                $html .= "</html>";
                                                                                if($return == true)
                                                                                {
                                                                                    return $html;
                                                                                }
                                                                                else
                                                                                {
                                                                                    echo $html;
                                                                                }
                                                                            }
                                                                            function dibujarTuplaOfSQLSimpleinventariotallamnuevo($idkardex,$sql,$sql21,$row1,$idmarca,$idestilo,$rango1,$rango2,$totalpar1,$totalbs1, $tipo,$marcapedido)
                                                                            {
                                                                                $sqlmarca = " SELECT tabla,mesrango,idperiodo,fechainicio,fechafin FROM administrakardex WHERE idkardex = '$idkardex' ";
                                                                                $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "tabla");
                                                                                $tabla = $opcionkardex['resultado'];
                                                                                $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "mesrango");
                                                                                $mesrango = $opcionkardex['resultado'];
                                                                                $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "idperiodo");
                                                                                $idperiodo = $opcionkardex['resultado'];
                                                                                //echo $tabla;
                                                                                $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "fechainicio");
                                                                                $fechainicio = $opcionkardex['resultado'];
                                                                                $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "fechafin");
                                                                                $fechafin = $opcionkardex['resultado'];
                                                                                if($fechafin==null ||$fechafin == ""){
                                                                                    $fechafin = Date("Y-m-d");
                                                                                }

                                                                                //if($tabla=="historialkardextienda"){
                                                                                //}else{
                                                                                $sqlInv = "SELECT MAX(idperiodo)AS numero
FROM administrakardex where tabla='historialkardextienda'";
                                                                                $almacenA1 =  findBySqlReturnCampoUnique($sqlInv, true, true, 'numero');
                                                                                $idperiodoant = $almacenA1['resultado'];
                                                                                $sqlmarca = " SELECT tabla,mesrango,idperiodo,fechainicio,fechafin FROM administrakardex WHERE idperiodo = '$idperiodoant' ";
                                                                                $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "fechainicio");
                                                                                // $fechainicio = $opcionkardex['resultado'];
                                                                                $opcionkardex = findBySqlReturnCampoUnique($sqlmarca, true, true, "fechafin");
                                                                                // $fechafin = $opcionkardex['resultado'];
                                                                                //}
                                                                                $sql211 = getTablaToArrayOfSQL($sql21);
                                                                                $sql3 = $sql211['resultado'];
                                                                                if($link=new BD)
                                                                                {
                                                                                    if($link->conectar())
                                                                                    {
                                                                                        if($re = $link->consulta($sql))
                                                                                        {
                                                                                            //echo mysql_num_rows($re);
                                                                                            if($fi = mysql_fetch_array($re))
                                                                                            {
                                                                                                $devS .= "<table cellpadding='0' cellspacing='0' border='0' style='width:1250px;border:1px solid #000000;font-size:13px;font-family:Arial;'>";

                                                                                                //             $devS .= "<table cellpadding='0' cellspacing='0' border='0' style='width:750px;border:1px solid #000000;font-size:11px;'>";
                                                                                                $devS .= "<tr style='font-size:12px;background-color:silver;'><td style='border-bottom:1px solid #000000;font-weight:bold;font-size:12px;text-align:center;background-color:silver;'>Nro</td>";
                                                                                                $devS .= "<td style='display:none;'>".mysql_field_name($re, $zz)."</td>";
                                                                                                // $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Modelo</td>";
                                                                                                $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;'>Modelo</td>";
                                                                                                $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;'>Color</td>";
                                                                                                $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;'>Precio</td>";
                                                                                                // $devS .= "<td style='border-bottom:2px solid #000000;border-left:2px solid #000000;font-weight:bold;font-size:12px;text-align:center;background-color:silver;'>Modelo</td>";
                                                                                                // $devS .= "<td style='border-bottom:2px solid #000000;border-left:2px solid #000000;font-weight:bold;font-size:12px;text-align:center;background-color:silver;'>Color</td>";
                                                                                                // $devS .= "<td style='border-bottom:2px solid #000000;border-left:2px solid #000000;font-weight:bold;font-size:12px;text-align:center;background-color:silver;'>Precio</td>";
                                                                                                for($hi=0;$hi<$row1;$hi++){
                                                                                                    $codigo = $sql3[$hi];
                                                                                                    $idmmarca = $codigo['talla'];

                                                                                                    $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-size:13px;'>$idmmarca</td>";
                                                                                                    $ji++;
                                                                                                }
                                                                                                $devS .= "<td style='border:1px solid #000000;font-size:12px;background-color:silver;'>Stock Anterior</td>";
                                                                                                //$devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Stock Anterior</td>";

                                                                                                $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Recibido</td>";
                                                                                                $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Trasp Rec</td>";
                                                                                                $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Dev</td>";
                                                                                                $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Trasp Desp</td>";
                                                                                                $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Venta</td>";

                                                                                                $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>Stock Actual</td>";
                                                                                                // $devS .= "<td style='border-bottom:1px solid #000000;border-left:1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'>SBs</td>";

                                                                                                $devS .= "</tr>";
                                                                                                $ii = 0;
                                                                                                //$totalCount = mysql_num_rows($re);
                                                                                                $z = 1;
                                                                                                do{
                                                                                                    $devS .= "<tr><td style='text-align:left'>".$z."</td>";
                                                                                                    for($i = 0; $i< mysql_num_fields($re); $i++)
                                                                                                    {$dato = $fi[$i];
                                                                                                        $iddetalleingreso = $fi[$i]['iddetalleingreso'];
                                                                                                        $devS .= "<td style='display:none;'>&nbsp;".$dato."&nbsp;</td>";
                                                                                                        // echo $marcapedido;
                                                                                                        $select = "dtp.totalbs AS precio";
                                                                                                        $from = "adiciondetalleingreso dtp, modelos mdd, coleccion col, estilos es";
                                                                                                        $where = "dtp.idmodelo = mdd.idmodelo AND mdd.idcoleccion = col.idcoleccion AND mdd.stylename = es.idestilo AND dtp.iddetalleingreso='$dato'";


                                                                                                        switch ($marcapedido){
                                                                                                            case "CODIGO-COLOR" :
                                                                                                                $select .= ",UPPER(mdd.codigo)AS codigo, dtp.color";
                                                                                                                break;
                                                                                                            case "CODIGO" :
                                                                                                                $select .= ",UPPER(mdd.codigo)AS codigo, dtp.color";
                                                                                                                break;
                                                                                                            case "CODIGO-COLOR-STYLENAME" :
                                                                                                                $select .= ",concat(mdd.codigo,'-',dtp.color) AS codigo, dtp.material AS color";
                                                                                                                break;
                                                                                                            default:
                                                                                                                $select .= ",UPPER(mdd.codigo)AS codigo";
                                                                                                            }
                                                                                                            // $from = "adiciondetalleingreso dtp, modelos mdd, coleccion col, estilos es";
                                                                                                            //$where = "dtp.idmodelo = mdd.idmodelo AND mdd.idcoleccion = col.idcoleccion AND mdd.stylename = es.idestilo AND dtp.iddetalleingreso='$dato'";
                                                                                                            $sql2p1 = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                                                                                                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p1, true, true, 'codigo');
                                                                                                            $modelo = $almacenA1['resultado'];
                                                                                                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p1, true, true, 'color');
                                                                                                            $color = $almacenA1['resultado'];
                                                                                                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p1, true, true, 'precio');
                                                                                                            $precio = $almacenA1['resultado'];
                                                                                                            $devS .= "<td style='text-align:left;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$modelo."&nbsp;</td>";
                                                                                                            $devS .= "<td style='text-align:left;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$color."&nbsp;</td>";
                                                                                                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$precio."&nbsp;</td>";


                                                                                                            for($h=0;$h<$row1;$h++){
                                                                                                                $codigo = $sql3[$h];
                                                                                                                $idmmarca = $codigo['talla'];
                                                                                                                //if($tabla=="historialkardextienda"){
                                                                                                                ////if( saldocantidad = '0', '', saldocantidad ) AS Pares
                                                                                                                //        $select1 = "if( saldocantidad = '0', '', saldocantidad ) AS Pares";
                                                                                                                //
                                                                                                                // //$select1 = "saldocantidad AS Pares";
                                                                                                                //    $from1 = "historialkardextienda";
                                                                                                                //    $where1 = "idcalzado = '$dato' AND talla='$idmmarca' AND idperiodo='$idperiodo'";
                                                                                                                //   //if($ltienda != "Todos"){ $where .= " AND ve.idtienda = '$ltienda' ";}
                                                                                                                //    $sql21 = "SELECT ".$select1." FROM ".$from1. " WHERE ".$where1;
                                                                                                                ////echo $sql21;
                                                                                                                //     $almacenA1 =  findBySqlReturnCampoUnique($sql21, true, true, 'Pares');
                                                                                                                //    $pares1 = $almacenA1['resultado'];
                                                                                                                //}else{
                                                                                                                $select1 = "if( saldocantidad = '0', '', saldocantidad ) AS Pares";
                                                                                                                //  $select1 = "saldocantidad AS Pares";
                                                                                                                $from1 = "adicionkardextienda";
                                                                                                                $where1 = "idcalzado = '$dato' AND talla='$idmmarca'";
                                                                                                                //if($ltienda != "Todos"){ $where .= " AND ve.idtienda = '$ltienda' ";}
                                                                                                                $sql21 = "SELECT ".$select1." FROM ".$from1. " WHERE ".$where1;

                                                                                                                $almacenA1 =  findBySqlReturnCampoUnique($sql21, true, true, 'Pares');
                                                                                                                $pares1 = $almacenA1['resultado'];

                                                                                                                //}
                                                                                                                // if($pares1==NULL || $pares1 =='' || $pares1 == ""){ $pares1="0"; }
                                                                                                                $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$pares1."&nbsp;</td>";
                                                                                                                $j++;
                                                                                                            }

                                                                                                            //    if($tabla=="historialkardextienda"){
                                                                                                            //        $sqlInv = "SELECT MAX(idperiodo)AS numero
                                                                                                            //FROM administrakardex where tabla='historialkardextienda'";
                                                                                                            //           $almacenA1 =  findBySqlReturnCampoUnique($sqlInv, true, true, 'numero');
                                                                                                            //    $idperiodoant = $almacenA1['resultado'];
                                                                                                            // $idper = $idperiodoant - 1;
                                                                                                            //      $select = "SUM(saldocantidad) AS Pares";
                                                                                                            //    $from = "historialkardextienda k";
                                                                                                            //    $where = " k.idcalzado='$dato' AND k.idperiodo='$idper' AND k.unido='no'";
                                                                                                            //    $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                                                                                                            //
                                                                                                            //     $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                                                                                                            //    $stockanterior = $almacenA1['resultado'];
                                                                                                            //    }
                                                                                                            //else{
                                                                                                            $sqlInv = "SELECT MAX(idperiodo)AS numero
FROM administrakardex where tabla='historialkardextienda'";
                                                                                                            $almacenA1 =  findBySqlReturnCampoUnique($sqlInv, true, true, 'numero');
                                                                                                            $idperiodoant = $almacenA1['resultado'];
                                                                                                            //  echo $idperiodoant;
                                                                                                            $select = "SUM(saldocantidad) AS Pares";
                                                                                                            $from = "historialkardextienda k";
                                                                                                            $where = " k.idcalzado='$dato' AND k.idperiodo='$idperiodoant' AND k.unido='no'";
                                                                                                            $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                                                                                                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                                                                                                            $stockanterior = $almacenA1['resultado'];

                                                                                                            //}
                                                                                                            //if($stockanterior==NULL || $stockanterior =='' || $stockanterior == ""){ $stockanterior="0"; }


                                                                                                            $select = "SUM( dtpt.cantidad ) AS Pares";
                                                                                                            $from = "adicioningresotienda k, adiciondetalleingresotalla dtpt, adiciondetalleingreso ad, modelos mdd";
                                                                                                            $where = "k.idingreso = dtpt.idingreso AND dtpt.idmodelo = mdd.idmodelo
AND dtpt.iddetalleingreso = ad.iddetalleingreso";
                                                                                                            { $where .= " AND k.fecha >= '$fechainicio' AND
k.fecha <= '$fechafin' AND  dtpt.iddetalleingreso='$dato'";}
                                                                                                            if($idestilo !="null")
                                                                                                            { $where .= " AND mdd.stylename = '$idestilo'";}
                                                                                                            if($idestilo!=null || $idestilo!='')
                                                                                                            { $where .= " AND mdd.stylename = '$idestilo'";}
                                                                                                            $sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where;
                                                                                                            $almacenA1 =  findBySqlReturnCampoUnique($sql25, true, true, 'Pares');
                                                                                                            $recibido = $almacenA1['resultado'];

                                                                                                            //  if($recibido==NULL || $recibido =='' || $recibido == ""){ $recibido="0"; }
                                                                                                            $select = "SUM(i.cantidad) AS Pares";
                                                                                                            $from = "ingresos i,adicionkardextienda k";
                                                                                                            $where = " k.idcalzado='$dato' AND k.idkardextienda=i.idkardextienda AND i.fecha >= '$fechainicio'
    AND i.fecha <= '$fechafin' AND i.detalle2!='ingresoalmacen' ";
                                                                                                            $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                                                                                                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                                                                                                            $trasrecibido = $almacenA1['resultado'];
                                                                                                            //     if($trasrecibido==NULL || $trasrecibido =='' || $trasrecibido == ""){ $trasrecibido="0"; }
                                                                                                            $select = "SUM(i.cantidad) AS Pares";
                                                                                                            $from = "itemventa i,adicionkardextienda k, ventasdetalle v";
                                                                                                            $where = " k.idcalzado='$dato' AND k.idkardextienda=i.idkardextienda ANd i.idventa=v.idventadetalle AND  i.estado='cambiado'
and v.fecha >= '$fechainicio'
    AND v.fecha <= '$fechafin' ";
                                                                                                            $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                                                                                                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                                                                                                            $dev = $almacenA1['resultado'];

                                                                                                            $select = "SUM(i.cantidad) AS Pares";
                                                                                                            $from = "detalletraspaso i,adicionkardextienda k,traspasos tr";
                                                                                                            $where = " k.idcalzado='$dato' AND k.idkardextienda=i.idkardextienda ANd i.idtraspaso=tr.idtraspaso AND tr.fecha >= '$fechainicio'
    AND tr.fecha <= '$fechafin' ";
                                                                                                            $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                                                                                                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                                                                                                            $trasdesp = $almacenA1['resultado'];

                                                                                                            //     if($trasdesp==NULL || $trasdesp =='' || $trasdesp == ""){ $trasdesp="0"; }
                                                                                                            $select = "SUM(i.cantidad) AS Pares";
                                                                                                            $from = "itemventa i,adicionkardextienda k, ventasdetalle v";
                                                                                                            $where = " k.idcalzado='$dato' AND k.idkardextienda=i.idkardextienda ANd i.idventa=v.idventadetalle AND  i.estado!='cambiado'
and v.fecha >= '$fechainicio'
    AND v.fecha <= '$fechafin' ";
                                                                                                            $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                                                                                                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                                                                                                            $venta = $almacenA1['resultado'];
                                                                                                            // $pares=$totalparesiddetalleingreso;
                                                                                                            //     if($venta==NULL || $venta =='' || $venta == ""){ $venta="0"; }
                                                                                                            //   if($tabla=="historialkardextienda"){
                                                                                                            //
                                                                                                            //        $select = "SUM(saldocantidad) AS Pares";
                                                                                                            //    $from = "historialkardextienda k";
                                                                                                            //    $where = " k.idcalzado='$dato' and k.unido='no' AND k.idperiodo='$idperiodo'";
                                                                                                            //    $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                                                                                                            //
                                                                                                            //     $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                                                                                                            //    $pares = $almacenA1['resultado'];
                                                                                                            //}else{
                                                                                                            $select = "SUM(saldocantidad) AS Pares";
                                                                                                            $from = "adicionkardextienda k";
                                                                                                            $where = " k.idcalzado='$dato' and k.unido='no'";
                                                                                                            $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                                                                                                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                                                                                                            $pares = $almacenA1['resultado'];

                                                                                                            //   }
                                                                                                            // if($tabla=="historialkardextienda"){
                                                                                                            //   $select = "SUM(saldocantidad*precio2bs) AS Pares";
                                                                                                            //    $from = "historialkardextienda k";
                                                                                                            //    $where = " k.idcalzado='$dato' and k.unido='no' AND k.idperiodo='$idperiodo'";
                                                                                                            //    $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                                                                                                            //
                                                                                                            //     $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                                                                                                            //    $totalbs = $almacenA1['resultado'];
                                                                                                            //}else{
                                                                                                            $select = "SUM(saldocantidad*precio2bs) AS bs";
                                                                                                            $from = "adicionkardextienda k";
                                                                                                            $where = " k.idcalzado='$dato' and k.unido='no'";
                                                                                                            $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                                                                                                            $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'bs');
                                                                                                            $totalbs = $almacenA1['resultado'];
                                                                                                            //}
                                                                                                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$stockanterior."&nbsp;</td>";
                                                                                                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$recibido."&nbsp;</td>";
                                                                                                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$trasprec."&nbsp;</td>";
                                                                                                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$dev."&nbsp;</td>";
                                                                                                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$trasdesp."&nbsp;</td>";
                                                                                                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$venta."&nbsp;</td>";

                                                                                                            $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$pares."&nbsp;</td>";

                                                                                                            //$devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$totalbsn."&nbsp;</td>";

                                                                                                        }
                                                                                                        $devS .= "</tr>";
                                                                                                        $ii++;
                                                                                                        $z ++;
                                                                                                    }while($fi = mysql_fetch_array($re));
                                                                                                    $devS .= "<tr style='background-color:silver;'><td style='border: 1px solid #000000;font-weight:bold;font-size:11px;text-align:center;background-color:silver;'></td>";
                                                                                                    $devS .= "<td style='display:none;'></td>";
                                                                                                    $fechatoday = Date("d-m-Y");

                                                                                                    $devS .= "<td style='text-align:center;border-bottom: 1px solid #000000;'>TOTAL</td>";
                                                                                                    $devS .= "<td style='text-align:center;border-bottom: 1px solid #000000;'></td>";
                                                                                                    $devS .= "<td style='text-align:center;border-bottom: 1px solid #000000;'></td>";

                                                                                                    for($h=0;$h<$row1;$h++){
                                                                                                        $codigo = $sql3[$h];
                                                                                                        $idmmarca = $codigo['idmarca'];

                                                                                                        $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'></td>";
                                                                                                        $j++;
                                                                                                    }


                                                                                                    //       if($tabla=="historialkardextienda"){
                                                                                                    //        $sqlInv = "SELECT MAX(idperiodo)AS numero
                                                                                                    //FROM administrakardex where tabla='historialkardextienda'";
                                                                                                    //           $almacenA1 =  findBySqlReturnCampoUnique($sqlInv, true, true, 'numero');
                                                                                                    //    $idperiodoant = $almacenA1['resultado'];
                                                                                                    // $idper = $idperiodoant - 1;
                                                                                                    //      $select = "SUM(saldocantidad) AS Pares";
                                                                                                    //    $from = "historialkardextienda k,modelos mdt";
                                                                                                    //    $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND mdt.stylename = '$idestilo' AND k.idperiodo='$idper' AND k.unido='no'";
                                                                                                    //    $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                                                                                                    //
                                                                                                    //     $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                                                                                                    //    $tstockant = $almacenA1['resultado'];
                                                                                                    //    }
                                                                                                    //else{
                                                                                                    $sqlInv = "SELECT MAX(idperiodo)AS numero
FROM administrakardex where tabla='historialkardextienda'";
                                                                                                    $almacenA1 =  findBySqlReturnCampoUnique($sqlInv, true, true, 'numero');
                                                                                                    $idperiodoant = $almacenA1['resultado'];
                                                                                                    $select = "SUM(saldocantidad) AS Pares";
                                                                                                    $from = "historialkardextienda k,modelos mdt";
                                                                                                    $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.idmarca = '$idmarca' AND mdt.stylename = '$idestilo' AND k.idperiodo='$idperiodoant' AND k.unido='no'";
                                                                                                    $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                                                                                                    //echo $sql2p;
                                                                                                    $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                                                                                                    $tstockant = $almacenA1['resultado'];
                                                                                                    //}
                                                                                                    // reseteo
                                                                                                    $select = "SUM( dtpt.cantidad ) AS Pares";
                                                                                                    $from = "adicioningresotienda k, adiciondetalleingresotalla dtpt, adiciondetalleingreso ad, modelos mdd";
                                                                                                    $where = "k.idingreso = dtpt.idingreso AND dtpt.idmodelo = mdd.idmodelo
AND dtpt.iddetalleingreso = ad.iddetalleingreso";
                                                                                                    { $where .= " AND mdd.stylename = '$idestilo' AND k.fecha >= '$fechainicio' AND
k.fecha <= '$fechafin' ";}

                                                                                                    $sql25 = "SELECT ".$select." FROM ".$from." WHERE ".$where;

                                                                                                    $almacenA1 =  findBySqlReturnCampoUnique($sql25, true, true, 'Pares');
                                                                                                    $recibido = $almacenA1['resultado'];
                                                                                                    if($recibido==NULL || $recibido =='' || $recibido == ""){ $recibido="0"; }
                                                                                                    $select = "SUM(i.cantidad) AS Pares";
                                                                                                    $from = "ingresos i,adicionkardextienda k,modelos mdt";
                                                                                                    $where = "k.idkardextienda=i.idkardextienda AND i.fecha >= '$fechainicio'
    AND i.fecha <= '$fechafin' and k.idmodelodetalle=mdt.idmodelo and mdt.stylename = '$idestilo' AND i.detalle2!='ingresoalmacen' ";
                                                                                                    $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                                                                                                    $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                                                                                                    $trasrecibido = $almacenA1['resultado'];
                                                                                                    //  if($trasrecibido==NULL || $trasrecibido =='' || $trasrecibido == ""){ $trasrecibido="0"; }

                                                                                                    $select = "SUM(i.cantidad) AS Pares";
                                                                                                    $from = "detalletraspaso i,adicionkardextienda k,traspasos tr,modelos mdt";
                                                                                                    $where = "  k.idkardextienda=i.idkardextienda ANd i.idtraspaso=tr.idtraspaso  and k.idmodelodetalle=mdt.idmodelo and mdt.stylename = '$idestilo'
AND tr.fecha >= '$fechainicio'
    AND tr.fecha <= '$fechafin' ";
                                                                                                    $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                                                                                                    $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                                                                                                    $trasdesp = $almacenA1['resultado'];

                                                                                                    //  if($trasdesp==NULL || $trasdesp =='' || $trasdesp == ""){ $trasdesp="0"; }
                                                                                                    $select = "SUM(i.cantidad) AS Pares";
                                                                                                    $from = "itemventa i,adicionkardextienda k, ventasdetalle v,modelos mdt";
                                                                                                    $where = "k.idkardextienda=i.idkardextienda ANd i.idventa=v.idventadetalle AND k.idmodelodetalle=mdt.idmodelo  and mdt.stylename = '$idestilo'
and i.estado!='cambiado' AND v.fecha >= '$fechainicio'
    AND v.fecha <= '$fechafin' ";

                                                                                                    $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                                                                                                    //  echo $sql2p;
                                                                                                    //    d
                                                                                                    $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                                                                                                    $venta = $almacenA1['resultado'];
                                                                                                    // $pares=$totalparesiddetalleingreso;
                                                                                                    if($venta==NULL || $venta =='' || $venta == ""){ $venta="0"; }



                                                                                                    //  if($tabla=="historialkardextienda"){
                                                                                                    //       $select = "SUM(k.saldocantidad) AS Pares";
                                                                                                    //    $from = "historialkardextienda k,modelos mdt";
                                                                                                    //    $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.stylename = '$idestilo'  AND k.unido='no' AND k.idperiodo='$idperiodo'";
                                                                                                    //    $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                                                                                                    //
                                                                                                    //     $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                                                                                                    //    $tstockactual = $almacenA1['resultado'];
                                                                                                    //
                                                                                                    // }else{
                                                                                                    $select = "SUM(k.saldocantidad) AS Pares";
                                                                                                    $from = "adicionkardextienda k,modelos mdt";
                                                                                                    $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.stylename = '$idestilo'  AND k.unido='no'";
                                                                                                    $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                                                                                                    $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                                                                                                    $tstockactual = $almacenA1['resultado'];

                                                                                                    //  }

                                                                                                    if($tstockactual==NULL || $tstockactual =='' || $tstockactual == ""){ $tstockactual="0"; }
                                                                                                    //fin
                                                                                                    //if($tabla=="historialkardextienda"){
                                                                                                    //
                                                                                                    //   $select = "SUM(saldocantidad*precio2bs) AS bs";
                                                                                                    //    $from = "historialkardextienda k,modelos mdt";
                                                                                                    //    $where = "k.idmodelodetalle=mdt.idmodelo AND mdt.stylename = '$idestilo' and k.unido='no' AND k.idperiodo='$idperiodo'";
                                                                                                    //    $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                                                                                                    //
                                                                                                    //     $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'bs');
                                                                                                    //    $totalbsactual = $almacenA1['resultado'];
                                                                                                    //
                                                                                                    // }else{
                                                                                                    $select = "SUM(k.saldocantidad*precio2bs) AS Pares";
                                                                                                    $from = "adicionkardextienda k,modelos mdt";
                                                                                                    $where = " k.idmodelodetalle = mdt.idmodelo AND mdt.stylename = '$idestilo'  AND k.unido='no'";
                                                                                                    $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;

                                                                                                    $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                                                                                                    $totalbsactual = $almacenA1['resultado'];

                                                                                                    // }

                                                                                                    if($tstockactual==NULL || $tstockactual =='' || $tstockactual == ""){ $tstockactual="0"; }
                                                                                                    //     style='text-align:left;border-left: 1px solid #000000;border-bottom: 1px solid #000000;

                                                                                                    //         $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$tstockant."&nbsp;</td>";
                                                                                                    $select = "SUM(i.cantidad) AS Pares";
                                                                                                    $from = "itemventa i,adicionkardextienda k, ventasdetalle v,modelos mdt";
                                                                                                    $where = "k.idkardextienda=i.idkardextienda ANd i.idventa=v.idventadetalle AND k.idmodelodetalle=mdt.idmodelo  and mdt.stylename = '$idestilo'
and i.estado ='cambiado' AND v.fecha >= '$fechainicio'
    AND v.fecha <= '$fechafin' ";
                                                                                                    $sql2p = "SELECT ".$select." FROM ".$from. " WHERE ".$where;
                                                                                                    $almacenA1 =  findBySqlReturnCampoUnique($sql2p, true, true, 'Pares');
                                                                                                    $dev1 = $almacenA1['resultado'];
                                                                                                    // $pares=$totalparesiddetalleingreso;
                                                                                                    if($dev1==NULL || $dev1 =='' || $dev1 == ""){ $dev1="0"; }

                                                                                                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$tstockant."&nbsp;</td>";

                                                                                                    $devS .= "<td style='text-align:left;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$recibido."&nbsp;</td>";
                                                                                                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$trasrecibido."&nbsp;</td>";
                                                                                                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$dev1."&nbsp;</td>";

                                                                                                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$trasdesp."&nbsp;</td>";
                                                                                                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$venta."&nbsp;</td>";
                                                                                                    $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border-bottom: 1px solid #000000;'>&nbsp;".$tstockactual."&nbsp;</td>";
                                                                                                    // $devS .= "<td style='text-align:center;border-left: 1px solid #000000;border: 1px solid #000000;'>&nbsp;".$totalbsactual."&nbsp;</td>";

                                                                                                    $devS .= "</tr>";
                                                                                                    $devS .= "</table>";

                                                                                                    $dev['mensaje'] = "Existen resultados";
                                                                                                    $dev['error']   = "true";
                                                                                                    $dev['resultado'] = $devS;

                                                                                                }
                                                                                                else
                                                                                                {
                                                                                                    $dev['mensaje'] = "No se encontro datos en la consulta2".mysql_error();
                                                                                                    $dev['error']   = "false";
                                                                                                    $dev['resultado'] = "";
                                                                                                }
                                                                                            }
                                                                                            else
                                                                                            {
                                                                                                $dev['mensaje'] = "Error en la consulta";
                                                                                                $dev['error']   = "false";
                                                                                                $dev['resultado'] = "";
                                                                                            }
                                                                                        }
                                                                                        else
                                                                                        {
                                                                                            $dev['mensaje'] = "No se pudo conectar a la BD";
                                                                                            $dev['error']   = "false";
                                                                                            $dev['resultado'] = "";
                                                                                        }
                                                                                    }
                                                                                    else
                                                                                    {
                                                                                        $dev['mensaje'] = "No se pudo crear la conexion a la BD";
                                                                                        $dev['error']   = "false";
                                                                                        $dev['resultado'] = "";
                                                                                    }
                                                                                    return $dev;
                                                                                }
                                                                                ?>